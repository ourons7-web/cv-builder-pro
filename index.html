<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<meta name="theme-color" content="#0F766E"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="CV Builder Pro"/>
<meta name="description" content="Build professional CVs — works offline, no internet needed"/>
<title>CV Builder — Free</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&family=Montserrat:wght@400;600;700&family=Raleway:wght@400;600;700&family=EB+Garamond:wght@400;500;600&family=Josefin+Sans:wght@300;400;600;700&family=Nunito+Sans:wght@400;600;700&family=Cormorant+Garamond:wght@400;600;700&display=swap" rel="stylesheet"/>
<!-- jsPDF + html2canvas for watermark PDF download -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<!-- PDF.js for CV import -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<!-- QR Code generator -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
/* ═══════════════════════════════════════════════════
   CV BUILDER PRO — SUPER PREMIUM v2
   Mobile-First · CSS Icons · No Ugly Boxes
═══════════════════════════════════════════════════ */
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
:root{
  --primary:#0D6B5E;
  --primary-2:#0A8F7E;
  --primary-light:#E8F8F5;
  --primary-glow:rgba(13,107,94,.15);
  --bg:#F0F3F8;
  --card:#FFFFFF;
  --border:#E2E8F2;
  --border-2:#EEF2F9;
  --text:#0B1829;
  --text-2:#374558;
  --muted:#7A8BA0;
  --danger:#DC3545;
  --success:#1A9E6A;
  --shadow-sm:0 1px 3px rgba(11,24,41,.06);
  --shadow:0 2px 12px rgba(11,24,41,.08);
  --shadow-lg:0 8px 32px rgba(11,24,41,.12);
  --shadow-xl:0 20px 60px rgba(11,24,41,.18);
  --radius:16px;
  --radius-sm:10px;
  --font:'Inter',-apple-system,'SF Pro Text','Segoe UI',system-ui,sans-serif;
  --sb-bg:#111827;
  --sb-item:rgba(255,255,255,.45);
  --sb-hover:rgba(255,255,255,.06);
  --sb-active-bg:rgba(13,107,94,.2);
  --sb-active:#FFFFFF;
  --topbar-h:58px;
  --bottom-nav-h:62px;
}
html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
body{font-family:var(--font);background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}

/* ═══════════════
   TOPBAR
═══════════════ */
#topbar{
  position:fixed;top:0;left:0;right:0;z-index:200;
  height:var(--topbar-h);
  background:rgba(255,255,255,.96);
  backdrop-filter:blur(24px) saturate(2);
  -webkit-backdrop-filter:blur(24px) saturate(2);
  border-bottom:1px solid rgba(226,232,242,.8);
  display:flex;align-items:center;
  padding:0 16px;gap:12px;
  box-shadow:0 1px 0 rgba(0,0,0,.04),0 4px 16px rgba(11,24,41,.04);
}

/* Logo icon — dark badge */
.logo-icon{
  width:36px;height:36px;flex-shrink:0;
  background:linear-gradient(145deg,#0B1829 0%,#1C2E47 100%);
  border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 2px 8px rgba(11,24,41,.3),inset 0 1px 0 rgba(255,255,255,.08);
}
/* make the CV file SVG lines teal */
.logo-icon svg path[fill="white"]{fill:#1C3A55!important;}
.logo-icon svg path[stroke="#1E293B"],.logo-icon svg line,.logo-icon svg polyline{stroke:#7EEEDD!important;}

.logo-text{
  font-weight:800;font-size:14.5px;
  color:var(--text);letter-spacing:-.5px;line-height:1.2;
}
.logo-text span{
  background:linear-gradient(135deg,#0B1829,#1C2E47);
  color:#7EEEDD;padding:1px 6px;border-radius:5px;
  font-size:12px;font-weight:900;margin-right:2px;
  letter-spacing:.4px;
}
.logo-sub{font-size:10px;color:var(--muted);font-weight:400;line-height:1;}

#slot-select{
  flex:1;max-width:120px;
  padding:7px 28px 7px 10px;
  border:1.5px solid var(--border);border-radius:9px;
  font-size:12px;font-weight:600;color:var(--text);
  background:#F7F9FD url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%237A8BA0' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E") no-repeat right 9px center;
  appearance:none;outline:none;cursor:pointer;
  transition:border-color .15s;
  font-family:var(--font);
}
#slot-select:focus{border-color:var(--primary);}

.topbar-btns{display:flex;gap:6px;margin-left:auto;}
.tbtn{
  padding:8px 14px;border:none;border-radius:9px;
  font-weight:600;font-size:12px;cursor:pointer;
  display:flex;align-items:center;gap:6px;
  white-space:nowrap;font-family:var(--font);
  transition:all .2s cubic-bezier(.25,1,.5,1);
  letter-spacing:-.1px;
}
.tbtn:active{transform:scale(.96);}

.tbtn-primary{
  background:linear-gradient(135deg,var(--primary),var(--primary-2));
  color:#fff;box-shadow:0 2px 10px rgba(13,107,94,.3);
}
.tbtn-primary:hover{box-shadow:0 4px 18px rgba(13,107,94,.4);transform:translateY(-1px);}

.tbtn-dark{
  background:linear-gradient(135deg,#0B1829,#1C2E47);
  color:#F0FFF8;box-shadow:0 2px 10px rgba(11,24,41,.25);
}
.tbtn-dark:hover{box-shadow:0 4px 18px rgba(11,24,41,.35);transform:translateY(-1px);}

.tbtn-light{
  background:#fff;color:var(--text-2);
  border:1.5px solid var(--border);
  box-shadow:var(--shadow-sm);
}
.tbtn-light:hover{border-color:#B8C4D0;background:#F7F9FD;}

.tbtn-wm{
  background:linear-gradient(135deg,#5B21B6,#7C3AED);
  color:#fff;box-shadow:0 2px 10px rgba(124,58,237,.3);
}
.tbtn-wm:hover{box-shadow:0 4px 18px rgba(124,58,237,.4);transform:translateY(-1px);}

.tbtn-danger{
  background:#FFF5F5;color:var(--danger);
  border:1.5px solid #FED7D7;
}
.tbtn-danger:hover{background:var(--danger);color:#fff;border-color:transparent;box-shadow:0 4px 16px rgba(220,53,69,.3);}

/* ═══════════════
   LAYOUT
═══════════════ */
#app{padding-top:var(--topbar-h);display:flex;min-height:100vh;}

#sidebar{
  width:230px;flex-shrink:0;
  background:var(--sb-bg);
  position:fixed;top:var(--topbar-h);left:0;bottom:0;
  overflow-y:auto;overflow-x:hidden;
  display:flex;flex-direction:column;
  z-index:150;
  box-shadow:2px 0 24px rgba(0,0,0,.18);
}
#sidebar::-webkit-scrollbar{width:2px;}
#sidebar::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:4px;}

#main-content{
  margin-left:230px;flex:1;
  padding:22px 20px 30px;
  min-height:calc(100vh - var(--topbar-h));
  max-width:720px;
}

#right-panel{
  width:360px;flex-shrink:0;
  position:sticky;top:var(--topbar-h);
  height:calc(100vh - var(--topbar-h));
  overflow-y:auto;padding:18px 16px 18px;
  display:flex;flex-direction:column;gap:14px;
  background:var(--bg);
  border-left:1px solid var(--border);
}
#right-panel::-webkit-scrollbar{width:3px;}
#right-panel::-webkit-scrollbar-thumb{background:#D4DCE8;border-radius:4px;}

/* ═══════════════
   SIDEBAR — Dark
═══════════════ */
.sidebar-section{
  padding:22px 16px 6px;
  font-size:8.5px;font-weight:800;
  color:rgba(255,255,255,.2);
  text-transform:uppercase;letter-spacing:2.5px;
}

.nav-item{
  display:flex;align-items:center;gap:12px;
  padding:10px 16px;margin:2px 8px;
  border-radius:10px;cursor:pointer;
  font-size:13px;font-weight:500;
  color:var(--sb-item);
  transition:all .18s cubic-bezier(.25,1,.5,1);
  position:relative;
}
.nav-item:hover{background:var(--sb-hover);color:rgba(255,255,255,.8);}
.nav-item.active{
  background:var(--sb-active-bg);
  color:var(--sb-active);font-weight:600;
}
/* Active left bar */
.nav-item.active::before{
  content:'';position:absolute;
  left:0;top:8px;bottom:8px;width:3px;
  background:linear-gradient(180deg,var(--primary-2),#2DD4BF);
  border-radius:0 3px 3px 0;
  box-shadow:0 0 8px rgba(13,143,126,.6);
}

/* Nav icons via data-page — using background SVG */
.nav-item .icon{
  width:20px;height:20px;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;
  font-size:0;
  opacity:.7;
  transition:opacity .18s;
}
.nav-item.active .icon,.nav-item:hover .icon{opacity:1;}
.nav-item .icon::before{
  content:'';display:block;
  width:18px;height:18px;
  background-size:contain;background-repeat:no-repeat;
  background-position:center;
  filter:brightness(0) invert(1);
}

/* Person icon — Personal */
.nav-item[data-page="personal"] .icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2'/%3E%3Ccircle cx='12' cy='7' r='4'/%3E%3C/svg%3E");
}
/* Briefcase — Experience */
.nav-item[data-page="experience"] .icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='2' y='7' width='20' height='14' rx='2' ry='2'/%3E%3Cpath d='M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16'/%3E%3C/svg%3E");
}
/* Graduation cap — Education */
.nav-item[data-page="education"] .icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolygon points='12 2 22 8.5 12 15 2 8.5'/%3E%3Cpath d='M22 8.5V15'/%3E%3Cpath d='M6 11.5v5a6 6 0 0012 0v-5'/%3E%3C/svg%3E");
}
/* Star — Skills */
.nav-item[data-page="skills"] .icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01z'/%3E%3C/svg%3E");
}
/* Sliders — Extras */
.nav-item[data-page="extras"] .icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='4' y1='21' x2='4' y2='14'/%3E%3Cline x1='4' y1='10' x2='4' y2='3'/%3E%3Cline x1='12' y1='21' x2='12' y2='12'/%3E%3Cline x1='12' y1='8' x2='12' y2='3'/%3E%3Cline x1='20' y1='21' x2='20' y2='16'/%3E%3Cline x1='20' y1='12' x2='20' y2='3'/%3E%3Cline x1='1' y1='14' x2='7' y2='14'/%3E%3Cline x1='9' y1='8' x2='15' y2='8'/%3E%3Cline x1='17' y1='16' x2='23' y2='16'/%3E%3C/svg%3E");
}
/* Palette — Design */
.nav-item[data-page="design"] .icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='13.5' cy='6.5' r='0.5' fill='white'/%3E%3Ccircle cx='17.5' cy='10.5' r='0.5' fill='white'/%3E%3Ccircle cx='8.5' cy='7.5' r='0.5' fill='white'/%3E%3Ccircle cx='6.5' cy='12.5' r='0.5' fill='white'/%3E%3Cpath d='M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 011.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z'/%3E%3C/svg%3E");
}
/* Upload — Import */
.nav-item[data-page="cvimport"] .icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4'/%3E%3Cpolyline points='17 8 12 3 7 8'/%3E%3Cline x1='12' y1='3' x2='12' y2='15'/%3E%3C/svg%3E");
}
/* Download backup */
#nav-backup .icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4'/%3E%3Cpolyline points='7 10 12 15 17 10'/%3E%3Cline x1='12' y1='15' x2='12' y2='3'/%3E%3C/svg%3E");
}
/* Restore backup */
#nav-restore .icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='1 4 1 10 7 10'/%3E%3Cpath d='M3.51 15a9 9 0 102.13-9.36L1 10'/%3E%3C/svg%3E");
}

.nav-footer{
  margin-top:auto;
  padding:16px;
  font-size:10.5px;color:rgba(255,255,255,.18);
  border-top:1px solid rgba(255,255,255,.05);
  line-height:1.8;
}

/* ═══════════════
   CARDS
═══════════════ */
.page{display:none;}.page.active{display:block;}

.card{
  background:var(--card);
  border-radius:var(--radius);
  border:1px solid var(--border-2);
  margin-bottom:12px;
  overflow:hidden;
  box-shadow:var(--shadow-sm);
  transition:box-shadow .2s,transform .2s;
}
.card:hover{box-shadow:var(--shadow);}

.card-header{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 16px;background:#fff;
  border-bottom:1px solid transparent;
  cursor:pointer;user-select:none;
  transition:background .15s;
}
.card-header:hover{background:#FAFBFF;}
.card-header-left{display:flex;align-items:center;gap:11px;}

/* ── THE FIX: Card icon — NOT a box, a proper colored icon badge ── */
.card-icon{
  display:inline-flex;align-items:center;justify-content:center;
  width:32px;height:32px;flex-shrink:0;
  border-radius:9px;
  font-size:0;
  background:linear-gradient(145deg,#EEF8F6,#E2F4F1);
  box-shadow:0 1px 3px rgba(13,107,94,.1);
  position:relative;
  overflow:visible;
}
/* Default inner icon shape */
.card-icon::after{
  content:'';display:block;
  width:16px;height:16px;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%230D6B5E' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='18' height='18' rx='2'/%3E%3Cline x1='9' y1='9' x2='15' y2='9'/%3E%3Cline x1='9' y1='13' x2='15' y2='13'/%3E%3C/svg%3E") no-repeat center/contain;
}

/* Specific icons by card title — using adjacent sibling targeting trick */
/* Profile Photo & Name → person */
.card-header-left:has(> .card-title:first-child + *){} /* fallback */
/* We use nth-child within each page section */

/* page-personal cards */
#page-personal .card:nth-child(2) .card-icon{background:linear-gradient(145deg,#EEF1FC,#E2E8FA);}
#page-personal .card:nth-child(2) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%232563EB' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2'/%3E%3Ccircle cx='12' cy='7' r='4'/%3E%3C/svg%3E");
}
#page-personal .card:nth-child(3) .card-icon{background:linear-gradient(145deg,#F0FBF0,#E2F5E2);}
#page-personal .card:nth-child(3) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23059669' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 9.81 19.79 19.79 0 01.12 1.22 2 2 0 012.11 0h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L6.91 7.2a16 16 0 006.29 6.29l1.36-.85a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z'/%3E%3C/svg%3E");
}
#page-personal .card:nth-child(4) .card-icon{background:linear-gradient(145deg,#FFF8EC,#FEF0D6);}
#page-personal .card:nth-child(4) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23D97706' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='2' y='5' width='20' height='14' rx='2'/%3E%3Cline x1='2' y1='10' x2='22' y2='10'/%3E%3C/svg%3E");
}
#page-personal .card:nth-child(5) .card-icon{background:linear-gradient(145deg,#F3EEFF,#EAE0FC);}
#page-personal .card:nth-child(5) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%237C3AED' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z'/%3E%3Cpolyline points='14 2 14 8 20 8'/%3E%3Cline x1='16' y1='13' x2='8' y2='13'/%3E%3Cline x1='16' y1='17' x2='8' y2='17'/%3E%3C/svg%3E");
}

/* page-skills cards */
#page-skills .card:nth-child(2) .card-icon{background:linear-gradient(145deg,#FFFBEC,#FFF4CC);}
#page-skills .card:nth-child(2) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23B45309' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01z'/%3E%3C/svg%3E");
}
#page-skills .card:nth-child(3) .card-icon{background:linear-gradient(145deg,#F0F9FF,#E0F2FE);}
#page-skills .card:nth-child(3) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%230284C7' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='8' r='6'/%3E%3Cpath d='M15.477 12.89L17 22l-5-3-5 3 1.523-9.11'/%3E%3C/svg%3E");
}
#page-skills .card:nth-child(4) .card-icon{background:linear-gradient(145deg,#FFF5F5,#FFE4E4);}
#page-skills .card:nth-child(4) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23DC2626' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='8' y1='6' x2='21' y2='6'/%3E%3Cline x1='8' y1='12' x2='21' y2='12'/%3E%3Cline x1='8' y1='18' x2='21' y2='18'/%3E%3Cline x1='3' y1='6' x2='3.01' y2='6'/%3E%3Cline x1='3' y1='12' x2='3.01' y2='12'/%3E%3Cline x1='3' y1='18' x2='3.01' y2='18'/%3E%3C/svg%3E");
}

/* page-extras cards */
#page-extras .card:nth-child(2) .card-icon{background:linear-gradient(145deg,#EEF8F6,#DCF5F1);}
#page-extras .card:nth-child(2) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%230D6B5E' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='3'/%3E%3Cpath d='M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z'/%3E%3C/svg%3E");
}
#page-extras .card:nth-child(3) .card-icon{background:linear-gradient(145deg,#F3EEFF,#EDE0FC);}
#page-extras .card:nth-child(3) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%237C3AED' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M4 7V4h16v3'/%3E%3Cpath d='M9 20h6'/%3E%3Cpath d='M12 4v16'/%3E%3C/svg%3E");
}
#page-extras .card:nth-child(4) .card-icon{background:linear-gradient(145deg,#FFF8EC,#FEF0D6);}
#page-extras .card:nth-child(4) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23D97706' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cline x1='4' y1='21' x2='4' y2='14'/%3E%3Cline x1='4' y1='10' x2='4' y2='3'/%3E%3Cline x1='12' y1='21' x2='12' y2='12'/%3E%3Cline x1='12' y1='8' x2='12' y2='3'/%3E%3Cline x1='20' y1='21' x2='20' y2='16'/%3E%3Cline x1='20' y1='12' x2='20' y2='3'/%3E%3Cline x1='1' y1='14' x2='7' y2='14'/%3E%3Cline x1='9' y1='8' x2='15' y2='8'/%3E%3Cline x1='17' y1='16' x2='23' y2='16'/%3E%3C/svg%3E");
}
#page-extras .card:nth-child(5) .card-icon{background:linear-gradient(145deg,#F0F9FF,#E0F2FE);}
#page-extras .card:nth-child(5) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%230284C7' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='7' height='7'/%3E%3Crect x='14' y='3' width='7' height='7'/%3E%3Crect x='14' y='14' width='7' height='7'/%3E%3Crect x='3' y='14' width='7' height='7'/%3E%3C/svg%3E");
}

/* page-design cards */
#page-design .card:nth-child(2) .card-icon{background:linear-gradient(145deg,#EEF1FC,#E2E8FA);}
#page-design .card:nth-child(2) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%232563EB' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='7' height='9'/%3E%3Crect x='14' y='3' width='7' height='5'/%3E%3Crect x='14' y='12' width='7' height='9'/%3E%3Crect x='3' y='16' width='7' height='5'/%3E%3C/svg%3E");
}
#page-design .card:nth-child(3) .card-icon{background:linear-gradient(145deg,#FFF8EC,#FEF0D6);}
#page-design .card:nth-child(3) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23D97706' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='4'/%3E%3Cpath d='M4 12h.01M20 12h.01M12 4v.01M12 20v.01M6.34 6.34l.01.01M17.66 17.66l.01.01M17.66 6.34l.01.01M6.34 17.66l.01.01'/%3E%3C/svg%3E");
}
#page-design .card:nth-child(4) .card-icon{background:linear-gradient(145deg,#F3EEFF,#EDE0FC);}
#page-design .card:nth-child(4) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%237C3AED' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M4 7V4h16v3M9 20h6M12 4v16'/%3E%3C/svg%3E");
}

/* page-import cards */
#page-cvimport .card:nth-child(2) .card-icon{background:linear-gradient(145deg,#EEF8F6,#DCF5F1);}
#page-cvimport .card:nth-child(2) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%230D6B5E' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4'/%3E%3Cpolyline points='17 8 12 3 7 8'/%3E%3Cline x1='12' y1='3' x2='12' y2='15'/%3E%3C/svg%3E");
}
#page-cvimport .card:nth-child(3) .card-icon{background:linear-gradient(145deg,#F0F9FF,#E0F2FE);}
#page-cvimport .card:nth-child(3) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%230284C7' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cline x1='12' y1='8' x2='12' y2='12'/%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'/%3E%3C/svg%3E");
}

/* page-import backup/restore cards */
#page-import .card:nth-child(2) .card-icon{background:linear-gradient(145deg,#EEF8F6,#DCF5F1);}
#page-import .card:nth-child(2) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%230D6B5E' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4'/%3E%3Cpolyline points='7 10 12 15 17 10'/%3E%3Cline x1='12' y1='15' x2='12' y2='3'/%3E%3C/svg%3E");
}
#page-import .card:nth-child(3) .card-icon{background:linear-gradient(145deg,#FFF5F5,#FFE4E4);}
#page-import .card:nth-child(3) .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23DC2626' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='3 6 5 6 21 6'/%3E%3Cpath d='M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a1 1 0 011-1h4a1 1 0 011 1v2'/%3E%3C/svg%3E");
}

/* Experience / Education cards — generated dynamically, use fallback */
#page-experience .card .card-icon{background:linear-gradient(145deg,#EEF1FC,#E2E8FA);}
#page-experience .card .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%232563EB' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='2' y='7' width='20' height='14' rx='2'/%3E%3Cpath d='M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16'/%3E%3C/svg%3E");
}
#page-education .card .card-icon{background:linear-gradient(145deg,#F0FBF0,#E2F5E2);}
#page-education .card .card-icon::after{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23059669' stroke-width='2.2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolygon points='12 2 22 8.5 12 15 2 8.5'/%3E%3Cpath d='M22 8.5V15M6 11.5v5a6 6 0 0012 0v-5'/%3E%3C/svg%3E");
}

.card-title{font-weight:600;font-size:14px;color:var(--text);letter-spacing:-.2px;}

.chevron{
  color:#C2CDD8;font-size:0;
  width:22px;height:22px;
  display:flex;align-items:center;justify-content:center;
  border-radius:6px;background:#F2F5FB;
  flex-shrink:0;
  transition:all .22s cubic-bezier(.25,1,.5,1);
  position:relative;
}
.chevron::before{
  content:'';display:block;
  width:8px;height:8px;
  border-right:2px solid #94A3B8;
  border-bottom:2px solid #94A3B8;
  transform:rotate(45deg);
  margin-top:-3px;
  transition:transform .22s;
}
.chevron.up{background:var(--primary-light);}
.chevron.up::before{
  transform:rotate(-135deg);
  margin-top:3px;
  border-color:var(--primary);
}

.card-body{padding:18px;}
.card-body.collapsed{display:none;}

/* ═══════════════
   FORMS
═══════════════ */
.field{margin-bottom:14px;}
.field label{
  display:block;font-size:10.5px;font-weight:700;
  color:var(--muted);text-transform:uppercase;
  letter-spacing:.9px;margin-bottom:6px;
}
.field label span.req{color:var(--danger);}
.field input,.field textarea,.field select{
  width:100%;padding:11px 13px;
  border:1.5px solid var(--border);border-radius:10px;
  font-size:14px;color:var(--text);
  background:#FAFCFF;outline:none;
  font-family:var(--font);
  transition:border-color .18s,box-shadow .18s,background .15s;
}
.field input::placeholder,.field textarea::placeholder{color:#B4BECC;font-size:13.5px;}
.field input:focus,.field textarea:focus,.field select:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(13,107,94,.1);
  background:#fff;
}
.field textarea{resize:vertical;min-height:80px;line-height:1.6;}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:11px;}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}

/* ═══════════════
   ENTRY BLOCKS
═══════════════ */
.entry-block{
  background:linear-gradient(180deg,#FAFCFF,#F5F8FD);
  border:1px solid var(--border-2);border-radius:12px;
  padding:16px;margin-bottom:12px;
  transition:border-color .15s;
}
.entry-block:focus-within{border-color:rgba(13,107,94,.25);}
.entry-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}
.entry-num{
  font-weight:700;font-size:10.5px;color:var(--primary);
  text-transform:uppercase;letter-spacing:1.2px;
  padding:3px 11px;background:var(--primary-light);
  border-radius:99px;border:1px solid rgba(13,107,94,.15);
}
.entry-actions{display:flex;gap:6px;}
.icon-btn{
  padding:6px 11px;border:1px solid var(--border);
  border-radius:8px;background:#fff;cursor:pointer;
  font-size:12px;color:var(--muted);
  font-family:var(--font);font-weight:500;
  transition:all .15s;
}
.icon-btn:hover{border-color:var(--primary);color:var(--primary);background:var(--primary-light);}
.icon-btn.danger:hover{border-color:var(--danger);color:var(--danger);background:#FFF5F5;}
.icon-btn.danger::before{content:'✕';font-size:11px;}

/* ═══════════════
   BULLETS
═══════════════ */
.bullet-wrap{margin-bottom:10px;}
.bullet-label{
  font-size:10.5px;font-weight:700;color:var(--muted);
  text-transform:uppercase;letter-spacing:.9px;
  margin-bottom:7px;
  display:flex;align-items:center;justify-content:space-between;
}
.bullet-row{display:flex;gap:7px;margin-bottom:5px;align-items:center;}
.bullet-row input{
  flex:1;padding:9px 12px;
  border:1.5px solid var(--border);border-radius:8px;
  font-size:13.5px;outline:none;
  font-family:var(--font);background:#fff;color:var(--text);
  transition:border-color .15s;
}
.bullet-row input::placeholder{color:#B4BECC;}
.bullet-row input:focus{border-color:var(--primary);}
.bullet-del{
  background:none;border:none;color:#CBD5E1;
  cursor:pointer;font-size:16px;padding:4px;
  border-radius:5px;transition:all .15s;line-height:1;
}
.bullet-del:empty::before{content:'✕';font-size:14px;}
.bullet-del:hover{color:var(--danger);background:#FFF5F5;}
.add-bullet-btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:7px 14px;background:none;
  border:1.5px dashed #C4D0DF;border-radius:8px;
  color:var(--muted);font-size:12px;font-weight:600;
  cursor:pointer;margin-top:3px;
  font-family:var(--font);transition:all .15s;
}
.add-bullet-btn:hover{border-color:var(--primary);color:var(--primary);background:var(--primary-light);}
.suggest-btn{
  padding:5px 11px;background:var(--primary-light);
  border:1px solid rgba(13,107,94,.2);border-radius:7px;
  color:var(--primary);font-size:11px;font-weight:700;
  cursor:pointer;font-family:var(--font);transition:all .15s;
}
.suggest-btn:hover{background:var(--primary);color:#fff;}

/* ═══════════════
   ADD BUTTONS
═══════════════ */
.add-entry-btn{
  display:flex;align-items:center;justify-content:center;gap:8px;
  width:100%;padding:13px;background:#fff;
  border:1.5px dashed #C4D0DF;border-radius:12px;
  color:var(--muted);font-weight:600;font-size:13px;
  cursor:pointer;font-family:var(--font);
  transition:all .2s;margin-bottom:6px;
  box-shadow:var(--shadow-sm);
}
.add-entry-btn:hover{
  border-color:var(--primary);color:var(--primary);
  background:var(--primary-light);box-shadow:none;
}

/* ═══════════════
   TOGGLES
═══════════════ */
.toggle-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:13px 0;border-bottom:1px solid var(--border-2);gap:14px;
}
.toggle-row:last-child{border-bottom:none;}
.toggle-info{display:flex;flex-direction:column;flex:1;min-width:0;}
.toggle-info label{font-weight:600;font-size:13.5px;cursor:pointer;color:var(--text);}
.toggle-info span{font-size:11.5px;color:var(--muted);margin-top:2px;}
.switch{position:relative;width:46px;height:26px;flex-shrink:0;display:inline-block;}
.switch input{opacity:0;width:0;height:0;position:absolute;}
.slider{
  position:absolute;inset:0;background:#D5DDE8;
  border-radius:26px;cursor:pointer;transition:background .22s;
}
.slider::after{
  content:'';position:absolute;
  width:20px;height:20px;top:3px;left:3px;
  background:#fff;border-radius:50%;
  transition:transform .22s cubic-bezier(.25,1,.5,1);
  box-shadow:0 1px 4px rgba(0,0,0,.2);
}
input:checked + .slider{background:var(--primary);}
input:checked + .slider::after{transform:translateX(20px);}

/* ═══════════════
   PHOTO ZONE
═══════════════ */
#photo-zone{
  width:100%;height:130px;
  border:2px dashed #C4D0DF;border-radius:12px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  cursor:pointer;transition:all .2s;
  background:linear-gradient(180deg,#FAFCFF,#F2F6FC);
  overflow:hidden;position:relative;
}
#photo-zone:hover{border-color:var(--primary);background:var(--primary-light);}
#photo-zone img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;}
#photo-zone .overlay{
  position:absolute;inset:0;background:rgba(11,24,41,.4);
  display:none;align-items:center;justify-content:center;
  color:#fff;font-weight:700;font-size:13px;backdrop-filter:blur(2px);
}
#photo-zone:hover .overlay{display:flex;}

/* CSS Person placeholder */
.photo-placeholder{display:flex;flex-direction:column;align-items:center;gap:10px;}
.photo-placeholder span{
  font-size:0;
  width:44px;height:44px;
  position:relative;display:block;
}
.photo-placeholder span::before{
  content:'';position:absolute;
  left:50%;transform:translateX(-50%);top:0;
  width:20px;height:20px;border-radius:50%;
  border:2px solid #A0B0C8;
}
.photo-placeholder span::after{
  content:'';position:absolute;
  left:50%;transform:translateX(-50%);bottom:0;
  width:34px;height:18px;
  border-radius:10px 10px 0 0;
  border:2px solid #A0B0C8;border-bottom:none;
}
.photo-placeholder p{font-size:12.5px;font-weight:600;color:var(--muted);}

/* ═══════════════
   CV STRENGTH CARD
═══════════════ */
#strength-card{
  background:var(--card);border-radius:var(--radius);
  border:1px solid var(--border-2);padding:18px;
  box-shadow:var(--shadow);
}
#strength-card h3{
  font-size:13px;font-weight:700;margin-bottom:14px;
  display:flex;align-items:center;gap:9px;color:var(--text);
}
#strength-card h3::before{
  content:'';flex-shrink:0;
  width:20px;height:20px;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%230D6B5E' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M22 11.08V12a10 10 0 11-5.93-9.14'/%3E%3Cpolyline points='22 4 12 14.01 9 11.01'/%3E%3C/svg%3E") no-repeat center/contain;
  display:block;
}
.score-ring{display:flex;flex-direction:column;align-items:center;margin-bottom:14px;}
.score-num{font-size:42px;font-weight:800;color:var(--primary);letter-spacing:-3px;line-height:1;}
.score-label{font-size:11px;color:var(--muted);font-weight:500;margin-top:3px;}
.score-bar{width:100%;height:7px;background:#EBF0F7;border-radius:7px;overflow:hidden;margin-bottom:14px;}
.score-fill{height:100%;border-radius:7px;background:linear-gradient(90deg,var(--primary),#2DD4BF);transition:width .5s cubic-bezier(.25,1,.5,1);}
.score-item{display:flex;align-items:center;gap:9px;padding:5px 0;font-size:12px;border-bottom:1px solid #F2F5F9;color:#4A5A6C;}
.score-item:last-child{border:none;}
.score-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}

/* ═══════════════
   PREVIEW CARD
═══════════════ */
#preview-card{
  background:var(--card);border-radius:var(--radius);
  border:1px solid var(--border-2);padding:14px;
  box-shadow:var(--shadow);
}
#preview-card h3{
  font-size:13px;font-weight:700;margin-bottom:12px;
  display:flex;align-items:center;gap:9px;color:var(--text);
}
#preview-card h3::before{
  content:'';flex-shrink:0;
  width:20px;height:20px;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%230D6B5E' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z'/%3E%3Cpolyline points='14 2 14 8 20 8'/%3E%3Cline x1='16' y1='13' x2='8' y2='13'/%3E%3Cline x1='16' y1='17' x2='8' y2='17'/%3E%3C/svg%3E") no-repeat center/contain;
  display:block;
}
#preview-wrap{
  width:100%;overflow:hidden;
  border:1px solid var(--border);border-radius:8px;
  background:#DDE2EA;position:relative;max-height:500px;
  overflow-y:auto;
}
#preview-sizer{position:relative;width:100%;}
#preview-iframe{width:595px;border:none;transform-origin:top left;display:block;position:absolute;top:0;left:0;}

/* ═══════════════
   TEMPLATE PICKER
═══════════════ */
.tpl-grid{display:grid;grid-template-columns:1fr 1fr;gap:11px;}
@media(max-width:360px){.tpl-grid{grid-template-columns:1fr;}}
.tpl-card{
  border:1.5px solid var(--border-2);border-radius:13px;
  padding:15px 13px 13px;cursor:pointer;
  transition:all .2s cubic-bezier(.25,1,.5,1);
  position:relative;background:#FAFCFF;
  box-shadow:var(--shadow-sm);overflow:visible;
}
.tpl-card::before{
  content:'';position:absolute;inset:0;opacity:0;
  transition:opacity .2s;
  pointer-events:none;
  background:linear-gradient(135deg,rgba(13,107,94,.04) 0%,transparent 100%);
}
.tpl-card:hover{border-color:var(--primary);box-shadow:0 4px 20px rgba(13,107,94,.12);transform:translateY(-2px);}
.tpl-card:hover::before{opacity:1;}
.tpl-card.active{border-color:var(--primary);background:#fff;box-shadow:0 0 0 3px rgba(13,107,94,.12),0 4px 20px rgba(13,107,94,.1);}
.tpl-card.active::before{opacity:1;}
.tpl-bar{height:3px;border-radius:99px;margin-bottom:10px;width:60%;}
.tpl-name{font-weight:700;font-size:12px;margin-bottom:3px;color:var(--text);letter-spacing:-.2px;padding-top:6px;}
.tpl-desc{font-size:10px;color:#94A3B8;line-height:1.4;}
.tpl-demo-tag{
  display:inline-flex;align-items:center;gap:5px;
  margin-top:10px;font-size:9.5px;font-weight:700;
  color:var(--primary);padding:3px 9px;
  border:1px solid rgba(13,107,94,.2);border-radius:99px;
  background:rgba(13,107,94,.05);transition:all .15s;
  letter-spacing:.3px;text-transform:uppercase;
}
.tpl-demo-tag:hover{background:rgba(13,107,94,.12);}
.tpl-tier-badge{
  position:absolute;top:10px;right:10px;
  padding:2px 8px;font-size:8px;font-weight:700;
  border-radius:99px;letter-spacing:.5px;text-transform:uppercase;pointer-events:none;
}
.tpl-free-badge{background:#ECFDF5;color:#047857;border:1px solid #A7F3D0;}
.tpl-paid-badge{background:linear-gradient(120deg,#0B1829,#1C2E47);color:rgba(255,255,255,.9);}
.tpl-card.active .tpl-name{color:var(--primary);}

/* ═══════════════
   COLOR PICKER
═══════════════ */
.color-grid,.ds-swatches{display:flex;flex-wrap:wrap;gap:9px;padding:2px 0;}
.color-dot{
  width:32px;height:32px;border-radius:50%;cursor:pointer;
  border:3px solid transparent;transition:all .18s;
  box-shadow:0 1px 5px rgba(0,0,0,.18);flex-shrink:0;
}
.color-dot.active{
  transform:scale(1.18);
  box-shadow:0 0 0 3px #fff,0 0 0 5.5px currentColor,0 2px 8px rgba(0,0,0,.2);
}
.color-dot:hover:not(.active){ transform:scale(1.1); }
#custom-color,#custom-header-color{
  width:32px;height:32px;border-radius:50%;cursor:pointer;
  border:2.5px solid #D4DCE8;padding:0;flex-shrink:0;
  background:conic-gradient(red,yellow,lime,cyan,blue,magenta,red);
  transition:transform .18s;
}
#custom-color:hover,#custom-header-color:hover{ transform:scale(1.1); }

/* ── Design System ── */
.ds-section{ display:flex;flex-direction:column;gap:6px; }
.ds-label{ font-size:12px;font-weight:700;color:var(--text);letter-spacing:-.1px; }
.ds-hint{ font-size:11px;color:var(--muted);margin-bottom:2px;line-height:1.4; }

.ds-toggle-row{ display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap; }
.ds-toggle-label{ font-size:11px;color:var(--text-2);font-weight:600; }
.ds-toggle-btns{ display:flex;gap:6px; }
.ds-tog{
  padding:6px 18px;border-radius:8px;font-size:11.5px;font-weight:600;
  border:1.5px solid var(--border);background:var(--card);
  color:var(--muted);cursor:pointer;transition:all .15s;font-family:var(--font);
}
.ds-tog.active{ background:var(--primary);color:#fff;border-color:var(--primary); }

.ds-line-btns{ display:grid;grid-template-columns:repeat(5,1fr);gap:7px; }
@media(max-width:380px){ .ds-line-btns{ grid-template-columns:repeat(3,1fr); } }
.ds-line-btn{
  display:flex;flex-direction:column;align-items:center;gap:7px;
  padding:11px 4px 9px;border-radius:10px;cursor:pointer;
  border:1.5px solid var(--border);background:var(--card);
  font-size:10.5px;font-weight:600;color:var(--muted);
  transition:all .15s;font-family:var(--font);
}
.ds-line-btn:hover{ border-color:var(--primary);color:var(--text); }
.ds-line-btn.active{ border-color:var(--primary);background:var(--primary-light);color:var(--primary); }
.ds-line-preview{ width:100%;padding:0 4px; }

/* Theme grid */
.theme-grid{
  display:grid;grid-template-columns:repeat(2,1fr);gap:8px;
}
@media(min-width:460px){ .theme-grid{ grid-template-columns:repeat(3,1fr); } }
.theme-card{
  display:flex;align-items:center;gap:9px;
  padding:10px 12px;border-radius:11px;cursor:pointer;
  border:1.5px solid var(--border-2);background:var(--card);
  transition:all .15s;
}
.theme-card:hover{ border-color:var(--primary);box-shadow:0 2px 10px rgba(13,107,94,.1);transform:translateY(-1px); }
.theme-card.active-theme{ border-color:var(--primary);background:var(--primary-light); }
.theme-swatches{ display:flex;flex-shrink:0; }
.theme-swatch{
  width:16px;height:16px;border-radius:50%;
  border:2px solid rgba(255,255,255,.7);
  box-shadow:0 1px 3px rgba(0,0,0,.2);
}
.theme-swatch:not(:first-child){ margin-left:-5px; }
.theme-name{ font-size:10.5px;font-weight:600;color:var(--text);min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap; }



/* ═══════════════
   MOBILE BOTTOM NAV — Premium
═══════════════ */
#bottom-nav{
  display:none;position:fixed;bottom:0;left:0;right:0;
  height:var(--bottom-nav-h);
  background:rgba(255,255,255,.97);
  backdrop-filter:blur(24px) saturate(2);
  -webkit-backdrop-filter:blur(24px) saturate(2);
  border-top:1px solid rgba(226,232,242,.9);
  z-index:200;
  grid-template-columns:repeat(8,1fr);
  box-shadow:0 -1px 0 rgba(0,0,0,.04),0 -8px 24px rgba(11,24,41,.06);
  align-items:center;
}
.bnav-item{
  display:flex;flex-direction:column;align-items:center;
  justify-content:center;gap:3px;cursor:pointer;
  font-size:8px;font-weight:600;color:var(--muted);
  transition:color .18s,transform .18s;
  border:none;background:none;padding:4px 2px;
  font-family:var(--font);letter-spacing:.3px;
  text-transform:uppercase;
}
.bnav-item:active{transform:scale(.92);}
.bnav-item.active{color:var(--primary);}

/* Bottom nav icon area */
.bnav-icon{
  width:26px;height:26px;font-size:0;
  position:relative;display:flex;
  align-items:center;justify-content:center;
  border-radius:8px;transition:background .18s;
}
.bnav-item.active .bnav-icon{background:var(--primary-light);}
.bnav-icon::before{
  content:'';display:block;
  width:18px;height:18px;
  background-size:contain;background-repeat:no-repeat;
  background-position:center;
  filter:brightness(0) saturate(0) opacity(.4);
  transition:filter .18s;
}
.bnav-item.active .bnav-icon::before,.bnav-item:hover .bnav-icon::before{
  filter:brightness(0) invert(27%) sepia(88%) saturate(500%) hue-rotate(145deg) brightness(90%);
}

/* EACH bottom nav icon SVG */
.bnav-item[data-page="personal"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2'/%3E%3Ccircle cx='12' cy='7' r='4'/%3E%3C/svg%3E");
}
.bnav-item[data-page="experience"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='2' y='7' width='20' height='14' rx='2'/%3E%3Cpath d='M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16'/%3E%3C/svg%3E");
}
.bnav-item[data-page="education"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolygon points='12 2 22 8.5 12 15 2 8.5'/%3E%3Cpath d='M22 8.5V15M6 11.5v5a6 6 0 0012 0v-5'/%3E%3C/svg%3E");
}
.bnav-item[data-page="skills"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01z'/%3E%3C/svg%3E");
}
.bnav-item[data-page="extras"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='3'/%3E%3Cpath d='M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z'/%3E%3C/svg%3E");
}
.bnav-item[data-page="design"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='7' height='9'/%3E%3Crect x='14' y='3' width='7' height='5'/%3E%3Crect x='14' y='12' width='7' height='9'/%3E%3Crect x='3' y='16' width='7' height='5'/%3E%3C/svg%3E");
}
#bnav-preview .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z'/%3E%3Ccircle cx='12' cy='12' r='3'/%3E%3C/svg%3E");
}
#bnav-more .bnav-icon{font-size:20px;font-weight:800;color:inherit;letter-spacing:1px;}
#bnav-more .bnav-icon::before{display:none;}

/* ═══════════════
   SECTION TITLES
═══════════════ */
.section-title{
  font-size:10px;font-weight:800;color:#8FA0B5;
  text-transform:uppercase;letter-spacing:2.5px;
  margin-bottom:16px;padding-bottom:10px;
  border-bottom:1px solid var(--border-2);
  display:flex;align-items:center;gap:9px;
}
.section-title::before{
  content:'';width:4px;height:16px;flex-shrink:0;
  background:linear-gradient(180deg,var(--primary),#2DD4BF);
  border-radius:2px;display:block;
}

/* ═══════════════
   INFO BOX
═══════════════ */
.info-box{
  background:linear-gradient(135deg,#F0F7FF,#EBF4FF);
  border:1px solid #BAD4FB;border-radius:10px;
  padding:11px 14px;font-size:12px;color:#1C4ED8;
  margin-bottom:14px;display:flex;gap:10px;
  align-items:flex-start;line-height:1.6;
}
.info-box::before{
  content:'';flex-shrink:0;
  width:16px;height:16px;margin-top:1px;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%231C4ED8' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cline x1='12' y1='8' x2='12' y2='12'/%3E%3Cline x1='12' y1='16' x2='12.01' y2='16'/%3E%3C/svg%3E") no-repeat center/contain;
}

/* ═══════════════
   MISC
═══════════════ */
.toast{
  position:fixed;bottom:80px;left:50%;transform:translateX(-50%);
  background:linear-gradient(135deg,#0B1829,#1C2E47);
  color:#fff;padding:11px 24px;border-radius:99px;
  font-size:13px;font-weight:600;z-index:9999;
  opacity:0;transition:opacity .3s;pointer-events:none;
  box-shadow:0 4px 20px rgba(11,24,41,.3);
  border:1px solid rgba(255,255,255,.08);
  white-space:nowrap;
}
.toast.show{opacity:1;}

/* ═══════════════
   MODALS & OVERLAYS
═══════════════ */
#pdf-overlay{
  display:none;position:fixed;inset:0;z-index:9999;
  background:rgba(11,24,41,.88);
  backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
  align-items:center;justify-content:center;
  flex-direction:column;gap:18px;
}
#pdf-overlay.show{display:flex;}
.pdf-spinner{
  width:48px;height:48px;
  border:3px solid rgba(255,255,255,.1);
  border-top-color:rgba(255,255,255,.9);
  border-radius:50%;animation:spin .7s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg);}}
.pdf-overlay-text{color:#fff;font-weight:700;font-size:16px;letter-spacing:-.3px;}
.pdf-overlay-sub{color:rgba(255,255,255,.45);font-size:12px;}

/* Mobile Preview */
#preview-page{
  display:none;position:fixed;inset:0;
  top:var(--topbar-h);bottom:var(--bottom-nav-h);
  z-index:80;background:#BEC4CC;overflow:hidden;flex-direction:column;
}
#preview-page.show{display:flex;}
#preview-mobile-toolbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:8px 14px;background:#0B1829;flex-shrink:0;
}
#preview-mobile-toolbar span{color:rgba(255,255,255,.75);font-size:12px;font-weight:600;}
#preview-mobile-toolbar button{
  padding:7px 14px;border:none;border-radius:8px;
  font-size:12px;font-weight:700;cursor:pointer;font-family:var(--font);
}
#preview-mobile-toolbar .export-btn{
  background:linear-gradient(135deg,var(--primary),var(--primary-2));
  color:#fff;
}
#preview-mobile-toolbar .close-btn{background:rgba(255,255,255,.1);color:rgba(255,255,255,.7);}
#preview-scroll-area{
  flex:1;overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  display:flex;justify-content:center;padding:16px 0;
}
#preview-scaled-wrap{transform-origin:top center;will-change:transform;}
#preview-full-iframe{
  width:595px;min-height:842px;border:none;
  background:#fff;box-shadow:0 8px 40px rgba(0,0,0,.3);
  border-radius:2px;display:block;
}

/* Reset modal */
#reset-modal{
  display:none;position:fixed;inset:0;z-index:9999;
  background:rgba(11,24,41,.65);
  backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);
  align-items:center;justify-content:center;padding:16px;
}

/* Free modal */
#free-modal{
  display:none;position:fixed;inset:0;z-index:10000;
  background:rgba(11,24,41,.8);
  backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
  align-items:flex-end;justify-content:center;
}
#free-modal.show{display:flex;}
@media(min-width:540px){#free-modal{align-items:center;padding:20px;}}
#free-box{
  background:#fff;border-radius:24px 24px 0 0;
  width:100%;max-width:420px;overflow:hidden;
  box-shadow:0 -12px 60px rgba(11,24,41,.22);
}
@media(min-width:540px){#free-box{border-radius:22px;}}
#free-header{
  background:linear-gradient(145deg,#064E3B 0%,#065F46 100%);
  padding:22px 22px 20px;position:relative;
}
#free-header .free-pill{
  width:32px;height:3px;background:rgba(255,255,255,.3);
  border-radius:2px;margin:0 auto 16px;
}
#free-header h2{color:#fff;font-size:16px;font-weight:800;margin:0 0 5px;text-align:center;letter-spacing:-.3px;}
#free-header p{color:rgba(255,255,255,.7);font-size:11.5px;text-align:center;margin:0;}
.free-close-x{
  position:absolute;top:14px;right:16px;
  background:rgba(255,255,255,.15);border:none;color:#fff;
  width:28px;height:28px;border-radius:50%;font-size:13px;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:background .15s;
}
.free-close-x:hover{background:rgba(255,255,255,.25);}
#free-body{padding:20px 20px 28px;}
.free-cards{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:4px;}
.free-card{
  border:1.5px solid var(--border-2);border-radius:14px;
  padding:16px 12px;cursor:pointer;text-align:center;
  transition:all .18s;background:#FAFCFF;
}
.free-card:hover{border-color:#047857;background:#F0FDF4;}
.free-card-ico{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;margin:0 auto 10px;}
.free-card-ico.c-green{background:#D1FAE5;}
.free-card-ico.c-blue{background:#DBEAFE;}
.free-card h3{font-size:12.5px;font-weight:800;color:var(--text);margin:0 0 4px;}
.free-card p{font-size:10.5px;color:#64748B;margin:0;line-height:1.4;}
#free-req-sec{display:none;}
#free-code-sec{display:none;}
.free-section-title{font-size:13px;font-weight:800;color:var(--text);margin:0 0 12px;display:flex;align-items:center;gap:8px;}
.free-steps{background:#F8FAFC;border-radius:10px;padding:12px 14px;font-size:11px;color:#475569;line-height:1.9;margin-bottom:14px;border:1px solid var(--border-2);}
.free-wa-btn{
  width:100%;padding:14px;
  background:linear-gradient(135deg,#25D366,#128C7E);
  color:#fff;border:none;border-radius:12px;font-weight:800;font-size:14px;
  cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;
  margin-bottom:10px;box-shadow:0 4px 16px rgba(37,211,102,.3);transition:all .2s;
}
.free-wa-btn:hover{box-shadow:0 6px 24px rgba(37,211,102,.4);}
.free-wa-btn:active{opacity:.9;}
.free-code-input{
  width:100%;padding:14px;border:2px solid var(--border);border-radius:12px;
  font-size:18px;font-weight:700;letter-spacing:8px;text-align:center;
  text-transform:uppercase;margin-bottom:10px;outline:none;box-sizing:border-box;
  color:var(--text);font-family:'Courier New',monospace;transition:border-color .18s,box-shadow .18s;
}
.free-code-input:focus{border-color:#047857;box-shadow:0 0 0 3px rgba(4,120,87,.1);}
.free-unlock-btn{
  width:100%;padding:14px;
  background:linear-gradient(135deg,#0D6B5E,#0A8F7E);
  color:#fff;border:none;border-radius:12px;font-weight:900;font-size:14px;
  cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;
  box-shadow:0 4px 16px rgba(13,107,94,.3);transition:all .2s;
}
.free-unlock-btn:hover{box-shadow:0 6px 24px rgba(13,107,94,.4);}
.free-unlock-btn:active{background:#065F46;}
.free-unlock-btn:disabled{background:#CBD5E1;cursor:not-allowed;box-shadow:none;}
.free-back-lnk{text-align:center;margin-top:11px;font-size:11.5px;color:#64748B;cursor:pointer;}
.free-back-lnk span{color:#047857;font-weight:700;}
.free-err{color:#DC2626;font-size:11px;text-align:center;margin-bottom:8px;display:none;}
.free-note{font-size:10.5px;color:#64748B;text-align:center;margin-top:8px;}

/* Payment modal */
#pay-modal{
  display:none;position:fixed;inset:0;z-index:10000;
  background:rgba(11,24,41,.82);
  backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
  align-items:flex-end;justify-content:center;
}
#pay-modal.show{display:flex;}
@media(min-width:540px){#pay-modal{align-items:center;padding:20px;}}
#pay-box{
  background:#fff;border-radius:24px 24px 0 0;
  width:100%;max-width:440px;overflow:hidden;
  box-shadow:0 -8px 50px rgba(11,24,41,.25);
  animation:paySlide .28s cubic-bezier(.25,1,.5,1);
}
@media(min-width:540px){#pay-box{border-radius:22px;animation:payPop .25s cubic-bezier(.25,1,.5,1);}}
@keyframes paySlide{from{transform:translateY(50px);opacity:.5}to{transform:none;opacity:1}}
@keyframes payPop{from{transform:scale(.95);opacity:0}to{transform:none;opacity:1}}
#pay-header{
  background:linear-gradient(145deg,#0B1829 0%,#1C2E47 100%);
  padding:16px 20px 20px;position:relative;
}
.pay-pill{width:32px;height:3px;background:rgba(255,255,255,.15);border-radius:99px;margin:0 auto 16px;}
.pay-close-x{
  position:absolute;top:12px;right:14px;width:28px;height:28px;border-radius:50%;
  border:none;background:rgba(255,255,255,.08);color:rgba(255,255,255,.55);
  font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .15s;
}
.pay-close-x:hover{background:rgba(255,255,255,.16);color:#fff;}
.pay-lock-icon{
  width:40px;height:40px;background:rgba(255,255,255,.08);
  border-radius:12px;border:1px solid rgba(255,255,255,.1);
  display:flex;align-items:center;justify-content:center;margin-bottom:12px;
}
#pay-header h2{color:#fff;font-size:18px;font-weight:800;margin-bottom:5px;letter-spacing:-.4px;}
#pay-header .pay-sub{color:rgba(255,255,255,.42);font-size:11.5px;line-height:1.6;}
.pay-price-tag{
  display:inline-flex;align-items:baseline;gap:1px;
  background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);
  border-radius:99px;padding:4px 16px 5px;margin-top:12px;
}
.pay-price-tag .sym{color:rgba(255,255,255,.6);font-size:12px;font-weight:700;}
.pay-price-tag .num{color:#fff;font-size:24px;font-weight:900;letter-spacing:-.5px;line-height:1;}
.pay-price-tag .lbl{color:rgba(255,255,255,.32);font-size:10.5px;margin-left:5px;}
#pay-body{padding:20px 20px 26px;}
@media(min-width:540px){#pay-body{padding:22px 24px 30px;}}
.pay-cards{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.pay-card{
  border:1.5px solid var(--border-2);border-radius:14px;
  padding:18px 12px 16px;text-align:center;cursor:pointer;
  background:#FAFCFF;transition:all .18s;
  -webkit-tap-highlight-color:transparent;user-select:none;
}
.pay-card:active{transform:scale(.97);}
.pay-card:hover{border-color:#0B1829;background:#F4F7FA;}
.pay-card-ico{width:44px;height:44px;border-radius:12px;margin:0 auto 12px;display:flex;align-items:center;justify-content:center;}
.pay-card-ico.c-blue{background:#EFF6FF;}
.pay-card-ico.c-green{background:#F0FDF4;}
.pay-card h3{font-size:13px;font-weight:800;color:var(--text);margin-bottom:4px;}
.pay-card p{font-size:11px;color:#64748B;line-height:1.5;}
#pay-upi-sec{display:none;}
.qr-wrap{background:#F8FAFC;border:1.5px solid var(--border-2);border-radius:16px;padding:18px;display:flex;flex-direction:column;align-items:center;margin-bottom:14px;}
.qr-wrap canvas,.qr-wrap img{border-radius:8px;}
.qr-hint{font-size:11px;color:#94A3B8;font-weight:600;margin-top:9px;text-align:center;}
.upi-row{display:flex;align-items:center;gap:10px;background:#F8FAFC;border:1.5px solid var(--border-2);border-radius:12px;padding:12px 14px;margin-bottom:12px;}
.upi-text{flex:1;min-width:0;}
.upi-lbl{font-size:9.5px;color:#94A3B8;font-weight:700;text-transform:uppercase;letter-spacing:.8px;margin-bottom:3px;}
.upi-val{font-size:13px;font-weight:800;color:var(--text);word-break:break-all;letter-spacing:.2px;}
.copy-btn{padding:9px 16px;background:linear-gradient(135deg,#0B1829,#1C2E47);color:#fff;border:none;border-radius:9px;font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap;flex-shrink:0;box-shadow:0 2px 8px rgba(11,24,41,.2);}
.copy-btn:active{opacity:.8;}
.send-note{background:#F0FDF4;border:1.5px solid #86EFAC;border-radius:10px;padding:10px 14px;font-size:12px;color:#166534;font-weight:700;text-align:center;margin-bottom:14px;display:flex;align-items:center;justify-content:center;gap:7px;}
.wa-btn{
  width:100%;padding:15px;
  background:linear-gradient(135deg,#25D366,#128C7E);
  color:#fff;border:none;border-radius:14px;font-weight:800;font-size:15px;
  cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;
  -webkit-tap-highlight-color:transparent;
  box-shadow:0 4px 16px rgba(37,211,102,.3);transition:all .2s;
}
.wa-btn:active{background:#128C7E;}
.wa-btn:hover{box-shadow:0 6px 24px rgba(37,211,102,.4);}
.back-lnk{text-align:center;margin-top:14px;font-size:12px;color:#94A3B8;cursor:pointer;padding:6px;}
.back-lnk:hover{color:#475569;}
#pay-code-sec{display:none;}
.code-steps{font-size:12px;color:#475569;margin-bottom:14px;background:#F8FAFC;border:1.5px solid var(--border-2);border-radius:12px;padding:13px 15px;line-height:1.9;}
.code-steps strong{color:var(--text);}
.code-lbl{font-size:12px;font-weight:700;color:var(--text);margin-bottom:9px;display:block;}
.code-dots{display:flex;align-items:center;justify-content:center;gap:6px;margin-bottom:14px;}
.cdot{width:10px;height:10px;border-radius:50%;background:var(--border);transition:background .2s;}
.cdot.used{background:var(--danger);}
.cdot-lbl{font-size:11px;color:#94A3B8;margin-left:2px;}
.code-field{
  width:100%;padding:18px 10px;border:2.5px solid var(--border);border-radius:14px;
  font-size:28px;font-weight:900;text-align:center;letter-spacing:10px;
  text-transform:uppercase;outline:none;font-family:'Courier New',monospace;
  color:var(--text);background:#FAFCFF;
  transition:border-color .18s,box-shadow .18s;-webkit-tap-highlight-color:transparent;margin-bottom:8px;
}
.code-field:focus{border-color:#1E293B;box-shadow:0 0 0 4px rgba(30,41,59,.07);}
.code-field.err{border-color:var(--danger);box-shadow:0 0 0 4px rgba(220,53,69,.08);animation:cshake .35s;}
.code-field.ok{border-color:var(--success);box-shadow:0 0 0 4px rgba(26,158,106,.09);}
@keyframes cshake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}50%{transform:translateX(4px)}}
.code-pool-hint{font-size:11px;color:#94A3B8;text-align:center;margin-bottom:14px;line-height:1.6;}
.err-box{background:#FFF5F5;border:1.5px solid #FED7D7;border-radius:10px;padding:11px 14px;font-size:12px;color:#991B1B;font-weight:600;margin-bottom:12px;display:none;text-align:center;line-height:1.5;}
.lock-box{background:#FFFBF5;border:1.5px solid #FED7AA;border-radius:12px;padding:14px;display:none;text-align:center;margin-bottom:12px;}
.lock-title{font-size:13px;color:#9A3412;font-weight:800;margin-bottom:6px;}
.lock-time{font-size:28px;font-weight:900;color:#C2410C;letter-spacing:3px;line-height:1;}
.lock-sub{font-size:11px;color:#9A3412;margin-top:5px;}
.unlock-btn{
  width:100%;padding:15px;background:linear-gradient(135deg,#0B1829,#1C2E47);
  color:#fff;border:none;border-radius:14px;font-weight:900;font-size:15px;
  cursor:pointer;-webkit-tap-highlight-color:transparent;
  display:flex;align-items:center;justify-content:center;gap:8px;
  box-shadow:0 4px 16px rgba(11,24,41,.25);transition:all .2s;
}
.unlock-btn:active{background:#1C2E47;}
.unlock-btn:disabled{background:#CBD5E1;cursor:not-allowed;box-shadow:none;}

/* Admin panel */
#admin-panel{display:none;position:fixed;inset:0;z-index:10001;background:rgba(0,0,0,.9);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);align-items:center;justify-content:center;padding:20px;}
#admin-panel.show{display:flex;}
#admin-box{background:#0B1829;border:1px solid rgba(255,255,255,.07);border-radius:20px;width:100%;max-width:300px;overflow:hidden;box-shadow:0 32px 80px rgba(0,0,0,.5);}
#admin-header{padding:15px 20px;border-bottom:1px solid rgba(255,255,255,.05);display:flex;align-items:center;justify-content:space-between;}
#admin-header h3{color:rgba(255,255,255,.7);font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;}
.admin-x{background:none;border:none;color:rgba(255,255,255,.3);font-size:16px;cursor:pointer;line-height:1;transition:color .15s;}
.admin-x:hover{color:rgba(255,255,255,.7);}
#admin-body{padding:18px 20px;}
.a-pwd{width:100%;padding:13px 15px;background:rgba(255,255,255,.04);border:1.5px solid rgba(255,255,255,.08);border-radius:10px;color:#F1F5F9;font-size:20px;outline:none;margin-bottom:10px;letter-spacing:6px;font-family:'Courier New',monospace;text-align:center;transition:border-color .18s;}
.a-pwd:focus{border-color:#60A5FA;}
.a-login{width:100%;padding:12px;background:linear-gradient(135deg,#3B82F6,#2563EB);color:#fff;border:none;border-radius:10px;font-weight:800;font-size:13px;cursor:pointer;font-family:var(--font);box-shadow:0 2px 10px rgba(59,130,246,.3);}
.a-err{color:#F87171;font-size:11px;text-align:center;margin-top:7px;display:none;}
#admin-content{display:none;}
.a-lbl{font-size:9px;font-weight:800;color:#60A5FA;text-transform:uppercase;letter-spacing:2px;margin-bottom:6px;}
.a-code{font-size:30px;font-weight:900;color:#34D399;letter-spacing:8px;font-family:'Courier New',monospace;text-align:center;background:rgba(255,255,255,.03);border:1px solid rgba(52,211,153,.12);border-radius:10px;padding:14px;margin-bottom:4px;}
.a-date{font-size:10px;color:rgba(255,255,255,.2);text-align:center;margin-bottom:14px;}
.a-rule{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.05);border-radius:10px;padding:12px;font-size:11px;color:rgba(255,255,255,.25);line-height:1.8;}
.a-rule b{color:rgba(255,255,255,.45);}
.admin-tabs{display:flex;border-bottom:1px solid rgba(255,255,255,.05);margin-bottom:12px;}
.admin-tab{flex:1;padding:9px;background:none;border:none;color:rgba(255,255,255,.28);font-size:11px;font-weight:700;cursor:pointer;text-align:center;border-bottom:2px solid transparent;transition:all .15s;font-family:var(--font);}
.admin-tab.active{color:#60A5FA;border-bottom-color:#60A5FA;}
.admin-tab-pane{display:none;}
.admin-tab-pane.active{display:block;}
.a-gen-btn{width:100%;padding:11px;background:linear-gradient(135deg,#10B981,#059669);color:#fff;border:none;border-radius:8px;font-weight:800;font-size:13px;cursor:pointer;margin-top:8px;font-family:var(--font);}
.a-free-section{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.05);border-radius:10px;padding:14px;margin-bottom:10px;}
.a-free-label{font-size:9px;font-weight:800;color:#34D399;text-transform:uppercase;letter-spacing:2px;margin-bottom:6px;display:flex;align-items:center;gap:6px;}
.a-free-input{width:100%;padding:10px 13px;background:#050B14;border:1.5px solid rgba(255,255,255,.08);border-radius:8px;color:#F1F5F9;font-size:14px;font-weight:700;letter-spacing:3px;font-family:'Courier New',monospace;outline:none;box-sizing:border-box;transition:border-color .18s;}
.a-free-input:focus{border-color:#34D399;}
.a-free-input.wa{letter-spacing:1px;font-size:13px;}
.a-free-save{width:100%;padding:11px;background:linear-gradient(90deg,#059669,#047857);color:#fff;border:none;border-radius:8px;font-weight:800;font-size:13px;cursor:pointer;margin-top:10px;display:flex;align-items:center;justify-content:center;gap:7px;font-family:var(--font);}
.a-free-save:hover{opacity:.9;}
.a-free-msg{text-align:center;font-size:11px;font-weight:700;margin-top:7px;min-height:16px;color:#34D399;}
.a-free-current{font-size:10px;color:rgba(255,255,255,.2);margin-top:5px;font-family:'Courier New',monospace;letter-spacing:2px;}
.a-free-hint{font-size:10px;color:rgba(255,255,255,.2);margin-top:5px;line-height:1.5;}
.a-free-gen-btn{width:100%;padding:8px;background:rgba(59,130,246,.08);color:#60A5FA;border:1.5px dashed rgba(59,130,246,.2);border-radius:8px;font-weight:700;font-size:11px;cursor:pointer;margin-top:6px;font-family:var(--font);transition:all .15s;}
.a-free-gen-btn:hover{background:rgba(59,130,246,.14);border-color:#60A5FA;}
.a-gen-btn:hover{opacity:.9;}
.a-code-out{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.05);border-radius:8px;padding:12px;text-align:center;margin-top:8px;}
.a-code-big{font-size:28px;font-weight:900;color:#34D399;letter-spacing:8px;font-family:'Courier New',monospace;}
.a-code-copy{margin-top:6px;padding:6px 18px;background:linear-gradient(135deg,#3B82F6,#2563EB);color:#fff;border:none;border-radius:6px;font-size:11px;font-weight:700;cursor:pointer;font-family:var(--font);}

/* Demo modal — hidden, replaced by inline preview */
#demo-modal{display:none!important;}

/* ── INLINE TEMPLATE PREVIEW ── */
.tpl-preview-wrap{
  display:none;
  margin-top:10px;
  border-radius:10px;
  overflow:hidden;
  border:1.5px solid var(--border);
}
.tpl-preview-wrap.open{ display:block; }

.tpl-preview-loading{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:180px;background:#E8ECF0;gap:10px;
  font-size:12px;color:#64748B;font-weight:600;
}
.tpl-preview-loading .spin{
  width:22px;height:22px;
  border:2.5px solid #CBD5E1;border-top-color:var(--primary);
  border-radius:50%;animation:spin .7s linear infinite;
}
.tpl-preview-viewport{
  width:100%;
  overflow:hidden;
  background:#E8ECF0;
  position:relative;
  /* height set by JS to = contentHeight * scale, clipping the blank space */
}
.tpl-preview-iframe{
  width:595px;
  border:none;
  background:#fff;
  display:block;
  transform-origin:top left;
  position:absolute;
  top:0;
  left:0;
  /* height + transform set by JS */
}
.tpl-preview-bar{
  display:flex;align-items:center;gap:8px;
  padding:8px 10px;background:#fff;
  border-top:1px solid var(--border);
}
.tpl-preview-bar-name{
  flex:1;font-size:12px;font-weight:700;color:var(--text);
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
}
.tpl-use-btn{
  flex-shrink:0;padding:6px 14px;
  background:linear-gradient(135deg,var(--primary),var(--primary-2));
  color:#fff;border:none;border-radius:7px;
  font-weight:700;font-size:11.5px;cursor:pointer;
  font-family:var(--font);
  box-shadow:0 2px 8px rgba(13,107,94,.25);
}
.tpl-close-btn{
  flex-shrink:0;
  width:28px;height:28px;border-radius:50%;
  border:1.5px solid var(--border);background:#fff;
  color:#666;font-size:14px;font-weight:700;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  font-family:var(--font);transition:all .15s;
}
.tpl-close-btn:hover{ background:#FFF5F5;color:#EF4444;border-color:#FECACA; }
.tpl-card.preview-open{
  grid-column:1 / -1;
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(13,107,94,.12),0 6px 24px rgba(13,107,94,.1);
  transform:none !important;
}

/* Bullet library */
#lib-modal{display:none;position:fixed;inset:0;z-index:998;background:rgba(11,24,41,.55);align-items:flex-end;justify-content:center;}
#lib-modal.show{display:flex;}
#lib-box{background:var(--card);border-radius:20px 20px 0 0;width:100%;max-width:600px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 -8px 50px rgba(11,24,41,.2);}
.lib-handle{width:36px;height:3px;background:#D4DCE8;border-radius:3px;margin:12px auto 0;}
.lib-header{padding:13px 18px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
.lib-header h3{font-size:15px;font-weight:700;color:var(--text);}
.lib-cats{display:flex;flex-wrap:nowrap;align-items:center;gap:6px;padding:10px 16px 12px;border-bottom:1px solid var(--border);overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:thin;scrollbar-color:var(--primary) var(--border);}
.lib-cats::-webkit-scrollbar{height:3px;}
.lib-cats::-webkit-scrollbar-thumb{background:var(--primary);border-radius:10px;}
.lib-cat{display:inline-flex;align-items:center;height:28px;padding:0 14px;border-radius:14px;border:1.5px solid var(--border);font-size:11px;font-weight:600;cursor:pointer;white-space:nowrap;background:#fff;color:var(--muted);transition:all .15s;flex-shrink:0;}
.lib-cat:hover{border-color:var(--primary);color:var(--primary);}
.lib-cat.active{background:var(--primary);color:#fff;border-color:var(--primary);}
#lib-bullets{overflow-y:auto;padding:12px 16px;flex:1;}
.lib-bullet{display:flex;align-items:center;gap:11px;padding:9px 10px;border-radius:8px;cursor:pointer;transition:background .15s;border:1px solid transparent;}
.lib-bullet:hover{background:var(--primary-light);border-color:rgba(13,107,94,.12);}
.lib-bullet-text{font-size:13px;flex:1;line-height:1.4;color:var(--text);}
.lib-add-icon{color:var(--primary);font-size:18px;font-weight:700;flex-shrink:0;}

/* Import zone */
.import-zone{
  border:2px dashed #C4D0DF;border-radius:12px;
  padding:28px;text-align:center;cursor:pointer;
  transition:all .2s;
  background:linear-gradient(180deg,#FAFCFF,#F4F7FC);
}
.import-zone:hover,.import-zone.dragover{border-color:var(--primary);background:var(--primary-light);}
.import-zone p{font-size:13px;color:var(--muted);margin-top:8px;}
.import-icon{
  font-size:0;width:48px;height:48px;
  margin:0 auto 10px;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' fill='none' stroke='%237A8BA0' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4'/%3E%3Cpolyline points='17 8 12 3 7 8'/%3E%3Cline x1='12' y1='3' x2='12' y2='15'/%3E%3C/svg%3E") no-repeat center/contain;
}
.import-result{border-radius:10px;padding:12px;margin-top:10px;font-size:12.5px;font-weight:600;}
.import-ok{background:var(--primary-light);border:1px solid rgba(13,107,94,.2);color:var(--primary);}
.import-err{background:#FFF5F5;border:1px solid #FED7D7;color:var(--danger);}
.import-fields{margin-top:10px;font-size:11.5px;color:var(--muted);background:#F8FAFC;border-radius:8px;padding:12px;line-height:1.9;}
.import-progress{margin-top:8px;height:5px;background:#EBF0F7;border-radius:5px;overflow:hidden;}
.import-progress-bar{height:100%;background:linear-gradient(90deg,var(--primary),#2DD4BF);border-radius:5px;transition:width .3s;width:0%;}

/* ═══════════════
   FONT/TYPO CARDS
═══════════════ */
.font-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:4px;}
.font-card{border:2px solid var(--border);border-radius:10px;padding:11px 13px;cursor:pointer;transition:all .15s;background:var(--card);position:relative;overflow:hidden;}
.font-card:hover{border-color:var(--primary);background:#FAFFFF;}
.font-card.active{border-color:var(--primary);background:var(--primary-light);}
.font-card-name{font-weight:800;font-size:11px;color:var(--text);margin-bottom:3px;letter-spacing:.3px;}
.font-card-preview{font-size:15px;color:#444;line-height:1.3;margin-bottom:3px;}
.font-card-tag{font-size:9px;color:var(--muted);background:var(--bg);border-radius:4px;padding:2px 6px;display:inline-block;}

.typo-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:4px;}
.typo-preset{border:2px solid var(--border);border-radius:10px;padding:11px 13px;cursor:pointer;transition:all .15s;background:var(--card);position:relative;}
.typo-preset:hover{border-color:var(--primary);background:#FAFFFF;}
.typo-preset.active{border-color:var(--primary);background:var(--primary-light);}
.typo-name{font-weight:800;font-size:12px;color:var(--text);margin-bottom:3px;}
.typo-desc{font-size:10px;color:var(--muted);margin-bottom:7px;line-height:1.3;}
.typo-bars{display:flex;flex-direction:column;gap:2px;}
.typo-bar-row{display:flex;align-items:center;gap:5px;}
.typo-bar{background:var(--primary);border-radius:3px;opacity:.3;transition:opacity .15s;}
.typo-bar-lbl{font-size:8.5px;color:var(--muted);min-width:28px;}
.typo-preset.active .typo-bar{opacity:.7;}
.typo-preset:hover .typo-bar{opacity:.5;}

/* ═══════════════
   RESPONSIVE
═══════════════ */
@media(max-width:900px){
  #sidebar{display:none;}
  #main-content{margin-left:0;padding:16px 14px 24px;}
  #right-panel{display:none;}
  #app{padding-bottom:var(--bottom-nav-h);}
  #bottom-nav{display:grid;}
  .topbar-btns .tbtn-dark{display:none;}
}
@media(max-width:600px){
  .g2,.g3{grid-template-columns:1fr;}
  #topbar{padding:0 10px;gap:8px;}
  .logo-sub{display:none;}
  .logo-text{display:none;}
  #slot-select{max-width:90px;font-size:11px;}
  .topbar-btns{gap:4px;flex-shrink:0;}
  .tbtn{padding:7px 10px;font-size:11.5px;gap:4px;}
  /* Hide span on small screens for buttons that are still visible */
  .tbtn-dark span{font-size:11px;}
  .tbtn-danger span,.tbtn-light span,.tbtn-wm span{display:none;}
  .card-body{padding:14px;}
  .entry-block{padding:13px;}
  .field input,.field textarea,.field select{font-size:16px;}
  .bullet-row input{font-size:16px;}
  .add-entry-btn{padding:14px;font-size:14px;}
  #strength-card{display:none;}
  .card-title{font-size:14px;}
  .card{border-radius:13px;}
  .card-icon{width:30px;height:30px;border-radius:8px;}
  .card-icon::after{width:15px;height:15px;}
}
@media(max-width:400px){
  #topbar{gap:4px;padding:0 8px;}
  #slot-select{max-width:75px;font-size:10px;}
  .tbtn{padding:6px 8px;font-size:11px;}
}

/* ═══════════════
   PRINT
═══════════════ */
@media print{
  *{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;color-adjust:exact!important;}
  html,body{margin:0!important;padding:0!important;background:white!important;}
  #topbar,#sidebar,#app,#bottom-nav,#demo-modal,#lib-modal,#print-overlay ~ *,.toast,#pdf-overlay{display:none!important;}
  #print-overlay{display:block!important;width:100%;margin:0;padding:0;}
  @page{size:A4;margin:0;}
}
#print-overlay{display:none;}
*{scroll-behavior:smooth;}

/* ══════════════════════════════════════════════
   BOTTOM NAV — PILL FILL ANIMATION
══════════════════════════════════════════════ */
#bottom-nav{
  display:none;position:fixed;bottom:0;left:0;right:0;
  height:var(--bottom-nav-h);
  background:rgba(255,255,255,.98);
  backdrop-filter:blur(24px) saturate(2);
  -webkit-backdrop-filter:blur(24px) saturate(2);
  border-top:1px solid rgba(226,232,242,.9);
  z-index:200;
  display:none;
  grid-template-columns:repeat(8,1fr);
  box-shadow:0 -1px 0 rgba(0,0,0,.04),0 -8px 24px rgba(11,24,41,.05);
  align-items:center;
}

.bnav-item{
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  gap:3px;cursor:pointer;
  font-size:7.5px;font-weight:700;
  color:#9AA8BC;
  transition:color .25s ease;
  border:none;background:none;
  padding:5px 2px;
  font-family:var(--font);
  letter-spacing:.4px;text-transform:uppercase;
  position:relative;
  -webkit-tap-highlight-color:transparent;
  user-select:none;
}
.bnav-item:active{transform:scale(.9);transition:transform .1s ease;}

/* Pill background — the animated fill shape */
.bnav-icon{
  width:44px;height:28px;
  font-size:0;
  position:relative;
  display:flex;align-items:center;justify-content:center;
  border-radius:14px;
  transition:background .3s cubic-bezier(.34,1.56,.64,1), width .3s cubic-bezier(.34,1.56,.64,1);
  overflow:hidden;
  flex-shrink:0;
}
/* The pill fill bg layer */
.bnav-icon::after{
  content:'';
  position:absolute;inset:0;
  border-radius:14px;
  background:var(--primary-light);
  transform:scale(.3);
  opacity:0;
  transition:transform .35s cubic-bezier(.34,1.56,.64,1), opacity .25s ease;
}
.bnav-item.active .bnav-icon::after{
  transform:scale(1);
  opacity:1;
}

/* Icon SVG layer */
.bnav-icon::before{
  content:'';display:block;
  width:18px;height:18px;
  background-size:contain;background-repeat:no-repeat;
  background-position:center;
  filter:brightness(0) saturate(0) opacity(.35);
  transition:filter .25s ease, transform .3s cubic-bezier(.34,1.56,.64,1);
  position:relative;z-index:1;
}
.bnav-item.active .bnav-icon::before{
  filter:brightness(0) invert(28%) sepia(80%) saturate(600%) hue-rotate(148deg) brightness(88%);
  transform:scale(1.1);
}
.bnav-item:active .bnav-icon::before{
  transform:scale(.85);
}

/* Active label color */
.bnav-item.active{color:var(--primary);}

/* Nav icons — reuse exact same SVGs */
.bnav-item[data-page="personal"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2'/%3E%3Ccircle cx='12' cy='7' r='4'/%3E%3C/svg%3E");
}
.bnav-item[data-page="experience"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='2' y='7' width='20' height='14' rx='2'/%3E%3Cpath d='M16 21V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v16'/%3E%3C/svg%3E");
}
.bnav-item[data-page="education"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolygon points='12 2 22 8.5 12 15 2 8.5'/%3E%3Cpath d='M22 8.5V15M6 11.5v5a6 6 0 0012 0v-5'/%3E%3C/svg%3E");
}
.bnav-item[data-page="skills"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01z'/%3E%3C/svg%3E");
}
.bnav-item[data-page="extras"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='3'/%3E%3Cpath d='M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z'/%3E%3C/svg%3E");
}
.bnav-item[data-page="design"] .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='7' height='9'/%3E%3Crect x='14' y='3' width='7' height='5'/%3E%3Crect x='14' y='12' width='7' height='9'/%3E%3Crect x='3' y='16' width='7' height='5'/%3E%3C/svg%3E");
}
#bnav-preview .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z'/%3E%3Ccircle cx='12' cy='12' r='3'/%3E%3C/svg%3E");
}
/* More dots */
#bnav-more .bnav-icon::before{
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2.5' stroke-linecap='round'%3E%3Ccircle cx='5' cy='12' r='1.5'/%3E%3Ccircle cx='12' cy='12' r='1.5'/%3E%3Ccircle cx='19' cy='12' r='1.5'/%3E%3C/svg%3E");
}
#bnav-more.active .bnav-icon::before{
  filter:brightness(0) invert(28%) sepia(80%) saturate(600%) hue-rotate(148deg) brightness(88%);
}

/* Ripple on tap */
@keyframes bnav-ripple{
  0%{transform:scale(0);opacity:.4;}
  100%{transform:scale(2.5);opacity:0;}
}
.bnav-item:active .bnav-icon::after{
  animation:bnav-ripple .4s ease-out;
}

/* ══════════════════════════════════════════════
   PREMIUM BADGE — Gold Foil
══════════════════════════════════════════════ */
.tpl-paid-badge{
  background:linear-gradient(115deg, #B8860B 0%, #F5D020 35%, #F5A623 55%, #C8961A 80%, #B8860B 100%);
  background-size:200% 100%;
  color:#4A2C00;
  border:none;
  font-size:7.5px;letter-spacing:.7px;font-weight:900;
  box-shadow:0 1px 6px rgba(184,134,11,.4), inset 0 1px 0 rgba(255,255,255,.35);
  text-shadow:0 1px 0 rgba(255,255,255,.3);
  animation:gold-shimmer 3s ease-in-out infinite;
}
@keyframes gold-shimmer{
  0%,100%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
}
.tpl-free-badge{
  background:#F0FDF4;color:#166534;
  border:1px solid #86EFAC;font-weight:700;
  font-size:7.5px;
}

/* ══════════════════════════════════════════════
   MORE MENU — Bottom Sheet Animation
══════════════════════════════════════════════ */
#more-menu{
  display:none;
  position:fixed;bottom:0;left:0;right:0;
  z-index:500;
  padding:0 10px calc(var(--bottom-nav-h) + 6px);
  pointer-events:none;
}
#more-menu.open{
  display:block;
  pointer-events:all;
}
.more-sheet{
  background:#fff;
  border-radius:20px 20px 0 0;
  box-shadow:0 -4px 40px rgba(11,24,41,.16), 0 0 0 1px rgba(226,232,242,.6);
  overflow:hidden;
  transform:translateY(100%);
  opacity:0;
  transition:transform .38s cubic-bezier(.32,1.6,.64,1), opacity .25s ease;
  will-change:transform;
}
#more-menu.open .more-sheet{
  transform:translateY(0);
  opacity:1;
}

/* Drag handle */
.more-header{
  padding:14px 18px 12px;
  border-bottom:1px solid var(--border-2);
  display:flex;align-items:center;justify-content:space-between;
  position:relative;
}
.more-header::before{
  content:'';
  position:absolute;top:8px;left:50%;transform:translateX(-50%);
  width:32px;height:3px;
  background:#D8DFE8;border-radius:3px;
}
.more-title{
  font-size:10px;font-weight:800;
  color:var(--muted);text-transform:uppercase;letter-spacing:2px;
}
.more-close-btn{
  width:26px;height:26px;border-radius:50%;
  border:none;background:#F2F5F9;
  color:var(--muted);cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  transition:background .15s, color .15s;
  flex-shrink:0;
}
.more-close-btn:hover{background:#FEEAEE;color:var(--danger);}
.more-close-btn svg{display:block;}

.more-body{padding:8px;}

.more-row{
  width:100%;
  display:flex;align-items:center;gap:14px;
  padding:13px 10px;border:none;background:none;
  border-radius:12px;font-size:14px;
  color:var(--text);cursor:pointer;
  text-align:left;font-family:var(--font);
  transition:background .18s, transform .18s;
  -webkit-tap-highlight-color:transparent;
}
.more-row:hover{background:#F8FAFC;}
.more-row:active{background:#F0F3F8;transform:scale(.98);}

/* Staggered entrance animation */
.more-row:nth-child(1){transition-delay:.03s;}
.more-row:nth-child(3){transition-delay:.06s;}
.more-row:nth-child(4){transition-delay:.09s;}
.more-row:nth-child(6){transition-delay:.12s;}

.more-icon-wrap{
  width:40px;height:40px;flex-shrink:0;
  border-radius:11px;
  display:flex;align-items:center;justify-content:center;
  transition:transform .2s cubic-bezier(.34,1.56,.64,1);
}
.more-row:active .more-icon-wrap{transform:scale(.88);}
.more-icon-wrap.c-teal{background:linear-gradient(135deg,#D0F5F0,#A7EEE5);color:#0A6B61;}
.more-icon-wrap.c-blue{background:linear-gradient(135deg,#DBEAFE,#BFDBFE);color:#1D4ED8;}
.more-icon-wrap.c-purple{background:linear-gradient(135deg,#EDE9FE,#DDD6FE);color:#6D28D9;}
.more-icon-wrap.c-red{background:linear-gradient(135deg,#FEE2E2,#FECACA);color:#B91C1C;}
.more-icon-wrap svg{display:block;}

.more-text{flex:1;min-width:0;}
.more-row-title{font-weight:700;font-size:14px;color:var(--text);line-height:1.2;}
.more-row-sub{font-size:11px;color:var(--muted);margin-top:2px;line-height:1.3;}
.more-row-danger .more-row-title{color:#DC2626;}
.more-row-danger .more-row-sub{color:#F87171;}
.more-row-danger:hover{background:#FFF5F5;}

.more-chevron{color:#CBD5E1;flex-shrink:0;display:flex;}
.more-chevron svg{display:block;}
.more-row-danger .more-chevron{color:#FCA5A5;}

.more-divider{
  height:1px;background:var(--border-2);
  margin:3px 6px;border-radius:1px;
}

/* More backdrop */
#more-backdrop{
  display:none;position:fixed;inset:0;z-index:499;
  background:rgba(11,24,41,.0);
  backdrop-filter:blur(0px);
  transition:background .3s ease, backdrop-filter .3s ease;
}
#more-backdrop.open{
  display:block;
  background:rgba(11,24,41,.25);
  backdrop-filter:blur(3px);
  -webkit-backdrop-filter:blur(3px);
}

/* ══════════════════════════════════════════════
   SIDEBAR NAV — Smooth transitions
══════════════════════════════════════════════ */
.nav-item .icon{
  width:20px;height:20px;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;
  font-size:0;
  transition:transform .25s cubic-bezier(.34,1.56,.64,1);
}
.nav-item.active .icon,.nav-item:hover .icon{transform:scale(1.1);}

/* ══════════════════════════════════════════════
   CARD HEADER — Chevron smooth
══════════════════════════════════════════════ */
.card-header{transition:background .15s;}
.card-icon{transition:transform .2s cubic-bezier(.34,1.56,.64,1), box-shadow .2s;}
.card-header:hover .card-icon{transform:scale(1.08);}

/* ══════════════════════════════════════════════
   TEMPLATE CARD — Ripple on select
══════════════════════════════════════════════ */
.tpl-card::after{
  content:'';
  position:absolute;
  inset:0;border-radius:inherit;
  background:radial-gradient(circle at center, rgba(13,107,94,.18) 0%, transparent 70%);
  opacity:0;transform:scale(0.5);
  transition:opacity .4s, transform .4s;
  pointer-events:none;
  overflow:hidden;
}
.tpl-card.active::after{opacity:1;transform:scale(1);}

/* ══════════════════════════════════════════════
   TOAST — Slide up
══════════════════════════════════════════════ */
.toast{
  transition:opacity .3s ease, transform .3s cubic-bezier(.34,1.56,.64,1);
  transform:translateX(-50%) translateY(10px);
}
.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}

/* ══════════════════════════════════════════════
   BUTTON ACTIVE STATES — Micro press
══════════════════════════════════════════════ */
.tbtn{transition:all .2s cubic-bezier(.25,1,.5,1);}
.tbtn:active{transform:scale(.95) translateY(1px);}
.add-entry-btn:active{transform:scale(.98);}
.tbtn-primary:hover,.tbtn-dark:hover,.tbtn-wm:hover{transform:translateY(-2px);}

/* Responsive */
@media(max-width:900px){
  #bottom-nav{display:grid;}
  /* Hide cluttered topbar buttons on tablet+ — they're in More menu */
  .tb-hide-mobile{display:none!important;}
}
@media(max-width:600px){
  .bnav-item{font-size:7px;letter-spacing:.3px;}
  .bnav-icon{width:38px;height:26px;border-radius:12px;}
  /* Keep Download PDF visible with full text on mobile */
  .tbtn.tbtn-dark span{display:inline!important;}
  .tbtn.tbtn-dark{padding:8px 12px;}
}
/* tpl-demo-tag as button — reset browser defaults */
button.tpl-demo-tag{
  cursor:pointer;
  font-family:var(--font);
  outline:none;
  -webkit-appearance:none;
  appearance:none;
  -webkit-tap-highlight-color:transparent;
}
button.tpl-demo-tag:focus{box-shadow:0 0 0 2px rgba(13,107,94,.25);}
/* More menu icon SVG explicit size */
.more-icon-wrap svg{width:18px;height:18px;flex-shrink:0;display:block;}
</style>
</head>
<body>

<div class="toast" id="toast"></div>

<!-- PDF DOWNLOAD OVERLAY -->
<div id="pdf-overlay">
  <div class="pdf-spinner"></div>
  <div class="pdf-overlay-text" id="pdf-overlay-text"> Opening Print Dialog...</div>
  <div class="pdf-overlay-sub" id="pdf-overlay-sub">Choose <strong style="color:#fff;">"Save as PDF"</strong> → destination in the dialog</div>
</div>

<!-- TOP BAR -->
<div id="topbar">
  <div class="logo-icon" onclick="logoClick()" style="cursor:pointer;" title="CV Builder Pro">
    <svg width="20" height="22" viewBox="0 0 20 22" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M3 2C3 1.44772 3.44772 1 4 1H13L18 6V20C18 20.5523 17.5523 21 17 21H4C3.44772 21 3 20.5523 3 20V2Z" fill="white" stroke="#1E293B" stroke-width="1.5"/>
      <path d="M13 1L13 6H18" stroke="#1E293B" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      <line x1="6.5" y1="9" x2="14.5" y2="9" stroke="#1E293B" stroke-width="1.2" stroke-linecap="round"/>
      <line x1="6.5" y1="12" x2="14.5" y2="12" stroke="#1E293B" stroke-width="1.2" stroke-linecap="round"/>
      <line x1="6.5" y1="15" x2="11" y2="15" stroke="#1E293B" stroke-width="1.2" stroke-linecap="round"/>
    </svg>
  </div>
  <div>
    <div class="logo-text"><span style="background:#1E293B;color:#fff;padding:1px 5px;border-radius:4px;font-size:13px;margin-right:3px;">CV</span>Builder Pro</div>
    <div class="logo-sub">Free · Offline · Auto-saves</div>
  </div>
  <select id="slot-select" onchange="loadSlot(+this.value)">
    <option value="0"> CV 1</option>
    <option value="1"> CV 2</option>
    <option value="2"> CV 3</option>
  </select>
  <div class="topbar-btns">
    <button class="tbtn tbtn-danger tb-hide-mobile" onclick="confirmHardReset()" title="Reset CV">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a1 1 0 011-1h4a1 1 0 011 1v2"/></svg>
      <span>Reset</span>
    </button>
    <button class="tbtn tbtn-light tb-hide-mobile" onclick="backupData()" title="Backup">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      <span>Backup</span>
    </button>
    <button class="tbtn tbtn-wm tb-hide-mobile" onclick="downloadWatermarkPDF()" title="Preview PDF">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
      <span>Preview PDF</span>
    </button>
    <button class="tbtn tbtn-dark" onclick="downloadPDF()">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      <span>Download PDF</span>
    </button>
  </div>
</div>

<!-- SIDEBAR -->
<div id="sidebar">
  <div class="sidebar-section">Build CV</div>
  <div class="nav-item active" onclick="showPage('personal')" data-page="personal"><span class="icon"></span>Personal Info</div>
  <div class="nav-item" onclick="showPage('experience')" data-page="experience"><span class="icon"></span>Experience</div>
  <div class="nav-item" onclick="showPage('education')" data-page="education"><span class="icon"></span>Education</div>
  <div class="nav-item" onclick="showPage('skills')" data-page="skills"><span class="icon"></span>Skills</div>
  <div class="nav-item" onclick="showPage('extras')" data-page="extras"><span class="icon"></span>Extras & Toggles</div>
  <div class="sidebar-section">Design</div>
  <div class="nav-item" onclick="showPage('design')" data-page="design"><span class="icon"></span>Templates & Style</div>
  <div class="sidebar-section">Tools</div>
  <div class="nav-item" onclick="showPage('cvimport')" data-page="cvimport"><span class="icon"></span>Import Old CV</div>
  <div class="nav-item" id="nav-backup" onclick="backupData()"><span class="icon"></span>Download Backup</div>
  <div class="nav-item" id="nav-restore" onclick="document.getElementById('restore-input').click()"><span class="icon"></span>Restore Backup</div>
  <input type="file" id="restore-input" accept=".json" style="display:none" onchange="restoreData(this)"/>
  <div class="nav-footer">Free · Auto-saved · Works Offline<br/>No internet needed</div>
</div>

<!-- MAIN APP -->
<div id="app">
<div id="main-content">

  <!-- PERSONAL -->
  <div id="page-personal" class="page active">
    <div class="section-title"> Personal Information</div>
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Profile Photo & Name</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div class="g2">
          <div>
            <div id="photo-zone" onclick="document.getElementById('photo-input').click()">
              <div class="photo-placeholder"><span></span><p>Tap to upload</p></div>
              <div class="overlay">Change Photo</div>
            </div>
            <input type="file" id="photo-input" accept="image/*" style="display:none" onchange="handlePhoto(this)"/>
            <button onclick="removePhoto()" style="width:100%;margin-top:6px;padding:6px;background:var(--bg);border:1px solid var(--border);border-radius:7px;font-size:12px;color:var(--muted);cursor:pointer;"> Remove Photo</button>
          </div>
          <div>
            <div class="field"><label>Full Name <span class="req">*</span></label><input id="p_name" placeholder="Enter your full name" oninput="autoSave()"/></div>
            <div class="field"><label>Father's Name</label><input id="p_father" placeholder="Enter your father's name" oninput="autoSave()"/></div>
            <div class="field"><label>Job Title <span class="req">*</span></label><input id="p_title" placeholder="Enter your job title" oninput="autoSave()"/></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Contact Details</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div class="g2">
          <div class="field"><label>Phone <span class="req">*</span></label><input id="p_phone" type="tel" placeholder="Enter your phone number" oninput="autoSave()"/></div>
          <div class="field"><label>Email</label><input id="p_email" type="email" placeholder="Enter your email address" oninput="autoSave()"/></div>
        </div>
        <div class="field"><label>City, Country <span class="req">*</span></label><input id="p_location" placeholder="e.g. Mumbai, India" oninput="autoSave()"/></div>
        <div class="field"><label>LinkedIn (Optional)</label><input id="p_linkedin" placeholder="linkedin.com/in/yourprofile" oninput="autoSave()"/></div>
      </div>
    </div>

    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Personal Details</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div class="g2">
          <div class="field"><label>Date of Birth</label><input id="p_dob" placeholder="e.g. 12 Jan 1993" oninput="autoSave()"/></div>
          <div class="field"><label>Nationality</label><input id="p_nation" placeholder="e.g. Indian" oninput="autoSave()"/></div>
          <div class="field"><label>Marital Status</label><input id="p_marital" placeholder="e.g. Married" oninput="autoSave()"/></div>
          <div class="field"><label>Religion</label><input id="p_religion" placeholder="e.g. Hindu" oninput="autoSave()"/></div>
        </div>
        <div class="field"><label>Languages Known</label><input id="p_lang" placeholder="e.g. Hindi, English, Odia" oninput="autoSave()"/></div>
        <div class="g2">
          <div class="field"><label>Passport No.</label><input id="p_passport" placeholder="e.g. A1234567" oninput="autoSave()"/></div>
          <div class="field"><label>Passport Expiry</label><input id="p_passport_exp" placeholder="e.g. 27/12/2033" oninput="autoSave()"/></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon">️</span><span class="card-title">Professional Summary</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div class="field">
          <textarea id="p_summary" rows="4" placeholder="Write 2–4 lines about your experience, key skills, and what makes you a strong candidate..." oninput="autoSave();updateSummaryCount()"></textarea>
          <div style="text-align:right;font-size:10px;color:var(--muted);margin-top:3px;"><span id="summary-count">0</span> characters</div>
        </div>
        <button onclick="autoGenSummary()" id="ai-sum-btn" style="padding:9px 18px;background:linear-gradient(135deg,#0F766E,#0D6B63);border:none;border-radius:8px;color:#fff;font-weight:700;font-size:12px;cursor:pointer;letter-spacing:.4px;transition:opacity .15s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">Generate with AI</button>
      </div>
    </div>
  </div>

  <!-- EXPERIENCE -->
  <div id="page-experience" class="page">
    <div class="section-title"> Work Experience</div>
    <div class="info-box">ℹ️ Add most recent job first.</div>
    <div id="jobs-container"></div>
    <button class="add-entry-btn" onclick="addJob()">+ Add Job</button>
  </div>

  <!-- EDUCATION -->
  <div id="page-education" class="page">
    <div class="section-title"> Education</div>
    <div id="edu-container"></div>
    <button class="add-entry-btn" onclick="addEdu()">+ Add Education</button>
  </div>

  <!-- SKILLS -->
  <div id="page-skills" class="page">
    <div class="section-title"> Skills & Certifications</div>
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Skills</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div id="skills-container"></div>
        <button class="add-entry-btn" onclick="addSkill()">+ Add Skill</button>
      </div>
    </div>
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Certifications</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div id="certs-container"></div>
        <button class="add-entry-btn" onclick="addCert()">+ Add Certificate</button>
      </div>
    </div>
  <!-- CUSTOM SECTIONS -->
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Custom Sections</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div style="font-size:11px;color:var(--muted);margin-bottom:12px;background:var(--primary-light);border:1px solid rgba(15,118,110,.2);border-radius:8px;padding:10px;">
           Add any section — <strong>Interests, Hobbies, Languages, Achievements, Volunteer Work, Projects, Awards</strong> etc. Each section gets its own heading, entries with sub-titles, dates, and bullet points — just like Experience.
        </div>
        <div id="custom-sections-container"></div>
        <button class="add-entry-btn" onclick="addCustomSection()">+ Add Custom Section</button>
      </div>
    </div>
  </div>

  <!-- EXTRAS -->
  <div id="page-extras" class="page">
    <div class="section-title"> Extras & Page Layout</div>

    <!-- TOGGLES -->
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Section Toggles</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div class="toggle-row">
          <div class="toggle-info"><label for="tog_decl">Include Declaration</label><span>Standard declaration at end of CV</span></div>
          <label class="switch"><input type="checkbox" id="tog_decl" onchange="autoSave();renderPageLayout()"/><span class="slider"></span></label>
        </div>
        <div class="toggle-row">
          <div class="toggle-info"><label for="tog_personal">Personal Details Section</label><span>DOB, Nationality, Passport etc.</span></div>
          <label class="switch"><input type="checkbox" id="tog_personal" onchange="autoSave();renderPageLayout()"/><span class="slider"></span></label>
        </div>
        <div class="toggle-row">
          <div class="toggle-info"><label for="tog_photo">Show Photo on CV</label><span>Display uploaded photo on CV</span></div>
          <label class="switch"><input type="checkbox" id="tog_photo" onchange="autoSave()" checked/><span class="slider"></span></label>
        </div>
        <div class="toggle-row">
          <div class="toggle-info"><label for="tog_father">Show Father's Name on CV</label><span>Display S/O father name on CV</span></div>
          <label class="switch"><input type="checkbox" id="tog_father" onchange="autoSave()" checked/><span class="slider"></span></label>
        </div>
      </div>
    </div>

    <!-- FONT FAMILY SELECTOR -->
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Font Style</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <style>
          .font-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:4px;}
          .font-card{border:2px solid var(--border);border-radius:10px;padding:10px 12px;cursor:pointer;transition:all .15s;background:var(--card);position:relative;overflow:hidden;}
          .font-card:hover{border-color:var(--primary);background:#FAFFFF;}
          .font-card.active{border-color:var(--primary);background:var(--primary-light);}
          .font-card.active::after{content:"";position:absolute;top:7px;right:9px;font-size:11px;font-weight:900;color:var(--primary);}
          .font-card-name{font-weight:800;font-size:11px;color:var(--text);margin-bottom:3px;letter-spacing:.3px;}
          .font-card-preview{font-size:15px;color:#444;line-height:1.3;margin-bottom:3px;}
          .font-card-tag{font-size:9px;color:var(--muted);background:var(--bg);border-radius:4px;padding:2px 6px;display:inline-block;}
        </style>
        <p style="font-size:11px;color:var(--muted);margin-bottom:10px;line-height:1.5;">Choose a font style for your CV. Each family gives a different professional feel.</p>
        <div class="font-grid">
          <div class="font-card active" id="ff-default" onclick="applyFontFamily('default')">
            <div class="font-card-name">Default</div>
            <div class="font-card-preview" style="font-family:Georgia,serif;">Resume</div>
            <span class="font-card-tag">Classic</span>
          </div>
          <div class="font-card" id="ff-playfair" onclick="applyFontFamily('playfair')">
            <div class="font-card-name">Playfair Display</div>
            <div class="font-card-preview" style="font-family:'Playfair Display',serif;">Resume</div>
            <span class="font-card-tag">Elegant · Serif</span>
          </div>
          <div class="font-card" id="ff-montserrat" onclick="applyFontFamily('montserrat')">
            <div class="font-card-name">Montserrat</div>
            <div class="font-card-preview" style="font-family:'Montserrat',sans-serif;">Resume</div>
            <span class="font-card-tag">Modern · Bold</span>
          </div>
          <div class="font-card" id="ff-raleway" onclick="applyFontFamily('raleway')">
            <div class="font-card-name">Raleway</div>
            <div class="font-card-preview" style="font-family:'Raleway',sans-serif;">Resume</div>
            <span class="font-card-tag">Premium · Clean</span>
          </div>
          <div class="font-card" id="ff-garamond" onclick="applyFontFamily('garamond')">
            <div class="font-card-name">EB Garamond</div>
            <div class="font-card-preview" style="font-family:'EB Garamond',serif;">Resume</div>
            <span class="font-card-tag">Literary · Refined</span>
          </div>
          <div class="font-card" id="ff-josefin" onclick="applyFontFamily('josefin')">
            <div class="font-card-name">Josefin Sans</div>
            <div class="font-card-preview" style="font-family:'Josefin Sans',sans-serif;">Resume</div>
            <span class="font-card-tag">Geometric · Sharp</span>
          </div>
          <div class="font-card" id="ff-nunito" onclick="applyFontFamily('nunito')">
            <div class="font-card-name">Nunito Sans</div>
            <div class="font-card-preview" style="font-family:'Nunito Sans',sans-serif;">Resume</div>
            <span class="font-card-tag">Friendly · Round</span>
          </div>
          <div class="font-card" id="ff-cormorant" onclick="applyFontFamily('cormorant')">
            <div class="font-card-name">Cormorant</div>
            <div class="font-card-preview" style="font-family:'Cormorant Garamond',serif;">Resume</div>
            <span class="font-card-tag">Luxury · Editorial</span>
          </div>
          <div class="font-card" id="ff-lato" onclick="applyFontFamily('lato')" style="grid-column:1/-1;">
            <div class="font-card-name">Lato</div>
            <div class="font-card-preview" style="font-family:'Lato',sans-serif;font-size:18px;">Resume · Professional</div>
            <span class="font-card-tag">Corporate · Trusted</span>
          </div>
        </div>
      </div>
    </div>

    <!-- FONT SIZE CONTROLS -->
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Typography Style</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">

        <style>
          .typo-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:4px;}
          .typo-preset{border:2px solid var(--border);border-radius:10px;padding:10px 12px;cursor:pointer;transition:all .15s;background:var(--card);position:relative;overflow:hidden;}
          .typo-preset:hover{border-color:var(--primary);background:#FAFFFF;}
          .typo-preset.active{border-color:var(--primary);background:var(--primary-light);}
          .typo-preset.active::after{content:"";position:absolute;top:7px;right:9px;font-size:11px;font-weight:900;color:var(--primary);}
          .typo-name{font-weight:800;font-size:12px;color:var(--text);margin-bottom:3px;}
          .typo-desc{font-size:10px;color:var(--muted);margin-bottom:7px;line-height:1.3;}
          .typo-bars{display:flex;flex-direction:column;gap:2px;}
          .typo-bar-row{display:flex;align-items:center;gap:5px;}
          .typo-bar{background:var(--primary);border-radius:3px;opacity:.35;transition:opacity .15s;}
          .typo-bar-lbl{font-size:8.5px;color:var(--muted);min-width:28px;}
          .typo-preset.active .typo-bar{opacity:.75;}
          .typo-preset:hover .typo-bar{opacity:.55;}
        </style>

        <!-- Hidden inputs keep save/load working -->
        <input type="hidden" id="fs-name" value="24"/>
        <input type="hidden" id="fs-toptitle" value="14"/>
        <input type="hidden" id="fs-section" value="13"/>
        <input type="hidden" id="fs-subheader" value="13"/>
        <input type="hidden" id="fs-body" value="12"/>

        <div class="typo-grid">

          <!-- Preset 1: Professional -->
          <div class="typo-preset active" id="typo-professional" onclick="applyTypoPreset('professional')">
            <div class="typo-name">Professional</div>
            <div class="typo-desc">Clean & balanced. Best for most jobs.</div>
            <div class="typo-bars">
              <div class="typo-bar-row"><span class="typo-bar-lbl">Name</span><div class="typo-bar" style="height:5px;width:70px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Title</span><div class="typo-bar" style="height:4px;width:45px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Header</span><div class="typo-bar" style="height:3px;width:36px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Body</span><div class="typo-bar" style="height:2.5px;width:28px;"></div></div>
            </div>
          </div>

          <!-- Preset 2: Compact -->
          <div class="typo-preset" id="typo-compact" onclick="applyTypoPreset('compact')">
            <div class="typo-name">Compact</div>
            <div class="typo-desc">Fits more content. One page CVs.</div>
            <div class="typo-bars">
              <div class="typo-bar-row"><span class="typo-bar-lbl">Name</span><div class="typo-bar" style="height:5px;width:55px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Title</span><div class="typo-bar" style="height:4px;width:36px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Header</span><div class="typo-bar" style="height:3px;width:28px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Body</span><div class="typo-bar" style="height:2px;width:22px;"></div></div>
            </div>
          </div>

          <!-- Preset 3: Bold -->
          <div class="typo-preset" id="typo-bold" onclick="applyTypoPreset('bold')">
            <div class="typo-name">Bold & Modern</div>
            <div class="typo-desc">Strong hierarchy. Makes a statement.</div>
            <div class="typo-bars">
              <div class="typo-bar-row"><span class="typo-bar-lbl">Name</span><div class="typo-bar" style="height:6px;width:80px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Title</span><div class="typo-bar" style="height:4.5px;width:52px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Header</span><div class="typo-bar" style="height:3.5px;width:40px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Body</span><div class="typo-bar" style="height:3px;width:32px;"></div></div>
            </div>
          </div>

          <!-- Preset 4: Executive -->
          <div class="typo-preset" id="typo-executive" onclick="applyTypoPreset('executive')">
            <div class="typo-name">Executive</div>
            <div class="typo-desc">Premium feel. Senior & leadership roles.</div>
            <div class="typo-bars">
              <div class="typo-bar-row"><span class="typo-bar-lbl">Name</span><div class="typo-bar" style="height:6px;width:72px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Title</span><div class="typo-bar" style="height:4.5px;width:50px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Header</span><div class="typo-bar" style="height:4px;width:44px;"></div></div>
              <div class="typo-bar-row"><span class="typo-bar-lbl">Body</span><div class="typo-bar" style="height:3px;width:34px;"></div></div>
            </div>
          </div>

          <!-- Preset 5: Ultra Compact (full width) -->
          <div class="typo-preset" id="typo-ultra" onclick="applyTypoPreset('ultra')" style="grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;">
            <div>
              <div class="typo-name">Ultra Compact</div>
              <div class="typo-desc" style="margin-bottom:0;">Maximum content. Experienced professionals with lots to show.</div>
            </div>
            <div class="typo-bars" style="flex-direction:row;align-items:flex-end;gap:3px;flex-shrink:0;margin-left:10px;">
              <div class="typo-bar" style="height:14px;width:7px;border-radius:2px;"></div>
              <div class="typo-bar" style="height:10px;width:7px;border-radius:2px;"></div>
              <div class="typo-bar" style="height:8px;width:7px;border-radius:2px;"></div>
              <div class="typo-bar" style="height:7px;width:7px;border-radius:2px;"></div>
            </div>
          </div>

        </div>

      </div>
    </div>

        <!-- PAGE LAYOUT MANAGER -->
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Page Layout Control</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div class="info-box" style="margin-bottom:12px;"> Control section order in your CV. P1 sections appear first (start of CV), P2 sections in the middle, P3 sections last. Smart page-breaking ensures clean cuts — no text is ever split mid-sentence.</div>
        <div style="display:flex;justify-content:flex-end;margin-bottom:8px;">
          <button onclick="resetPageLayout()" style="padding:5px 12px;background:#FEF2F2;color:#EF4444;border:1.5px solid #FECACA;border-radius:7px;font-size:11px;font-weight:700;cursor:pointer;" title="Reset all sections back to defaults">↺ Reset Layout</button>
        </div>
        <div id="page-layout-ui"></div>
        <div style="margin-top:14px;padding:10px;background:#F0FDF4;border-radius:8px;border:1px solid #86EFAC;">
          <div style="font-size:11px;font-weight:700;color:#166534;margin-bottom:6px;"> Margin Settings</div>
          <div class="g2" style="gap:10px;">
            <div class="field" style="margin:0;">
              <label style="font-size:11px;">Bottom margin — Page 1 (mm)</label>
              <input type="number" id="margin_p1_b" value="10" min="0" max="40" oninput="autoSave();schedulePreview()" style="font-size:13px;"/>
            </div>
            <div class="field" style="margin:0;">
              <label style="font-size:11px;">Top margin — Page 2+ (mm)</label>
              <input type="number" id="margin_p2_t" value="10" min="0" max="40" oninput="autoSave();schedulePreview()" style="font-size:13px;"/>
            </div>
          </div>
          <div class="field" style="margin:8px 0 0;">
            <label style="font-size:11px;">Bottom margin — Page 2+ (mm)</label>
            <input type="number" id="margin_p2_b" value="10" min="0" max="40" oninput="autoSave();schedulePreview()" style="font-size:13px;"/>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DESIGN -->
  <div id="page-design" class="page">
    <div class="section-title">Templates &amp; Style</div>
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Choose Template</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div class="tpl-grid" id="tpl-grid"></div>
      </div>
    </div>

    <!-- UNIFIED COLOR & STYLE CARD -->
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Colors &amp; Style</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body" style="display:flex;flex-direction:column;gap:20px;">

        <!-- THEME PRESETS — top section, most prominent -->
        <div class="ds-section">
          <div class="ds-label">Quick Themes</div>
          <div class="ds-hint">One tap sets the whole look</div>
          <div id="theme-preset-grid" class="theme-grid"></div>
        </div>

        <!-- ACCENT COLOR -->
        <div class="ds-section">
          <div class="ds-label">Accent Color</div>
          <div class="ds-hint">Used for section titles, borders and highlights</div>
          <div class="ds-swatches" id="color-grid"></div>
        </div>

        <!-- HEADER COLOR -->
        <div class="ds-section">
          <div class="ds-label">Header Color</div>
          <div class="ds-hint">Background of the name and contact area</div>
          <div class="ds-swatches" id="header-color-grid"></div>
          <div class="ds-toggle-row" style="margin-top:10px;">
            <span class="ds-toggle-label">Text on header</span>
            <div class="ds-toggle-btns">
              <button id="ht-light" onclick="setHeaderText('light')" class="ds-tog active">White</button>
              <button id="ht-dark"  onclick="setHeaderText('dark')"  class="ds-tog">Black</button>
            </div>
          </div>
        </div>

        <!-- SECTION LINE STYLE -->
        <div class="ds-section">
          <div class="ds-label">Section Lines</div>
          <div class="ds-hint">Style of the line under each section heading</div>
          <div class="ds-line-btns">
            <button id="bar-solid"    onclick="setBarStyle('solid')"    class="ds-line-btn active">
              <div class="ds-line-preview"><div style="height:2px;background:var(--primary);border-radius:2px;"></div></div>
              <span>Solid</span>
            </button>
            <button id="bar-gradient" onclick="setBarStyle('gradient')" class="ds-line-btn">
              <div class="ds-line-preview"><div style="height:2px;background:linear-gradient(90deg,var(--primary),transparent);border-radius:2px;"></div></div>
              <span>Fade</span>
            </button>
            <button id="bar-dots"     onclick="setBarStyle('dots')"     class="ds-line-btn">
              <div class="ds-line-preview"><div style="height:2px;background:repeating-linear-gradient(90deg,var(--primary) 0,var(--primary) 4px,transparent 4px,transparent 8px);"></div></div>
              <span>Dots</span>
            </button>
            <button id="bar-line"     onclick="setBarStyle('line')"     class="ds-line-btn">
              <div class="ds-line-preview"><div style="height:0;border-top:1.5px dashed var(--primary);"></div></div>
              <span>Dash</span>
            </button>
            <button id="bar-none"     onclick="setBarStyle('none')"     class="ds-line-btn">
              <div class="ds-line-preview"><div style="height:2px;background:transparent;"></div></div>
              <span>None</span>
            </button>
          </div>
        </div>

      </div>
    </div>

    <!-- SPACING & FONT -->
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon">↔️</span><span class="card-title">Spacing &amp; Font Size</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div class="field">
          <label>Font Size</label>
          <div style="display:flex;align-items:center;gap:12px;">
            <span style="font-size:11px;color:var(--muted);">A</span>
            <input type="range" id="font-size-slider" min="9" max="16" value="12" step="0.5" oninput="updateDesign()" style="flex:1;accent-color:var(--primary);"/>
            <span style="font-size:15px;color:var(--muted);">A</span>
          </div>
        </div>
        <div class="field">
          <label>Layout Spacing</label>
          <div style="display:flex;gap:8px;">
            <button id="sp-compact"  onclick="setSpacing('compact')"  class="icon-btn active" style="flex:1;justify-content:center;">Compact</button>
            <button id="sp-normal"   onclick="setSpacing('normal')"   class="icon-btn"        style="flex:1;justify-content:center;">Normal</button>
            <button id="sp-spacious" onclick="setSpacing('spacious')" class="icon-btn"        style="flex:1;justify-content:center;">Spacious</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- BACKUP/RESTORE PAGE -->
  <div id="page-import" class="page">
    <div class="section-title"> Backup & Restore</div>
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Backup & Restore Your CV Data</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div class="info-box">ℹ️ Download a backup of all your CV data. Restore it anytime on any device — even offline.</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <button onclick="backupData()" class="tbtn tbtn-primary" style="flex:1;justify-content:center;">⬇ Download Backup</button>
          <button onclick="document.getElementById('restore-input-2').click()" class="tbtn tbtn-light" style="flex:1;justify-content:center;">⬆ Restore Backup</button>
        </div>
        <input type="file" id="restore-input-2" accept=".json" style="display:none" onchange="restoreData(this)"/>
        <p style="font-size:11px;color:var(--muted);margin-top:10px;">Your backup includes all 3 CV slots. Restore will overwrite current data.</p>
      </div>
    </div>
    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Reset CV Data</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <p style="font-size:13px;color:var(--muted);margin-bottom:12px;">Hard reset clears all data for the current CV slot. This cannot be undone.</p>
        <button onclick="confirmHardReset()" class="tbtn tbtn-danger" style="width:100%;justify-content:center;padding:12px;"> Hard Reset Current CV</button>
      </div>
    </div>
  </div>

  <!-- IMPORT OLD CV PAGE -->
  <div id="page-cvimport" class="page">
    <div class="section-title"> Import Old CV</div>

    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Upload Your Old CV (PDF)</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div class="info-box">ℹ️ Upload your existing CV as a PDF. We'll read it and auto-fill your name, phone, email, jobs, education, skills and more. Works 100% offline — nothing leaves your device.</div>

        <!-- Drop zone -->
        <div id="cv-import-zone" class="import-zone"
          onclick="document.getElementById('cv-import-input').click()"
          ondragover="event.preventDefault();this.classList.add('dragover')"
          ondragleave="this.classList.remove('dragover')"
          ondrop="event.preventDefault();this.classList.remove('dragover');handleCVImportFile(event.dataTransfer.files[0])">
          <div class="import-icon"></div>
          <p style="font-weight:700;font-size:14px;color:var(--text);margin-bottom:4px;">Tap to choose PDF or drag &amp; drop here</p>
          <p>Works offline · No data leaves your device</p>
        </div>
        <input type="file" id="cv-import-input" accept=".pdf" style="display:none" onchange="handleCVImportFile(this.files[0])"/>

        <!-- Progress bar -->
        <div id="cv-import-progress" style="display:none;margin-top:14px;">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
            <div style="width:18px;height:18px;border:3px solid var(--primary-light);border-top-color:var(--primary);border-radius:50%;animation:spin .8s linear infinite;flex-shrink:0;"></div>
            <span id="cv-import-status" style="font-size:13px;font-weight:600;color:var(--primary);">Reading PDF...</span>
          </div>
          <div class="import-progress"><div class="import-progress-bar" id="cv-import-bar"></div></div>
        </div>

        <!-- Error / info result -->
        <div id="cv-import-result" style="display:none;margin-top:12px;"></div>

        <!-- Extracted preview -->
        <div id="cv-import-preview" style="display:none;margin-top:14px;">
          <div style="font-size:11px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:.8px;margin-bottom:10px;">Extracted Data Preview</div>
          <div id="cv-import-fields" class="import-fields"></div>
          <div style="display:flex;gap:10px;margin-top:14px;flex-wrap:wrap;">
            <button onclick="applyImportedCV()" class="tbtn tbtn-primary" style="flex:1;min-width:140px;justify-content:center;padding:13px;"> Apply to CV Builder</button>
            <button onclick="resetCVImport()" class="tbtn tbtn-light" style="justify-content:center;padding:13px 18px;"> Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header" onclick="toggleCard(this)">
        <div class="card-header-left"><span class="card-icon"></span><span class="card-title">Tips for Best Results</span></div>
        <span class="chevron up">▾</span>
      </div>
      <div class="card-body">
        <div style="font-size:13px;color:var(--muted);line-height:2.2;">
          <div> <strong>Best:</strong> PDF made from Word, Google Docs, or any CV builder app</div>
          <div> <strong>Good:</strong> Any digitally typed PDF with selectable text</div>
          <div>️ <strong>Partial:</strong> Heavily designed / graphic CVs</div>
          <div> <strong>Won't work:</strong> Scanned paper CVs (image-only PDF)</div>
          <div style="margin-top:8px;padding-top:8px;border-top:1px solid var(--border);">After import, check each section and correct anything that wasn't picked up.</div>
        </div>
      </div>
    </div>
  </div>

</div><!-- end main-content -->

<!-- RIGHT PANEL -->
<div id="right-panel">
  <div id="strength-card">
    <h3> CV Strength</h3>
    <div class="score-ring">
      <div class="score-num" id="score-num">0</div>
      <div class="score-label">out of 100</div>
    </div>
    <div class="score-bar"><div class="score-fill" id="score-fill" style="width:0%"></div></div>
    <div id="score-items"></div>
  </div>
  <div id="preview-card">
    <h3> Live Preview <span style="font-size:10px;color:var(--muted);font-weight:400;">(A4 · live)</span></h3>
    <div id="preview-wrap">
      <div id="preview-sizer">
        <iframe id="preview-iframe" scrolling="no"></iframe>
      </div>
    </div>
    <div style="display:flex;gap:8px;margin-top:10px;">
      <button onclick="downloadWatermarkPDF()" class="tbtn tbtn-wm" style="flex:1;justify-content:center;font-size:12px;"> Preview PDF</button>
      <button onclick="downloadPDF()" class="tbtn tbtn-dark" style="flex:1;justify-content:center;font-size:12px;"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>&nbsp;Download PDF</button>
    </div>
  </div>
</div>

</div><!-- end app -->

<!-- MOBILE PREVIEW PAGE -->
<div id="preview-page">
  <div id="preview-mobile-toolbar">
    <span> CV Preview</span>
    <div style="display:flex;gap:6px;">
      <button class="export-btn" style="background:#7C3AED;" onclick="downloadWatermarkPDF()"> Preview</button>
      <button class="export-btn" onclick="downloadPDF()"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>&nbsp;Download PDF</button>
      <button class="close-btn" onclick="closeMobilePreview()">✕ Close</button>
    </div>
  </div>
  <div id="preview-scroll-area">
    <div id="preview-scaled-wrap">
      <iframe id="preview-full-iframe" scrolling="no"></iframe>
    </div>
  </div>
</div>

<!-- MOBILE BOTTOM NAV -->
<div id="bottom-nav">
  <button class="bnav-item active" onclick="showPage('personal')" data-page="personal"><span class="bnav-icon"></span>Info</button>
  <button class="bnav-item" onclick="showPage('experience')" data-page="experience"><span class="bnav-icon"></span>Work</button>
  <button class="bnav-item" onclick="showPage('education')" data-page="education"><span class="bnav-icon"></span>Edu</button>
  <button class="bnav-item" onclick="showPage('skills')" data-page="skills"><span class="bnav-icon"></span>Skills</button>
  <button class="bnav-item" onclick="showPage('extras')" data-page="extras"><span class="bnav-icon"></span>Extras</button>
  <button class="bnav-item" onclick="showPage('design')" data-page="design"><span class="bnav-icon"></span>Design</button>
  <button class="bnav-item" onclick="openMobilePreview()" id="bnav-preview"><span class="bnav-icon"></span>Preview</button>
  <button class="bnav-item" onclick="toggleMoreMenu()" id="bnav-more"><span class="bnav-icon">⋯</span>More</button>
</div>

<!-- MOBILE MORE MENU -->
<div id="more-menu">
  <div class="more-sheet">
    <div class="more-header">
      <span class="more-title">More Options</span>
      <button class="more-close-btn" onclick="closeMoreMenu()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="more-body">
      <button class="more-row" onclick="showPage('cvimport');closeMoreMenu();">
        <div class="more-icon-wrap c-teal">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        </div>
        <div class="more-text">
          <div class="more-row-title">Import Old CV</div>
          <div class="more-row-sub">Upload PDF and auto-fill all fields</div>
        </div>
        <div class="more-chevron"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg></div>
      </button>
      <div class="more-divider"></div>
      <button class="more-row" onclick="backupData();closeMoreMenu();">
        <div class="more-icon-wrap c-blue">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        </div>
        <div class="more-text">
          <div class="more-row-title">Download Backup</div>
          <div class="more-row-sub">Save all 3 CV slots as a file</div>
        </div>
        <div class="more-chevron"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg></div>
      </button>
      <button class="more-row" onclick="document.getElementById('restore-input-mob').click();closeMoreMenu();">
        <div class="more-icon-wrap c-purple">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
        </div>
        <div class="more-text">
          <div class="more-row-title">Restore Backup</div>
          <div class="more-row-sub">Load a previously saved backup file</div>
        </div>
        <div class="more-chevron"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg></div>
      </button>
      <input type="file" id="restore-input-mob" accept=".json" style="display:none" onchange="restoreData(this)"/>
      <div class="more-divider"></div>
      <button class="more-row more-row-danger" onclick="confirmHardReset();closeMoreMenu();">
        <div class="more-icon-wrap c-red">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a1 1 0 011-1h4a1 1 0 011 1v2"/></svg>
        </div>
        <div class="more-text">
          <div class="more-row-title">Reset Current CV</div>
          <div class="more-row-sub">Clear all data in this slot</div>
        </div>
        <div class="more-chevron"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg></div>
      </button>
    </div>
  </div>
</div>
<!-- backdrop to close more menu -->
<div id="more-backdrop" onclick="closeMoreMenu()" style="display:none;position:fixed;inset:0;z-index:499;"></div>

<!-- RESET CONFIRMATION MODAL -->
<div id="reset-modal" style="display:none;position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);align-items:center;justify-content:center;padding:16px;">
  <div style="background:#fff;border-radius:16px;padding:28px 24px;max-width:340px;width:100%;box-shadow:0 24px 64px rgba(0,0,0,.3);text-align:center;">
    <div style="font-size:40px;margin-bottom:10px;"></div>
    <h2 style="font-size:18px;font-weight:800;color:#1E293B;margin-bottom:8px;">Hard Reset CV?</h2>
    <p style="font-size:13px;color:#64748B;margin-bottom:20px;line-height:1.5;">This will clear <strong>all data</strong> in the current CV slot. This action cannot be undone.</p>
    <div style="display:flex;gap:10px;">
      <button onclick="closeResetModal()" style="flex:1;padding:12px;border:1.5px solid #E2E8F0;border-radius:9px;background:#F8FAFC;font-weight:700;font-size:13px;cursor:pointer;color:#64748B;">Cancel</button>
      <button onclick="hardReset()" style="flex:1;padding:12px;border:none;border-radius:9px;background:#EF4444;color:#fff;font-weight:700;font-size:13px;cursor:pointer;">Yes, Reset</button>
    </div>
  </div>
</div>

<!-- DEMO MODAL -->
<div id="demo-modal">
  <div id="demo-box">
    <div id="demo-topbar">
      <div>
        <div id="demo-title">Template</div>
        <div id="demo-subtitle"></div>
      </div>
      <button class="demo-close-btn" onclick="closeDemo()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div id="demo-scroll">
      <iframe id="demo-iframe" scrolling="no"></iframe>
    </div>
    <div id="demo-footer">
      <div class="demo-nav-row">
        <button class="demo-arrow" onclick="demoPrev()">◀</button>
        <div id="demo-dots" style="display:flex;gap:8px;"></div>
        <button class="demo-arrow" onclick="demoNext()">▶</button>
      </div>
      <button class="btn-use-tpl" onclick="selectTemplate(demoTpl);closeDemo();showToast('Template applied!')"> Use This Template</button>
    </div>
  </div>
</div>

<!-- BULLET LIBRARY MODAL -->
<div id="lib-modal">
  <div id="lib-box">
    <div class="lib-handle" style="width:40px;height:4px;background:#C4CDD8;border-radius:4px;margin:14px auto 0;cursor:grab;"></div>
    <div class="lib-header">
      <h3> Responsibility Suggestions</h3>
      <button onclick="closeLib()" style="border:none;background:none;font-size:20px;cursor:pointer;color:var(--muted);"></button>
    </div>
    <div style="padding:10px 14px;border-bottom:1px solid var(--border);">
      <input id="lib-search" type="text" placeholder="Search by job title or category..." oninput="filterLibCats(this.value)" style="width:100%;padding:9px 12px;border:1.5px solid var(--border);border-radius:8px;font-size:13px;background:var(--bg);color:var(--text);outline:none;box-sizing:border-box;" onfocus="this.style.borderColor='var(--primary)'" onblur="this.style.borderColor='var(--border)'"/>
      <div id="lib-match-hint" style="font-size:11px;color:var(--primary);font-weight:600;margin-top:5px;display:none;"></div>
    </div>
    <div class="lib-cats" id="lib-cats"></div>
    <div id="lib-bullets"></div>
  </div>
</div>

<!-- DOWNLOAD CODE MODAL — Free Version -->
<div id="pay-modal">
  <div id="pay-box">
    <div id="pay-header">
      <div class="pay-pill"></div>
      <button class="pay-close-x" onclick="closePayModal()" aria-label="Close">&#x2715;</button>
      <div class="pay-lock-icon">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.8)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
      </div>
      <h2>Download Clean PDF</h2>
      <p class="pay-sub">Pay &#x20B9;5 &rarr; Message us on WhatsApp &rarr; Get a code &rarr; 1-Day Access</p>
      <div class="pay-price-tag"><span class="sym">&#x20B9;</span><span class="num">5</span><span class="lbl">1-day access</span></div>
    </div>
    <div id="pay-body">
      <div id="pay-chooser">
        <div class="pay-cards">
          <div class="pay-card" onclick="showUPISec()" tabindex="0">
            <div class="pay-card-ico c-blue">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#3B82F6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>
            </div>
            <h3>Pay &#x20B9;5</h3><p>New here? Pay &#x20B9;5 for full-day access</p>
          </div>
          <div class="pay-card" onclick="showCodeSec()" tabindex="0">
            <div class="pay-card-ico c-green">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#22C55E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
            </div>
            <h3>Enter Code</h3><p>Already paid? Type the code we sent you</p>
          </div>
        </div>
      </div>
      <div id="pay-upi-sec">
        <div class="qr-wrap">
          <div id="pay-qr-canvas"></div>
          <p class="qr-hint">Scan with GPay, PhonePe, Paytm — or copy ID below</p>
        </div>
        <div class="upi-row">
          <div class="upi-text">
            <div class="upi-lbl">UPI ID</div>
            <div class="upi-val" id="upi-display">&#8226; &#8226; &#8226; &#8226; &#8226; &#8226;</div>
          </div>
          <button class="copy-btn" onclick="copyUPI()" id="copy-upi-btn">Copy</button>
        </div>
        <div class="send-note">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#166534" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
          Send exactly <strong style="margin:0 3px;">&#x20B9;5</strong> — then press the button below
        </div>
        <button class="wa-btn" onclick="openWhatsApp()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.099.539 4.073 1.482 5.796L0 24l6.371-1.461A11.94 11.94 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 22c-1.885 0-3.655-.508-5.183-1.393l-.371-.22-3.781.866.896-3.683-.242-.381A9.944 9.944 0 012 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10z"/></svg>
          I Paid — Message Us for Code
        </button>
        <div class="back-lnk" onclick="backToChooser()">&#8592; Go back</div>
      </div>
      <div id="pay-code-sec">
        <div class="err-box" id="err-box"></div>
        <div class="lock-box" id="lock-box">
          <div class="lock-title">Too many wrong attempts</div>
          <div class="lock-time" id="lock-timer">10:00</div>
          <div class="lock-sub">Please wait, then try again</div>
        </div>
        <div class="code-steps">
          <strong>How to get your code:</strong><br/>
          1. Pay &#x20B9;5 to our UPI ID<br/>
          2. Send us the payment screenshot on WhatsApp<br/>
          3. We will send you a 6-letter code<br/>
          4. Type the code below and download your CV
        </div>
        <div class="code-dots">
          <div class="cdot" id="cd1"></div><div class="cdot" id="cd2"></div><div class="cdot" id="cd3"></div>
          <span class="cdot-lbl">attempts remaining</span>
        </div>
        <label class="code-lbl" for="code-field">Enter your code here</label>
        <input class="code-field" id="code-field" maxlength="6" placeholder="&#xB7; &#xB7; &#xB7; &#xB7; &#xB7; &#xB7;" oninput="this.value=this.value.toUpperCase().replace(/[^A-Z0-9]/g,'')" onkeydown="if(event.key==='Enter')doSubmitCode()" autocomplete="off" spellcheck="false" inputmode="text"/>
        <div class="code-pool-hint">Enter the 6-character code exactly as received</div>
        <button class="unlock-btn" id="unlock-btn" onclick="doSubmitCode()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
          Unlock &amp; Download
        </button>
        <div class="back-lnk" onclick="backToChooser()">&#8592; Go back &nbsp;&middot;&nbsp;<span onclick="showUPISec()" style="color:#3B82F6;font-weight:700;cursor:pointer;">Pay &#x20B9;5</span></div>
      </div>
    </div>
  </div>
</div>




<!-- FREE TEMPLATE DOWNLOAD MODAL -->
<div id="free-modal">
  <div id="free-box">
    <div id="free-header">
      <div class="free-pill"></div>
      <button class="free-close-x" onclick="closeFreeModal()">&#x2715;</button>
      <h2>&#x1F193; Free Template Download</h2>
      <p>Request a free download code from admin or enter an existing code</p>
    </div>
    <div id="free-body">
      <div id="free-chooser">
        <div class="free-cards">
          <div class="free-card" onclick="showFreeReq()">
            <div class="free-card-ico c-blue">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#3B82F6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.17 9.81 19.79 19.79 0 01.08 1.21 2 2 0 012.06 0h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L6.37 7.37a16 16 0 006.26 6.26l.93-.93a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg>
            </div>
            <h3>Ask Admin</h3>
            <p>Request a free code from the admin via WhatsApp</p>
          </div>
          <div class="free-card" onclick="showFreeCode()">
            <div class="free-card-ico c-green">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#22C55E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
            </div>
            <h3>Enter Code</h3>
            <p>Already have a code? Enter it below to download</p>
          </div>
        </div>
      </div>
      <div id="free-req-sec">
        <div class="free-section-title">&#x1F4DE; Request a Free Download Code</div>
        <div class="free-steps">
          <strong>How to get your free code:</strong><br/>
          1. Click the WhatsApp button below<br/>
          2. Send message: <em>"Free CV Code"</em><br/>
          3. Admin will reply with your 6-letter code<br/>
          4. Come back here and enter the code to download
        </div>
        <button class="free-wa-btn" onclick="freeOpenWhatsApp()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.099.539 4.073 1.482 5.796L0 24l6.371-1.461A11.94 11.94 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 22c-1.885 0-3.655-.508-5.183-1.393l-.371-.22-3.781.866.896-3.683-.242-.381A9.944 9.944 0 012 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10z"/></svg>
          Message Admin on WhatsApp
        </button>
        <div class="free-back-lnk" onclick="backToFreeChooser()">&#8592; Back &nbsp;&middot;&nbsp; <span onclick="showFreeCode()">Already have a code?</span></div>
      </div>
      <div id="free-code-sec">
        <div class="free-section-title">&#x1F511; Enter Your Download Code</div>
        <div id="free-err" class="free-err">Invalid or expired code. Please try again.</div>
        <input class="free-code-input" id="free-code-field" maxlength="6" placeholder="&#xB7; &#xB7; &#xB7; &#xB7; &#xB7; &#xB7;"
          oninput="this.value=this.value.toUpperCase().replace(/[^A-Z0-9]/g,'')"
          onkeydown="if(event.key==='Enter')doFreeUnlock()"
          autocomplete="off" spellcheck="false" inputmode="text"/>
        <div class="free-note">Enter the 6-character code from admin</div>
        <button class="free-unlock-btn" id="free-unlock-btn" onclick="doFreeUnlock()" style="margin-top:12px;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
          Download Free CV
        </button>
        <div class="free-back-lnk" onclick="backToFreeChooser()">&#8592; Back &nbsp;&middot;&nbsp; <span onclick="showFreeReq()">Ask Admin for code</span></div>
      </div>
    </div>
  </div>
</div>

<!-- ADMIN PANEL — open by clicking logo 5 times fast -->
<div id="admin-panel">
  <div id="admin-box" style="max-width:400px;">
    <div id="admin-header">
      <h3> Admin Panel</h3>
      <button class="admin-x" onclick="closeAdmin()">&#x2715;</button>
    </div>
    <div id="admin-body">
      <div id="admin-login-sec">
        <div style="color:#475569;font-size:11.5px;text-align:center;margin-bottom:12px;">Enter admin password to continue</div>
        <input class="a-pwd" type="password" id="a-pwd" placeholder="&#9679;&#9679;&#9679;&#9679;" onkeydown="if(event.key==='Enter')doAdminLogin()"/>
        <button class="a-login" onclick="doAdminLogin()">Login</button>
        <div class="a-err" id="a-err">Wrong password. Try again.</div>
      </div>
      <div id="admin-content">
        <div class="admin-tabs">
          <button class="admin-tab active" onclick="switchAdminTab('codes',this)"> Codes</button>
          <button class="admin-tab" onclick="switchAdminTab('generate',this)"> Generate</button>
          <button class="admin-tab" onclick="switchAdminTab('free',this)"> Free</button>
        </div>

        <!-- CODES TAB -->
        <div class="admin-tab-pane active" id="atab-codes">
          <div class="a-lbl">Today's Date</div>
          <div class="a-code" id="a-day">--</div>
          <div class="a-date" id="a-date-full"></div>
          <div class="a-rule">
            <b>Valid codes end in: <span id="a-eg-date" style="color:#34D399;font-size:16px;">--</span></b><br/>
            Example code: <b id="a-eg-code" style="color:#34D399;font-size:18px;letter-spacing:4px;">------</b>
          </div>
        </div>

        <!-- GENERATE TAB -->
        <div class="admin-tab-pane" id="atab-generate">
          <div class="a-lbl" style="margin-bottom:8px;">Auto-Generate Code</div>
          <div class="a-rule" style="margin-bottom:10px;">
            Give this code to users who request a download. Code is valid for <b style="color:#34D399;">today only</b>.
          </div>
          <button class="a-gen-btn" onclick="adminGenCode()"> Generate New Code</button>
          <div class="a-code-out" id="a-gen-out" style="display:none;">
            <div style="font-size:10px;color:#64748B;margin-bottom:4px;">Share this code:</div>
            <div class="a-code-big" id="a-gen-code-val">------</div>
            <button class="a-code-copy" onclick="adminCopyCode()"> Copy Code</button>
            <div style="font-size:10px;color:#475569;margin-top:6px;" id="a-gen-expiry"></div>
          </div>
          <div style="margin-top:12px;" class="a-rule">
            <b style="color:#94A3B8;">Recent codes given:</b>
            <div id="a-recent-codes" style="margin-top:6px;font-size:11px;color:#64748B;">–</div>
          </div>
        </div>

        <!-- FREE SETTINGS TAB -->
        <div class="admin-tab-pane" id="atab-free">
          <div class="a-free-section">
            <div class="a-free-label"> Free Download Password</div>
            <input class="a-free-input" type="text" id="admin-free-pwd" placeholder="e.g. XK9P2M" maxlength="20" autocomplete="off" spellcheck="false"/>
            <div class="a-free-current">Current: <span id="admin-free-pwd-current" style="color:#34D399;">–</span></div>
            <div class="a-free-hint">Any characters. Case-insensitive. Users type this to download free CVs.</div>
            <button class="a-free-gen-btn" onclick="adminGenFreePassword()"> Generate Random Password</button>
          </div>
          <div class="a-free-section">
            <div class="a-free-label"> WhatsApp Number (Free)</div>
            <input class="a-free-input wa" type="tel" id="admin-free-wa" placeholder="+91 98765 43210" autocomplete="off"/>
            <div class="a-free-current">Current: <span id="admin-free-wa-current" style="color:#60A5FA;">–</span></div>
            <div class="a-free-hint">Include country code. E.g. +919876543210</div>
          </div>
          <button class="a-free-save" onclick="adminSaveFreeSettings()"> Save Free Settings</button>
          <div class="a-free-msg" id="admin-free-msg"></div>

        </div>

      </div>
    </div>
  </div>
</div>

<!-- PRINT OVERLAY (fallback) -->
<!-- PRINT OVERLAY (fallback) -->
<div id="print-overlay">
  <style id="print-cv-styles"></style>
  <div id="print-cv-content"></div>
</div>

<script>
// ══════════════════════════════════════════════════════════
// CONSTANTS
// ══════════════════════════════════════════════════════════
// ── PREMIUM COLOR PALETTE ── organized by family
const COLOR_PALETTES = [
  { label: '🌿 Professional', colors: ['#0F766E','#0369A1','#1D4ED8','#374151','#1e3a5f'] },
  { label: '✨ Premium Dark',  colors: ['#1a1a2e','#16213e','#0f3460','#1B2A4A','#2C1A4E'] },
  { label: '🏆 Luxury',        colors: ['#B8860B','#92400E','#7f6000','#4A1942','#5C2D0E'] },
  { label: '🎨 Creative',      colors: ['#7C3AED','#6D28D9','#B91C1C','#C2410C','#0891B2'] },
  { label: '🌱 Natural',       colors: ['#047857','#065F46','#4D7C0F','#6B5E4C','#78716C'] },
];
const COLORS = COLOR_PALETTES.flatMap(p => p.colors);

// ── FULL CV THEME PRESETS (accent + header combos) ──
const COLOR_THEMES = [
  { name:'Classic Teal',    accent:'#0F766E', header:'#0F766E', headerText:'light' },
  { name:'Royal Navy',      accent:'#1e3a5f', header:'#1e3a5f', headerText:'light' },
  { name:'Midnight',        accent:'#1a1a2e', header:'#1a1a2e', headerText:'light' },
  { name:'Dark Gold',       accent:'#B8860B', header:'#1a1a2e', headerText:'light' },
  { name:'Deep Emerald',    accent:'#065F46', header:'#065F46', headerText:'light' },
  { name:'Royal Blue',      accent:'#1D4ED8', header:'#1D4ED8', headerText:'light' },
  { name:'Cognac Cream',    accent:'#92400E', header:'#FDF8F0', headerText:'dark'  },
  { name:'Slate Pro',       accent:'#374151', header:'#374151', headerText:'light' },
  { name:'Deep Violet',     accent:'#2C1A4E', header:'#2C1A4E', headerText:'light' },
  { name:'Clean White',     accent:'#0F766E', header:'#FFFFFF', headerText:'dark'  },
  { name:'Warm Taupe',      accent:'#6B5E4C', header:'#6B5E4C', headerText:'light' },
  { name:'Crimson',         accent:'#B91C1C', header:'#7f1d1d', headerText:'light' },
];
const TPL_INFO = [
  {n:'Classic',          d:'Traditional serif, clean & formal',       c:'#374151', free:true},
  {n:'Modern Blue',      d:'Colorful header, sidebar layout',          c:'#1D4ED8', free:true},
  {n:'Executive',        d:'Elegant centered header',                  c:'#92400E', free:true},
  {n:'Minimal',          d:'Clean whitespace-rich design',             c:'#374151', free:true},
  {n:'Skilled Worker',   d:'Bold header with skill tags',              c:'#047857'},
  {n:'Two-Column',       d:'Sidebar layout, modern look',              c:'#0369A1'},
  {n:'Government',       d:'Formal govt-style single column',          c:'#1a1a2e'},
  {n:'Creative',         d:'Bold accent, creative industries',         c:'#7C3AED'},
  {n:'ATS Clean',        d:'Plain text, ATS scanner-friendly',         c:'#374151'},
  {n:'Corporate',        d:'Corporate navy, professional feel',        c:'#1e3a5f'},
  {n:'Noir Elite',       d:'Black & gold — ultra-premium luxury',      c:'#B8860B'},
  {n:'Prism Sidebar',    d:'Gradient sidebar, modern India & Global',  c:'#7C3AED'},
  {n:'Velocity',         d:'Diagonal header, bold tech feel',          c:'#0EA5E9'},
  {n:'Prestige Finance', d:'Structured columns, banking & finance',    c:'#1B4332'},
  {n:'Glass Horizon',    d:'Full-bleed header, top executive',         c:'#0F766E'},
  {n:'Timeline Pro',     d:'Left timeline, consulting & leadership',   c:'#991B1B'},
  {n:'Metro Cards',      d:'Card-based sections, startup & product',   c:'#4F46E5'},
  {n:'Zen Minimal',      d:'Ultra-clean Japanese-inspired layout',     c:'#111827'},
  {n:'Dubai Gold',       d:'Luxury premium, Gulf & abroad markets',    c:'#92400E'},
  {n:'Nexus Tech',       d:'Dark sidebar, IT & engineering abroad',    c:'#1E293B'},
];

const BULLET_LIB = {
  "Software Engineer": ["Designed, developed and deployed scalable web applications using React, Node.js and REST APIs", "Collaborated with product managers and designers to deliver features on time within Agile sprints", "Wrote clean, maintainable code following SOLID principles, design patterns and coding standards", "Performed thorough code reviews and provided constructive feedback to improve team code quality", "Debugged and resolved critical production issues across front-end, back-end and database layers", "Optimised application performance reducing page load times by up to 40% through caching and lazy loading", "Integrated third-party APIs, payment gateways and cloud services including AWS and Firebase", "Developed and maintained CI/CD pipelines using GitHub Actions, Jenkins and Docker", "Wrote unit, integration and end-to-end tests using Jest, Mocha and Selenium to maintain 90%+ coverage", "Participated in system design discussions and contributed to architectural decisions for new features", "Documented technical specifications, API contracts and system diagrams for internal and external teams", "Mentored junior developers through pair programming, knowledge-sharing sessions and code walkthroughs", "Worked with cross-functional teams across design, QA and DevOps to ship production-ready releases", "Managed and resolved Git merge conflicts, versioning and branching strategies for team repositories"],
  "IT Support": ["Provided first and second-line technical support to 200+ end users across the organisation", "Diagnosed and resolved hardware, software and network issues with an average resolution time under 2 hours", "Managed and maintained IT asset inventory including laptops, desktops, printers and peripherals", "Set up and configured new user accounts, email IDs, VPN access and software installations", "Maintained helpdesk ticketing system (ServiceNow / Freshdesk) with timely escalation and closure", "Administered Active Directory, Office 365 and Google Workspace user accounts and permissions", "Assisted in network administration including LAN/WAN setup, switch configuration and Wi-Fi management", "Deployed and managed endpoint security tools including antivirus, MDM and patch management systems", "Trained new staff on IT policies, software tools and cybersecurity best practices", "Coordinated with vendors and OEMs for hardware repairs, AMC renewals and software licensing", "Maintained SLA compliance with 95%+ first-call resolution rate for routine support requests", "Assisted in setting up conference rooms, projectors and AV equipment for meetings and events", "Documented IT procedures, troubleshooting guides and network topology diagrams for reference"],
  "Data Analyst": ["Collected, cleaned and transformed large datasets from multiple sources using Python, SQL and Excel", "Built interactive dashboards and reports in Power BI and Tableau for C-level and operations teams", "Prepared weekly, monthly and quarterly performance reports with actionable business insights", "Identified trends, patterns and anomalies in sales, operations and financial data to support decisions", "Collaborated with business stakeholders to define KPIs, metrics and reporting requirements", "Automated repetitive reporting tasks using Python (Pandas, NumPy) and SQL scripts, saving 10+ hours/week", "Conducted A/B test analysis and presented findings to product and marketing teams", "Ensured data accuracy, completeness and integrity across all reporting systems and databases", "Developed predictive models and statistical analyses to forecast demand, revenue and customer behaviour", "Managed data pipelines and ETL workflows to ensure timely availability of clean data", "Worked with engineers to design data warehousing solutions and optimise query performance", "Presented data findings to non-technical stakeholders using clear, visual storytelling techniques", "Created and maintained data dictionaries, documentation and governance standards for data assets"],
  "Accountant": ["Maintained accurate books of accounts including ledgers, journals and trial balance in Tally/SAP", "Prepared monthly financial statements, P&L reports and balance sheets for management review", "Processed invoices, vendor payments, bank reconciliations and NEFT/RTGS transactions on time", "Filed GST returns (GSTR-1, GSTR-3B), TDS returns and income tax challans within due dates", "Assisted in statutory audit, internal audit and tax audit and liaised with CA firm for compliance", "Managed petty cash, employee expense reimbursements and travel advance settlements", "Monitored accounts receivable, generated ageing reports and followed up on overdue payments", "Prepared MIS reports, cash flow statements and fund flow statements for senior management", "Reconciled vendor statements, inter-company accounts and bank statements monthly", "Maintained fixed asset register, computed depreciation and tracked capital expenditure", "Handled payroll processing, professional tax, ESI and PF deductions and remittances", "Assisted in preparation of project cost reports, budget vs actual analysis and variance reporting", "Coordinated with banks for OD facilities, letter of credit and bank guarantee documentation"],
  "Sales / Marketing": ["Consistently achieved and exceeded monthly and quarterly sales targets by 110-130%", "Built and nurtured strong relationships with key accounts, resulting in 30% revenue retention growth", "Conducted product demonstrations, client presentations and negotiated commercial terms successfully", "Generated and qualified new leads through cold calls, LinkedIn outreach and field visits", "Identified new business opportunities through market mapping, competitor analysis and customer referrals", "Managed CRM database (Salesforce / Zoho) and maintained accurate pipeline and deal records", "Coordinated with marketing team on campaign execution, lead nurturing and trade show participation", "Prepared weekly sales reports, forecast summaries and pipeline review decks for management", "Onboarded new clients with smooth handover to delivery and account management teams", "Responded to RFPs, prepared commercial proposals and tailored presentations to client needs", "Tracked digital marketing campaign performance on Google Ads, Meta and LinkedIn using analytics tools", "Conducted post-sale follow-ups to ensure client satisfaction and generate repeat business", "Trained and mentored junior sales team members on pitch techniques, objection handling and CRM usage"],
  "Office / Admin": ["Managed daily office operations including scheduling, correspondence, filing and facility coordination", "Maintained accurate physical and digital records, document management systems and filing protocols", "Handled incoming calls, emails and walk-in visitor queries professionally and with prompt response", "Coordinated internal and external meetings, travel bookings, visa arrangements and accommodations", "Supported senior management with report preparation, presentations, data entry and research tasks", "Managed office supplies procurement, vendor coordination and ensured cost-effective purchasing", "Processed invoices, expense claims and petty cash with proper documentation and approvals", "Maintained confidentiality of sensitive documents and executive communications at all times", "Handled courier dispatch, mail management and document tracking across departments", "Onboarded new employees by coordinating ID cards, system access, workstation and documentation", "Ensured smooth interdepartmental communication and timely follow-up on pending action items", "Organised company events, townhalls, off-sites and staff engagement activities end to end", "Maintained office equipment including printers, scanners and EPABX systems and arranged servicing"],
  "HR Executive": ["Managed end-to-end recruitment across multiple departments including sourcing, screening and offer rollout", "Sourced candidates through Naukri, LinkedIn, job portals and employee referral programmes", "Conducted HR interviews, salary negotiations and coordinated with hiring managers for final decisions", "Handled onboarding, induction planning and pre-joining documentation for all new joiners", "Maintained employee records, HRMS data, attendance, leave balances and contract documentation", "Processed monthly payroll for 200+ employees including salary revisions and full and final settlements", "Managed PF, ESI, professional tax, gratuity and labour law statutory compliance", "Administered performance appraisal cycles, goal-setting frameworks and promotion processes", "Handled employee grievances, disciplinary proceedings and exit interviews professionally", "Coordinated training and development programmes including skill-building and compliance training", "Prepared HR MIS reports including headcount, attrition, hiring TAT and manpower cost analysis", "Developed and updated HR policies, employee handbook and standard operating procedures", "Engaged with employees on welfare initiatives, rewards programmes and cultural activities"],
  "Teacher / Educator": ["Delivered engaging, curriculum-aligned lessons for classes of 30-50 students across age groups", "Developed detailed lesson plans, worksheets, assessments and project-based learning activities", "Monitored student academic progress through formative and summative assessments with actionable feedback", "Differentiated instruction to accommodate diverse learning styles, abilities and needs in the classroom", "Maintained classroom discipline, created a respectful environment and managed behavioural challenges", "Communicated student performance, attendance and behavioural updates to parents via meetings and reports", "Integrated digital tools including Google Classroom, Kahoot and smart boards into teaching practice", "Participated in curriculum review, textbook committee work and school-wide academic planning", "Organised and supervised co-curricular activities, field trips, competitions and school events", "Collaborated with fellow teachers for interdisciplinary projects and shared classroom strategies", "Prepared students for board examinations, competitive exams and Olympiad-level challenges", "Provided extra support and remedial sessions for academically weaker students after school hours", "Maintained student records, attendance registers and report cards as per school administration requirements"],
  "Nurse / Healthcare": ["Provided compassionate direct patient care including vital signs monitoring, medication administration and wound dressing", "Assisted physicians and surgeons during ward rounds, procedures, minor surgeries and emergency interventions", "Maintained accurate patient records, nursing notes, medication charts and discharge summaries in HMS software", "Educated patients and family members on diagnoses, treatment plans, medication adherence and post-discharge care", "Managed IV lines, catheters, nasogastric tubes and other clinical devices as per standard protocols", "Coordinated with multidisciplinary teams including physiotherapy, dietetics and social work for holistic care", "Responded to medical emergencies, code blues and critical deteriorations with calm and clinical precision", "Ensured strict adherence to infection control, hand hygiene and biomedical waste disposal protocols", "Supervised and guided junior nurses and nursing students during clinical rotations", "Maintained high patient satisfaction by addressing concerns, ensuring comfort and clear communication", "Administered blood transfusions, chemotherapy and specialised IV medications under physician orders", "Prepared patients for diagnostic procedures including ECG, X-ray and endoscopy with proper consent", "Conducted pre-operative and post-operative care assessments and escalated changes in patient condition promptly"],
  "Driver": ["Operated heavy commercial vehicles (HCV/LCV) safely across local, state and long-distance routes", "Maintained accurate vehicle logbooks, trip sheets, mileage records and fuel consumption reports", "Performed daily pre-trip and post-trip vehicle safety checks and escalated defects promptly", "Delivered goods, equipment and personnel on schedule with zero accidents and near-zero delays", "Followed all RTO regulations, traffic laws and company transport policies at all times", "Managed vehicle documentation including RC, insurance, PUC and fitness certificate renewals", "Assisted with loading, unloading, strapping and securing of cargo to prevent transit damage", "Coordinated with dispatch team for route planning, delivery instructions and real-time updates", "Maintained vehicle cleanliness, basic servicing and coordinated with workshop for scheduled maintenance", "Ensured safe and professional transport of senior executives, clients and VIP guests", "Managed cash collections, delivery receipts and POD documentation for goods dispatched", "Navigated efficiently using GPS tools and local knowledge to avoid traffic delays"],
  "Security Guard": ["Monitored and secured premises, assets, equipment and personnel during assigned 8/12-hour shifts", "Conducted regular patrol rounds across all designated zones and logged all observations and incidents", "Managed visitor access control, vehicle entry/exit and contractor badge issuance at entry gates", "Responded promptly to alarms, security breaches, trespassing and fire emergency situations", "Coordinated with local police, fire brigade and emergency services during critical incidents", "Maintained detailed shift handover reports, daily occurrence registers and incident documentation", "Operated CCTV surveillance systems, metal detectors and biometric access equipment", "Ensured all visitors complied with site security procedures and photo ID verification policies", "Monitored fire safety equipment including extinguishers, hydrants and emergency exits", "Reported suspicious activity, potential security threats and policy violations to supervisors", "Trained new security personnel on post duties, SOPs and emergency evacuation procedures", "Maintained a professional, calm and courteous approach with employees, visitors and vendors"],
  "Construction": ["Executed civil construction activities including earthworks, formwork, concreting and masonry as per drawings", "Operated heavy machinery including excavators, concrete mixers, compactors and transit mixers safely", "Followed all site safety protocols including permit-to-work, toolbox talks and PPE compliance at all times", "Worked with site team to achieve daily productivity targets while maintaining quality standards", "Assisted engineers and surveyors in setting out, levelling, benchmarking and quality inspection activities", "Placed and vibrated concrete, laid reinforcement steel and ensured proper cover and alignment as specified", "Maintained site cleanliness and ensured safe, organised storage of construction materials and equipment", "Participated in daily safety briefings, hazard identification and near-miss reporting activities", "Erected and dismantled scaffolding, centering and shuttering safely as per site requirements", "Assisted in block work, plastering, tiling and finishing activities as required by project scope", "Supported material handling, plant operations and general site logistics for smooth project execution", "Reported progress, issues and defects to site supervisor for timely resolution and documentation"],
  "Loco/MSV Operator": ["Operated MSV and locomotive equipment safely in underground tunnel construction environments", "Transported construction materials, precast segments and personnel through tunnel headings safely", "Performed detailed pre-operation checks, shift maintenance logs and safety inspections each day", "Coordinated with tunnel engineers and mining supervisors for timely and efficient material movement", "Operated locomotive in metro rail tunnel projects following NATM and EPBM construction methods", "Maintained accurate records of shift operations, trip counts and equipment status in logbooks", "Ensured full compliance with site safety rules, permit-to-work systems and PPE requirements", "Managed loading and unloading of heavy construction materials in confined and restricted spaces", "Assisted in TBM launch and breakthrough operations and segment ring-build activities", "Operated battery-powered locomotives and diesel engines across varying gradient tunnel profiles", "Responded to emergency situations inside tunnel including evacuation and equipment breakdown protocols", "Maintained communication with surface control room and surface plant operators during operations"],
  "Gantry / Crane Operator": ["Operated TBM gantry crane for segment handling, grout supply and materials in metro tunnel projects", "Maintained precise and controlled crane movements in confined underground workspaces", "Conducted thorough pre-shift crane inspections, safety checks and defect reporting", "Coordinated all lifts with signal man, banksmen and site engineers for safe and efficient operations", "Handled heavy precast tunnel segments, rebar cages, formwork and site equipment with precision", "Documented daily crane operation logs, lift plans and defect reports for site records", "Ensured all lifts complied with safe working load limits, rigging standards and lifting regulations", "Operated overhead cranes, mobile cranes and gantry systems depending on project requirements", "Participated in third-party crane inspection and load testing activities and maintained certification", "Maintained wire rope, sheaves, hooks and rigging accessories in good working condition", "Guided riggers and slingers on correct slinging techniques and load balance during critical lifts", "Adhered strictly to lift plans, exclusion zones and permit-to-lift requirements on all occasions"],
  "Electrician": ["Installed, tested and commissioned electrical wiring, distribution boards, panels and equipment", "Carried out preventive and breakdown maintenance of electrical systems, motors and machinery", "Diagnosed electrical faults using multimeters, clamp meters and insulation resistance testers", "Ensured all installations complied with IS codes, safety standards and client specifications", "Maintained records of electrical maintenance, periodic inspection reports and energy meter readings", "Installed and terminated power and control cables for HT/LT systems as per SLD drawings", "Coordinated with civil and mechanical teams during MEP works in construction and fit-out projects", "Conducted routine inspections and load tests on DG sets, UPS systems and battery banks", "Performed earthing and lightning protection system installation and testing as per standards", "Operated switchgear, contactors, relays and VFDs and carried out routine maintenance tasks", "Assisted in commissioning of LT panels, MCC panels and power factor correction equipment", "Reported unsafe electrical conditions, exposed wiring and equipment failures to supervisor immediately"],
  "Plumber": ["Installed, tested and commissioned plumbing systems including water supply, drainage and sewage networks", "Diagnosed and resolved plumbing faults, pipe leakages, blockages and waterproofing failures efficiently", "Installed sanitary fixtures, water heaters, pumps and pressure-reducing valves as per specifications", "Read and interpreted plumbing layout drawings, isometrics and P&ID diagrams for installation", "Ensured all plumbing work complied with NBC codes, building regulations and client standards", "Installed fire suppression, sprinkler and hydrant systems as part of MEP project scope", "Carried out pressure testing, flushing and disinfection of water supply pipelines before handover", "Coordinated with civil, electrical and HVAC teams during MEP installation and fit-out works", "Maintained records of work completed, material usage, as-built drawings and pending punch items", "Assisted in installation of STP/ETP pipework, chemical dosing systems and sump pump connections", "Performed routine maintenance on overhead tanks, underground sumps and booster pump stations", "Handled CPVC, UPVC, GI, CI and PPR piping systems using appropriate jointing and threading methods"],
  "Welder / Fabricator": ["Performed MIG, TIG, SMAW and FCAW welding on structural steel, pipes and pressure vessels", "Read and interpreted engineering drawings, weld symbols, isometrics and fabrication blueprints", "Ensured all welds met quality standards and passed visual, DPT, radiographic and UT inspections", "Operated angle grinders, plasma cutters, cutting torches and fabrication tools safely and precisely", "Maintained welding machines, cables, torches and associated equipment in good working condition", "Adhered strictly to hot work permits, fire precautions, PPE requirements and safety procedures", "Coordinated with QC inspectors during weld testing, WPS qualification and joint inspection stages", "Fabricated structural steel members including beams, columns, trusses and staircase components", "Performed pre-weld and inter-pass temperature checks and maintained preheat as per WPS requirements", "Assisted in erection and alignment of steel structures using come-alongs, jacks and rigging equipment", "Handled stainless steel, duplex, mild steel and alloy steel welding across various applications", "Prepared weld inspection records, joint registers and welder qualification documentation"],
  "Mechanic": ["Diagnosed and repaired mechanical faults in HCV, LCV, construction equipment and industrial machinery", "Performed scheduled preventive maintenance including oil changes, filter replacements and greasing", "Overhauled engines, gearboxes, differentials, brake systems and suspension assemblies as required", "Maintained accurate job cards, maintenance logs and repair history records for all equipment", "Operated diagnostic tools (OBD scanners, pressure gauges, multimeters) to identify root causes", "Ensured timely completion of servicing schedules to minimise equipment downtime and production loss", "Managed spare parts requisitions, maintained workshop inventory and coordinated with parts suppliers", "Repaired hydraulic systems, cylinders, pumps and control valves on earthmoving equipment", "Performed electrical diagnostics and repaired starter motors, alternators and wiring harnesses", "Assisted in major plant shutdowns and overhauling of critical equipment within tight schedules", "Conducted post-repair road tests and load tests to verify equipment performance before sign-off", "Trained apprentice mechanics on safe workshop practices, tool usage and equipment care"],
  "Civil Engineer": ["Supervised and managed civil construction activities including earthworks, RCC, masonry and finishing", "Reviewed engineering drawings, BOQs and specifications and coordinated site execution accordingly", "Ensured site activities complied with IS codes, design standards and client quality plans", "Coordinated with contractors, subcontractors, consultants and vendors for seamless project execution", "Prepared daily site progress reports, inspection records, snag lists and method statements", "Conducted quality checks on concrete cube tests, rebar placement, brick work and plaster finishing", "Carried out quantity surveying, prepared running account bills and processed subcontractor payments", "Managed land survey, setting out, levelling and alignment checks using total station and auto level", "Assisted in preparation of project schedules, baseline programmes and three-week lookahead plans", "Monitored construction safety, enforced PPE compliance and conducted weekly toolbox talks on site", "Resolved site engineering issues, clashes and design gaps in coordination with design team", "Maintained material test reports, inspection test plans and quality documentation for handover dossier"],
  "Mechanical Engineer": ["Designed and reviewed mechanical systems including HVAC, piping, ducting and rotating equipment", "Supervised installation, testing, commissioning and pre-commissioning of mechanical systems", "Prepared technical documents including method statements, ITPs, P&IDs and engineering specifications", "Conducted root cause analysis and failure investigation for equipment breakdowns and recurring faults", "Coordinated with vendors, OEMs and sub-contractors for procurement, inspection and site activities", "Ensured compliance with ASME, IS and client engineering codes, standards and safety regulations", "Managed preventive and corrective maintenance programmes for rotating and static mechanical assets", "Prepared maintenance schedules, spare parts lists and critical equipment inventory management plans", "Assisted in selection and sizing of pumps, compressors, fans and heat exchangers for projects", "Reviewed vendor drawings, data sheets and O&M manuals and provided technical comments", "Conducted energy audits and implemented efficiency improvements reducing utility costs by 15%", "Led mechanical completion and punch-listing activities ahead of commissioning and client handover"],
  "Project Manager": ["Led end-to-end project delivery across planning, procurement, execution, monitoring and closure phases", "Developed detailed project plans, WBS, schedules, resource plans and budgets using MS Project/Primavera", "Managed project budgets of up to ₹50 crore and ensured cost control within approved baselines", "Maintained regular stakeholder communication through progress reports, presentations and site meetings", "Identified, assessed and mitigated project risks through structured risk registers and contingency plans", "Monitored project KPIs including schedule variance, cost performance index and resource utilisation", "Coordinated cross-functional teams across design, procurement, construction and commissioning phases", "Managed change control processes, variation orders and contract amendments with clients and contractors", "Ensured projects were delivered on time, within scope and within approved budget with high quality", "Conducted weekly and monthly project reviews with senior leadership and client representatives", "Resolved critical path delays through resource reallocation, acceleration and scope re-sequencing", "Led project close-out including documentation handover, lessons learned and final account settlement"],
  "Site Supervisor": ["Supervised daily site activities and ensured execution aligned with approved drawings and work plans", "Coordinated manpower, materials, tools and plant to maintain productivity and meet weekly milestones", "Conducted daily safety walkthroughs, enforced PPE usage and addressed unsafe acts immediately", "Reviewed work quality against ITP checkpoints and raised NCRs for non-conforming work", "Prepared daily progress reports, labour deployment records and material consumption summaries", "Briefed the workforce daily on targets, safety requirements, method of work and quality expectations", "Liaised with engineers, subcontractors, suppliers and client representatives on all site matters", "Managed subcontractor work activities, ensured scope compliance and resolved site coordination issues", "Monitored concrete pours, rebar fixing and formwork activities and ensured quality checkpoints were met", "Tracked tools, equipment and consumables on site to prevent loss, misuse and wastage", "Reported progress, manpower utilisation and equipment status daily to the project manager", "Participated in site safety audits, emergency drills and near-miss investigation exercises"],
  "Quantity Surveyor": ["Prepared detailed Bills of Quantities, cost estimates, rate analysis and tender pricing documents", "Evaluated contractor bids, conducted bid comparisons and assisted in contract award decisions", "Managed project budgets, tracked actual expenditure and prepared cost-to-complete forecasts monthly", "Processed interim payment certificates, back-charge claims, variations and final account settlements", "Conducted site measurements, verified quantities of work completed and reconciled against drawings", "Prepared monthly cash flow projections and submitted cost reports to project and finance teams", "Managed contract administration including RFIs, site instructions and variation order documentation", "Assisted in dispute resolution, claims analysis and extension of time assessments", "Prepared material reconciliation reports and controlled wastage against BOQ allocations on site", "Coordinated with procurement team for material price comparison, sourcing and purchase orders", "Reviewed subcontractor invoices, verified against work done and certified payments accordingly", "Maintained complete contract correspondence, cost records and registers for audit and review"],
  "Receptionist": ["Welcomed visitors, clients and employees with warmth, professionalism and a positive first impression", "Managed multi-line telephone switchboard, directed calls and handled queries with prompt, courteous responses", "Handled appointment scheduling, meeting room coordination and calendar management for senior staff", "Maintained visitor registers, issued visitor passes and ensured compliance with security entry protocols", "Coordinated courier dispatch, inbound mail management and document tracking across departments", "Managed front desk cleanliness, reception area presentation and company notice boards", "Provided administrative support including filing, photocopying, data entry and report preparation", "Handled travel booking, hotel reservations and cab arrangements for employees and guests", "Coordinated with housekeeping and facilities for visitor-readiness and event setups", "Maintained stationery and pantry inventory at front office and raised purchase requests timely", "Greeted and escorted VIP clients, investors and board members to meeting rooms and boardrooms", "Handled customer grievances at the front desk, provided accurate information and escalated when needed"],
  "Customer Service": ["Handled 80-100 inbound customer contacts daily via phone, email and live chat with professionalism", "Resolved customer issues, complaints and escalations efficiently while achieving high CSAT scores", "Maintained accurate records of all customer interactions and resolutions in CRM (Salesforce/Freshdesk)", "Escalated complex and unresolved issues to Level 2 teams with full documentation and follow-up", "Achieved first-call resolution (FCR) rates above 85% consistently over quarterly performance reviews", "Identified patterns in customer complaints and raised process improvement suggestions to the team lead", "Provided accurate product information, order status updates and after-sales support to customers", "Cross-sold and upsold company products and services, contributing to revenue targets", "Managed refund, replacement and return requests as per company policy within TAT", "Participated in new product training, quality calibration sessions and team performance reviews", "Maintained service quality during high-volume periods including sales events and festive seasons", "Contributed to VOC (Voice of Customer) feedback collection and shared insights with product teams"],
  "Logistics / Warehouse": ["Managed receiving, storage, picking, packing and dispatch operations in compliance with SOPs", "Operated WMS software for inventory tracking, order fulfilment, inbound and outbound management", "Conducted cycle counts, quarterly physical inventory and reconciled discrepancies with finance records", "Ensured accurate labelling, barcode scanning, packaging and documentation for all outbound shipments", "Coordinated with 3PL transport providers, fleet operators and couriers for timely deliveries", "Maintained cold chain, hazardous materials and high-value item storage as per regulatory requirements", "Supervised warehouse staff deployment, shift scheduling and daily work allocation", "Achieved 99%+ order accuracy rate through systematic pick-and-pack verification processes", "Managed reverse logistics for returns, damaged goods and vendor rejections efficiently", "Implemented 5S workplace organisation and visual management standards in the warehouse", "Prepared inventory reports, GRN reconciliations and stock ageing analysis for management review", "Reduced storage cost by 20% through optimised space utilisation and slotting strategies"],
  "Retail / Shop": ["Assisted customers in product selection, provided tailored recommendations and ensured excellent service", "Maintained product displays, planograms, shelf arrangements and store cleanliness at all times", "Processed cash, card and UPI transactions accurately and maintained till records with zero discrepancies", "Managed stock replenishment, product returns, exchange processing and damaged item documentation", "Achieved individual and store sales targets consistently through effective product knowledge and upselling", "Handled customer complaints courteously and escalated issues to store manager when required", "Participated in weekly stock-taking, bi-annual inventory audits and seasonal promotional campaigns", "Received and verified incoming stock, matched with purchase orders and updated inventory records", "Ensured store compliance with safety, hygiene, display and brand standards at all times", "Cross-sold and recommended complementary products to increase average transaction value", "Maintained knowledge of current offers, promotions, loyalty programmes and new product launches", "Trained new sales staff on customer handling, billing systems and store operating procedures"],
  "Cook / Chef": ["Prepared and cooked a range of dishes as per standardised recipes, portion sizes and presentation standards", "Maintained high standards of food hygiene, FSSAI compliance and kitchen cleanliness at all times", "Managed prep schedules, mise en place and kitchen workflow to ensure timely service during peak hours", "Monitored ingredient inventory, raised requisitions and minimised food wastage through FIFO practices", "Assisted head chef in menu planning, seasonal dish development and recipe cost standardisation", "Trained and supervised commis chefs and kitchen helpers on techniques, hygiene and station responsibilities", "Operated all kitchen equipment safely including ovens, fryers, grills, mixers and blast chillers", "Ensured consistent food quality, taste, temperature and plating standards across all service periods", "Managed daily cleaning schedules, deep cleaning activities and pest control coordination in the kitchen", "Handled special dietary requirements, allergen awareness and guest customisation requests professionally", "Participated in buffet setup, live counter management and banquet catering operations", "Maintained kitchen records including temperature logs, oil usage records and production reports"],
  "Hotel / Hospitality": ["Delivered outstanding guest experiences consistently in line with hotel brand standards and SOPs", "Managed guest check-in, check-out, room assignments, early arrivals and late checkouts efficiently", "Handled reservations, billing, guest folio review and cashiering with accuracy and attention to detail", "Resolved guest complaints, service failures and escalations promptly and with empathy", "Coordinated with housekeeping, engineering and F&B teams for seamless guest experience delivery", "Achieved high guest satisfaction scores (GSS/TripAdvisor) through personalised and attentive service", "Upsold room upgrades, dining packages and hotel facilities to enhance revenue and guest experience", "Managed VIP arrivals, repeat guest recognition and personalised amenity setups", "Handled group check-ins, tour operator billing and MICE guest coordination efficiently", "Maintained up-to-date knowledge of hotel facilities, room categories, local attractions and dining", "Trained new front office and guest services team members on systems and service standards", "Prepared shift handover reports, guest feedback summaries and occupancy/revenue briefing for management"],
  "Banking / Finance": ["Processed customer transactions including deposits, withdrawals, NEFT, RTGS and IMPS efficiently", "Handled account opening, KYC documentation, CKYC updates and customer onboarding processes", "Managed fixed deposits, recurring deposits, loan disbursals and pre-closure requests accurately", "Resolved customer queries, complaints and service requests within defined TAT and service standards", "Ensured strict compliance with RBI guidelines, AML/KYC norms, FEMA and bank internal audit policies", "Maintained accurate cash balances, currency chest operations and end-of-day reconciliation reports", "Cross-sold banking products including savings accounts, credit cards, insurance and mutual funds", "Assisted in preparation of credit appraisal notes, loan documentation and disbursement processes", "Managed branch operations during peak hours with efficiency, accuracy and customer friendliness", "Coordinated with back-office teams for trade finance, NRI services and government scheme operations", "Prepared branch MIS reports, regulatory returns and management dashboards for review", "Participated in financial literacy camps, customer awareness programmes and digital banking adoption drives"],
  "Pharmacist": ["Dispensed prescription and OTC medications accurately, verifying dosage, strength and patient details", "Counselled patients on drug usage, dosage schedules, drug interactions and side effect management", "Maintained pharmacy records, prescription registers, controlled drug logs and narcotic ledgers", "Conducted regular stock audits, expiry checks and ensured proper cold-chain storage of medicines", "Coordinated with doctors and clinical staff for prescription clarifications, substitutions and queries", "Ensured full compliance with Pharmacy Act, Drug Control regulations and licensing requirements", "Managed pharmacy inventory, placed purchase orders and maintained minimum par stock at all times", "Processed insurance claims, co-payment collection and pharmacy billing accurately", "Participated in hospital formulary management, drug shortage analysis and therapeutic substitution", "Educated nursing staff on medication storage, reconstitution and administration best practices", "Maintained pharmacovigilance records and submitted adverse drug reaction reports as required", "Handled patient medication history, allergy documentation and high-alert medication protocols"],
  "Lab Technician": ["Performed haematology, biochemistry, microbiology and serology tests as per laboratory SOPs", "Collected and processed blood, urine, sputum and other biological specimens accurately and safely", "Maintained calibration schedules for all laboratory instruments including auto-analysers and centrifuges", "Recorded and verified test results in LIS and reported critical values to clinical staff immediately", "Followed strict biosafety Level 2 protocols including PPE usage, spill management and waste disposal", "Managed laboratory inventory including reagent kits, consumables and controls with FIFO adherence", "Assisted in preparation for NABL accreditation, internal audits and external quality assessment programmes", "Performed QC checks including Levey-Jennings chart monitoring and corrective action documentation", "Maintained equipment maintenance logs, temperature records and SOP version control registers", "Processed samples for outsourced tests and coordinated with referral laboratories for result collection", "Assisted in microbiology culture plating, sensitivity testing and AFB smear examination procedures", "Supported pathologist and senior technologists in reporting and slide preparation for histopathology"],
  "Graphic Designer": ["Created compelling designs for social media, digital ads, emailers, brochures and print collaterals", "Developed brand identities including logos, brand guides, colour palettes and typography systems", "Collaborated with clients and marketing teams to understand design briefs and deliver creative solutions", "Produced high-quality artwork using Adobe Photoshop, Illustrator, InDesign and Figma", "Managed 5-10 concurrent design projects while consistently meeting tight deadlines", "Ensured brand consistency across all design touchpoints and digital and print platforms", "Designed responsive web graphics, UI elements, banners and landing page assets for digital campaigns", "Created motion graphics and animated social media content using Adobe After Effects and Canva", "Incorporated client feedback through iterative design review cycles with clear revision tracking", "Prepared print-ready artwork with correct bleed, resolution, colour mode and file specifications", "Developed creative concepts for product packaging, point-of-sale materials and outdoor advertising", "Maintained organised asset libraries, brand files and source file archives for all project deliverables"],
  "Content Writer": ["Researched and created SEO-optimised content for websites, blogs, landing pages and product descriptions", "Produced long-form articles, whitepapers, case studies and email campaigns for B2B and B2C brands", "Conducted keyword research using SEMrush, Ahrefs and Google Keyword Planner for content strategy", "Maintained consistent brand voice and tone across all content formats and communication channels", "Collaborated with designers, SEO teams and marketing managers to align content with campaign goals", "Developed content calendars and managed publishing schedules across WordPress, HubSpot and social media", "Proofread and edited content for grammar, accuracy, readability and brand voice alignment", "Created social media copies, ad scripts and video content briefs for performance marketing campaigns", "Analysed content performance using Google Analytics and Search Console and refined strategy based on data", "Interviewed subject matter experts and distilled technical information into reader-friendly content", "Achieved 30% organic traffic growth through consistent content publishing and on-page SEO improvements", "Built and managed a content repository and style guide to ensure quality and consistency across writers"],
  "Tailor / Garment": ["Operated industrial sewing machines including overlock, flatbed and button-holing machines with precision", "Read and interpreted technical sketches, patterns, size charts and measurement specifications accurately", "Completed daily production targets of 80-120 pieces while maintaining consistent quality standards", "Performed in-process quality checks on stitching, measurement and finishing of each garment", "Assisted in fabric cutting, trimming, ironing, button attachment and garment packing activities", "Reported machine defects, thread breakages and fabric faults to production supervisor immediately", "Maintained workstation cleanliness and followed all factory safety and housekeeping procedures", "Trained new tailoring staff on machine operation, basic stitching techniques and quality standards", "Handled alterations, rework and repair of defective garments identified during QC inspection", "Managed thread, needle and accessory inventory at workstation to avoid production stoppages", "Worked on a variety of garment types including shirts, trousers, kurtas, uniforms and formal wear", "Coordinated with floor supervisor on production priorities, batch changes and urgent order fulfilment"],
  "Farmer / Agriculture": ["Planned and managed seasonal crop cycles including sowing, irrigation, fertilisation and harvesting", "Operated agricultural equipment including tractors, tillers, sprayers and combine harvesters safely", "Applied fertilisers, pesticides and organic inputs as per recommended agronomic schedules", "Managed drip and sprinkler irrigation systems and ensured efficient water use across all crop areas", "Monitored crop health, identified pest and disease infestations and took timely corrective action", "Maintained farm records including input usage, yield data, cost per acre and seasonal profit analysis", "Coordinated with APMC agents, mandi traders and FPOs for timely and profitable produce sale", "Implemented soil health management practices including soil testing, organic manuring and crop rotation", "Managed post-harvest operations including cleaning, grading, storage and cold chain as applicable", "Participated in Krishi Vigyan Kendra programmes, government schemes and FPO training sessions", "Managed farm labour, seasonal workers and daily wage supervision during peak agricultural seasons", "Maintained irrigation infrastructure, bund repair and farm equipment through regular maintenance"],
  "Delivery / Courier": ["Delivered parcels, e-commerce orders and documents to 60-100 customers daily within promised timelines", "Planned efficient delivery routes using apps (Dunzo, Shadowfax, Porter) to maximise drops per shift", "Collected proof of delivery (POD), customer signatures, OTP verification and cash-on-delivery payments", "Maintained real-time delivery status updates in the company app for tracking and operations visibility", "Handled customer queries, failed delivery resolutions and rescheduling requests with professionalism", "Ensured safe handling of fragile, high-value, temperature-sensitive and time-critical shipments", "Maintained zero-accident, zero-shortage delivery record consistently throughout the tenure", "Coordinated with hub operations team for pick-up, sorting and load allocation before each shift", "Maintained two-wheeler or three-wheeler in clean condition and reported mechanical issues promptly", "Achieved daily performance targets and maintained 4.5+ customer rating on delivery app platforms", "Assisted in reverse logistics pick-up, return processing and label scanning at customer doorstep", "Managed daily trip sheets, cash reconciliation and undelivered shipment handback to hub accurately"],
  "Housekeeping": ["Maintained cleanliness, hygiene and presentation standards across all assigned hotel floors and areas", "Cleaned and serviced guest rooms, bathrooms, corridors and public areas as per brand SOPs", "Restocked room amenities, minibars, linens and toiletries accurately and within checkout turnaround time", "Reported maintenance defects, room damage, lost property and safety hazards to supervisor promptly", "Followed COSHH guidelines for safe handling, dilution and storage of cleaning chemicals and equipment", "Managed housekeeping trolley inventory and maintained par levels throughout the shift", "Delivered guest special requests including extra pillows, rollaway beds and baby cots with efficiency", "Participated in deep cleaning programmes, pest control schedules and carpet shampooing activities", "Maintained laundry dispatch, linen count and soiled linen management as per shift procedures", "Assisted in turndown service, VIP room setups and event room preparation as required", "Achieved consistent rooms-per-hour targets while maintaining high quality check scores", "Trained new housekeeping attendants on SOP, room inspection standards and chemical safety"],
  "Peon / Office Boy": ["Managed document delivery, file movement, photocopying and distribution across all office departments", "Assisted staff with printing, scanning, spiral binding and courier dispatch of official documents", "Maintained cleanliness of office floors, workstations, meeting rooms and pantry areas throughout the day", "Prepared and served tea, coffee, water and refreshments to staff, clients and senior management", "Managed mail dispatch, courier collection, registered post and internal document circulation", "Ran official errands including banking, government offices, purchase of stationery and office supplies", "Assisted in arrangement of furniture, AV equipment and stationery for meetings and conferences", "Maintained pantry stock, cleaning supplies and reported replenishment requirements to administration", "Supported reception team during high footfall periods with visitor management and seating", "Handled sensitive documents with confidentiality and ensured proper filing and record maintenance", "Assisted in relocation, shifting of equipment and office reorganisation activities as required", "Maintained a presentable appearance and professional conduct while representing the organisation"],
  "Product Manager": ["Defined product vision, roadmap and quarterly OKRs in alignment with business and customer goals", "Gathered and prioritised product requirements through customer interviews, surveys and data analysis", "Collaborated with engineering, design and marketing teams to deliver product features on time", "Wrote detailed product requirement documents (PRDs), user stories and acceptance criteria", "Managed the product backlog, sprint planning and release cycles in Jira and Confluence", "Analysed product metrics using Mixpanel, Amplitude and Google Analytics to drive informed decisions", "Conducted competitor analysis, market research and opportunity sizing for new feature investments", "Facilitated cross-functional alignment across stakeholders through regular steering reviews and demos", "Launched 3 major product features increasing user engagement by 25% and retention by 18%", "Coordinated beta testing, user acceptance testing and feedback collection before full product release", "Defined and monitored product KPIs including DAU, MAU, conversion rate, churn and NPS", "Built go-to-market strategy in partnership with sales, marketing and customer success teams", "Presented product updates, roadmap reviews and business impact reports to leadership and investors"],
  "Business Analyst": ["Gathered, documented and validated business requirements through stakeholder interviews and workshops", "Translated business needs into functional specifications, use cases and process flow diagrams", "Conducted AS-IS and TO-BE process analysis and identified gaps, bottlenecks and improvement opportunities", "Prepared Business Requirement Documents (BRDs), Functional Requirement Documents (FRDs) and UAT plans", "Facilitated requirement sign-off sessions and managed scope changes through formal change control", "Coordinated between business stakeholders and development teams to ensure shared understanding", "Performed data analysis using Excel, SQL and Power BI to support process improvement recommendations", "Conducted UAT, created test scenarios and tracked defects to ensure system meets business expectations", "Created and maintained RACI matrices, project trackers and business process documentation", "Supported ERP implementation projects including SAP and Oracle, driving configuration and training", "Identified automation opportunities and supported RPA and digital transformation initiatives", "Prepared executive dashboards, business case presentations and ROI analysis for proposed solutions", "Worked with agile teams in sprint ceremonies and continuously refined backlog with the product owner"],
  "DevOps / Cloud Engineer": ["Designed and managed CI/CD pipelines using Jenkins, GitHub Actions and GitLab CI for automated deployments", "Deployed and maintained containerised applications using Docker and Kubernetes on AWS/Azure/GCP", "Managed cloud infrastructure using Terraform, CloudFormation and Ansible for infrastructure-as-code", "Monitored system health, performance and availability using Prometheus, Grafana and Datadog", "Configured and managed AWS services including EC2, S3, RDS, Lambda, VPC and IAM policies", "Implemented auto-scaling, load balancing and disaster recovery mechanisms for high-availability systems", "Collaborated with development teams to improve deployment frequency and reduce release cycle time by 60%", "Managed secrets, certificates and access control using Vault, AWS Secrets Manager and KMS", "Performed capacity planning, cost optimisation and cloud spend analysis reducing bills by 30%", "Established logging, alerting and incident management workflows with PagerDuty and OpsGenie", "Conducted security audits, vulnerability scanning and patching across cloud and on-prem infrastructure", "Maintained documentation of architecture diagrams, runbooks and deployment procedures for the team"],
  "Cybersecurity Analyst": ["Monitored security events and alerts using SIEM tools (Splunk, IBM QRadar) to detect threats in real time", "Investigated and responded to security incidents, performed root cause analysis and produced incident reports", "Conducted vulnerability assessments and penetration tests on internal systems, networks and web applications", "Managed endpoint protection, EDR tools and antivirus policies across the organisation", "Implemented and enforced security policies, access controls and least-privilege principles", "Performed phishing simulation campaigns and conducted security awareness training for employees", "Reviewed firewall rules, IDS/IPS configurations and network traffic for anomalous activity", "Assisted in ISO 27001, SOC 2 and GDPR compliance assessments and control implementation", "Managed identity and access management (IAM) including Active Directory, SSO and MFA rollouts", "Coordinated with vendors and third parties on security assessments, patch management and remediation", "Prepared monthly security dashboards, threat intelligence reports and risk assessment summaries", "Participated in red team/blue team exercises and tabletop simulations for incident preparedness"],
  "UI/UX Designer": ["Designed user-centred interfaces for web and mobile applications based on research and usability testing", "Created wireframes, interactive prototypes and high-fidelity mockups using Figma, Adobe XD and Sketch", "Conducted user research through interviews, surveys, heatmaps and usability testing sessions", "Developed user personas, customer journey maps, task flows and information architecture diagrams", "Collaborated with product managers and developers to ensure design feasibility and smooth handoff", "Built and maintained a design system with reusable components, tokens and documented guidelines", "Improved checkout conversion rate by 22% through UX research-driven redesign of the purchase flow", "Designed responsive interfaces optimised for desktop, tablet and mobile device experiences", "Facilitated design thinking workshops and ideation sessions with cross-functional stakeholders", "Translated brand identity guidelines into consistent, scalable and accessible UI design patterns", "Performed accessibility audits against WCAG 2.1 standards and implemented inclusive design improvements", "Iterated on designs rapidly based on A/B test results, analytics and qualitative user feedback"],
  "Digital Marketing": ["Planned and executed digital marketing campaigns across Google Ads, Meta Ads and LinkedIn Ads", "Managed monthly ad budgets of ₹5-20 lakhs and optimised campaigns for ROAS, CPL and CPA targets", "Developed SEO strategies including technical audits, keyword targeting and link-building resulting in 40% organic growth", "Managed social media content calendars, community engagement and brand presence across platforms", "Created and optimised email marketing campaigns using Mailchimp, HubSpot and Klaviyo", "Set up and managed conversion tracking, Google Tag Manager, Google Analytics 4 and Meta Pixel", "Conducted competitive analysis, audience research and market positioning for campaign strategies", "Designed and executed A/B tests on ad creatives, landing pages and CTAs to improve conversion rates", "Collaborated with content writers, graphic designers and videographers for campaign asset production", "Prepared weekly and monthly performance reports with insights on impressions, CTR, CPL and ROAS", "Managed influencer marketing collaborations, affiliate programmes and brand partnership activations", "Drove 35% growth in qualified leads quarter-on-quarter through integrated digital campaign execution"],
  "Social Media Manager": ["Developed and executed monthly social media content strategy across Instagram, LinkedIn, YouTube and X", "Created engaging organic content including graphics, reels, carousels and short-form videos", "Grew Instagram following from 5K to 50K in 8 months through consistent posting and engagement strategies", "Managed paid social campaigns on Meta and LinkedIn and optimised for reach, engagement and conversions", "Monitored brand mentions, responded to comments and DMs and maintained community relationships", "Tracked and reported platform analytics including reach, engagement rate, follower growth and CTR", "Collaborated with influencers and content creators for brand collaborations and sponsored content", "Developed platform-specific content strategies aligned with brand voice and seasonal campaigns", "Managed social media crisis communication and brand reputation monitoring proactively", "Coordinated with design and video teams for timely creation and scheduling of all content assets", "Stayed current on platform algorithm changes, trending formats and competitor social activities", "Conducted regular social media audits and presented performance insights and recommendations to leadership"],
  "Operations Manager": ["Oversaw day-to-day business operations across departments to ensure efficiency, quality and compliance", "Developed and implemented standard operating procedures (SOPs) to streamline processes and reduce errors", "Led cross-functional teams of 20-50 staff across operations, logistics, customer service and administration", "Monitored operational KPIs and prepared weekly dashboards for leadership review and decision-making", "Identified process inefficiencies and implemented automation and improvement initiatives saving 15% cost", "Managed vendor relationships, service-level agreements and contract renewals for operational continuity", "Coordinated with finance for budget preparation, cost control and monthly operational expense review", "Resolved operational escalations, cross-team conflicts and process gaps with structured problem-solving", "Led recruitment, onboarding, performance management and capability building for operations teams", "Ensured regulatory compliance, safety standards and audit readiness across all operational areas", "Drove operational excellence through Lean, Six Sigma and Kaizen process improvement frameworks", "Managed business continuity planning, disaster recovery and crisis response for operational disruptions"],
  "Supply Chain Manager": ["Managed end-to-end supply chain operations including procurement, inventory, logistics and vendor management", "Developed and maintained supplier relationships and negotiated contracts achieving 12% cost reduction", "Implemented demand forecasting models improving inventory accuracy and reducing stockouts by 30%", "Oversaw import/export documentation, customs clearance and freight forwarding operations", "Managed procurement processes including RFQ, bid evaluation, purchase orders and vendor onboarding", "Monitored supply chain KPIs including lead time, fill rate, inventory turnover and on-time delivery", "Coordinated with production, sales and finance teams for S&OP planning and inventory alignment", "Led implementation of ERP modules (SAP/Oracle) for procurement, inventory and logistics management", "Managed 3PL and 4PL provider relationships and ensured contract SLA compliance and performance reviews", "Developed risk mitigation strategies for supply disruptions, geopolitical events and raw material shortage", "Drove sustainability and ESG initiatives in the supply chain including supplier audits and carbon tracking", "Prepared monthly supply chain reports, cost analysis and improvement roadmaps for senior management"],
  "Quality Control (QC)": ["Conducted incoming material inspection, in-process checks and final inspection as per quality plans", "Performed dimensional checks using vernier callipers, micrometers, gauges and CMM instruments", "Documented inspection results, raised non-conformance reports (NCRs) and tracked corrective actions", "Maintained inspection test plans (ITPs), control plans and quality records for traceability", "Reviewed and interpreted engineering drawings, GD&T symbols and material specifications", "Conducted root cause analysis using Ishikawa diagrams, 5-Why and 8D problem-solving methods", "Managed calibration records for all measuring instruments and coordinated with NABL-accredited labs", "Assisted in preparation for third-party audits, customer inspections and ISO 9001 surveillance audits", "Reviewed supplier quality documentation including test certificates, MTC and CoC before acceptance", "Monitored process parameters and statistical process control (SPC) charts on the production floor", "Prepared quality reports, rejection summaries and PPM trend analysis for management review", "Participated in PPAP, FAI and product qualification activities for new products and components"],
  "Financial Analyst": ["Prepared detailed financial models, valuation analyses and investment appraisals for business decisions", "Developed annual budgets, rolling forecasts and multi-year financial projections for leadership review", "Analysed monthly P&L, balance sheet and cash flow statements and provided variance commentary", "Supported M&A, fundraising and strategic planning with financial due diligence and scenario analysis", "Built DCF, comparable company and precedent transaction valuation models for investment decisions", "Prepared investor presentations, board packs and quarterly earnings analysis reports", "Monitored working capital, cash conversion cycle and liquidity ratios against internal benchmarks", "Automated financial reporting processes using Excel macros and Power BI reducing reporting time by 50%", "Coordinated with business units for budget submissions, reforecast updates and capital expenditure review", "Conducted sensitivity and scenario analysis to quantify business risk and support management decisions", "Managed treasury operations including cash forecasting, FX hedging and bank relationship management", "Supported fundraising rounds including preparation of financial data room, cap table and financial projections"],
  "Data Scientist": ["Built and deployed machine learning models for classification, regression, clustering and NLP applications", "Developed predictive models using Python (Scikit-learn, XGBoost, TensorFlow) improving forecast accuracy by 25%", "Performed exploratory data analysis (EDA), feature engineering and data preprocessing on large datasets", "Deployed ML models via REST APIs using Flask, FastAPI and containerised them with Docker on cloud", "Collaborated with business stakeholders to define problem statements, data requirements and success metrics", "Designed and analysed A/B experiments with statistical rigour to validate product and business hypotheses", "Built data pipelines and ETL workflows using Apache Spark, Airflow and cloud-native tools", "Developed recommendation engines, churn prediction and customer segmentation models for business use", "Presented model findings, business impact and technical methodology to both technical and non-technical audiences", "Used NLP techniques for sentiment analysis, topic modelling and text classification on unstructured data", "Monitored model performance in production, detected drift and retrained models to maintain accuracy", "Published Jupyter notebooks, model cards and technical documentation for all deployed solutions"],
  "Network Engineer": ["Designed, deployed and maintained LAN/WAN, MPLS and SD-WAN network infrastructure across locations", "Configured and managed enterprise routers, switches and firewalls (Cisco, Juniper, Palo Alto, Fortinet)", "Implemented network security policies, VLANs, ACLs and firewall rules to ensure perimeter protection", "Monitored network performance using SolarWinds, PRTG and Nagios and resolved degradation issues", "Managed BGP, OSPF, EIGRP routing protocols and troubleshot Layer 2/3 connectivity issues", "Supported VPN configurations including site-to-site IPSec VPN and remote access SSL VPN setups", "Coordinated with ISPs, MPLS providers and data centre teams for link provisioning and SLA management", "Performed network capacity planning, traffic analysis and bandwidth optimisation activities", "Assisted in data centre networking including spine-leaf architecture, server virtualisation and SAN connectivity", "Responded to P1/P2 network incidents and led troubleshooting to restore service within defined RTO", "Maintained network diagrams, IP address management (IPAM) records and configuration backups", "Implemented wireless LAN infrastructure including Cisco Meraki and Aruba access point deployments"],
  "Doctor / MBBS": ["Examined, diagnosed and treated patients across OPD, IPD and emergency settings with clinical accuracy", "Recorded detailed patient history, performed clinical examination and ordered appropriate investigations", "Prescribed evidence-based treatment plans and medications in line with standard treatment protocols", "Managed acute medical emergencies including resuscitation, stabilisation and escalation to specialists", "Performed procedures including wound suturing, IV cannulation, lumbar puncture and pleural tapping", "Counselled patients and families on diagnosis, prognosis, treatment options and lifestyle modifications", "Maintained accurate medical records, discharge summaries and documentation in HMS/EMR systems", "Collaborated with multidisciplinary teams including nursing, pharmacy and allied health professionals", "Participated in mortality and morbidity reviews, case conferences and clinical audit activities", "Supervised interns, resident doctors and nursing staff in clinical decision-making and ward management", "Contributed to preventive health campaigns, vaccination programmes and community health outreach", "Ensured adherence to medical ethics, patient confidentiality and hospital clinical governance standards"],
  "CA / Chartered Accountant": ["Led statutory audits, tax audits and internal audits for clients across manufacturing, BFSI and IT sectors", "Prepared and reviewed financial statements as per IndAS, IGAAP and IFRS reporting frameworks", "Filed income tax returns, handled assessments, appeals and represented clients before tax authorities", "Managed GST registration, monthly filings (GSTR-1, GSTR-3B, GSTR-9) and GST audit for clients", "Conducted due diligence, business valuation and financial modelling for M&A and investment transactions", "Advised clients on tax planning, transfer pricing, FEMA compliance and structuring for tax efficiency", "Managed a portfolio of 30+ clients across industries and ensured compliance with all statutory deadlines", "Prepared and reviewed Board reports, Director reports, CARO reports and related party disclosures", "Handled ROC filings, secretarial compliance and company law advisory under Companies Act 2013", "Assisted in NCLT matters, insolvency proceedings and resolution plan preparation under IBC framework", "Supervised article assistants, managed engagement teams and ensured quality of audit deliverables", "Liaised with SEBI, RBI, IRDAI and other regulators for filings, approvals and compliance matters"],
  "Legal / Paralegal": ["Drafted, reviewed and negotiated a wide range of commercial contracts, NDAs and vendor agreements", "Conducted legal research on statutes, regulations, case law and regulatory updates relevant to client matters", "Managed contract lifecycle including drafting, review, execution, amendments and renewals", "Assisted in litigation support including preparation of pleadings, affidavits, written submissions and briefs", "Coordinated with external counsel, courts and regulatory bodies for filing and hearing management", "Provided legal opinions and advisory on employment law, IP, data privacy and consumer protection matters", "Managed document review, due diligence and legal document management for M&A and fundraising deals", "Ensured corporate compliance including board resolutions, statutory registers and ROC filings", "Monitored regulatory developments and updated internal teams on compliance requirements and changes", "Handled labour law compliance including factory act, shops and establishments and industrial disputes", "Assisted in NCLT, NCLAT, High Court matters including preparation of applications and responses", "Maintained legal MIS, contract tracker, litigation register and compliance calendar for the organisation"],
  "Architect": ["Designed architectural concepts, space planning layouts and 3D visualisations for residential and commercial projects", "Prepared detailed architectural drawings, BOQs, material schedules and specifications using AutoCAD and Revit", "Coordinated with structural, MEP and interior design consultants for integrated and clash-free design delivery", "Managed project design from schematic design through design development, working drawings and site supervision", "Prepared design presentations, walkthroughs and client presentations using SketchUp and Lumion", "Ensured designs complied with NBC, development control regulations, zoning bylaws and fire safety norms", "Coordinated with local authorities for plan approval, OC and CC submissions and regulatory clearances", "Conducted site visits, quality inspections and resolved design-to-construction discrepancies on site", "Managed project documentation including drawing registers, RFI logs, design change records and as-built drawings", "Led design reviews, coordination meetings and ensured stakeholder alignment on design intent and specifications", "Developed sustainable design strategies including passive cooling, daylight optimisation and green building features", "Mentored junior architects and draftsmen and reviewed drawing outputs for quality and coordination compliance"],
  "Interior Designer": ["Designed innovative interior concepts for residential, commercial, retail and hospitality projects", "Prepared detailed design drawings, furniture layouts, elevation drawings and material boards", "Developed mood boards, colour palettes, material specifications and finish schedules for client presentations", "Coordinated with architects, MEP consultants and structural engineers for integrated interior design delivery", "Managed project execution from concept through design development, working drawings and site supervision", "Sourced and specified furniture, fixtures, fittings, lighting and décor from premium vendors", "Prepared BOQs, scope-of-work documents and design specifications for contractor tendering", "Conducted regular site inspections to ensure workmanship, material and finish quality met design intent", "Managed client relationships, design presentations and incorporated feedback through revision cycles", "Worked proficiently in AutoCAD, SketchUp, 3DS Max, V-Ray and Adobe Creative Suite", "Ensured designs met accessibility, safety, acoustic and ergonomic requirements for the project type", "Managed project timelines, vendor coordination and procurement to ensure on-schedule interior delivery"],
  "Real Estate Agent": ["Assisted buyers and sellers in residential and commercial property transactions end to end", "Developed and maintained a portfolio of 50+ active listings across the city with accurate property details", "Conducted property market research, comparative market analysis and advised clients on pricing strategy", "Managed client relationships, understood investment goals and matched requirements to suitable properties", "Negotiated sale and rental agreements, coordinated legal documentation and ensured smooth deal closure", "Generated new leads through digital marketing, referrals, site visits, builder tie-ups and networking events", "Achieved monthly revenue targets by closing 8-12 transactions consistently in competitive markets", "Coordinated property inspections, site visits and accompanied clients on personalised property tours", "Maintained up-to-date knowledge of RERA regulations, stamp duty, registration and property tax rules", "Provided post-sale support including documentation, registration, loan processing and handover coordination", "Managed builder and developer relationships to offer clients exclusive pre-launch and inventory deals", "Maintained a strong online presence through 99acres, MagicBricks, Housing and social media platforms"],
  "Event Manager": ["Planned, coordinated and executed corporate events, product launches, conferences and exhibitions end to end", "Managed event budgets ranging from ₹5 lakhs to ₹2 crore and ensured delivery within approved costs", "Sourced and negotiated with venues, caterers, AV vendors, decorators and entertainment agencies", "Coordinated logistics including registrations, travel, accommodation, guest management and on-site operations", "Developed event concepts, themes, runsheets and production schedules aligned with client vision", "Managed 10-30 member event teams on ground and ensured all stakeholders were briefed and aligned", "Handled client presentations, proposal preparations and creative concept pitches for new event mandates", "Coordinated with government authorities for permissions, NOCs and security arrangements for large events", "Managed virtual and hybrid event productions including Zoom, Hopin and streaming platform coordination", "Executed post-event reporting including attendance, feedback, cost analysis and lessons learned documentation", "Built and maintained a strong vendor network enabling competitive pricing and high service quality", "Delivered flawless events for 500-5000 attendees maintaining strict timelines and quality standards"],
  "Air Hostess / Cabin Crew": ["Delivered exceptional in-flight passenger service on domestic and international routes per airline standards", "Conducted comprehensive pre-flight safety demonstrations and ensured passenger compliance with safety norms", "Performed thorough safety checks on equipment, galley readiness and cabin condition before each flight", "Managed in-flight sales, duty-free services and meal service for economy and business class passengers", "Responded to medical emergencies, air turbulence incidents and passenger distress with composure", "Coordinated with cockpit crew on safety announcements, seat allocation and boarding management", "Delivered personalised service to premium passengers, frequent flyers and unaccompanied minors", "Maintained DGCA and airline-mandated compliance for safety procedures, grooming and conduct standards", "Participated in recurrent safety training, emergency drills and first aid certification programmes", "Managed passenger complaints, service disruptions and irregular operations with professionalism", "Contributed to positive passenger feedback scores and received commendations for service excellence", "Assisted in crew coordination, briefing sessions and collaborated as part of a multicultural cabin team"],
  "Fresher / Graduate": ["Completed graduation with a strong academic record and active participation in co-curricular activities", "Developed foundational skills in [your subject] through coursework, projects and academic assignments", "Participated in internship programmes gaining hands-on exposure to real-world professional environments", "Completed live projects, case study competitions and group assignments demonstrating analytical ability", "Demonstrated strong communication, teamwork and problem-solving skills through group projects and presentations", "Actively participated in technical workshops, seminars, hackathons and skill-development programmes", "Self-learned industry-relevant tools and technologies to supplement academic knowledge", "Volunteered in college events, social initiatives and NSS activities demonstrating leadership potential", "Pursued certifications in relevant fields including digital marketing, coding, finance and communication", "Maintained a consistent academic performance ranking within the top 20% of the department batch", "Completed capstone project focusing on real industry problem solving with measurable outcomes", "Demonstrated eagerness to learn, adapt quickly and contribute positively in team environments"],
  "Fitness Trainer / Gym Instructor": ["Designed personalised workout programmes for clients based on fitness goals, health conditions and assessments", "Conducted one-on-one PT sessions, group fitness classes and circuit training for 20-50 clients daily", "Performed initial fitness assessments including body composition, flexibility and cardiovascular capacity tests", "Monitored client progress, updated programmes periodically and provided continuous motivation and feedback", "Provided guidance on nutrition, hydration, recovery and supplementation aligned with fitness objectives", "Maintained gym equipment functionality and ensured safe, clean training environment at all times", "Ensured clients maintained correct form and technique to prevent injuries during all exercise sessions", "Organised fitness events, transformation challenges and group bootcamp programmes for client engagement", "Built strong client retention through personalised attention, result-driven training and community building", "Held relevant certifications including ISSA, ACE, ACSM or equivalent national fitness certifications", "Grew personal training client base from 10 to 40+ through referrals and social media presence", "Assisted members with onboarding, gym orientation and tailoring membership plans to individual goals"],
  "Beautician / Salon Professional": ["Provided a full range of beauty services including haircuts, styling, colouring, facials and waxing", "Consulted with clients to understand preferences, skin type and desired results before each service", "Performed advanced hair treatments including keratin, smoothening, rebonding and balayage colouring", "Conducted skin analysis and recommended suitable facials, clean-ups and skincare treatment plans", "Performed bridal makeup, party makeup and special occasion hair and beauty packages", "Maintained strict hygiene standards including sterilisation of tools and sanitation of workstations", "Managed client bookings, upsold premium services and maintained a loyal repeat clientele", "Stayed updated on the latest beauty trends, techniques and product launches through training", "Handled nail art, manicure, pedicure, gel extensions and nail care services with precision", "Managed stock of salon products, recommended professional retail products to clients for home care", "Achieved monthly service revenue targets and contributed to salon growth through client referrals", "Trained junior beauticians on techniques, client handling and hygiene standards"],
};
// Build keyword map for auto-matching job title to category
const LIB_KEYWORDS = {
  "Software Engineer": ["software", "developer", "programmer", "coder", "web", "frontend", "backend", "fullstack", "react", "node", "java", "python", "angular", "devops", "engineer", "swe", "sde"],
  "IT Support": ["it support", "helpdesk", "tech support", "desktop", "network", "system admin", "sysadmin", "technical support", "service desk"],
  "Data Analyst": ["data analyst", "data scientist", "analytics", "business intelligence", "bi analyst", "reporting", "sql", "tableau", "power bi", "data"],
  "Accountant": ["accountant", "accounts", "finance", "bookkeeper", "audit", "taxation", "gst", "tally", "ca", "cpa", "financial analyst", "finance executive"],
  "Sales / Marketing": ["sales", "marketing", "business development", "bd", "bdm", "relationship manager", "territory manager", "field sales", "brand", "sales executive"],
  "Office / Admin": ["admin", "administrator", "coordinator", "office", "executive assistant", "secretary", "back office", "data entry", "operations", "admin executive"],
  "HR Executive": ["hr", "human resource", "talent acquisition", "recruiter", "recruitment", "people ops", "payroll", "hrbp", "hr executive", "hr manager"],
  "Teacher / Educator": ["teacher", "lecturer", "professor", "educator", "faculty", "tutor", "instructor", "coach", "trainer", "school", "teaching"],
  "Nurse / Healthcare": ["nurse", "nursing", "staff nurse", "icu", "ot", "operation theatre", "healthcare", "patient care", "ward", "clinical", "rn"],
  "Driver": ["driver", "chauffeur", "vehicle operator", "cab driver", "truck driver", "bus driver", "transport", "heavy vehicle"],
  "Security Guard": ["security", "guard", "watchman", "bouncer", "surveillance", "cctv", "access control", "security officer"],
  "Construction": ["construction", "site worker", "labour", "mason", "carpenter", "painter", "civil work", "labourer"],
  "Loco/MSV Operator": ["loco", "msv", "locomotive", "tunnel", "metro", "rail operator", "train operator", "tunnel operator"],
  "Gantry / Crane Operator": ["crane", "gantry", "tbm", "hoist", "rigger", "lifting", "winch", "crane operator"],
  "Electrician": ["electrician", "electrical", "wiring", "panel", "switchgear", "lineman", "ehs electrical", "electrical technician"],
  "Plumber": ["plumber", "plumbing", "pipefitter", "pipe", "sanitary", "drainage", "mep", "plumbing technician"],
  "Welder / Fabricator": ["welder", "welding", "fabricat", "fitter", "mig", "tig", "arc", "structural welder"],
  "Mechanic": ["mechanic", "automotive", "vehicle repair", "workshop", "diesel", "engine", "automobile", "auto mechanic"],
  "Civil Engineer": ["civil engineer", "site engineer", "structural", "rcc", "concrete", "rebar", "survey", "civil"],
  "Mechanical Engineer": ["mechanical engineer", "hvac", "piping", "rotating", "maintenance engineer", "mech engineer"],
  "Project Manager": ["project manager", "pm", "pmo", "project lead", "delivery manager", "programme", "project management"],
  "Site Supervisor": ["site supervisor", "foreman", "gang leader", "supervisor", "site in-charge", "field supervisor"],
  "Quantity Surveyor": ["quantity surveyor", "qs", "estimator", "cost engineer", "billing engineer", "boe", "qs engineer"],
  "Receptionist": ["receptionist", "front desk", "front office", "guest relation", "concierge", "front office executive"],
  "Customer Service": ["customer service", "customer care", "customer support", "call centre", "helpline", "csr", "customer success"],
  "Logistics / Warehouse": ["logistics", "warehouse", "store", "storekeeper", "inventory", "supply chain", "dispatch", "procurement", "material"],
  "Retail / Shop": ["retail", "shop", "store assistant", "sales assistant", "cashier", "counter", "showroom", "retail executive"],
  "Cook / Chef": ["cook", "chef", "kitchen", "culinary", "food preparation", "sous chef", "commi", "head chef"],
  "Hotel / Hospitality": ["hotel", "hospitality", "f&b", "food beverage", "restaurant", "housekeeping manager", "front office manager", "hospitality executive"],
  "Banking / Finance": ["bank", "banking", "teller", "relationship banker", "loan officer", "credit", "insurance", "mutual fund", "bank executive"],
  "Pharmacist": ["pharmacist", "pharmacy", "chemist", "drug", "dispensing", "medicine", "clinical pharmacist"],
  "Lab Technician": ["lab", "laboratory", "technician", "pathology", "radiology", "blood", "sample", "diagnostic", "lab tech"],
  "Graphic Designer": ["graphic designer", "graphic", "designer", "visual", "illustrator", "photoshop", "creative", "ui", "ux", "visual designer"],
  "Content Writer": ["content", "writer", "copywriter", "blogger", "seo", "journalist", "editor", "content creator"],
  "Tailor / Garment": ["tailor", "sewing", "garment", "stitching", "textile", "fabric", "fashion", "apparel"],
  "Farmer / Agriculture": ["farmer", "agriculture", "farming", "crop", "horticulture", "agri", "agricultural"],
  "Delivery / Courier": ["delivery", "courier", "last mile", "logistics rider", "bike delivery", "shipping", "delivery executive"],
  "Housekeeping": ["housekeeping", "housekeeper", "room attendant", "cleaner", "sanitation", "janitorial", "housekeeping attendant"],
  "Peon / Office Boy": ["peon", "office boy", "attender", "helper", "support staff", "bell boy", "office helper"],
  "Product Manager": ["product manager", "product owner", "pm", "po", "product lead", "product head", "product management"],
  "Business Analyst": ["business analyst", "ba", "systems analyst", "functional consultant", "process analyst", "requirement analyst"],
  "DevOps / Cloud Engineer": ["devops", "cloud", "aws", "azure", "gcp", "kubernetes", "docker", "ci/cd", "infrastructure", "sre", "platform engineer"],
  "Cybersecurity Analyst": ["cybersecurity", "security analyst", "infosec", "soc", "penetration", "ethical hacker", "network security", "information security"],
  "UI/UX Designer": ["ui", "ux", "user experience", "user interface", "product designer", "interaction designer", "figma", "wireframe"],
  "Digital Marketing": ["digital marketing", "performance marketing", "seo", "sem", "ppc", "google ads", "meta ads", "growth", "digital"],
  "Social Media Manager": ["social media", "instagram", "facebook", "content creator", "community manager", "social media manager", "influencer"],
  "Operations Manager": ["operations manager", "ops manager", "general manager", "business operations", "operations head"],
  "Supply Chain Manager": ["supply chain", "scm", "procurement manager", "sourcing", "purchasing", "logistics manager", "materials manager"],
  "Quality Control (QC)": ["quality", "qc", "quality control", "inspector", "qce", "quality engineer", "quality assurance", "qa"],
  "Financial Analyst": ["financial analyst", "finance analyst", "fp&a", "corporate finance", "investment analyst", "treasury", "financial planning"],
  "Data Scientist": ["data scientist", "ml", "machine learning", "ai", "deep learning", "nlp", "data science", "artificial intelligence"],
  "Network Engineer": ["network engineer", "networking", "cisco", "ccna", "ccnp", "lan", "wan", "network admin", "noc"],
  "Doctor / MBBS": ["doctor", "mbbs", "physician", "general practitioner", "resident", "medical officer", "intern", "gp", "mo", "rmo"],
  "CA / Chartered Accountant": ["chartered accountant", "ca", "cfa", "icai", "audit partner", "tax consultant", "ca finalist"],
  "Legal / Paralegal": ["lawyer", "legal", "advocate", "paralegal", "legal counsel", "company secretary", "cs", "legal executive", "solicitor"],
  "Architect": ["architect", "architecture", "revit", "autocad", "urban planner", "landscape architect", "building design"],
  "Interior Designer": ["interior", "interior designer", "space designer", "decor", "3ds max", "vray", "interior decoration"],
  "Real Estate Agent": ["real estate", "property", "broker", "realtor", "property consultant", "site sales", "leasing"],
  "Event Manager": ["event", "event manager", "event planner", "wedding planner", "conference", "exhibition", "event coordinator"],
  "Air Hostess / Cabin Crew": ["air hostess", "cabin crew", "flight attendant", "stewardess", "inflight", "airline", "aviation crew"],
  "Fresher / Graduate": ["fresher", "graduate", "entry level", "new graduate", "student", "trainee", "junior", "campus"],
  "Fitness Trainer / Gym Instructor": ["fitness trainer", "gym instructor", "personal trainer", "pt", "fitness coach", "strength coach", "yoga"],
  "Beautician / Salon Professional": ["beautician", "salon", "makeup artist", "hairdresser", "beauty therapist", "nail technician", "spa", "stylist"],
};

// ══════════════════════════════════════════════════════════
// STATE
// ══════════════════════════════════════════════════════════
let currentSlot = 0, currentTemplate = 2, currentColor = '#0F766E';
let currentHeaderColor = '#0F766E', currentHeaderText = 'light', currentBarStyle = 'solid';
let currentSpacing = 'compact', currentFontSize = 12, currentNameSize = 24, currentSectionHeaderSize = 13;
let currentTopTitleSize = 14, currentSubHeaderSize = 13;
let currentFontFamily = 'default';
let photoData = null;
let jobs = [], edus = [], skills = [], certs = [], customSections = [];
let libTargetJob = 0, libTargetField = 'responsibilities';
let libActiveCat = Object.keys(BULLET_LIB)[0];
let demoTpl = 1;
let saveTimer = null, previewTimer = null;
let mobilePreviewOpen = false;

// ══════════════════════════════════════════════════════════
// STORAGE
// ══════════════════════════════════════════════════════════
function saveSlot(slot) {
  const data = {
    personal: getFormData(),
    jobs, edus, skills, certs, customSections,
    photo: photoData,
    extras: {
      decl: document.getElementById('tog_decl')?.checked || false,
      personal: document.getElementById('tog_personal')?.checked || false,
      photo: document.getElementById('tog_photo')?.checked !== false,
      father: document.getElementById('tog_father')?.checked !== false,
    },
    template: currentTemplate,
    color: currentColor,
    headerColor: currentHeaderColor,
    headerText: currentHeaderText,
    barStyle: currentBarStyle,
    spacing: currentSpacing,
    fontSize: currentFontSize,
    nameSize: currentNameSize,
    sectionHeaderSize: currentSectionHeaderSize,
    topTitleSize: currentTopTitleSize,
    subHeaderSize: currentSubHeaderSize,
    typoPreset: currentTypoPreset,
    fontFamily: currentFontFamily,
  };
  try { localStorage.setItem('cv_slot_' + slot, JSON.stringify(data)); } catch(e) {}
}

function loadSlot(slot) {
  currentSlot = +slot;
  document.getElementById('slot-select').value = slot;
  try {
    const raw = localStorage.getItem('cv_slot_' + slot);
    if (raw) {
      const d = JSON.parse(raw);
      fillForm(d.personal || {});
      jobs = d.jobs || [{title:'',company:'',location:'',start:'',end:'',current:false,type:'Full-time',responsibilities:['']}];
      edus = d.edus || [{degree:'',institution:'',location:'',startYear:'',endYear:'',grade:''}];
      skills = d.skills || [{name:'',level:'Advanced'}];
      certs = d.certs || [];
      // Load custom sections + migrate old 'entries' structure to new 'items' structure
      customSections = (d.customSections || []).map(sec => {
        if (sec.items) return sec; // already new format
        // Migrate old format: entries:[{subTitle,org,location,start,end,current,bullets}]
        const items = (sec.entries || []).map(e => ({
          name:    e.subTitle || '',
          detail:  (e.org||'') + (e.org && e.location ? ', ' : '') + (e.location||''),
          dates:   e.start ? (e.start + (e.end||e.current?' – ':'') + (e.current?'Present':(e.end||''))) : (e.end||''),
          bullets: e.bullets || ['']
        }));
        return { id:sec.id, title:sec.title||'', items:items.length ? items : [{name:'',detail:'',dates:'',bullets:['']}] };
      });
      photoData = d.photo || null;
      currentTemplate = d.template || 2;
      currentColor = d.color || '#0F766E';
      currentHeaderColor = d.headerColor || d.color || '#0F766E';
      currentHeaderText  = d.headerText  || 'light';
      currentBarStyle    = d.barStyle    || 'solid';
      currentSpacing = d.spacing || 'compact';
      currentFontSize = d.fontSize || 12;
      currentNameSize = d.nameSize || 24;
      currentSectionHeaderSize = d.sectionHeaderSize || 13;
      currentTopTitleSize = d.topTitleSize || 14;
      currentSubHeaderSize = d.subHeaderSize || 13;
      currentTypoPreset = d.typoPreset || 'professional';
      currentFontFamily = d.fontFamily || 'default';
      if (d.extras) {
        const tog_decl = document.getElementById('tog_decl');
        const tog_personal = document.getElementById('tog_personal');
        const tog_photo = document.getElementById('tog_photo');
        const tog_father = document.getElementById('tog_father');
        if (tog_decl) tog_decl.checked = d.extras.decl || false;
        if (tog_personal) tog_personal.checked = d.extras.personal || false;
        if (tog_photo) tog_photo.checked = d.extras.photo !== false;
        if (tog_father) tog_father.checked = d.extras.father !== false;
      }
      // ── Restore margin settings ──
      const mp1b = document.getElementById('margin_p1_b');
      const mp2t = document.getElementById('margin_p2_t');
      const mp2b = document.getElementById('margin_p2_b');
      if (mp1b) mp1b.value = (d.margin_p1_b != null ? d.margin_p1_b : 10);
      if (mp2t) mp2t.value = (d.margin_p2_t != null ? d.margin_p2_t : 10);
      if (mp2b) mp2b.value = (d.margin_p2_b != null ? d.margin_p2_b : 10);
    } else {
      resetState();
    }
  } catch(e) { resetState(); }
  applyColor(currentColor, false);
  setSpacingBtn(currentSpacing);
  syncTemplateUI();
  const fs = document.getElementById('font-size-slider');
  if (fs) fs.value = currentFontSize;
  const bodyInput = document.getElementById('fs-body');
  if (bodyInput) bodyInput.value = currentFontSize;
  const nmInput = document.getElementById('fs-name');
  if (nmInput) nmInput.value = currentNameSize;
  const shInput = document.getElementById('fs-section');
  if (shInput) shInput.value = currentSectionHeaderSize;
  const ttInput = document.getElementById('fs-toptitle');
  if (ttInput) ttInput.value = currentTopTitleSize;
  const subInput = document.getElementById('fs-subheader');
  if (subInput) subInput.value = currentSubHeaderSize;
  syncTypoPresetUI();
  syncFontFamilyUI();
  syncCustomSectionsToLayout();
  renderAll();
  renderCustomSections();
  updatePhotoUI();
  schedulePreview();
}

function resetState() {
  jobs = [{title:'',company:'',location:'',start:'',end:'',current:false,type:'Full-time',responsibilities:['']}];
  edus = [{degree:'',institution:'',location:'',startYear:'',endYear:'',grade:''}];
  skills = [{name:'',level:'Advanced'}];
  certs = [];
  customSections = [];
  photoData = null;
  currentTemplate = 2; currentColor = '#0F766E'; currentSpacing = 'compact'; currentFontSize = 12;
  currentNameSize = 24; currentSectionHeaderSize = 13; currentTopTitleSize = 14; currentSubHeaderSize = 13;
  currentTypoPreset = 'professional';
  fillForm({});
}

// ══════════════════════════════════════════════════════════
// CUSTOM SECTIONS
// Structure: [{id, title, items:[{name, detail, dates, bullets:[]}]}]
// ══════════════════════════════════════════════════════════

function csBlankItem() {
  return { name:'', detail:'', dates:'', bullets:[''] };
}

function addCustomSection() {
  const id = 'custom_' + Date.now();
  customSections.push({ id, title:'', items:[csBlankItem()] });
  pageLayout.push({ id, label:'Custom: (New)', icon:'', page:1 });
  renderCustomSections();
  renderPageLayout();
  // CRITICAL: save page layout so this section persists on reload
  try { localStorage.setItem('cv_page_layout', JSON.stringify(pageLayout)); } catch(e){}
  autoSave();
  schedulePreview();
}

function removeCustomSection(si) {
  const sec = customSections[si];
  if (sec) {
    const pIdx = pageLayout.findIndex(p => p.id === sec.id);
    if (pIdx >= 0) pageLayout.splice(pIdx, 1);
  }
  customSections.splice(si, 1);
  renderCustomSections();
  renderPageLayout();
  // CRITICAL: update saved page layout after removal
  try { localStorage.setItem('cv_page_layout', JSON.stringify(pageLayout)); } catch(e){}
  autoSave();
  schedulePreview();
}

function addCustomItem(si) {
  customSections[si].items.push(csBlankItem());
  renderCustomSections();
  setTimeout(() => {
    const inputs = document.querySelectorAll('#csi-'+si+' .csi-name');
    if (inputs.length) inputs[inputs.length-1].focus();
  }, 60);
}

function removeCustomItem(si, ii) {
  customSections[si].items.splice(ii, 1);
  if (!customSections[si].items.length) customSections[si].items = [csBlankItem()];
  renderCustomSections();
  autoSave();
}

function addCustomBullet(si, ii) {
  customSections[si].items[ii].bullets.push('');
  renderCustomSections();
  setTimeout(() => {
    const rows = document.querySelectorAll('#csb-'+si+'-'+ii+' .bullet-row input');
    if (rows.length) rows[rows.length-1].focus();
  }, 60);
}

function removeCustomBullet(si, ii, bi) {
  customSections[si].items[ii].bullets.splice(bi, 1);
  if (!customSections[si].items[ii].bullets.length) customSections[si].items[ii].bullets = [''];
  renderCustomSections();
  autoSave();
}

function updateCSTitle(si, val) {
  customSections[si].title = val;
  const p = pageLayout.find(p => p.id === customSections[si].id);
  if (p) p.label = 'Custom: ' + (val || '(New)');
  // Update saved page layout label
  try { localStorage.setItem('cv_page_layout', JSON.stringify(pageLayout)); } catch(e){}
  renderPageLayout();
  autoSave();
}

function updateCSItem(si, ii, field, val) {
  customSections[si].items[ii][field] = val;
  autoSave();
}

function updateCSBullet(si, ii, bi, val) {
  customSections[si].items[ii].bullets[bi] = val;
  autoSave();
}

function moveCustomSection(si, dir) {
  const ni = si + dir;
  if (ni < 0 || ni >= customSections.length) return;
  [customSections[si], customSections[ni]] = [customSections[ni], customSections[si]];
  renderCustomSections();
  autoSave();
}

function moveCustomItem(si, ii, dir) {
  const ni = ii + dir;
  if (ni < 0 || ni >= customSections[si].items.length) return;
  [customSections[si].items[ii], customSections[si].items[ni]] = [customSections[si].items[ni], customSections[si].items[ii]];
  renderCustomSections();
  autoSave();
}

function renderCustomSections() {
  const c = document.getElementById('custom-sections-container');
  if (!c) return;
  if (!customSections.length) { c.innerHTML = ''; return; }
  c.innerHTML = customSections.map((sec, si) => `
    <div class="entry-block" id="csi-${si}" style="border-left:3px solid var(--primary);">
      <div class="entry-header">
        <span class="entry-num"> Section #${si+1}${sec.title ? ' — '+esc(sec.title) : ''}</span>
        <div class="entry-actions">
          ${si>0?`<button class="icon-btn" onclick="moveCustomSection(${si},-1)">↑</button>`:''}
          ${si<customSections.length-1?`<button class="icon-btn" onclick="moveCustomSection(${si},1)">↓</button>`:''}
          <button class="icon-btn danger" onclick="removeCustomSection(${si})"></button>
        </div>
      </div>

      <div class="field">
        <label>Section Heading <span class="req">*</span></label>
        <input type="text" class="csi-title" placeholder="e.g. Interests · Hobbies · Languages · Projects · Awards…"
          value="${esc(sec.title)}"
          oninput="updateCSTitle(${si},this.value)"
          style="font-weight:700;font-size:14px;"/>
      </div>

      ${sec.items.map((item, ii) => `
        <div class="entry-block" style="background:#F8FAFC;margin-bottom:8px;border:1px solid #E2E8F0;">
          <div class="entry-header">
            <span class="entry-num" style="font-size:11px;">Item #${ii+1}${item.name?' — '+esc(item.name):''}</span>
            <div class="entry-actions">
              ${ii>0?`<button class="icon-btn" onclick="moveCustomItem(${si},${ii},-1)">↑</button>`:''}
              ${ii<sec.items.length-1?`<button class="icon-btn" onclick="moveCustomItem(${si},${ii},1)">↓</button>`:''}
              ${sec.items.length>1?`<button class="icon-btn danger" onclick="removeCustomItem(${si},${ii})"></button>`:''}
            </div>
          </div>

          <div class="g2">
            <div class="field">
              <label>Title / Name <span style="color:var(--primary);font-size:10px;">(shows on CV)</span></label>
              <input type="text" class="csi-name" placeholder="e.g. Reading · Cricket · React.js · Best Employee"
                value="${esc(item.name)}"
                oninput="updateCSItem(${si},${ii},'name',this.value)"
                onblur="autoSave()"/>
            </div>
            <div class="field">
              <label>Organisation / Context</label>
              <input type="text" placeholder="e.g. Google · IIT Bombay · Self-Taught"
                value="${esc(item.detail)}"
                oninput="updateCSItem(${si},${ii},'detail',this.value)"
                onblur="autoSave()"/>
            </div>
          </div>

          <div class="field">
            <label>Dates / Period <span style="color:var(--muted);font-size:10px;">(optional)</span></label>
            <input type="text" placeholder="e.g. Jan 2022 – Present · 2020 · Ongoing"
              value="${esc(item.dates)}"
              oninput="updateCSItem(${si},${ii},'dates',this.value)"
              onblur="autoSave()"/>
          </div>

          <div class="bullet-wrap" id="csb-${si}-${ii}">
            <div class="bullet-label">
              <span>Details / Bullet Points <span style="color:var(--muted);font-size:10px;">(optional)</span></span>
              <button class="suggest-btn" onclick="addCustomBullet(${si},${ii})">+ Add Line</button>
            </div>
            ${item.bullets.map((b,bi) => `
              <div class="bullet-row">
                <input type="text" placeholder="Add a detail about this item…"
                  value="${esc(b)}"
                  oninput="updateCSBullet(${si},${ii},${bi},this.value)"
                  onblur="autoSave()"/>
                ${item.bullets.length>1?`<button class="bullet-del" onclick="removeCustomBullet(${si},${ii},${bi})"></button>`:''}
              </div>`).join('')}
          </div>
        </div>`).join('')}

      <button class="add-entry-btn" onclick="addCustomItem(${si})">+ Add Item</button>
    </div>`).join('');
}

function syncCustomSectionsToLayout() {
  // Remember previously saved page values for custom sections
  const savedPages = {};
  pageLayout.forEach(p => { if (p.id.startsWith('custom_')) savedPages[p.id] = p.page; });
  // Remove all existing custom_ entries
  for (let i = pageLayout.length-1; i >= 0; i--) {
    if (pageLayout[i].id.startsWith('custom_')) pageLayout.splice(i,1);
  }
  const insertBefore = pageLayout.findIndex(p => p.id === 'personal');
  customSections.forEach(sec => {
    const savedPage = savedPages[sec.id] || 1;
    const entry = { id:sec.id, label:'Custom: '+(sec.title||'(New)'), icon:'', page:savedPage };
    if (insertBefore >= 0) pageLayout.splice(insertBefore, 0, entry);
    else pageLayout.push(entry);
  });
}

function autoSave() {
  schedulePreview();
  clearTimeout(saveTimer);
  saveTimer = setTimeout(() => saveSlot(currentSlot), 600);
}

function backupData() {
  saveSlot(currentSlot);
  const allData = {};
  for (let i = 0; i < 3; i++) {
    try { allData['slot_'+i] = JSON.parse(localStorage.getItem('cv_slot_'+i)||'{}'); } catch(e){}
  }
  const blob = new Blob([JSON.stringify(allData,null,2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'cv-backup-' + new Date().toISOString().slice(0,10) + '.json';
  a.click();
  showToast('Backup downloaded!');
}

function restoreData(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const d = JSON.parse(e.target.result);
      for (let i = 0; i < 3; i++) {
        if (d['slot_'+i]) localStorage.setItem('cv_slot_'+i, JSON.stringify(d['slot_'+i]));
      }
      loadSlot(currentSlot);
      showToast('Data restored!');
    } catch(err) { showToast('Invalid backup file'); }
  };
  reader.readAsText(file);
  input.value = '';
}

// ══════════════════════════════════════════════════════════
// FORM DATA
// ══════════════════════════════════════════════════════════
function getFormData() {
  return {
    name: v('p_name'), father: v('p_father'), title: v('p_title'),
    phone: v('p_phone'), email: v('p_email'), location: v('p_location'), linkedin: v('p_linkedin'),
    dob: v('p_dob'), nation: v('p_nation'), marital: v('p_marital'),
    religion: v('p_religion'), lang: v('p_lang'),
    passport: v('p_passport'), passport_exp: v('p_passport_exp'),
    summary: v('p_summary'),
  };
}

function fillForm(d) {
  if (!d) d = {};
  setv('p_name', d.name); setv('p_father', d.father); setv('p_title', d.title);
  setv('p_phone', d.phone); setv('p_email', d.email); setv('p_location', d.location); setv('p_linkedin', d.linkedin);
  setv('p_dob', d.dob); setv('p_nation', d.nation); setv('p_marital', d.marital);
  setv('p_religion', d.religion); setv('p_lang', d.lang);
  setv('p_passport', d.passport); setv('p_passport_exp', d.passport_exp);
  setv('p_summary', d.summary);
  updateSummaryCount();
}

// ══════════════════════════════════════════════════════════
// NAVIGATION
// ══════════════════════════════════════════════════════════
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  const pg = document.getElementById('page-' + id);
  if (pg) pg.classList.add('active');
  if (id === 'extras') setTimeout(renderPageLayout, 60);
  document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.dataset.page === id));
  document.querySelectorAll('.bnav-item').forEach(n => {
    n.classList.remove('active');
    if (n.dataset.page === id) n.classList.add('active');
  });
  if (mobilePreviewOpen) { closeMobilePreview(); }
  if (id === 'design') { renderColorGrid(); renderTemplateGrid(); renderThemePresets(); }
  window.scrollTo(0, 0);
}

function toggleCard(header) {
  const body = header.nextElementSibling;
  const chev = header.querySelector('.chevron');
  if (body) body.classList.toggle('collapsed');
  if (chev) chev.classList.toggle('up');
}

function openMobilePreview() {
  mobilePreviewOpen = true;
  const page = document.getElementById('preview-page');
  const btn = document.getElementById('bnav-preview');
  if (page) page.classList.add('show');
  if (btn) btn.classList.add('active');
  // Deactivate other nav items
  document.querySelectorAll('.bnav-item').forEach(n => { if (n.id !== 'bnav-preview') n.classList.remove('active'); });
  renderPreviewFull();
  scaleMobilePreview();
}

function closeMobilePreview() {
  mobilePreviewOpen = false;
  const page = document.getElementById('preview-page');
  const btn = document.getElementById('bnav-preview');
  if (page) page.classList.remove('show');
  if (btn) btn.classList.remove('active');
}

function toggleMobilePreview() {
  if (mobilePreviewOpen) { closeMobilePreview(); } else { openMobilePreview(); }
}

function scaleMobilePreview() {
  const wrap = document.getElementById('preview-scaled-wrap');
  const scrollArea = document.getElementById('preview-scroll-area');
  if (!wrap || !scrollArea) return;
  const availW = window.innerWidth;
  const scale = Math.min((availW - 16) / 595, 1);
  wrap.style.transform = `scale(${scale})`;
  const scaledH = Math.ceil(842 * scale);
  wrap.style.marginBottom = `-${842 - scaledH}px`;
}

function showToast(msg) {
  const t = document.getElementById('toast');
  if (!t) return;
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// ══════════════════════════════════════════════════════════
// RENDER FORMS
// ══════════════════════════════════════════════════════════
function renderAll() { renderJobs(); renderEdus(); renderSkills(); renderCerts(); renderCustomSections(); }

function renderJobs() {
  const c = document.getElementById('jobs-container');
  if (!c) return;
  c.innerHTML = '';
  jobs.forEach((j, ji) => {
    const d = document.createElement('div');
    d.className = 'entry-block';
    d.innerHTML = `
      <div class="entry-header">
        <span class="entry-num"> Job #${ji+1}${j.company ? ' — ' + esc(j.company) : ''}</span>
        <div class="entry-actions">
          ${ji > 0 ? `<button class="icon-btn" onclick="moveJob(${ji},-1)" title="Move Up">↑</button>` : ''}
          ${ji < jobs.length-1 ? `<button class="icon-btn" onclick="moveJob(${ji},1)" title="Move Down">↓</button>` : ''}
          <button class="icon-btn danger" onclick="removeJob(${ji})" title="Remove job"></button>
        </div>
      </div>
      <div class="g2">
        <div class="field"><label>Job Title</label><input value="${esc(j.title)}" placeholder="Loco Motive Operator" oninput="jobs[${ji}].title=this.value;updateEntryHeader(this,${ji});autoSave()"/></div>
        <div class="field"><label>Company Name</label><input value="${esc(j.company)}" placeholder="Company Pvt Ltd" oninput="jobs[${ji}].company=this.value;updateEntryHeader(this,${ji});autoSave()"/></div>
      </div>
      <div class="g2">
        <div class="field"><label>Location</label><input value="${esc(j.location)}" placeholder="Chennai, Tamil Nadu" oninput="jobs[${ji}].location=this.value;autoSave()"/></div>
        <div class="field"><label>Job Type</label>
          <select onchange="jobs[${ji}].type=this.value;autoSave()">
            ${['Full-time','Part-time','Contract','Freelance'].map(t=>`<option ${(j.type||'Full-time')===t?'selected':''}>${t}</option>`).join('')}
          </select>
        </div>
      </div>
      <div class="g2">
        <div class="field"><label>Start Date</label><input value="${esc(j.start)}" placeholder="Aug 2022" oninput="jobs[${ji}].start=this.value;autoSave()"/></div>
        <div class="field"><label>End Date</label><input value="${esc(j.end)}" placeholder="Present" ${j.current?'disabled':''} oninput="jobs[${ji}].end=this.value;autoSave()"/></div>
      </div>
      <label style="display:flex;align-items:center;gap:8px;font-size:13px;margin-bottom:12px;cursor:pointer;">
        <input type="checkbox" ${j.current?'checked':''} onchange="jobs[${ji}].current=this.checked;this.closest('.entry-block').querySelectorAll('input')[5].disabled=this.checked;if(this.checked){jobs[${ji}].end='';this.closest('.entry-block').querySelectorAll('input')[5].value='';}autoSave()"/>
        <span style="font-weight:500;">Currently working here</span>
      </label>
      <div class="bullet-wrap">
        <div class="bullet-label">
          <span>Responsibilities</span>
          <button class="suggest-btn" onclick="openLib(${ji},'responsibilities')"> Suggestions</button>
        </div>
        <div id="resp_${ji}">
          ${j.responsibilities.map((r,ri)=>`
            <div class="bullet-row">
              <input value="${esc(r)}" placeholder="What did you do in this job..." oninput="jobs[${ji}].responsibilities[${ri}]=this.value;autoSave()"/>
              ${j.responsibilities.length>1?`<button class="bullet-del" onclick="removeResp(${ji},${ri})"></button>`:''}
            </div>`).join('')}
        </div>
        <button class="add-bullet-btn" onclick="addResp(${ji})">+ Add Point</button>
      </div>`;
    c.appendChild(d);
  });
}

function updateEntryHeader(input, ji) {
  const block = input.closest('.entry-block');
  if (!block) return;
  const h = block.querySelector('.entry-num');
  if (h) h.textContent = ` Job #${ji+1}${jobs[ji].company ? ' — ' + jobs[ji].company : ''}`;
}

function addJob() { jobs.push({title:'',company:'',location:'',start:'',end:'',current:false,type:'Full-time',responsibilities:['']}); renderJobs(); autoSave(); }
function removeJob(i) { jobs.splice(i,1); if(!jobs.length) jobs=[{title:'',company:'',location:'',start:'',end:'',current:false,type:'Full-time',responsibilities:['']}]; renderJobs(); autoSave(); }
function moveJob(i,dir) { const t=jobs[i];jobs[i]=jobs[i+dir];jobs[i+dir]=t; renderJobs(); autoSave(); }
function addResp(ji) { jobs[ji].responsibilities.push(''); renderJobs(); autoSave(); }
function removeResp(ji,ri) { jobs[ji].responsibilities.splice(ri,1); renderJobs(); autoSave(); }

function renderEdus() {
  const c = document.getElementById('edu-container');
  if (!c) return;
  c.innerHTML = '';
  edus.forEach((e, ei) => {
    const d = document.createElement('div');
    d.className = 'entry-block';
    d.innerHTML = `
      <div class="entry-header">
        <span class="entry-num"> Education #${ei+1}${e.institution ? ' — ' + esc(e.institution) : ''}</span>
        <div class="entry-actions">
          <button class="icon-btn danger" onclick="removeEdu(${ei})" title="Remove education"></button>
        </div>
      </div>
      <div class="g2">
        <div class="field"><label>Degree / Class</label><input value="${esc(e.degree)}" placeholder="Class 6th / B.Tech" oninput="edus[${ei}].degree=this.value;autoSave()"/></div>
        <div class="field"><label>Institution Name</label><input value="${esc(e.institution)}" placeholder="School / College" oninput="edus[${ei}].institution=this.value;autoSave()"/></div>
      </div>
      <div class="g3">
        <div class="field"><label>Location</label><input value="${esc(e.location)}" placeholder="City" oninput="edus[${ei}].location=this.value;autoSave()"/></div>
        <div class="field"><label>Year From</label><input value="${esc(e.startYear)}" placeholder="2008" oninput="edus[${ei}].startYear=this.value;autoSave()"/></div>
        <div class="field"><label>Year To</label><input value="${esc(e.endYear)}" placeholder="2015" oninput="edus[${ei}].endYear=this.value;autoSave()"/></div>
      </div>
      <div class="field"><label>Grade / Percentage</label><input value="${esc(e.grade)}" placeholder="89% / 8.5 CGPA" oninput="edus[${ei}].grade=this.value;autoSave()"/></div>`;
    c.appendChild(d);
  });
}
function addEdu() { edus.push({degree:'',institution:'',location:'',startYear:'',endYear:'',grade:''}); renderEdus(); autoSave(); }
function removeEdu(i) { edus.splice(i,1); if(!edus.length) edus=[{degree:'',institution:'',location:'',startYear:'',endYear:'',grade:''}]; renderEdus(); autoSave(); }

function renderSkills() {
  const c = document.getElementById('skills-container');
  if (!c) return;
  c.innerHTML = '';
  skills.forEach((sk, si) => {
    const d = document.createElement('div');
    d.style.cssText = 'display:flex;gap:8px;margin-bottom:8px;align-items:center;';
    d.innerHTML = `
      <input value="${esc(sk.name)}" placeholder="e.g. MSV Operation" style="flex:2;padding:10px 12px;border:1.5px solid var(--border);border-radius:9px;font-size:13px;outline:none;font-family:var(--font);background:#fff;" oninput="skills[${si}].name=this.value;autoSave()"/>
      <select style="flex:1;padding:10px 8px;border:1.5px solid var(--border);border-radius:9px;font-size:12px;outline:none;background:#fff;" onchange="skills[${si}].level=this.value;autoSave()">
        ${['Beginner','Intermediate','Advanced','Expert'].map(l=>`<option ${sk.level===l?'selected':''}>${l}</option>`).join('')}
      </select>
      ${skills.length>1?`<button class="bullet-del" onclick="removeSkill(${si})"></button>`:''}`;
    c.appendChild(d);
  });
}
function addSkill() { skills.push({name:'',level:'Advanced'}); renderSkills(); autoSave(); }
function removeSkill(i) { skills.splice(i,1); renderSkills(); autoSave(); }

function renderCerts() {
  const c = document.getElementById('certs-container');
  if (!c) return;
  c.innerHTML = '';
  certs.forEach((cert, ci) => {
    const d = document.createElement('div');
    d.className = 'entry-block';
    d.innerHTML = `
      <div class="entry-header">
        <span class="entry-num"> Certificate #${ci+1}</span>
        <button class="icon-btn danger" onclick="removeCert(${ci})" title="Remove certificate"></button>
      </div>
      <div class="g2">
        <div class="field"><label>Certificate Name</label><input value="${esc(cert.name)}" placeholder="Safety Certification" oninput="certs[${ci}].name=this.value;autoSave()"/></div>
        <div class="field"><label>Issued By</label><input value="${esc(cert.issuedBy)}" placeholder="Organization" oninput="certs[${ci}].issuedBy=this.value;autoSave()"/></div>
        <div class="field"><label>Year</label><input value="${esc(cert.year)}" placeholder="2022" oninput="certs[${ci}].year=this.value;autoSave()"/></div>
      </div>`;
    c.appendChild(d);
  });
}
function addCert() { certs.push({name:'',issuedBy:'',year:''}); renderCerts(); autoSave(); }
function removeCert(i) { certs.splice(i,1); renderCerts(); autoSave(); }

// ══════════════════════════════════════════════════════════
// DESIGN
// ══════════════════════════════════════════════════════════
function renderColorGrid() {
  // ── Accent colors: flat row, no categories ──
  const c = document.getElementById('color-grid');
  if (c) {
    c.innerHTML = COLORS.map(col =>
      `<div class="color-dot ${col===currentColor?'active':''}" style="background:${col}" onclick="applyColor('${col}',true)" title="${col}"></div>`
    ).join('') + `<input type="color" id="custom-color" value="${currentColor}" onchange="applyColor(this.value,true)" title="Pick any color"/>`;
  }

  // ── Header colors: curated list that always looks good ──
  const hg = document.getElementById('header-color-grid');
  if (hg) {
    const hCols = ['#0F766E','#1e3a5f','#1a1a2e','#B8860B','#065F46','#1D4ED8','#374151','#2C1A4E','#7f1d1d','#6B5E4C','#FFFFFF','#F8F9FA'];
    hg.innerHTML = hCols.map(col => {
      const light = (col === '#FFFFFF' || col === '#F8F9FA');
      const extra = light ? 'box-shadow:0 0 0 1.5px #C8D0DA inset;' : '';
      return `<div class="color-dot ${col===currentHeaderColor?'active':''}" style="background:${col};${extra}" onclick="applyHeaderColor('${col}',true)"></div>`;
    }).join('') + `<input type="color" id="custom-header-color" value="${currentHeaderColor}" onchange="applyHeaderColor(this.value,true)" title="Pick any color"/>`;
  }

  // ── Toggle buttons ──
  ['ht-light','ht-dark'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.toggle('active', id === 'ht-' + currentHeaderText);
  });
  ['bar-solid','bar-gradient','bar-dots','bar-line','bar-none'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.toggle('active', id === 'bar-' + currentBarStyle);
  });

  // ── Theme active highlight ──
  document.querySelectorAll('.theme-card').forEach((card, i) => {
    const t = COLOR_THEMES[i];
    card.classList.toggle('active-theme', !!t && t.accent===currentColor && t.header===currentHeaderColor);
  });
}

function applyColor(col, save) {
  currentColor = col;
  document.documentElement.style.setProperty('--primary', col);
  document.documentElement.style.setProperty('--primary-dark', col);
  document.documentElement.style.setProperty('--primary-light', hexToLight(col));
  renderColorGrid();
  if (save) { autoSave(); scalePreviewIframe(); }
}

function applyHeaderColor(col, save) {
  currentHeaderColor = col;
  renderColorGrid();
  schedulePreview();
  if (save) { autoSave(); }
}

function setHeaderText(mode) {
  currentHeaderText = mode;
  renderColorGrid();
  schedulePreview();
  autoSave();
}

function setBarStyle(style) {
  currentBarStyle = style;
  renderColorGrid();
  schedulePreview();
  autoSave();
}

function applyTheme(idx) {
  const t = COLOR_THEMES[idx];
  if (!t) return;
  currentColor       = t.accent;
  currentHeaderColor = t.header;
  currentHeaderText  = t.headerText;
  document.documentElement.style.setProperty('--primary', t.accent);
  document.documentElement.style.setProperty('--primary-light', hexToLight(t.accent));
  renderColorGrid();
  renderThemePresets();
  autoSave(); scalePreviewIframe();
  showToast('Theme: ' + t.name);
}

function renderThemePresets() {
  const g = document.getElementById('theme-preset-grid');
  if (!g) return;
  g.innerHTML = COLOR_THEMES.map((t, i) => {
    const isActive = t.accent === currentColor && t.header === currentHeaderColor;
    return `<div class="theme-card ${isActive?'active-theme':''}" onclick="applyTheme(${i})">
      <div class="theme-swatches">
        <div class="theme-swatch" style="background:${t.header};"></div>
        <div class="theme-swatch" style="background:${t.accent};"></div>
      </div>
      <span class="theme-name">${t.name}</span>
    </div>`;
  }).join('');
}

function hexToLight(hex) {
  try {
    const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
    return `rgba(${r},${g},${b},0.12)`;
  } catch(e) { return 'rgba(15,118,110,0.12)'; }
}

function renderTemplateGrid() {
  const g = document.getElementById('tpl-grid');
  if (!g) return;
  g.innerHTML = TPL_INFO.map((t,i) => {
    const isFree = t.free === true;
    const badge = isFree
      ? `<span class="tpl-tier-badge tpl-free-badge">Free</span>`
      : `<span class="tpl-tier-badge tpl-paid-badge">Premium</span>`;
    return `
    <div class="tpl-card ${currentTemplate===i+1?'active':''}" id="tplcard-${i+1}" onclick="handleTplCardClick(event,${i+1})">
      <div class="tpl-bar" style="background:${t.c}"></div>
      ${badge}
      <div class="tpl-name">${t.n}</div>
      <div class="tpl-desc">${t.d}</div>
      <button class="tpl-demo-tag" onclick="event.stopPropagation();openInlineDemo(${i+1})" type="button">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
        Preview
      </button>
      <div class="tpl-preview-wrap" id="tplpreview-${i+1}">
        <div class="tpl-preview-loading" id="tplloading-${i+1}">
          <div class="spin"></div>Loading preview…
        </div>
        <div class="tpl-preview-viewport" id="tplviewport-${i+1}" style="display:none;">
          <iframe class="tpl-preview-iframe" id="tpliframe-${i+1}" scrolling="no"></iframe>
        </div>
        <div class="tpl-preview-bar">
          <span class="tpl-preview-bar-name">${t.n}</span>
          <button class="tpl-use-btn" onclick="event.stopPropagation();selectTemplate(${i+1});closeInlineDemo(${i+1});showToast('Template applied!')">✓ Use This</button>
          <button class="tpl-close-btn" onclick="event.stopPropagation();closeInlineDemo(${i+1})">✕</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function selectTemplate(n) {
  currentTemplate = n;
  syncTemplateUI();
  autoSave();
  showToast('Template changed!');
}

function syncTemplateUI() {
  document.querySelectorAll('.tpl-card').forEach((c,i) => c.classList.toggle('active', i+1===currentTemplate));
}

function setSpacing(s) { currentSpacing=s; setSpacingBtn(s); autoSave(); }
function setSpacingBtn(s) {
  ['compact','normal','spacious'].forEach(x => {
    const btn = document.getElementById('sp-'+x);
    if (btn) btn.classList.toggle('active', x===s);
  });
}
function updateDesign() {
  const el = document.getElementById('font-size-slider');
  if (el) currentFontSize = parseFloat(el.value);
  const bodyInput = document.getElementById('fs-body');
  if (bodyInput) { bodyInput.value = currentFontSize; }
  autoSave();
}

// ══════════════════════════════════════════════════════════
// TYPOGRAPHY PRESETS
// ══════════════════════════════════════════════════════════
const TYPO_PRESETS = {
  // ─── Body 12pt = MS Word standard. Hierarchy: Name > TopTitle > Section > SubHeader > Body
  professional: { name:24,  topTitle:14,   section:13,   subHeader:13,   body:12   },  // DEFAULT — Word 12pt
  compact:      { name:20,  topTitle:12,   section:11,   subHeader:11,   body:10   },  // Tight, 1-page friendly
  bold:         { name:28,  topTitle:15,   section:14,   subHeader:13.5, body:12.5 },  // Strong visual impact
  executive:    { name:27,  topTitle:15,   section:14,   subHeader:14,   body:13   },  // Senior roles, spacious
  ultra:        { name:18,  topTitle:11,   section:10,   subHeader:10.5, body:9    },  // Ultra compact, max content
};

let currentTypoPreset = 'professional';

function applyTypoPreset(presetKey) {
  const p = TYPO_PRESETS[presetKey];
  if (!p) return;
  currentTypoPreset = presetKey;

  // Apply to globals
  currentNameSize          = p.name;
  currentTopTitleSize      = p.topTitle;
  currentSectionHeaderSize = p.section;
  currentSubHeaderSize     = p.subHeader;
  currentFontSize          = p.body;

  // Sync hidden inputs (for save/load)
  const setHidden = (id, val) => { const el = document.getElementById(id); if (el) el.value = val; };
  setHidden('fs-name',      p.name);
  setHidden('fs-toptitle',  p.topTitle);
  setHidden('fs-section',   p.section);
  setHidden('fs-subheader', p.subHeader);
  setHidden('fs-body',      p.body);

  // Sync Design page slider
  const slider = document.getElementById('font-size-slider');
  if (slider) slider.value = p.body;

  // Update active UI state
  document.querySelectorAll('.typo-preset').forEach(el => el.classList.remove('active'));
  const active = document.getElementById('typo-' + presetKey);
  if (active) active.classList.add('active');

  autoSave();
}

function syncTypoPresetUI() {
  document.querySelectorAll('.typo-preset').forEach(el => el.classList.remove('active'));
  const active = document.getElementById('typo-' + currentTypoPreset);
  if (active) active.classList.add('active');
}

// ── FONT FAMILY MAP ──
const FONT_FAMILY_MAP = {
  'default':    { css: "Georgia, 'Times New Roman', serif", label: 'Default' },
  'playfair':   { css: "'Playfair Display', Georgia, serif", label: 'Playfair Display' },
  'montserrat': { css: "'Montserrat', 'Helvetica Neue', sans-serif", label: 'Montserrat' },
  'raleway':    { css: "'Raleway', 'Helvetica Neue', sans-serif", label: 'Raleway' },
  'garamond':   { css: "'EB Garamond', Georgia, serif", label: 'EB Garamond' },
  'josefin':    { css: "'Josefin Sans', Arial, sans-serif", label: 'Josefin Sans' },
  'nunito':     { css: "'Nunito Sans', Arial, sans-serif", label: 'Nunito Sans' },
  'cormorant':  { css: "'Cormorant Garamond', Georgia, serif", label: 'Cormorant Garamond' },
  'lato':       { css: "'Lato', 'Helvetica Neue', sans-serif", label: 'Lato' }
};

function applyFontFamily(key) {
  currentFontFamily = key;
  // Update active state in UI
  document.querySelectorAll('.font-card').forEach(el => el.classList.remove('active'));
  const active = document.getElementById('ff-' + key);
  if (active) active.classList.add('active');
  autoSave();
  schedulePreview();
}

function syncFontFamilyUI() {
  document.querySelectorAll('.font-card').forEach(el => el.classList.remove('active'));
  const active = document.getElementById('ff-' + (currentFontFamily || 'default'));
  if (active) active.classList.add('active');
}

function updateFontSizes() {
  // Read from hidden inputs (used when loading saved data)
  const get = (id, fallback) => { const el = document.getElementById(id); return el ? (parseFloat(el.value)||fallback) : fallback; };
  currentNameSize          = get('fs-name',      24);
  currentTopTitleSize      = get('fs-toptitle',  14);
  currentSectionHeaderSize = get('fs-section',   13);
  currentSubHeaderSize     = get('fs-subheader', 13);
  currentFontSize          = get('fs-body',       12);
  const slider = document.getElementById('font-size-slider');
  if (slider) slider.value = currentFontSize;
  autoSave();
}

function stepFontSize(inputId, delta) {
  // Keep for compatibility, no-op now
}

// ══════════════════════════════════════════════════════════
// PHOTO HANDLING
// ══════════════════════════════════════════════════════════
function handlePhoto(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    const img = new Image();
    img.onload = () => {
      const MAX = 400;
      let w = img.width, h = img.height;
      if (w > MAX || h > MAX) { const ratio = Math.min(MAX/w, MAX/h); w = Math.round(w*ratio); h = Math.round(h*ratio); }
      const canvas = document.createElement('canvas');
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(img, 0, 0, w, h);
      photoData = canvas.toDataURL('image/jpeg', 0.92);
      updatePhotoUI();
      autoSave();
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
  input.value = '';
}

function removePhoto() { photoData = null; updatePhotoUI(); autoSave(); }

function updatePhotoUI() {
  const zone = document.getElementById('photo-zone');
  if (!zone) return;
  const existing = zone.querySelector('img');
  if (existing) existing.remove();
  const ph = zone.querySelector('.photo-placeholder');
  if (photoData) {
    const img = document.createElement('img');
    img.src = photoData;
    zone.insertBefore(img, zone.firstChild);
    if (ph) ph.style.display = 'none';
  } else {
    if (ph) ph.style.display = '';
  }
}

// ══════════════════════════════════════════════════════════
// AUTO SUMMARY
// ══════════════════════════════════════════════════════════
let _sumIdx = -1;
function autoGenSummary() {
  const title = (v('p_title') || 'Professional').trim();
  const validJobs = jobs.filter(j => j.company);
  const hasExp = validJobs.length > 0;
  const skillList = skills.filter(sk => sk.name).slice(0, 4).map(sk => sk.name);
  const skillLine = skillList.length ? `Core competencies include ${skillList.join(', ')}.` : '';
  const prevCo = hasExp ? validJobs[0].company : '';
  const yrsNum = validJobs.length * 2;
  const expLine = yrsNum >= 2 ? `${yrsNum}+ years of` : (validJobs.length === 1 ? '2+ years of' : '');

  const expTemplates = [
    `A results-driven ${title} with ${expLine} progressive industry experience and a consistent record of delivering quality outcomes. ${prevCo ? `Previous tenure at ${prevCo} provided deep domain exposure and real-world expertise. ` : ''}${skillLine} Recognised for strong problem-solving ability, attention to detail, and effective collaboration across teams. Ready to contribute immediately and drive meaningful impact.`,
    `An accomplished ${title} with ${expLine} hands-on experience and a proven ability to perform under pressure. ${skillLine}${prevCo ? ` Built a strong professional foundation at ${prevCo}, developing skills that translate directly to results. ` : ' '}Known for reliability, clear communication, and a relentless focus on delivering work that exceeds expectations. Seeking a challenging opportunity to grow and lead.`,
    `A dedicated ${title} bringing ${expLine} industry expertise and a track record of consistent professional growth. ${prevCo ? `Significant contributions made during tenure at ${prevCo} shaped a versatile and adaptive approach to work. ` : ''}${skillLine} Combines technical proficiency with strong interpersonal skills to deliver results in fast-paced environments. Open to relocation and available for immediate joining.`,
    `A dynamic ${title} with ${expLine} comprehensive experience spanning multiple projects and organisational contexts. ${skillLine}${prevCo ? ` Experience at ${prevCo} honed the ability to manage competing priorities and deliver on time. ` : ' '}Highly dependable with a proactive mindset and a genuine commitment to quality. Looking to bring proven skills to a forward-thinking organisation.`,
    `A highly motivated ${title} with ${expLine} solid professional experience and a deep commitment to continuous improvement. ${prevCo ? `Demonstrated value during tenure at ${prevCo} through consistent performance and a solution-oriented mindset. ` : ''}${skillLine} Adept at building strong working relationships, adapting to new environments, and exceeding set targets. Available and eager to make an immediate contribution.`
  ];

  const fresherTemplates = [
    `An enthusiastic and career-focused ${title} graduate with a strong academic foundation and a genuine drive to contribute from day one. ${skillLine} Known for a sharp learning curve, disciplined work ethic, and the ability to adapt quickly to new environments. Eager to translate academic knowledge into real-world results within a growth-oriented organisation.`,
    `A motivated ${title} fresher with solid theoretical grounding and a proactive approach to professional development. ${skillLine} Demonstrated ability to collaborate effectively, manage responsibilities independently, and deliver within deadlines. Passionate about building a long-term career and adding tangible value from the very beginning.`,
    `A goal-driven ${title} graduate ready to take on professional challenges with focus and dedication. ${skillLine} Brings a fresh perspective, strong analytical thinking, and the ability to learn rapidly under experienced mentorship. Committed to growing alongside the organisation and making meaningful contributions at every stage.`,
    `An ambitious and detail-oriented ${title} fresher with a strong academic record and a clear professional vision. ${skillLine} Highly organised, dependable, and genuinely passionate about the field. Looking for an entry-level opportunity to apply foundational knowledge, grow consistently, and become a trusted long-term team member.`,
    `A self-motivated ${title} graduate equipped with current academic knowledge, a strong work ethic, and an eagerness to learn. ${skillLine} Thrives in collaborative settings and handles new challenges with a calm, structured approach. Seeking a platform to develop professionally, deliver real results, and build a successful career.`
  ];

  const pool = hasExp ? expTemplates : fresherTemplates;
  _sumIdx = (_sumIdx + 1) % pool.length;
  const text = pool[_sumIdx];

  const ta = document.getElementById('p_summary');
  const btn = document.getElementById('ai-sum-btn');
  if (!ta) { setv('p_summary', text); autoSave(); updateSummaryCount(); return; }
  if (btn) { btn.disabled = true; btn.textContent = 'Writing...'; }
  ta.value = '';
  let i = 0;
  const speed = Math.max(8, Math.round(2200 / text.length));
  const timer = setInterval(() => {
    ta.value += text[i++];
    updateSummaryCount();
    if (i >= text.length) {
      clearInterval(timer);
      if (btn) { btn.disabled = false; btn.textContent = 'Generate with AI'; }
      autoSave();
    }
  }, speed);
}

// ══════════════════════════════════════════════════════════
// CV STRENGTH
// ══════════════════════════════════════════════════════════
function updateStrengthScore() {
  const d = getFormData();
  const checks = [
    {label:'Name added',done:!!d.name,pts:8},
    {label:'Phone & Email',done:!!(d.phone&&d.email),pts:8},
    {label:'Location added',done:!!d.location,pts:5},
    {label:'Job title added',done:!!d.title,pts:7},
    {label:'Profile photo',done:!!photoData,pts:5},
    {label:'Summary written',done:!!(d.summary&&d.summary.length>30),pts:12},
    {label:'Work experience',done:jobs.some(j=>j.company),pts:15},
    {label:'2+ job entries',done:jobs.filter(j=>j.company).length>=2,pts:8},
    {label:'Job responsibilities',done:jobs.some(j=>j.responsibilities.some(r=>r.trim())),pts:10},
    {label:'Education added',done:edus.some(e=>e.institution),pts:8},
    {label:'5+ skills listed',done:skills.filter(s=>s.name).length>=5,pts:8},
    {label:'LinkedIn added',done:!!d.linkedin,pts:4},
    {label:'Certifications',done:certs.some(c=>c.name),pts:2},
  ];
  const total = checks.reduce((a,c) => a+(c.done?c.pts:0), 0);
  const maxTotal = checks.reduce((a,c) => a+c.pts, 0);
  const score = Math.round((total/maxTotal)*100);
  const el = document.getElementById('score-num');
  const fill = document.getElementById('score-fill');
  const items = document.getElementById('score-items');
  if (!el) return;
  el.textContent = score;
  const col = score>=80?'#22C55E':score>=50?'#F59E0B':'#EF4444';
  el.style.color = col;
  if (fill) { fill.style.width = score+'%'; fill.style.background = col; }
  if (items) {
    items.innerHTML = checks.map(c => `
      <div class="score-item">
        <div class="score-dot" style="background:${c.done?'#22C55E':'#E2E8F0'}"></div>
        <span style="flex:1;color:${c.done?'var(--text)':'var(--muted)'}">${c.label}</span>
        <span style="font-size:11px;font-weight:700;color:${c.done?'var(--primary)':'var(--muted)'}">+${c.pts}</span>
      </div>`).join('');
  }
}

// ══════════════════════════════════════════════════════════
// BULLET LIBRARY
// ══════════════════════════════════════════════════════════
function openLib(ji, field) {
  libTargetJob = ji; libTargetField = field;
  libAddedBullets = new Set();
  // Pre-mark bullets that are already in the job's responsibilities
  if (ji >= 0 && ji < jobs.length && jobs[ji][field]) {
    jobs[ji][field].forEach(existing => {
      Object.keys(BULLET_LIB).forEach(cat => {
        BULLET_LIB[cat].forEach((b, bi) => {
          if (b === existing) libAddedBullets.add(cat + '::' + bi);
        });
      });
    });
  }
  // Auto-match: try to detect category from job title
  const jobTitle = (jobs[ji] && jobs[ji].title || '').toLowerCase();
  let matched = null;
  if (jobTitle) {
    for (const [cat, keywords] of Object.entries(LIB_KEYWORDS)) {
      if (keywords.some(kw => jobTitle.includes(kw))) { matched = cat; break; }
    }
  }
  if (matched && BULLET_LIB[matched]) {
    libActiveCat = matched;
    const hint = document.getElementById('lib-match-hint');
    if (hint) { hint.textContent = ' Auto-matched to: ' + matched; hint.style.display = 'block'; }
  } else {
    libActiveCat = Object.keys(BULLET_LIB)[0];
    const hint = document.getElementById('lib-match-hint');
    if (hint) hint.style.display = 'none';
  }
  const searchEl = document.getElementById('lib-search');
  if (searchEl) searchEl.value = '';
  libFilteredCats = null;
  renderLibCats(); renderLibBullets();
  document.getElementById('lib-modal').classList.add('show');
}
function closeLib() { const el = document.getElementById('lib-modal'); if (el) el.classList.remove('show'); }

// Swipe-down to close lib modal
(function() {
  let libTouchStartY = 0;
  let libTouchStartScrollTop = 0;
  window.addEventListener('load', function() {
    const libBox = document.getElementById('lib-box');
    const libBullets = document.getElementById('lib-bullets');
    if (!libBox) return;
    libBox.addEventListener('touchstart', function(e) {
      libTouchStartY = e.touches[0].clientY;
      libTouchStartScrollTop = libBullets ? libBullets.scrollTop : 0;
    }, { passive: true });
    libBox.addEventListener('touchend', function(e) {
      const dy = e.changedTouches[0].clientY - libTouchStartY;
      const atTop = !libBullets || libBullets.scrollTop <= 0;
      if (dy > 80 && atTop) { closeLib(); }
    }, { passive: true });
  });
})();

let libFilteredCats = null;
function filterLibCats(query) {
  const hint = document.getElementById('lib-match-hint');
  if (!query.trim()) {
    libFilteredCats = null;
    if (hint) hint.style.display = 'none';
    renderLibCats(); renderLibBullets(); return;
  }
  const q = query.toLowerCase();
  // Search by category name
  const byName = Object.keys(BULLET_LIB).filter(cat => cat.toLowerCase().includes(q));
  // Search by keyword map
  const byKw = Object.keys(LIB_KEYWORDS).filter(cat =>
    LIB_KEYWORDS[cat].some(kw => kw.includes(q)) && BULLET_LIB[cat]
  );
  // Search inside bullet text
  const byBullet = Object.keys(BULLET_LIB).filter(cat =>
    BULLET_LIB[cat].some(b => b.toLowerCase().includes(q))
  );
  const merged = [...new Set([...byName, ...byKw, ...byBullet])];
  libFilteredCats = merged.length ? merged : null;
  if (merged.length === 1) libActiveCat = merged[0];
  else if (merged.length > 0 && !merged.includes(libActiveCat)) libActiveCat = merged[0];
  if (hint) hint.style.display = 'none';
  renderLibCats(); renderLibBullets();
}

function renderLibCats() {
  const c = document.getElementById('lib-cats');
  if (!c) return;
  const cats = libFilteredCats || Object.keys(BULLET_LIB);
  c.innerHTML = cats.map(cat =>
    `<div class="lib-cat ${cat===libActiveCat?'active':''}" onclick="libSetCat('${cat.replace(/'/g,"\\'")}')">${cat}</div>`
  ).join('') || `<div style="padding:8px 4px;font-size:12px;color:var(--muted);">No match found</div>`;
  // Scroll active pill into view
  const active = c.querySelector('.lib-cat.active');
  if (active) active.scrollIntoView({behavior:'smooth', block:'nearest', inline:'center'});
}
function libSetCat(cat) { libActiveCat = cat; renderLibCats(); renderLibBullets(); }
let libAddedBullets = new Set();
function renderLibBullets() {
  const c = document.getElementById('lib-bullets');
  if (!c) return;
  const bullets = BULLET_LIB[libActiveCat] || [];
  if (!bullets.length) { c.innerHTML = `<div style="padding:20px;text-align:center;color:var(--muted);font-size:13px;">No suggestions for this category yet.</div>`; return; }
  c.innerHTML = bullets.map((b,bi) => {
    const added = libAddedBullets.has(libActiveCat + '::' + bi);
    return `<div class="lib-bullet ${added ? 'lib-bullet-added' : ''}" data-bidx="${bi}" style="${added ? 'opacity:0.6;' : ''}">
      <span class="lib-bullet-text">${s(b)}</span>
      <span class="lib-add-icon" style="${added ? 'color:#16a34a;font-size:16px;' : ''}">${added ? '' : '+'}</span>
    </div>`;
  }).join('');
  // Use event delegation — one listener on the container, no inline onclick
  c.onclick = function(e) {
    const row = e.target.closest('.lib-bullet');
    if (!row) return;
    const bi = parseInt(row.getAttribute('data-bidx'), 10);
    const bullets2 = BULLET_LIB[libActiveCat] || [];
    const text = bullets2[bi];
    if (text === undefined) return;
    if (libTargetJob < 0 || libTargetJob >= jobs.length) return;
    if (!jobs[libTargetJob][libTargetField]) jobs[libTargetJob][libTargetField] = [];
    if (jobs[libTargetJob][libTargetField].includes(text)) {
      showToast('️ Already added to your CV!');
      return;
    }
    const emptyIdx = jobs[libTargetJob][libTargetField].findIndex(r => !r.trim());
    if (emptyIdx >= 0) jobs[libTargetJob][libTargetField][emptyIdx] = text;
    else jobs[libTargetJob][libTargetField].push(text);
    renderJobs(); autoSave();
    // Visual feedback
    row.style.opacity = '0.6';
    const icon = row.querySelector('.lib-add-icon');
    if (icon) { icon.textContent = ''; icon.style.color = '#16a34a'; icon.style.fontSize = '16px'; }
    libAddedBullets.add(libActiveCat + '::' + bi);
    showToast(' Added to your CV!');
  };
}

// ══════════════════════════════════════════════════════════
// CV IMPORT — PDF.js offline extraction + smart auto-fill
// ══════════════════════════════════════════════════════════
let _importedData = null;

function handleCVImportFile(file) {
  if (!file) return;
  if (file.type !== 'application/pdf') {
    showCVImportResult('error', ' Please upload a PDF file only.');
    return;
  }
  resetCVImport(true);
  document.getElementById('cv-import-progress').style.display = 'block';
  setCVImportStatus('Reading PDF...', 10);

  if (typeof pdfjsLib === 'undefined') {
    showCVImportResult('error', ' PDF reader not loaded. Please check your internet connection once and try again.');
    document.getElementById('cv-import-progress').style.display = 'none';
    return;
  }
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

  const reader = new FileReader();
  reader.onload = async (e) => {
    try {
      setCVImportStatus('Extracting text...', 25);
      const pdf = await pdfjsLib.getDocument({ data: e.target.result }).promise;
      let fullText = '';
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        // Preserve line structure by grouping items by Y position
        const byY = {};
        content.items.forEach(item => {
          const y = Math.round(item.transform[5]);
          if (!byY[y]) byY[y] = [];
          byY[y].push(item.str);
        });
        const sortedYs = Object.keys(byY).map(Number).sort((a, b) => b - a);
        sortedYs.forEach(y => { fullText += byY[y].join(' ') + '\n'; });
        setCVImportStatus(`Reading page ${i} of ${pdf.numPages}...`, 25 + Math.round((i / pdf.numPages) * 45));
      }

      if (!fullText.trim()) {
        document.getElementById('cv-import-progress').style.display = 'none';
        showCVImportResult('error', ' No readable text found. This PDF may be a scanned image. Please use a digitally typed PDF.');
        return;
      }

      setCVImportStatus('Analysing CV data...', 80);
      _importedData = parseCVText(fullText);
      setCVImportStatus('Done!', 100);

      setTimeout(() => {
        document.getElementById('cv-import-progress').style.display = 'none';
        showCVImportPreview(_importedData);
      }, 350);

    } catch (err) {
      document.getElementById('cv-import-progress').style.display = 'none';
      showCVImportResult('error', ' Could not read this PDF. Make sure it is a valid, non-password-protected PDF.');
    }
  };
  reader.onerror = () => {
    document.getElementById('cv-import-progress').style.display = 'none';
    showCVImportResult('error', ' Failed to read file. Please try again.');
  };
  reader.readAsArrayBuffer(file);
}

function setCVImportStatus(msg, pct) {
  const s = document.getElementById('cv-import-status');
  const b = document.getElementById('cv-import-bar');
  if (s) s.textContent = msg;
  if (b) b.style.width = pct + '%';
}

function parseCVText(text) {
  const lines = text.split('\n').map(l => l.trim()).filter(Boolean);

  // ── PHONE ──
  const phoneM = text.match(/(?:\+91[-\s]?)?[6-9]\d{9}|\+?[\d][\d\s\-().]{8,14}\d/);
  const phone = phoneM ? phoneM[0].trim() : '';

  // ── EMAIL ──
  const emailM = text.match(/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}/);
  const email = emailM ? emailM[0] : '';

  // ── LINKEDIN ──
  const linkedinM = text.match(/linkedin\.com\/in\/[a-zA-Z0-9\-_%]+/i);
  const linkedin = linkedinM ? linkedinM[0] : '';

  // ── NAME — find first short line that isn't a heading keyword ──
  const headingKw = /^(curriculum vitae|resume|cv|profile|contact|address|phone|email|mobile|objective|summary|experience|education|skills|about|declaration|passport|nationality|marital|dob|date)/i;
  let name = '';
  for (const line of lines.slice(0, 10)) {
    const clean = line.replace(/[^a-zA-Z\s.]/g, '').trim();
    if (clean.length >= 3 && clean.length <= 45 && !headingKw.test(clean) && !/\d/.test(line) && !line.includes('@') && !line.includes('http')) {
      name = clean; break;
    }
  }

  // ── JOB TITLE ──
  const titleKw = /engineer|developer|manager|officer|analyst|designer|consultant|executive|operator|supervisor|technician|specialist|coordinator|architect|director|associate|assistant|head|lead|senior|junior|intern|trainee|driver|accountant|teacher|professor|nurse|doctor|admin|clerk|officer|mechanic|electrician|plumber|welder|mason|operator|pilot|sailor/i;
  let title = '';
  for (const line of lines.slice(0, 20)) {
    if (titleKw.test(line) && line.length < 70 && !line.includes('@') && !/^\d/.test(line)) {
      title = line.replace(/[^a-zA-Z\s\/\-,&()]/g, '').trim().replace(/\s+/g, ' ');
      if (title.length > 3) break;
    }
  }

  // ── LOCATION ──
  const locM = text.match(/([A-Z][a-zA-Z\s]+,\s*(?:India|UAE|Qatar|Saudi Arabia|Kuwait|Bahrain|Oman|USA|UK|Canada|Australia|Singapore|Malaysia|Germany|France|[A-Z][a-z]{2,}))/) ;
  const location = locM ? locM[0].trim() : '';

  // ── FATHER NAME ──
  const fatherM = text.match(/(?:father(?:'?s)?\s*(?:name)?|s\/o\.?|d\/o\.?|son of|daughter of)\s*[:\-]?\s*([A-Z][a-zA-Z\s]{2,35})/i);
  const father = fatherM ? fatherM[1].trim() : '';

  // ── DOB ──
  const dobM = text.match(/(?:dob|date of birth|born)\s*[:\-]?\s*(\d{1,2}[\s\/\-.][a-zA-Z0-9]+[\s\/\-.]\d{2,4})/i);
  const dob = dobM ? dobM[1].trim() : '';

  // ── NATIONALITY ──
  const natM = text.match(/(?:nationality|citizen(?:ship)?)\s*[:\-]?\s*([a-zA-Z]+)/i);
  const nation = natM ? natM[1].trim() : '';

  // ── MARITAL STATUS ──
  const marM = text.match(/(?:marital\s*(?:status)?)\s*[:\-]?\s*(single|married|divorced|widowed|unmarried)/i);
  const marital = marM ? marM[1].trim() : '';

  // ── RELIGION ──
  const relM = text.match(/(?:religion)\s*[:\-]?\s*([a-zA-Z]+)/i);
  const religion = relM ? relM[1].trim() : '';

  // ── LANGUAGES ──
  const langM = text.match(/(?:languages?\s*(?:known)?)\s*[:\-]?\s*([^\n]{3,80})/i);
  const lang = langM ? langM[1].trim() : '';

  // ── PASSPORT ──
  const passM = text.match(/(?:passport\s*(?:no\.?|number)?)\s*[:\-]?\s*([A-Z]\d{7})/i);
  const passport = passM ? passM[1].trim() : '';

  const passExpM = text.match(/(?:passport\s*expiry|expiry\s*date|valid\s*(?:till|up\s*to))\s*[:\-]?\s*([^\n]{3,20})/i);
  const passport_exp = passExpM ? passExpM[1].trim() : '';

  // ── SUMMARY ──
  let summary = '';
  const sumM = text.match(/(?:(?:professional\s*)?(?:summary|objective|profile|about\s*me))\s*[:\-]?\s*\n([^]*?)(?=\n(?:[A-Z][A-Z\s]{3,}:|experience|work|employment|education|skills|qualification|declaration)|$)/i);
  if (sumM) summary = sumM[1].replace(/\s+/g, ' ').trim().slice(0, 700);

  // ── JOBS ──
  const jobsArr = [];
  const expM = text.match(/(?:work\s*experience|experience|employment\s*history|career\s*history)\s*[:\-]?\n([^]*?)(?=\n(?:education|qualification|skills|certif|declaration|personal|reference)|$)/i);
  if (expM) {
    const expBlock = expM[1];
    const dateRe = /(\b(?:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\w*\.?\s*)?(\d{4})\s*[-–to]+\s*((?:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\w*\.?\s*\d{4}|present|till\s*date|current)/gi;
    let dateMatch;
    const datePositions = [];
    while ((dateMatch = dateRe.exec(expBlock)) !== null) {
      datePositions.push({ idx: dateMatch.index, full: dateMatch[0], start: (dateMatch[1]||'').trim() + dateMatch[2], end: dateMatch[3] });
    }
    for (let i = 0; i < datePositions.length && jobsArr.length < 6; i++) {
      const pos = datePositions[i];
      const nextPos = datePositions[i + 1] ? datePositions[i + 1].idx : expBlock.length;
      const block = expBlock.slice(Math.max(0, pos.idx - 200), nextPos).split('\n').map(l => l.trim()).filter(Boolean);
      const current = /present|current|till\s*date/i.test(pos.end);
      const jTitle = block.find(l => titleKw.test(l) && l.length < 70) || block[0] || '';
      const jCompany = block.find(l => l !== jTitle && l.length > 2 && l.length < 60 && !/^\d/.test(l) && !dateRe.test(l)) || '';
      const resps = block.filter(l => l.length > 15 && l !== jTitle && l !== jCompany && !/^\d{4}/.test(l)).slice(0, 5);
      if (jTitle || jCompany) {
        jobsArr.push({ title: jTitle, company: jCompany, location: '', start: pos.start, end: current ? '' : pos.end, current, type: 'Full-time', responsibilities: resps.length ? resps : [''] });
      }
    }
  }

  // ── EDUCATION ──
  const edusArr = [];
  const eduM = text.match(/(?:education|qualification|academic(?:\s*background)?)\s*[:\-]?\n([^]*?)(?=\n(?:skills|experience|work|certif|declaration|personal|reference)|$)/i);
  if (eduM) {
    const eduBlock = eduM[1];
    const degreeRe = /b\.?tech|m\.?tech|b\.?e\.?|m\.?e\.?|b\.?sc|m\.?sc|b\.?com|m\.?com|mba|bba|b\.?a\.?|m\.?a\.?|ph\.?d|diploma|10th|12th|ssc|hsc|matriculation|intermediate|higher\s*secondary|secondary/gi;
    const eduLines = eduBlock.split('\n').map(l => l.trim()).filter(Boolean);
    for (let i = 0; i < eduLines.length && edusArr.length < 5; i++) {
      if (degreeRe.test(eduLines[i])) {
        degreeRe.lastIndex = 0;
        const yearM2 = (eduLines[i] + ' ' + (eduLines[i+1]||'')).match(/\b(19|20)\d{2}\b/);
        const gradeM = (eduLines[i] + ' ' + (eduLines[i+1]||'')).match(/(\d{2,3}\.?\d*\s*%|[0-9.]+\s*cgpa|first|second|third|distinction|pass)/i);
        const inst = eduLines[i+1] && !degreeRe.test(eduLines[i+1]) && eduLines[i+1].length < 80 ? eduLines[i+1] : '';
        edusArr.push({ degree: eduLines[i].replace(/\b(19|20)\d{2}\b.*/,'').trim(), institution: inst, location: '', startYear: '', endYear: yearM2 ? yearM2[0] : '', grade: gradeM ? gradeM[0] : '' });
        degreeRe.lastIndex = 0;
      }
    }
  }

  // ── SKILLS ──
  const skillsArr = [];
  const skillM = text.match(/(?:(?:technical\s*|key\s*|core\s*)?skills?)\s*[:\-]?\n([^]*?)(?=\n(?:experience|education|certif|work|declaration|reference|personal)|$)/i);
  if (skillM) {
    const extracted = skillM[1].split(/[,\n•·\-|\/▸►]/).map(s => s.replace(/\d+\s*(?:year|yr)s?/gi,'').trim()).filter(s => s.length > 1 && s.length < 45 && !/^\d+$/.test(s) && !/^https?/i.test(s));
    extracted.slice(0, 20).forEach(sk => skillsArr.push({ name: sk, level: 'Intermediate' }));
  }

  // ── CERTS ──
  const certsArr = [];
  const certM = text.match(/(?:certif(?:ications?|icates?)|training|courses?)\s*[:\-]?\n([^]*?)(?=\n(?:declaration|skills|experience|education|personal|reference)|$)/i);
  if (certM) {
    certM[1].split('\n').map(l => l.trim()).filter(l => l.length > 3 && l.length < 120).slice(0, 8).forEach(c => {
      const yearM3 = c.match(/\b(20\d{2})\b/);
      certsArr.push({ name: c.replace(/\b20\d{2}\b/,'').replace(/^[-•·▸►]/,'').trim(), issuedBy: '', year: yearM3 ? yearM3[0] : '' });
    });
  }

  return {
    personal: { name, father, title, phone, email, location, linkedin, dob, nation, marital, religion, lang, passport, passport_exp, summary },
    jobs: jobsArr.length ? jobsArr : [{ title:'', company:'', location:'', start:'', end:'', current:false, type:'Full-time', responsibilities:[''] }],
    edus: edusArr.length ? edusArr : [{ degree:'', institution:'', location:'', startYear:'', endYear:'', grade:'' }],
    skills: skillsArr.length ? skillsArr : [{ name:'', level:'Advanced' }],
    certs: certsArr
  };
}

function showCVImportPreview(data) {
  const p = data.personal;
  const el = document.getElementById('cv-import-fields');
  const pv = document.getElementById('cv-import-preview');
  if (!el || !pv) return;
  const row = (label, val) => val ? `<div><span style="color:var(--muted);display:inline-block;min-width:110px;">${label}:</span> <strong>${val}</strong></div>` : '';
  let html = '';
  html += row('Name', p.name);
  html += row('Job Title', p.title);
  html += row('Phone', p.phone);
  html += row('Email', p.email);
  html += row('Location', p.location);
  html += row('LinkedIn', p.linkedin);
  html += row('DOB', p.dob);
  html += row('Nationality', p.nation);
  html += row('Marital Status', p.marital);
  html += row('Religion', p.religion);
  html += row('Languages', p.lang);
  html += row('Passport', p.passport);
  html += row('Father Name', p.father);
  if (p.summary) html += `<div style="margin-top:4px;"><span style="color:var(--muted);">Summary:</span> <span style="color:#555;">${p.summary.slice(0,130)}…</span></div>`;
  const jc = data.jobs.filter(j=>j.company||j.title).length;
  const ec = data.edus.filter(e=>e.institution||e.degree).length;
  const sc = data.skills.filter(s=>s.name).length;
  const cc = data.certs.filter(c=>c.name).length;
  html += `<div style="margin-top:10px;padding-top:10px;border-top:1px solid var(--border);display:flex;flex-wrap:wrap;gap:6px;">`;
  html += `<span style="background:var(--primary-light);color:var(--primary);padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;"> ${jc} Job${jc!==1?'s':''}</span>`;
  html += `<span style="background:#EFF6FF;color:#1D4ED8;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;"> ${ec} Edu</span>`;
  html += `<span style="background:#F0FDF4;color:#15803D;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;"> ${sc} Skills</span>`;
  if (cc) html += `<span style="background:#FFF7ED;color:#C2410C;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;"> ${cc} Certs</span>`;
  html += `</div>`;
  el.innerHTML = html || '<div style="color:var(--muted);">Limited data extracted. Try a cleaner PDF.</div>';
  pv.style.display = 'block';
}

function applyImportedCV() {
  if (!_importedData) return;
  fillForm(_importedData.personal);
  jobs = _importedData.jobs;   renderJobs();
  edus = _importedData.edus;   renderEdus();
  skills = _importedData.skills.length ? _importedData.skills : [{name:'',level:'Advanced'}]; renderSkills();
  certs = _importedData.certs; renderCerts();
  autoSave();
  renderPreview();
  showToast(' CV imported! Review each section and make any corrections.');
  showPage('personal');
  resetCVImport();
}

function showCVImportResult(type, msg) {
  document.getElementById('cv-import-progress').style.display = 'none';
  const el = document.getElementById('cv-import-result');
  if (!el) return;
  el.style.display = 'block';
  el.className = 'import-result ' + (type === 'error' ? 'import-err' : 'import-ok');
  el.textContent = msg;
}

function resetCVImport(keepZone) {
  _importedData = null;
  const ids = ['cv-import-result','cv-import-preview','cv-import-progress'];
  ids.forEach(id => { const el = document.getElementById(id); if (el) el.style.display = 'none'; });
  const inp = document.getElementById('cv-import-input');
  if (inp) inp.value = '';
}
// ──────────────────────────────────────────────────────────

// ══════════════════════════════════════════════════════════
// PREVIEW (IFRAME BASED)
// ══════════════════════════════════════════════════════════
function schedulePreview() {
  clearTimeout(previewTimer);
  previewTimer = setTimeout(renderPreview, 350);
}

function renderPreview() {
  const data = collectCVData();
  if (!data) return;
  const styles = getCVStyles(currentColor, currentHeaderColor, currentHeaderText, currentBarStyle);
  const active = getActiveSections();
  const html = buildCV(data, currentTemplate, currentColor, currentSpacing, currentFontSize, active);
  const _mm2px = mm => Math.round(mm * 595 / 210);
  const MT2_prev = _mm2px(parseInt(document.getElementById('margin_p2_t')?.value) || 10);
  const pageBreakCSS = `
    .page-break-line{height:${MT2_prev}px;background:#e2e8f0;margin:0;position:relative;display:flex;align-items:center;justify-content:center;}
    .page-break-line::after{content:'--- Page Break ---';font-size:8px;color:#94a3b8;padding:0 6px;}
  `;
  const doc = `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>*{box-sizing:border-box;margin:0;padding:0;}body{background:#fff;overflow:visible;}${styles}${pageBreakCSS}</style></head><body>${html}</body></html>`;
  const iframe = document.getElementById('preview-iframe');
  if (!iframe) return;
  iframe.srcdoc = doc;
  // After load, resize iframe to full content height so preview scrolls
  iframe.onload = () => {
    try {
      const h = iframe.contentDocument.body.scrollHeight;
      iframe.style.height = (h || 842) + 'px';
    } catch(e) {}
    scalePreviewIframe();
  };
  updateStrengthScore();
}

function renderPreviewFull() {
  const data = collectCVData();
  if (!data) return;
  const styles = getCVStyles(currentColor, currentHeaderColor, currentHeaderText, currentBarStyle);
  const active = getActiveSections();
  const html = buildCV(data, currentTemplate, currentColor, currentSpacing, currentFontSize, active);
  const doc = `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>*{box-sizing:border-box;margin:0;padding:0;}body{background:#fff;overflow:visible;}${styles}</style></head><body>${html}</body></html>`;
  const iframe = document.getElementById('preview-full-iframe');
  if (!iframe) return;
  iframe.srcdoc = doc;
  iframe.onload = () => {
    try {
      const h = iframe.contentDocument.body.scrollHeight;
      if (h > 842) {
        iframe.style.height = h + 'px';
        scaleMobilePreview();
      }
    } catch(e) {}
  };
}

let _scaleLocked = false, _lastScaleH = 0;
function scalePreviewIframe() {
  if (_scaleLocked) return;
  const wrap = document.getElementById('preview-wrap');
  const sizer = document.getElementById('preview-sizer');
  const iframe = document.getElementById('preview-iframe');
  if (!wrap || !iframe || !sizer) return;
  _scaleLocked = true;
  const w = wrap.clientWidth || 300;
  const scale = w / 595;
  iframe.style.transform = `scale(${scale})`;
  iframe.style.transformOrigin = 'top left';
  const iframeH = parseInt(iframe.style.height) || 842;
  const newSizerH = Math.ceil(iframeH * scale);
  // Only set if changed — avoids triggering ResizeObserver loop
  if (newSizerH !== _lastScaleH) {
    _lastScaleH = newSizerH;
    sizer.style.height = newSizerH + 'px';
  }
  setTimeout(() => { _scaleLocked = false; }, 100);
}

// ══════════════════════════════════════════════════════════
// PAGE LAYOUT MANAGER
// ══════════════════════════════════════════════════════════

// Default section order & page assignment
// Each entry: { id, label, icon, page (1|2|3), enabled }
let pageLayout = [
  { id:'summary',     label:'Professional Summary', icon:'', page:1 },
  { id:'experience',  label:'Work Experience',       icon:'', page:1 },
  { id:'education',   label:'Education',             icon:'', page:1 },
  { id:'skills',      label:'Skills',                icon:'', page:1 },
  { id:'certs',       label:'Certifications',        icon:'', page:1 },
  { id:'personal',    label:'Personal Details',      icon:'', page:2 },
  { id:'declaration', label:'Declaration',           icon:'', page:2 },
];

function getActiveSections() {
  const declOn    = document.getElementById('tog_decl')?.checked;
  const personalOn= document.getElementById('tog_personal')?.checked;
  return pageLayout.filter(s => {
    if (s.id === 'declaration' && !declOn)    return false;
    if (s.id === 'personal'    && !personalOn) return false;
    return true;
  });
}

function resetPageLayout() {
  // Reset to sensible defaults: main sections on p1, personal/declaration on p2
  pageLayout.length = 0;
  pageLayout.push(
    { id:'summary',     label:'Professional Summary', icon:'', page:1 },
    { id:'experience',  label:'Work Experience',       icon:'', page:1 },
    { id:'education',   label:'Education',             icon:'', page:1 },
    { id:'skills',      label:'Skills',                icon:'', page:1 },
    { id:'certs',       label:'Certifications',        icon:'', page:1 },
    { id:'personal',    label:'Personal Details',      icon:'', page:2 },
    { id:'declaration', label:'Declaration',           icon:'', page:2 }
  );
  // Re-add any custom sections
  customSections.forEach(sec => {
    pageLayout.push({ id: sec.id, label: 'Custom: ' + (sec.title || '(New)'), icon: '', page: 1 });
  });
  savePageLayout();
  renderPageLayout();
  schedulePreview();
  showToast(' Page layout reset to defaults');
}

function savePageLayout() {
  try { localStorage.setItem('cv_page_layout', JSON.stringify(pageLayout)); } catch(e){}
  autoSave();
}

function loadPageLayout() {
  try {
    const saved = JSON.parse(localStorage.getItem('cv_page_layout') || 'null');
    if (saved && Array.isArray(saved)) {
      // Restore BOTH page assignments AND array order from saved data
      // Step 1: update page numbers for known sections
      saved.forEach(s => {
        const found = pageLayout.find(p => p.id === s.id);
        if (found) found.page = s.page;
      });
      // Step 2: restore array order to match saved order
      const newOrder = [];
      saved.forEach(s => {
        const found = pageLayout.find(p => p.id === s.id);
        if (found) newOrder.push(found);
      });
      // Append any new sections not in saved data (future-proof)
      pageLayout.forEach(p => {
        if (!newOrder.find(n => n.id === p.id)) newOrder.push(p);
      });
      pageLayout.length = 0;
      newOrder.forEach(p => pageLayout.push(p));
    }
  } catch(e) {}
}

function moveSection(id, dir) {
  // dir: -1 = up, +1 = down within same page, or change page
  const idx = pageLayout.findIndex(s => s.id === id);
  if (idx < 0) return;
  const newIdx = idx + dir;
  if (newIdx < 0 || newIdx >= pageLayout.length) return;
  [pageLayout[idx], pageLayout[newIdx]] = [pageLayout[newIdx], pageLayout[idx]];
  savePageLayout();
  renderPageLayout();
  schedulePreview();
}

function setSectionPage(id, page) {
  const s = pageLayout.find(s => s.id === id);
  if (!s) return;
  s.page = parseInt(page);
  // Re-sort pageLayout so sections are grouped by page (stable sort preserves within-page order)
  pageLayout.sort((a, b) => a.page - b.page);
  savePageLayout(); renderPageLayout(); schedulePreview();
}

function renderPageLayout() {
  const container = document.getElementById('page-layout-ui');
  if (!container) return;
  const active = getActiveSections();
  const pages = [1, 2, 3];
  const pageLabels = {1:'Page 1 — Main Content', 2:'Page 2 — Continuation', 3:'Page 3 — Extra'};
  const pageDesc   = {
    1:'Bottom margin only • Header always here',
    2:'Top + bottom margins • Content continues here',
    3:'Top + bottom margins • Extra overflow',
  };

  container.innerHTML = pages.map(pg => {
    const sections = active.filter(s => s.page === pg);
    const chips = sections.length ? sections.map(s => `
      <div class="plm-chip" draggable="true" id="chip-${s.id}"
           ondragstart="plmDragStart(event,'${s.id}')"
           ondragover="event.preventDefault()"
           ondrop="plmDrop(event,'${s.id}')">
        <span class="plm-chip-icon">${s.icon}</span>
        <span class="plm-chip-name">${s.label}</span>
        <div class="plm-arrows">
          <button onclick="moveSectionUp('${s.id}')" title="Move up">▲</button>
          <button onclick="moveSectionDown('${s.id}')" title="Move down">▼</button>
        </div>
        <select onchange="setSectionPage('${s.id}',this.value)" title="Move to page" style="font-size:10px;border:1px solid var(--border);border-radius:4px;padding:2px 4px;color:var(--muted);background:var(--bg);cursor:pointer;">
          <option value="1" ${s.page===1?'selected':''}>P1</option>
          <option value="2" ${s.page===2?'selected':''}>P2</option>
          <option value="3" ${s.page===3?'selected':''}>P3</option>
        </select>
      </div>`).join('') 
      : `<div style="font-size:11px;color:var(--muted);padding:6px;text-align:center;">— empty —</div>`;

    return `<div class="plm-page">
      <div class="plm-page-label"><span>${pg}</span>${pageLabels[pg]}</div>
      <div style="font-size:10px;color:var(--muted);margin-bottom:5px;">${pageDesc[pg]}</div>
      <div class="plm-slots" id="plm-pg-${pg}"
           ondragover="plmDragOverZone(event)"
           ondragleave="plmDragLeave(event)"
           ondrop="plmDropToPage(event,${pg})">${chips}</div>
    </div>`;
  }).join('');
}

// ── Drag and Drop ──
let _dragId = null;
function plmDragStart(e, id) { _dragId = id; e.dataTransfer.effectAllowed='move'; }
function plmDragOverZone(e)  { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
function plmDragLeave(e)     { e.currentTarget.classList.remove('drag-over'); }
function plmDropToPage(e, pg) {
  e.preventDefault();
  e.currentTarget.classList.remove('drag-over');
  if (_dragId) {
    setSectionPage(_dragId, pg); // setSectionPage already re-sorts
    _dragId = null;
  }
}
function plmDrop(e, targetId) {
  e.preventDefault();
  if (!_dragId || _dragId === targetId) return;
  const fromIdx = pageLayout.findIndex(s => s.id === _dragId);
  const toIdx   = pageLayout.findIndex(s => s.id === targetId);
  if (fromIdx >= 0 && toIdx >= 0) {
    pageLayout.splice(toIdx, 0, pageLayout.splice(fromIdx, 1)[0]);
    savePageLayout();
    renderPageLayout();
    schedulePreview();
  }
  _dragId = null;
}
function moveSectionUp(id) {
  const active = getActiveSections();
  const sec = pageLayout.find(s=>s.id===id);
  if (!sec) return;
  const pg = sec.page;
  const inPage = active.filter(s=>s.page===pg);
  const posInPage = inPage.findIndex(s=>s.id===id);

  if (posInPage > 0) {
    // Swap with previous on same page
    const prevId = inPage[posInPage-1].id;
    const iA = pageLayout.findIndex(s=>s.id===id);
    const iB = pageLayout.findIndex(s=>s.id===prevId);
    [pageLayout[iA], pageLayout[iB]] = [pageLayout[iB], pageLayout[iA]];
  } else {
    // At top of page — move to bottom of previous page
    const prevPg = pg - 1;
    if (prevPg < 1) return;
    sec.page = prevPg;
    const iA = pageLayout.findIndex(s=>s.id===id);
    pageLayout.splice(iA, 1);
    let insertAt = -1;
    pageLayout.forEach((s,i) => { if (s.page === prevPg) insertAt = i; });
    if (insertAt < 0) {
      const firstHigher = pageLayout.findIndex(s=>s.page > prevPg);
      insertAt = firstHigher >= 0 ? firstHigher - 1 : pageLayout.length - 1;
    }
    pageLayout.splice(insertAt + 1, 0, sec);
  }
  savePageLayout(); renderPageLayout(); schedulePreview();
}

function moveSectionDown(id) {
  const active = getActiveSections();
  const sec = pageLayout.find(s=>s.id===id);
  if (!sec) return;
  const pg = sec.page;
  const inPage = active.filter(s=>s.page===pg);
  const posInPage = inPage.findIndex(s=>s.id===id);

  if (posInPage < inPage.length - 1) {
    // Swap with next on same page
    const nextId = inPage[posInPage+1].id;
    const iA = pageLayout.findIndex(s=>s.id===id);
    const iB = pageLayout.findIndex(s=>s.id===nextId);
    [pageLayout[iA], pageLayout[iB]] = [pageLayout[iB], pageLayout[iA]];
  } else {
    // At bottom of page — move to top of next page
    const nextPg = pg + 1;
    if (nextPg > 3) return;
    sec.page = nextPg;
    const iA = pageLayout.findIndex(s=>s.id===id);
    pageLayout.splice(iA, 1);
    let insertAt = pageLayout.findIndex(s=>s.page === nextPg);
    if (insertAt < 0) {
      let lastLower = -1;
      pageLayout.forEach((s,i) => { if (s.page < nextPg) lastLower = i; });
      insertAt = lastLower >= 0 ? lastLower + 1 : pageLayout.length;
      pageLayout.splice(insertAt, 0, sec);
    } else {
      pageLayout.splice(insertAt, 0, sec);
    }
  }
  savePageLayout(); renderPageLayout(); schedulePreview();
}

// ══════════════════════════════════════════════════════════
// VECTOR PDF DOWNLOAD — BROWSER PRINT ENGINE
// ══════════════════════════════════════════════════════════
// Uses browser's native print engine — real vector text, real fonts,
// infinitely crisp at any zoom — same quality as government certificates.
// html2canvas (screenshot) is completely replaced.
// ══════════════════════════════════════════════════════════
// ══════════════════════════════════════════════════════════
// MOBILE DETECTION
// ══════════════════════════════════════════════════════════
function _isMobile() {
  return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent) || window.innerWidth < 768;
}

// ══════════════════════════════════════════════════════════
// MOBILE: Direct clean PDF download (no print dialog)
// Same engine as watermark PDF but WITHOUT watermark
// ══════════════════════════════════════════════════════════
async function _doPDFDownloadMobile() {
  const overlay = document.getElementById('pdf-overlay');
  const txtEl   = document.getElementById('pdf-overlay-text');
  const subEl   = document.getElementById('pdf-overlay-sub');

  if (txtEl) txtEl.innerHTML = ' Generating Your PDF...';
  if (subEl) subEl.innerHTML = 'Please wait — downloading clean PDF to your phone';
  if (overlay) overlay.classList.add('show');

  try {
    const data       = collectCVData();
    const styles     = getCVStyles(currentColor, currentHeaderColor, currentHeaderText, currentBarStyle);
    const active     = getActiveSections();
    const orderedIds = active; // pass full objects with page info
    const html       = buildCV(data, currentTemplate, currentColor, currentSpacing, currentFontSize, orderedIds);

    const mm2px = mm => Math.round(mm * 595 / 210);
    const MB1   = mm2px(parseInt(document.getElementById('margin_p1_b')?.value) || 10);
    const MT2   = mm2px(parseInt(document.getElementById('margin_p2_t')?.value) || 10);
    const MB2   = mm2px(parseInt(document.getElementById('margin_p2_b')?.value) || 10);
    const SCALE = 2; // 2× is enough for mobile — 3× causes memory issues on phones

    // ── KEY FIX: Use a div container, NOT an iframe ──
    // On mobile, iframes placed at left:-9999px fall outside the viewport
    // and the browser renders them at the PHONE width (~390px) not 595px.
    // A div inside a clipping container stays in the DOM flow at exactly 595px.
    const wrapper = document.createElement('div');
    wrapper.style.cssText = [
      'position:fixed',
      'top:0',
      'left:0',
      'width:595px',           // exact A4 pixel width
      'height:1px',            // clip to 1px tall so user sees nothing
      'overflow:hidden',       // hide the content
      'opacity:0',             // invisible
      'pointer-events:none',
      'z-index:-9999',
    ].join(';');

    const cvDiv = document.createElement('div');
    cvDiv.style.cssText = 'width:595px;background:#fff;margin:0;padding:0;position:relative;';

    // Inject a style tag + CV html
    const styleTag = document.createElement('style');
    styleTag.textContent = [
      '*{box-sizing:border-box;-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;}',
      'body,html{margin:0;padding:0;}',
      styles
    ].join('');

    cvDiv.appendChild(styleTag);
    const cvContent = document.createElement('div');
    cvContent.innerHTML = html;
    while (cvContent.firstChild) cvDiv.appendChild(cvContent.firstChild);
    wrapper.appendChild(cvDiv);
    document.body.appendChild(wrapper);

    // Let browser paint it
    await new Promise(r => setTimeout(r, 600));

    const realH = Math.max(cvDiv.scrollHeight, cvDiv.offsetHeight, 842);

    // Expand wrapper tall enough so html2canvas can see it all
    wrapper.style.height = realH + 'px';
    await new Promise(r => setTimeout(r, 200));

    // Capture at exactly 595px wide
    const cvCanvas = await html2canvas(cvDiv, {
      scale: SCALE,
      useCORS: true,
      allowTaint: true,
      backgroundColor: '#ffffff',
      width: 595,
      height: realH,
      windowWidth: 595,
      windowHeight: realH,
      scrollX: 0,
      scrollY: 0,
      logging: false,
      imageTimeout: 0,
      removeContainer: false,
      x: 0,
      y: 0,
    });

    document.body.removeChild(wrapper);

    // ── Slice into A4 pages with NO margins (clean mobile download) ──
    const { jsPDF } = window.jspdf;
    const pdf     = new jsPDF({ orientation:'portrait', unit:'mm', format:'a4', compress:true });
    const A4_H    = 842;
    const A4_SCAN = 100;
    const P1_SAFE = A4_H - MB1;
    const P2_SAFE = A4_H - MT2 - MB2;
    const total   = cvCanvas.height;

    if (total / SCALE <= A4_H + 20) {
      // Single page — fits on one A4
      const pc = _makePageCanvas(cvCanvas, A4_H * SCALE, 0, 0, total);
      pdf.addImage(pc.toDataURL('image/jpeg', 0.92), 'JPEG', 0, 0, 210, 297);
    } else {
      // Multi-page — smart slice to avoid cutting through text
      const slices = _smartSliceWM(cvCanvas, A4_H, P1_SAFE, P2_SAFE, A4_SCAN, SCALE);
      slices.forEach((sl, si) => {
        if (si > 0) pdf.addPage('a4', 'portrait');
        const topOff = si > 0 ? Math.round(MT2 * SCALE) : 0;
        const pc = _makePageCanvas(cvCanvas, A4_H * SCALE, sl.start, topOff, sl.len);
        pdf.addImage(pc.toDataURL('image/jpeg', 0.92), 'JPEG', 0, 0, 210, 297);
      });
    }

    const cvName = (data.personal.name || 'CV').replace(/[^a-zA-Z0-9\s]/g,'').trim().replace(/\s+/g,'_') || 'CV';
    pdf.save(`${cvName}_CV.pdf`);
    showToast(' PDF downloaded to your phone!');

  } catch(err) {
    console.error('Mobile PDF error:', err);
    showToast(' Error generating PDF. Please try again.');
  } finally {
    if (txtEl) txtEl.innerHTML = ' Opening Print Dialog...';
    if (subEl) subEl.innerHTML = 'Choose <strong style="color:#fff;">"Save as PDF"</strong> → destination in the dialog';
    if (overlay) overlay.classList.remove('show');
  }
}

function _doPDFDownload() {
  // On mobile — skip print dialog, directly download PDF
  if (_isMobile()) { _doPDFDownloadMobile(); return; }

  const data   = collectCVData();
  const styles = getCVStyles(currentColor, currentHeaderColor, currentHeaderText, currentBarStyle);
  const active = getActiveSections();
  const orderedIds = active; // pass full objects with page info
  const html   = buildCV(data, currentTemplate, currentColor, currentSpacing, currentFontSize, orderedIds);

  // Read margin settings (px → mm: 1px = 0.2646mm at 96dpi)
  const mm2px = mm => Math.round(mm * 595 / 210);
  const MB1 = mm2px(parseInt(document.getElementById('margin_p1_b')?.value) || 10);
  const MT2 = mm2px(parseInt(document.getElementById('margin_p2_t')?.value) || 10);
  const MB2 = mm2px(parseInt(document.getElementById('margin_p2_b')?.value) || 10);
  const px2mm = px => +(px * 0.2646).toFixed(1);

  const cvName = (data.personal.name || 'CV').replace(/[^a-zA-Z0-9\s]/g,'').trim() || 'My CV';

  // ── Build the print document ──
  // @page :first  = Page 1 (no top margin, only bottom)
  // @page         = Page 2 onward (top + bottom margin)
  const printDoc = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>${cvName} — CV</title>
<style>
  /* ── PRINT ENGINE SETTINGS ── */
  *, *::before, *::after {
    box-sizing: border-box;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color-adjust: exact !important;
  }

  /* Page 2 and beyond — top + bottom margin */
  @page {
    size: A4 portrait;
    margin: ${px2mm(MT2)}mm 0 ${px2mm(MB2)}mm 0;
  }
  /* First page — no top margin (header bleeds to edge), only bottom */
  @page :first {
    margin: 0 0 ${px2mm(MB1)}mm 0;
  }

  html {
    width: 210mm;
    background: #fff;
  }
  body {
    width: 210mm;
    margin: 0;
    padding: 0;
    background: #fff;
    font-smooth: always;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }

  /* ── CV Template Styles ── */
  ${styles}

  /* ── Print-time overrides — ensure backgrounds & colors print ── */
  @media print {
    html, body { background: #fff !important; }
    * {
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
    /* Smart page-break rules */
    h1,h2,h3,h4,h5,h6 { page-break-after: avoid; break-after: avoid; }
    .t1 .sh,.t2 .sh,.t3 .sh,.t4 .sh,.t5 .sh,
    .t6 .msh,.t7 .sh,.t8 .sh,.t9 .sh,.t10 .sh {
      page-break-after: avoid !important;
      break-after: avoid !important;
    }
    .t2 .job,.t5 .job,.t6 .job,.t8 .job,.t10 .job {
      page-break-inside: avoid !important;
      break-inside: avoid !important;
    }
    /* table page-break-inside REMOVED — caused entire table to be pushed to page 2 */
    /* Individual rows still avoid mid-row splits */
    tr { page-break-inside: avoid; }
  }
</style>
</head>
<body>${html}</body>
</html>`;

  // ── Open print window ──
  const pw = window.open('', '_blank', 'width=900,height=700,scrollbars=yes');
  if (!pw) {
    // Popup blocked — fall back to print overlay method
    showToast('️ Allow popups, or use the Print button below');
    _printFallbackDirect(printDoc);
    return;
  }

  pw.document.open();
  pw.document.write(printDoc);
  pw.document.close();

  // Wait for all resources (fonts, images) to fully load before printing
  pw.addEventListener('load', () => {
    setTimeout(() => {
      pw.document.title = cvName + ' — CV';
      pw.focus();
      pw.print();
      pw.addEventListener('afterprint', () => { try { pw.close(); } catch(e){} });
    }, 900);
  });

  // Fallback if load event already fired (srcdoc scenario)
  setTimeout(() => {
    if (pw && !pw.closed) {
      try {
        pw.focus();
        pw.print();
      } catch(e) {}
    }
  }, 2200);

  showToast(' Choose "Save as PDF" in the print dialog');
}

// Direct fallback: inject into hidden iframe and print from current page
function _printFallbackDirect(printDoc) {
  const el = document.getElementById('print-cv-styles');
  const ct = document.getElementById('print-cv-content');
  if (el && ct) {
    el.textContent = '';
    ct.innerHTML = printDoc;
    setTimeout(() => { window.print(); setTimeout(() => { ct.innerHTML=''; }, 2000); }, 200);
  }
}

// ══════════════════════════════════════════════════════════
// WATERMARK PDF — screenshot + "One Net Solution" diagonal
// ══════════════════════════════════════════════════════════
async function downloadWatermarkPDF() {
  const overlay    = document.getElementById('pdf-overlay');
  const txtEl      = document.getElementById('pdf-overlay-text');
  const subEl      = document.getElementById('pdf-overlay-sub');

  // Update overlay message for watermark mode
  if (txtEl) txtEl.innerHTML = ' Generating Preview PDF...';
  if (subEl) subEl.innerHTML = 'Adding <strong style="color:#fff;">One Net Solution</strong> watermark — please wait';
  overlay.classList.add('show');

  try {
    const data       = collectCVData();
    const styles     = getCVStyles(currentColor, currentHeaderColor, currentHeaderText, currentBarStyle);
    const active     = getActiveSections();
    const orderedIds = active; // pass full objects with page info
    const html       = buildCV(data, currentTemplate, currentColor, currentSpacing, currentFontSize, orderedIds);

    const mm2px = mm => Math.round(mm * 595 / 210);
    const MB1 = mm2px(parseInt(document.getElementById('margin_p1_b')?.value) || 10);
    const MT2 = mm2px(parseInt(document.getElementById('margin_p2_t')?.value) || 10);
    const MB2 = mm2px(parseInt(document.getElementById('margin_p2_b')?.value) || 10);
    const SCALE = 3; // 3× for good quality raster

    const pageDoc = `<!DOCTYPE html><html><head><meta charset="UTF-8">
<style>
  *{box-sizing:border-box;margin:0;padding:0;-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;}
  html,body{background:#fff;width:595px;margin:0;padding:0;}
  ${styles}
</style></head><body style="width:595px;background:#fff;margin:0;padding:0;">${html}</body></html>`;

    // Off-screen iframe — opacity:0 (critical: NOT visibility:hidden)
    const iframe = document.createElement('iframe');
    iframe.style.cssText = 'position:fixed;left:-9999px;top:0;width:595px;height:10000px;border:none;opacity:0;pointer-events:none;z-index:-1;';
    document.body.appendChild(iframe);

    await new Promise(res => { iframe.onload = res; iframe.srcdoc = pageDoc; });
    await new Promise(r => setTimeout(r, 1600));

    const iDoc  = iframe.contentDocument;
    const iBody = iDoc.body;
    const realH = Math.max(iBody.scrollHeight, iBody.offsetHeight, iDoc.documentElement.scrollHeight, 842);
    iframe.style.height = (realH + 100) + 'px';
    await new Promise(r => setTimeout(r, 350));

    // Capture full CV as canvas
    const cvCanvas = await html2canvas(iBody, {
      scale: SCALE,
      useCORS: true,
      allowTaint: true,
      backgroundColor: '#ffffff',
      width: 595,
      height: realH,
      windowWidth: 595,
      windowHeight: realH,
      scrollX: 0, scrollY: 0,
      logging: false,
      imageTimeout: 0,
      removeContainer: false,
    });
    document.body.removeChild(iframe);

    // ── Slice into A4 pages with margins ──
    const { jsPDF } = window.jspdf;
    const pdf    = new jsPDF({ orientation:'portrait', unit:'mm', format:'a4', compress:true });
    const A4_H   = 842;
    const A4_SCAN = 100;
    const P1_SAFE = A4_H - MB1;
    const P2_SAFE = A4_H - MT2 - MB2;

    const total = cvCanvas.height;

    // Helper: check if a canvas slice has any real content (not all white)
    function sliceHasContent(canvas, startY, lenY) {
      const sampleStep = Math.max(1, Math.floor(lenY / 80));
      const img = canvas.getContext('2d').getImageData(0, startY, canvas.width, Math.min(lenY, canvas.height - startY));
      const px  = img.data;
      for (let i = 0; i < px.length; i += 4 * sampleStep) {
        if (px[i] < 245 || px[i+1] < 245 || px[i+2] < 245) return true;
      }
      return false;
    }

    if (total / SCALE <= A4_H + 20) {
      // Single page — one watermark centered
      _applyWatermarkOnSlice(cvCanvas, 0, total, SCALE);
      const pc = _makePageCanvas(cvCanvas, A4_H * SCALE, 0, 0, total);
      _applyWatermarkOnPageCanvas(pc, SCALE);
      pdf.addImage(pc.toDataURL('image/jpeg', 0.88), 'JPEG', 0, 0, 210, 297);
    } else {
      const slices = _smartSliceWM(cvCanvas, A4_H, P1_SAFE, P2_SAFE, A4_SCAN, SCALE);
      // Keep only content-holding pages (skip blank trailing pages)
      const contentSlices = slices.filter(sl => sliceHasContent(cvCanvas, sl.start, sl.len));
      contentSlices.forEach((sl, si) => {
        // Draw exactly one watermark centered on this page slice
        _applyWatermarkOnSlice(cvCanvas, sl.start, sl.len, SCALE);
        if (si > 0) pdf.addPage('a4', 'portrait');
        const topOff = si > 0 ? Math.round(MT2 * SCALE) : 0;
        const pc = _makePageCanvas(cvCanvas, A4_H * SCALE, sl.start, topOff, sl.len);
        _applyWatermarkOnPageCanvas(pc, SCALE);
        pdf.addImage(pc.toDataURL('image/jpeg', 0.88), 'JPEG', 0, 0, 210, 297);
      });
    }

    const name = (data.personal.name || 'CV').replace(/[^a-zA-Z0-9\s]/g,'').trim().replace(/\s+/g,'_') || 'CV';
    pdf.save(`${name}_PREVIEW_OneNetSolution.pdf`);
    showToast(' Watermark preview downloaded!');

  } catch(err) {
    console.error('Watermark PDF error:', err);
    showToast('Error generating preview PDF');
  } finally {
    // Restore overlay text to default
    if (txtEl) txtEl.innerHTML = ' Opening Print Dialog...';
    if (subEl) subEl.innerHTML = 'Choose <strong style="color:#fff;">"Save as PDF"</strong> → destination in the dialog';
    overlay.classList.remove('show');
  }
}

// ── Draw ONE "One Net Solution" watermark centered on an already-sliced page canvas ──
function _applyWatermarkOnPageCanvas(pageCanvas, scale) {
  const ctx = pageCanvas.getContext('2d');
  const W   = pageCanvas.width;
  const H   = pageCanvas.height;

  const TEXT      = 'One Net Solution';
  const FONT_SIZE = Math.round(52 * scale);
  const ANGLE     = -35 * (Math.PI / 180);

  // Main diagonal watermark — centered on the page
  ctx.save();
  ctx.globalAlpha  = 0.18;
  ctx.fillStyle    = '#1D4ED8';
  ctx.font         = `700 ${FONT_SIZE}px "Helvetica Neue", Arial, sans-serif`;
  ctx.textAlign    = 'center';
  ctx.textBaseline = 'middle';
  ctx.translate(W / 2, H / 2);
  ctx.rotate(ANGLE);
  ctx.fillText(TEXT, 0, 0);
  ctx.restore();

  // Bottom-right stamp
  const STAMP_FONT = Math.round(11 * scale);
  ctx.save();
  ctx.globalAlpha  = 0.35;
  ctx.fillStyle    = '#1D4ED8';
  ctx.font         = `600 ${STAMP_FONT}px "Helvetica Neue", Arial, sans-serif`;
  ctx.textAlign    = 'right';
  ctx.textBaseline = 'bottom';
  ctx.fillText('© One Net Solution — Preview Only', W - Math.round(10 * scale), H - Math.round(8 * scale));
  ctx.restore();
}

// kept for backward compat (no-op)
function _applyWatermark(canvas, scale) {}
// kept for backward compat (no-op)
function _applyWatermarkOnSlice(canvas, sliceStart, sliceLen, scale) {}

// ── Copy a slice of srcCanvas into a clean A4-sized canvas with optional top offset ──
function _makePageCanvas(src, a4Px, srcStart, topOff, srcLen) {
  const c   = document.createElement('canvas');
  c.width   = src.width;
  c.height  = a4Px;
  const ctx = c.getContext('2d');
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(0, 0, c.width, c.height);
  const copy = Math.min(srcLen, a4Px - topOff);
  if (copy > 0) ctx.drawImage(src, 0, srcStart, src.width, copy, 0, topOff, src.width, copy);
  return c;
}

// ── Smart slice respecting different safe heights per page ──
function _smartSliceWM(canvas, a4H, p1Safe, p2Safe, scanPx, scale) {
  const slices = [];
  let startY = 0, pg = 0;
  while (startY < canvas.height) {
    pg++;
    const safeH   = (pg === 1 ? p1Safe : p2Safe) * scale;
    const idealEnd = startY + safeH;
    if (idealEnd >= canvas.height) { slices.push({ start: startY, len: canvas.height - startY }); break; }
    const scanH   = Math.min(scanPx * scale, safeH);
    const scanTop = idealEnd - scanH;
    const img     = canvas.getContext('2d').getImageData(0, scanTop, canvas.width, scanH);
    const px      = img.data;
    let cutY      = idealEnd;
    for (let row = scanH - 1; row >= 0; row--) {
      let white = true;
      for (let col = 0; col < canvas.width; col++) {
        const i = (row * canvas.width + col) * 4;
        if (px[i] < 236 || px[i+1] < 236 || px[i+2] < 236) { white = false; break; }
      }
      if (white) { cutY = scanTop + row; break; }
    }
    slices.push({ start: startY, len: cutY - startY });
    startY = cutY;
  }
  return slices;
}




// Build only the sections assigned to a given page (section-aware, template-aware)
function buildPageSections(data, sections, tpl, col, spacing, fs) {
  const d = data.personal;
  const validJ = data.jobs.filter(j=>j.company);
  const validE = data.edus.filter(e=>e.institution);
  const validS = data.skills.filter(sk=>sk.name);
  const validC = data.certs.filter(c=>c.name);

  // Get template's section class names
  const tplNum = parseInt(tpl) || 2;
  const shClass = ['t1','t2','t3','t4','t5','t6','t7','t8','t9','t10'][tplNum-1] + ' sh';
  const bodyStyle = getBuildStyle(tpl, col, spacing, fs);

  let html = '';
  for (const sec of sections) {
    switch(sec.id) {
      case 'summary':
        if (d.summary) html += `<div class="${shClass}">Professional Summary</div><p style="margin:0 0 10px;color:#333;text-align:justify;font-size:${fs}px;line-height:1.6;">${s(d.summary)}</p>`;
        break;
      case 'experience':
        if (validJ.length) html += buildSectionExperience(validJ, shClass, fs);
        break;
      case 'education':
        if (validE.length) html += buildSectionEducation(validE, shClass, fs);
        break;
      case 'skills':
        if (validS.length) html += `<div class="${shClass}">Skills</div><div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px;">${validS.map(sk=>`<span style="font-size:${fs-1}px;margin-right:10px;">• ${s(sk.name)}</span>`).join('')}</div>`;
        break;
      case 'certs':
        if (validC.length) html += `<div class="${shClass}">Certifications</div>${validC.map(c=>`<div style="font-size:${fs-1}px;margin-bottom:3px;">• <strong>${s(c.name)}</strong>${c.issuedBy?` — ${s(c.issuedBy)}`:''} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`;
        break;
      case 'personal':
        html += buildPersonalSection(data, shClass, col);
        break;
      case 'declaration':
        html += buildDeclaration(data, shClass, d.name, col);
        break;
    }
  }

  // Wrap in template padding div
  return `<div style="${bodyStyle}">${html}</div>`;
}

function getBuildStyle(tpl, col, spacing, fs) {
  const tplNum = parseInt(tpl) || 2;
  const pads = {
    1: spacing==='spacious'?'42px 46px':spacing==='compact'?'28px 34px':'36px 40px',
    2: spacing==='compact'?'14px 26px':spacing==='spacious'?'22px 34px':'16px 30px',
    3: '40px 46px', 4: '44px 48px', 5: '14px 20px',
    6: '14px 20px', 7: '30px 40px', 8: '32px 36px',
    9: '32px 38px', 10:'20px 30px',
  };
  const pad = pads[tplNum] || '36px 40px';
  const fonts = {1:'Georgia,serif',2:"'Helvetica Neue',Arial,sans-serif",3:'Georgia,serif',
    4:"'Helvetica Neue',Arial,sans-serif",5:'Arial,sans-serif',6:'Arial,sans-serif',
    7:"'Times New Roman',Times,serif",8:'Arial,sans-serif',9:"'Courier New',monospace",
    10:"'Helvetica Neue',Arial,sans-serif"};
  return `font-family:${fonts[tplNum]||'Arial,sans-serif'};font-size:${fs}px;padding:${pad};color:#111;line-height:1.6;`;
}

function buildSectionExperience(jobs, shClass, fs) {
  return `<div class="${shClass}">Work Experience</div>` + jobs.map(j => {
    const period = j.startDate ? (j.startDate + ' — ' + (j.current?'Present':j.endDate||'')) : '';
    const bullets = (j.bullets||[]).filter(Boolean);
    return `<div style="margin-bottom:10px;">
      <div style="display:flex;justify-content:space-between;align-items:baseline;gap:8px;">
        <strong style="font-size:${fs}px;">${s(j.role||j.company)}</strong>
        <span style="font-size:${fs-1.5}px;color:#666;white-space:nowrap;flex-shrink:0;">${s(period)}</span>
      </div>
      <div style="font-style:italic;color:#555;font-size:${fs-1}px;">${s(j.company)}${j.location?`, ${s(j.location)}`:''}</div>
      ${bullets.length?`<ul style="padding-left:14px;margin:3px 0;">${bullets.map(b=>`<li style="font-size:${fs-1}px;color:#333;margin-bottom:1px;">${s(b)}</li>`).join('')}</ul>`:''}
    </div>`;
  }).join('');
}

function buildSectionEducation(edus, shClass, fs) {
  return `<div class="${shClass}">Education</div>` + edus.map(e => {
    return `<div style="display:flex;justify-content:space-between;margin-bottom:7px;">
      <div>
        <strong style="font-size:${fs}px;">${s(e.degree)}</strong>
        <div style="font-style:italic;color:#555;font-size:${fs-1}px;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
      </div>
      <div style="text-align:right;color:#666;font-size:${fs-1.5}px;">${s(e.endYear||e.startYear)}${e.grade?`<br/>Grade: ${s(e.grade)}`:''}</div>
    </div>`;
  }).join('');
}


function triggerPrintFallback() {
  // Same vector-quality fallback — uses print CSS directly on page
  const data   = collectCVData();
  const styles = getCVStyles(currentColor, currentHeaderColor, currentHeaderText, currentBarStyle);
  const active = getActiveSections();
  const orderedIds = active; // pass full objects with page info
  const html   = buildCV(data, currentTemplate, currentColor, currentSpacing, currentFontSize, orderedIds);
  const stylesEl   = document.getElementById('print-cv-styles');
  const contentEl  = document.getElementById('print-cv-content');
  if (!stylesEl || !contentEl) return;
  stylesEl.textContent = `
    *{box-sizing:border-box;margin:0;padding:0;-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;}
    @page{size:A4 portrait;margin:0;}
    html,body{background:#fff;width:210mm;}
    ${styles}
  `;
  contentEl.innerHTML = html;
  setTimeout(() => {
    window.print();
    setTimeout(() => { contentEl.innerHTML = ''; stylesEl.textContent = ''; }, 2000);
  }, 200);
}

// ══════════════════════════════════════════════════════════
// DEMO MODAL
// ══════════════════════════════════════════════════════════
const DEMO_DATA = {
  personal:{name:'Rahul Sharma',father:'Ramesh Sharma',title:'Senior Loco Motive Operator',phone:'+91 9876543210',email:'rahul.sharma@email.com',location:'Mumbai, Maharashtra',dob:'15 March 1992',nation:'Indian',marital:'Married',lang:'Hindi, English, Marathi',passport:'P1234567',passport_exp:'27/12/2030',summary:'Dedicated and experienced Loco Motive and MSV Operator with over 10 years of proven experience in metro and tunnel railway construction projects across India. Committed to safety, efficiency and high standards of work.'},
  jobs:[
    {title:'Loco Motive Operator',company:'M/S Corrival Corp — Tata Project',location:'Chennai',start:'Aug 2022',end:'',current:true,type:'Full-time',responsibilities:['Operated locomotive in underground tunnel on Chennai Metro Project','Ensured safe transportation of TBM segments and construction materials','Performed daily pre-operation safety checks and maintained logs']},
    {title:'MSV Operator',company:'Varasha Infracon Pvt Ltd',location:'Bangalore',start:'Mar 2021',end:'Jun 2022',current:false,type:'Full-time',responsibilities:['Operated MSV in tunnel construction for Bangalore Metro expansion','Coordinated with tunnel engineers for smooth material flow']},
  ],
  edus:[{degree:'Class 10th Pass',institution:'Govt. High School',location:'Odisha',startYear:'',endYear:'2007',grade:''}],
  skills:[{name:'Loco Motive Operation',level:'Expert'},{name:'MSV Operation',level:'Expert'},{name:'TBM Gantry Crane',level:'Advanced'},{name:'NATM Method',level:'Advanced'},{name:'Tunnel Safety Protocols',level:'Expert'},{name:'Heavy Vehicle Driving',level:'Advanced'}],
  certs:[{name:'Tunnel Safety Certificate',issuedBy:'MMRC',year:'2020'}],
  extras:{decl:true,personal:true,photo:false,father:true},
  photo: null,
};

function openDemo(n) { openInlineDemo(n); } // legacy shim
function closeDemo() { TPL_INFO.forEach((_,i) => closeInlineDemo(i+1)); }

// ── INLINE TEMPLATE PREVIEW ──
let _activeDemoIdx = 0;

function handleTplCardClick(e, n) {
  // If click is on/inside the preview wrap, don't select template
  if (e.target.closest('.tpl-preview-wrap')) return;
  selectTemplate(n);
}

function openInlineDemo(n) {
  // Close any currently open preview first
  TPL_INFO.forEach((_,i) => {
    if (i+1 !== n) closeInlineDemo(i+1);
  });
  _activeDemoIdx = n;

  const wrap = document.getElementById('tplpreview-' + n);
  const card = document.getElementById('tplcard-' + n);
  if (!wrap || !card) return;

  wrap.classList.add('open');
  card.classList.add('preview-open');

  // Show loading spinner, hide viewport
  const loading  = document.getElementById('tplloading-'  + n);
  const viewport = document.getElementById('tplviewport-' + n);
  if (loading)  loading.style.display  = 'flex';
  if (viewport) viewport.style.display = 'none';

  // Render after paint
  requestAnimationFrame(() => setTimeout(() => renderInlineDemo(n), 80));

  // Scroll card into view
  setTimeout(() => card.scrollIntoView({behavior:'smooth', block:'nearest'}), 150);
}

function closeInlineDemo(n) {
  const wrap = document.getElementById('tplpreview-' + n);
  const card = document.getElementById('tplcard-' + n);
  if (wrap) wrap.classList.remove('open');
  if (card) card.classList.remove('preview-open');
  if (_activeDemoIdx === n) _activeDemoIdx = 0;
}

function renderInlineDemo(n) {
  const iframe   = document.getElementById('tpliframe-'   + n);
  const viewport = document.getElementById('tplviewport-' + n);
  const loading  = document.getElementById('tplloading-'  + n);
  if (!iframe || !viewport) return;

  const styles = getCVStyles(currentColor, currentHeaderColor, currentHeaderText, currentBarStyle);
  const html   = buildCV(DEMO_DATA, n, currentColor, 'normal', 10.5);

  iframe.onload = () => {
    try {
      // How wide is the card right now?
      const cardW = viewport.parentElement.offsetWidth || 300;
      const scale = cardW / 595;

      // Full content height of the CV
      const contentH = iframe.contentDocument.body.scrollHeight || 842;
      // Limit to ~400px visible area (rest scrolls)
      const visibleH  = Math.min(Math.round(contentH * scale), 400);

      // Size the iframe at full 595px × contentH, then scale it down
      iframe.style.width     = '595px';
      iframe.style.height    = contentH + 'px';
      iframe.style.transform = `scale(${scale})`;

      // The viewport clips to visibleH so no blank space shows
      viewport.style.height = visibleH + 'px';
      viewport.style.overflowY = 'auto';

      // Show viewport, hide loading
      if (loading) loading.style.display = 'none';
      viewport.style.display = 'block';
    } catch(err) {
      if (loading) loading.style.display = 'none';
      viewport.style.display = 'block';
    }
  };

  iframe.srcdoc = `<!DOCTYPE html><html><head><meta charset="UTF-8">
<style>*{box-sizing:border-box;margin:0;padding:0;}body{background:#fff;}${styles}</style>
</head><body>${html}</body></html>`;
}

function renderDemoModal() {} // no-op, legacy
function demoNav(n)  { openInlineDemo(n); }
function demoPrev()  { if (_activeDemoIdx > 1) openInlineDemo(_activeDemoIdx - 1); }
function demoNext()  { if (_activeDemoIdx < TPL_INFO.length) openInlineDemo(_activeDemoIdx + 1); }

// ══════════════════════════════════════════════════════════
// CV DATA COLLECTOR
// ══════════════════════════════════════════════════════════
function collectCVData() {
  return {
    personal: getFormData(),
    jobs, edus, skills, certs, customSections,
    extras: {
      decl:     document.getElementById('tog_decl')?.checked     || false,
      personal: document.getElementById('tog_personal')?.checked || false,
      photo:    document.getElementById('tog_photo')?.checked    !== false,
      father:   document.getElementById('tog_father')?.checked   !== false,
      layout:   JSON.parse(JSON.stringify(pageLayout)),
      margin_p1_b: parseInt(document.getElementById('margin_p1_b')?.value) || 10,
      margin_p2_t: parseInt(document.getElementById('margin_p2_t')?.value) || 10,
      margin_p2_b: parseInt(document.getElementById('margin_p2_b')?.value) || 10,
    },
    photo: photoData,
  };
}

// ══════════════════════════════════════════════════════════
// CV BUILDER — ALL 10 TEMPLATES
// ══════════════════════════════════════════════════════════
/**
 * Renders sections GROUPED by page number in one continuous flow.
 * p1 sections render first, then p2, then p3 — NO forced page breaks.
 * The browser's natural A4 pagination decides where pages split.
 * Supports both plain string IDs and {id, page} objects.
 */
function renderSections(secOrder, sections) {
  const hasPageInfo = secOrder.some(item => typeof item === 'object' && item.page != null);
  if (!hasPageInfo) {
    return secOrder.map(item => sections[typeof item === 'object' ? item.id : item] || '').join('');
  }
  // Group by page, preserving within-page order
  const pageMap = {};
  secOrder.forEach(item => {
    const id   = typeof item === 'object' ? item.id   : item;
    const page = (typeof item === 'object' && item.page) ? item.page : 1;
    if (!pageMap[page]) pageMap[page] = [];
    pageMap[page].push(id);
  });
  // Sort page groups numerically, render all sections in one continuous flow
  const sortedPages = Object.keys(pageMap).map(Number).sort((a, b) => a - b);
  return sortedPages.map(pg => pageMap[pg].map(id => sections[id] || '').join('')).join('');
}

// Build custom sections HTML for any template
function buildCustomSectionsHTML(data, shSz, fs) {
  if (!data.customSections || !data.customSections.length) return {};
  const result = {};
  const sm = +(fs * 0.88).toFixed(1);
  const xs = +(fs * 0.82).toFixed(1);

  data.customSections.forEach(sec => {
    if (!sec.title) return; // skip untitled sections

    let html = `<div class="sh" style="font-size:${shSz}px;">${s(sec.title)}</div>`;
    const items = sec.items || [];

    items.forEach(item => {
      const hasName   = item.name   && item.name.trim();
      const hasDetail = item.detail && item.detail.trim();
      const hasDates  = item.dates  && item.dates.trim();
      // Support both old structure (bullets:[]) and new
      const bulletArr = (item.bullets || []).filter(b => b && b.trim());

      if (!hasName && !hasDetail && !hasDates && !bulletArr.length) return; // truly empty item — skip

      if (hasName || hasDetail || hasDates) {
        html += `<div style="margin-bottom:7px;">`;

        // Row 1: name + dates
        if (hasName || hasDates) {
          html += `<div style="display:flex;justify-content:space-between;align-items:baseline;">`;
          html += hasName
            ? `<strong style="font-size:${sm}px;">${s(item.name)}</strong>`
            : `<span></span>`;
          if (hasDates)
            html += `<span style="color:#666;font-size:${xs}px;font-style:italic;">${s(item.dates)}</span>`;
          html += `</div>`;
        }

        // Row 2: detail / org
        if (hasDetail)
          html += `<div style="color:#555;font-style:italic;font-size:${xs}px;">${s(item.detail)}</div>`;

        // Bullets
        bulletArr.forEach(b => {
          html += `<div style="padding-left:12px;color:#333;font-size:${fs}px;">• ${s(b)}</div>`;
        });

        html += `</div>`;
      } else {
        // Only bullets, no name/detail/dates
        bulletArr.forEach(b => {
          html += `<div style="font-size:${sm}px;margin-bottom:2px;">• ${s(b)}</div>`;
        });
      }
    });

    result[sec.id] = html;
  });
  return result;
}

function buildCV(data, tplNum, color, spacing, fontSize, sectionOrder) {
  const fns = [buildT1,buildT2,buildT3,buildT4,buildT5,buildT6,buildT7,buildT8,buildT9,buildT10,buildT11,buildT12,buildT13,buildT14,buildT15,buildT16,buildT17,buildT18,buildT19,buildT20];
  const fn = fns[Math.min(Math.max((tplNum||2)-1,0), fns.length-1)];
  const nmSz  = (typeof currentNameSize          !=='undefined' ? currentNameSize          : 24);
  const ttlSz = (typeof currentTopTitleSize       !=='undefined' ? currentTopTitleSize       : 14);
  const shSz  = (typeof currentSectionHeaderSize  !=='undefined' ? currentSectionHeaderSize  : 13);
  const subSz = (typeof currentSubHeaderSize      !=='undefined' ? currentSubHeaderSize      : 13);
  return fn(data, color||'#0F766E', spacing||'normal', fontSize||12, sectionOrder||null, nmSz, ttlSz, shSz, subSz);
}

function getCVStyles(col, hdrCol, hdrTxt, barStyle) {
  col      = col      || '#0F766E';
  hdrCol   = hdrCol   || col;
  hdrTxt   = hdrTxt   || 'light';
  barStyle = barStyle  || 'solid';
  const hdrTextColor = hdrTxt === 'dark' ? '#1a1a1a' : '#ffffff';
  const hdrSubColor  = hdrTxt === 'dark' ? 'rgba(0,0,0,0.6)' : 'rgba(255,255,255,0.82)';

  // Bar style CSS helper — used in ::after pseudo-element on .sh elements
  function barCSS(color) {
    if (barStyle === 'gradient') return `background:linear-gradient(90deg,${color},transparent);height:2px;border:none;`;
    if (barStyle === 'dots')     return `background:repeating-linear-gradient(90deg,${color} 0,${color} 4px,transparent 4px,transparent 8px);height:2px;border:none;`;
    if (barStyle === 'line')     return `background:transparent;height:0;border-bottom:1.5px dashed ${color};`;
    if (barStyle === 'none')     return `background:transparent;height:0;border:none;`;
    return `background:${color};height:2px;border:none;`; // solid default
  }
  return `
.plm-page{margin-bottom:16px;}
.plm-page-label{font-size:11px;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;display:flex;align-items:center;gap:6px;}
.plm-page-label span{background:var(--primary);color:#fff;border-radius:50%;width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;font-size:10px;font-weight:900;}
.plm-slots{display:flex;flex-direction:column;gap:4px;min-height:32px;border:2px dashed var(--border);border-radius:8px;padding:6px;background:var(--bg);}
.plm-slots.drag-over{border-color:var(--primary);background:var(--primary-light);}
.plm-chip{display:flex;align-items:center;justify-content:space-between;background:var(--card);border:1.5px solid var(--border);border-radius:8px;padding:7px 10px;cursor:grab;font-size:12px;font-weight:600;gap:8px;user-select:none;transition:box-shadow .15s,transform .1s;}
.plm-chip:active{cursor:grabbing;box-shadow:0 4px 16px rgba(0,0,0,.15);transform:scale(1.02);}
.plm-chip-icon{font-size:15px;flex-shrink:0;}
.plm-chip-name{flex:1;}
.plm-chip-pg{font-size:10px;color:var(--muted);background:var(--bg);border-radius:4px;padding:2px 6px;flex-shrink:0;}
.plm-arrows{display:flex;gap:3px;}
.plm-arrows button{width:22px;height:22px;border:1px solid var(--border);border-radius:4px;background:var(--card);cursor:pointer;font-size:11px;display:flex;align-items:center;justify-content:center;color:var(--muted);}
.plm-arrows button:hover{background:var(--primary);color:#fff;border-color:var(--primary);}

.t1{font-family:Georgia,serif;color:#111;padding:36px 40px;font-size:10.5px;line-height:1.55;}
  .t1 .hdr{text-align:center;border-bottom:2px solid #333;padding-bottom:12px;margin-bottom:14px;}
  .t1 .nm{font-size:22px;font-weight:700;letter-spacing:2px;text-transform:uppercase;word-break:break-word;}
  .t1 .fn{font-size:10px;color:#666;margin-top:1px;}
  .t1 .ttl{font-size:11.5px;color:#555;margin-top:3px;letter-spacing:1px;}
  .t1 .ct{font-size:9px;color:#666;margin-top:5px;display:flex;flex-wrap:wrap;justify-content:center;gap:4px 10px;word-break:break-word;}
  .t1 .sh{font-weight:700;font-size:10.5px;text-transform:uppercase;letter-spacing:1.5px;border-bottom:1px solid #999;margin:12px 0 7px;padding-bottom:2px;color:${col};}
  .t1 .jo{color:#444;font-style:italic;font-size:9.5px;}
  .t1 .jp{color:#666;font-size:9px;}
  .t1 .jb{padding-left:12px;color:#333;font-size:9.5px;}
  .t2{font-family:'Helvetica Neue',Arial,sans-serif;font-size:10px;}
  .t2 .hdr{padding:22px 30px 18px;color:${hdrTextColor};background:${hdrCol};}
  .t2 .nm{font-size:22px;font-weight:800;color:${hdrTextColor};}
  .t2 .fn{font-size:10px;opacity:.85;margin-top:1px;color:${hdrSubColor};}
  .t2 .ttl{font-size:11.5px;margin-top:3px;color:${hdrSubColor};}
  .t2 .ct{margin-top:7px;font-size:9px;color:${hdrSubColor};display:flex;flex-wrap:wrap;gap:4px 12px;word-break:break-word;}
  .t2 .body{padding:16px 30px;}
  .t2 .sh{font-weight:800;font-size:10px;text-transform:uppercase;letter-spacing:1px;border-bottom:2px solid ${col};color:${col};margin:12px 0 7px;padding-bottom:2px;}
  .t2 .job{margin-bottom:11px;padding-left:10px;border-left:3px solid ${col};}
  .t2 .jrow{display:flex;justify-content:space-between;}
  .t2 .jrl{font-weight:700;font-size:10.5px;}
  .t2 .jp{color:#888;font-size:9px;font-style:italic;}
  .t2 .jco{color:${col};font-weight:600;font-size:9.5px;}
  .t2 .gr{display:grid;grid-template-columns:1fr 1fr;gap:18px;}
  .t2 .tag{background:rgba(0,0,0,.08);color:${col};padding:2px 9px;border-radius:20px;font-size:8.5px;font-weight:600;display:inline-block;margin:2px 2px 2px 0;}
  .t3{font-family:Georgia,serif;color:#222;padding:40px 46px;font-size:10.5px;line-height:1.6;}
  .t3 .hdr{text-align:center;margin-bottom:16px;}
  .t3 .nm{font-size:24px;font-weight:700;letter-spacing:4px;text-transform:uppercase;color:${col};word-break:break-word;}
  .t3 .fn{font-size:10px;color:#7f8c8d;margin-top:2px;}
  .t3 .ttl{font-size:12px;color:#7f8c8d;margin-top:4px;letter-spacing:2px;}
  .t3 .cb{display:block;border-top:1px solid #ccc;border-bottom:1px solid #ccc;padding:5px 10px;margin-top:8px;font-size:9px;color:#666;word-break:break-word;text-align:center;}
  .t3 .sh{font-weight:700;font-size:10.5px;text-transform:uppercase;letter-spacing:2px;color:${col};text-align:center;border-bottom:.5px solid #bdc3c7;margin:14px 0 8px;padding-bottom:3px;}
  .t3 .jh{display:flex;justify-content:space-between;border-bottom:.5px solid #ddd;padding-bottom:2px;}
  .t3 .jo{color:#666;font-size:9.5px;margin-bottom:3px;}
  .t4{font-family:'Helvetica Neue',Arial,sans-serif;color:#111;padding:44px 48px;font-size:10.5px;line-height:1.65;}
  .t4 .nm{font-size:26px;font-weight:900;letter-spacing:-.5px;word-break:break-word;}
  .t4 .fn{font-size:11px;color:#888;margin-top:1px;}
  .t4 .ttl{font-size:13px;color:${col};margin-top:2px;}
  .t4 .ct{margin-top:7px;font-size:9.5px;color:#888;display:flex;gap:4px 14px;flex-wrap:wrap;word-break:break-word;}
  .t4 .sh{font-weight:700;font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:${col};margin:14px 0 5px;border-left:3px solid ${col};padding-left:8px;}
  .t4 .jo{color:#888;font-size:9.5px;}
  .t5{font-family:Arial,sans-serif;font-size:10px;}
  .t5 .hdr{color:${hdrTextColor};padding:18px 24px;background:${hdrCol};}
  .t5 .nm{font-size:21px;font-weight:800;color:${hdrTextColor};}
  .t5 .fn{font-size:9.5px;color:${hdrSubColor};margin-top:1px;}
  .t5 .ttl{font-size:11px;margin-top:3px;opacity:.9;}
  .t5 .ct{margin-top:6px;font-size:9px;opacity:.85;display:flex;flex-wrap:wrap;gap:4px 10px;word-break:break-word;}
  .t5 .body{padding:14px 24px;}
  .t5 .sbox{border-radius:6px;padding:9px 12px;margin-bottom:12px;background:rgba(0,0,0,.04);border:1.5px solid ${col};}
  .t5 .sh{font-weight:800;font-size:10px;text-transform:uppercase;border-bottom:1.5px solid ${col};color:${col};margin:12px 0 6px;padding-bottom:2px;}
  .t5 .tag{color:#fff;background:${col};padding:2px 9px;border-radius:12px;font-size:8.5px;font-weight:600;display:inline-block;margin:2px 2px 2px 0;}
  .t5 .job{margin-bottom:10px;padding-left:9px;border-left:3px solid ${col};}
  .t5 .jrow{display:flex;justify-content:space-between;}
  .t6{font-family:Arial,sans-serif;font-size:10px;display:flex;}
  .t6 .sidebar{width:38%;background:${hdrCol};color:${hdrTextColor};padding:24px 18px;flex-shrink:0;}
  .t6 .maincol{flex:1;padding:24px 20px;background:#fff;}
  .t6 .snm{font-size:20px;font-weight:800;line-height:1.2;margin-bottom:3px;color:${hdrTextColor};}
  .t6 .sttl{font-size:10.5px;opacity:.85;margin-bottom:12px;color:${hdrSubColor};}
  .t6 .sfn{font-size:9.5px;opacity:.8;margin-bottom:10px;color:${hdrSubColor};}
  .t6 .ssh{font-weight:800;font-size:9.5px;text-transform:uppercase;letter-spacing:1px;border-bottom:1.5px solid rgba(255,255,255,.4);margin:13px 0 6px;padding-bottom:3px;color:${hdrTextColor};}
  .t6 .sct{font-size:9px;opacity:.85;margin-bottom:3px;word-break:break-word;color:${hdrSubColor};}
  .t6 .msh{font-weight:800;font-size:10.5px;text-transform:uppercase;color:${col};border-bottom:2px solid ${col};margin:12px 0 7px;padding-bottom:2px;}
  .t6 .sh{font-weight:800;font-size:10.5px;text-transform:uppercase;color:${col};border-bottom:2px solid ${col};margin:12px 0 7px;padding-bottom:2px;}
  .t6 .job{margin-bottom:10px;}
  .t6 .jrow{display:flex;justify-content:space-between;}
  .t6 .jt{font-weight:700;font-size:10.5px;}
  .t6 .jc{color:${col};font-size:9.5px;font-weight:600;}
  .t6 .jd{color:#888;font-size:9px;}
  .t6 .stag{background:rgba(255,255,255,.2);color:#fff;padding:2px 8px;border-radius:10px;font-size:8.5px;display:inline-block;margin:2px 2px 2px 0;}
  .t7{font-family:'Times New Roman',Times,serif;color:#000;padding:30px 40px;font-size:10.5px;line-height:1.6;}
  .t7 .hdr{text-align:center;border:2px solid #000;padding:12px 18px;margin-bottom:14px;}
  .t7 .nm{font-size:20px;font-weight:700;text-transform:uppercase;letter-spacing:3px;}
  .t7 .fn{font-size:10px;color:#333;margin-top:2px;}
  .t7 .ttl{font-size:11px;margin-top:3px;}
  .t7 .ct{font-size:9px;color:#333;margin-top:5px;display:flex;flex-wrap:wrap;justify-content:center;gap:4px 10px;word-break:break-word;}
  .t7 .sh{font-weight:700;font-size:10.5px;text-transform:uppercase;background:#f0f0f0;padding:3px 8px;margin:12px 0 7px;border-left:4px solid #000;}
  .t7 .jo{font-style:italic;color:#333;font-size:9.5px;}
  .t7 .jp{color:#333;font-size:9px;}
  .t8{font-family:Arial,sans-serif;color:#111;padding:32px 36px;font-size:10.5px;line-height:1.55;}
  .t8 .hdr{background:linear-gradient(135deg,${hdrCol},${hdrCol}cc);color:${hdrTextColor};margin:-32px -36px 18px;padding:28px 36px;}
  .t8 .nm{font-size:24px;font-weight:900;letter-spacing:-0.5px;word-break:break-word;color:${hdrTextColor};}
  .t8 .fn{font-size:10px;color:${hdrSubColor};margin-top:2px;}
  .t8 .ttl{font-size:12px;margin-top:4px;opacity:.9;font-style:italic;}
  .t8 .ct{margin-top:10px;font-size:9px;opacity:.85;display:flex;flex-wrap:wrap;gap:4px 12px;word-break:break-word;}
  .t8 .sh{font-weight:800;font-size:10px;text-transform:uppercase;letter-spacing:1px;color:${col};margin:14px 0 7px;display:flex;align-items:center;gap:6px;}
  .t8 .sh::after{content:'';flex:1;height:1px;background:${col};}
  .t8 .job{margin-bottom:11px;padding:8px 12px;border-radius:6px;background:#f8fafc;border-left:3px solid ${col};}
  .t8 .jt{font-weight:700;font-size:10.5px;}
  .t8 .jc{color:${col};font-size:9.5px;font-weight:600;}
  .t8 .jd{color:#888;font-size:9px;}
  .t8 .chip{background:${col}18;color:${col};padding:2px 10px;border-radius:20px;font-size:8.5px;font-weight:700;display:inline-block;margin:2px 2px 2px 0;}
  .t9{font-family:'Courier New',monospace;color:#1a1a1a;padding:32px 38px;font-size:10px;line-height:1.7;}
  .t9 .nm{font-size:20px;font-weight:700;border-bottom:2px solid #1a1a1a;padding-bottom:5px;margin-bottom:3px;word-break:break-word;}
  .t9 .fn{font-size:9.5px;color:#444;margin-top:1px;}
  .t9 .ttl{font-size:10.5px;color:#444;margin-top:2px;}
  .t9 .ct{font-size:9px;color:#666;margin:5px 0 16px;display:flex;flex-wrap:wrap;gap:4px 12px;word-break:break-word;}
  .t9 .sh{font-weight:700;font-size:10px;text-transform:uppercase;letter-spacing:2px;margin:12px 0 5px;color:#1a1a1a;}
  .t9 .jo{color:#444;font-size:9.5px;}
  .t9 .jp{color:#666;font-size:9px;}
  .t10{font-family:'Helvetica Neue',Arial,sans-serif;color:#1e3a5f;}
  .t10 .hdr{background:${hdrCol};color:${hdrTextColor};padding:24px 30px;display:flex;align-items:center;gap:18px;}
  .t10 .nmsec{flex:1;}
  .t10 .nm{font-size:22px;font-weight:800;letter-spacing:-.3px;}
  .t10 .fn{font-size:10px;opacity:.8;margin-top:2px;}
  .t10 .ttl{font-size:11.5px;color:${col};margin-top:4px;font-weight:600;}
  .t10 .ctbar{background:${col};padding:8px 30px;display:flex;flex-wrap:wrap;gap:6px 16px;}
  .t10 .cti{font-size:9px;color:#fff;font-weight:600;word-break:break-word;}
  .t10 .body{padding:18px 30px;}
  .t10 .sh{font-weight:800;font-size:10px;text-transform:uppercase;color:#1e3a5f;border-bottom:2px solid ${col};margin:14px 0 8px;padding-bottom:3px;letter-spacing:.5px;}
  .t10 .job{margin-bottom:12px;padding-left:12px;border-left:3px solid ${col};}
  .t10 .jt{font-weight:700;font-size:10.5px;color:#1e3a5f;}
  .t10 .jc{color:${col};font-size:9.5px;font-weight:600;}
  .t10 .jd{color:#888;font-size:9px;}
  .t10 .gr{display:grid;grid-template-columns:3fr 2fr;gap:20px;}
  .t10 .chip{background:#1e3a5f18;color:#1e3a5f;border:1px solid #1e3a5f33;padding:2px 9px;border-radius:4px;font-size:8.5px;font-weight:600;display:inline-block;margin:2px 2px 2px 0;}
  
  /* ── Page break control */
  .t1 div[style*="margin-bottom:10px"],.t1 div[style*="margin-bottom:7px"]{page-break-inside:avoid;}
  .t2 .job,.t3 div,.t4 div,.t5 .job,.t6 .job,.t7 tr,.t8 .job,.t9 div,.t10 .job{page-break-inside:avoid;}
  .t11 .t11job,.t12 .t12job,.t13 .t13job,.t14 .t14job,.t15 .t15job,.t16 .t16item,.t17 .t17card,.t18 .t18job,.t19 .t19job,.t20 .t20job{page-break-inside:avoid;}
  .t1 .sh,.t2 .sh,.t3 .sh,.t4 .sh,.t5 .sh,.t6 .sh,.t6 .msh,.t7 .sh,.t8 .sh,.t9 .sh,.t10 .sh{page-break-after:avoid;}
  .t11 .sh,.t12 .sh,.t13 .sh,.t14 .sh,.t15 .sh,.t16 .sh,.t17 .sh,.t18 .sh,.t19 .sh,.t20 .sh{page-break-after:avoid;}

  /* ── PREMIUM TEMPLATE CSS ────────────────────────────── */

  /* ══ T11: NOIR ELITE — Black & Gold Split-Band ══════════
     Header: Pure black background, left gold accent bar,
     name in UPPERCASE white, title in accent color.
     Body: Accent-color underlined section headers.         */
  .t11{font-family:'Helvetica Neue',Arial,sans-serif;color:#1a1a1a;font-size:10.5px;line-height:1.6;}
  .t11 .t11hdr{background:${hdrCol};color:${hdrTextColor};display:flex;align-items:stretch;}
  .t11 .t11accentbar{width:7px;background:${col};flex-shrink:0;}
  .t11 .t11hdrcontent{flex:1;padding:26px 32px;}
  .t11 .t11goldline{height:2px;background:linear-gradient(90deg,${col},${col}66,transparent);}
  .t11 .t11nm{font-size:26px;font-weight:900;letter-spacing:2.5px;text-transform:uppercase;color:${hdrTextColor};}
  .t11 .t11ttl{font-size:11px;color:${col};margin-top:5px;letter-spacing:3px;text-transform:uppercase;font-weight:600;}
  .t11 .t11fn{font-size:9.5px;color:${hdrSubColor};margin-top:2px;}
  .t11 .t11ct{margin-top:10px;display:flex;flex-wrap:wrap;gap:4px 20px;font-size:9px;color:${hdrSubColor};}
  .t11 .t11body{padding:18px 32px;}
  .t11 .sh{font-weight:800;font-size:10px;text-transform:uppercase;letter-spacing:2px;color:${col} !important;margin:16px 0 7px;border-bottom:2px solid ${col};padding-bottom:3px;display:block;}
  .t11 .t11job{margin-bottom:12px;padding-left:14px;border-left:3px solid ${col}44;}
  .t11 .t11jt{font-weight:700;font-size:11px;color:#111;}
  .t11 .t11jc{color:${col};font-size:9.5px;font-weight:600;}
  .t11 .t11jd{color:#888;font-size:9px;}
  .t11 .t11chip{background:#111;color:${col};border:1px solid ${col};padding:2px 9px;border-radius:2px;font-size:8.5px;font-weight:700;display:inline-block;margin:2px 3px 2px 0;letter-spacing:.5px;}

  /* ══ T12: PRISM SIDEBAR — Gradient Sidebar ══════════════
     Header: Name & title sit inside the gradient sidebar.
     Body: Clean white main column with accent accents.     */
  .t12{font-family:'Helvetica Neue',Arial,sans-serif;font-size:10px;display:flex;min-height:100%;}
  .t12 .t12side{width:36%;background:linear-gradient(170deg,${hdrCol} 0%,${hdrCol}cc 100%);color:${hdrTextColor};padding:28px 18px;flex-shrink:0;}
  .t12 .t12main{flex:1;padding:28px 22px;background:#fff;}
  .t12 .t12snm{font-size:19px;font-weight:900;line-height:1.2;margin-bottom:3px;word-break:break-word;}
  .t12 .t12sttl{font-size:10px;opacity:.85;margin-bottom:16px;font-style:italic;}
  .t12 .t12sfn{font-size:9px;opacity:.78;margin-bottom:4px;}
  .t12 .t12ssh{font-weight:800;font-size:8.5px;text-transform:uppercase;letter-spacing:1.5px;border-bottom:1px solid rgba(255,255,255,.3);margin:13px 0 6px;padding-bottom:3px;}
  .t12 .t12sct{font-size:8.5px;opacity:.85;margin-bottom:4px;word-break:break-word;}
  .t12 .t12stag{background:rgba(255,255,255,.18);color:#fff;padding:2px 8px;border-radius:10px;font-size:8px;display:inline-block;margin:2px 2px 2px 0;}
  .t12 .sh{font-weight:800;font-size:10.5px;text-transform:uppercase;color:${col} !important;border-left:4px solid ${col};padding-left:9px;margin:14px 0 7px;letter-spacing:.5px;display:block;}
  .t12 .t12job{margin-bottom:11px;padding-bottom:9px;border-bottom:1px dashed #e5e7eb;}
  .t12 .t12jt{font-weight:700;font-size:10.5px;color:#111;}
  .t12 .t12jc{color:${col};font-size:9.5px;font-weight:600;}
  .t12 .t12jd{color:#999;font-size:9px;}

  /* ══ T13: VELOCITY — Angled Cut Header ═════════════════
     Header: Full-bleed accent color, bottom-right triangle
     cut away revealing white body. Dynamic, modern feel.  */
  .t13{font-family:'Helvetica Neue',Arial,sans-serif;color:#111;font-size:10.5px;line-height:1.6;}
  .t13 .t13hdr{background:${hdrCol};padding:0;position:relative;overflow:hidden;}
  .t13 .t13hdr-inner{padding:28px 36px 36px;position:relative;z-index:1;}
  .t13 .t13hdr::after{content:'';position:absolute;bottom:-1px;right:-1px;width:0;height:0;border-style:solid;border-width:0 0 56px 200px;border-color:transparent transparent #fff transparent;}
  .t13 .t13nm{font-size:26px;font-weight:900;color:${hdrTextColor};letter-spacing:-0.5px;text-transform:uppercase;}
  .t13 .t13ttl{font-size:11.5px;color:${hdrSubColor};margin-top:4px;font-weight:600;letter-spacing:1px;}
  .t13 .t13fn{font-size:9.5px;color:${hdrSubColor};margin-top:2px;}
  .t13 .t13ct{margin-top:10px;display:flex;flex-wrap:wrap;gap:5px 18px;font-size:9px;color:${hdrSubColor};}
  .t13 .t13body{padding:18px 36px;}
  .t13 .sh{font-weight:800;font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:${col} !important;border-left:4px solid ${col};padding:4px 10px;background:${col}0d;margin:14px 0 8px;display:block;}
  .t13 .t13job{margin-bottom:12px;background:#f8fafc;border-radius:6px;padding:9px 12px;border-top:3px solid ${col};}
  .t13 .t13jt{font-weight:700;font-size:11px;}
  .t13 .t13jc{color:${col};font-size:9.5px;font-weight:600;}
  .t13 .t13jd{color:#888;font-size:9px;}
  .t13 .t13chip{background:${col}18;color:${col};padding:2px 10px;border-radius:3px;font-size:8.5px;font-weight:700;display:inline-block;margin:2px 3px 2px 0;}

  /* ══ T14: PRESTIGE FINANCE — Double-Rule Header ══════════
     Header: Clean white with serif font, double-rule line
     below. Two-column body for structured layout.          */
  .t14{font-family:Georgia,serif;color:#0d1b2a;font-size:10.5px;line-height:1.6;}
  .t14 .t14hdr{padding:28px 36px 16px;border-bottom:3px double ${col};}
  .t14 .t14nm{font-size:24px;font-weight:700;color:#0d1b2a;letter-spacing:1px;}
  .t14 .t14ttl{font-size:11.5px;color:${col};margin-top:3px;font-style:italic;letter-spacing:1px;}
  .t14 .t14fn{font-size:9.5px;color:#666;margin-top:1px;}
  .t14 .t14ct{margin-top:7px;display:flex;flex-wrap:wrap;gap:4px 16px;font-size:9px;color:#555;}
  .t14 .t14body{padding:14px 36px;display:grid;grid-template-columns:3fr 2fr;gap:0 28px;}
  .t14 .sh{font-weight:700;font-size:10px;text-transform:uppercase;letter-spacing:2px;color:${col} !important;border-bottom:1px solid ${col};margin:14px 0 7px;padding-bottom:2px;display:block;}
  .t14 .t14job{margin-bottom:11px;}
  .t14 .t14jt{font-weight:700;font-size:10.5px;}
  .t14 .t14jc{color:${col};font-size:9.5px;font-style:italic;}
  .t14 .t14jd{color:#888;font-size:9px;}
  .t14 .t14tag{background:${col}14;color:${col};border:1px solid ${col}55;padding:2px 8px;border-radius:3px;font-size:8.5px;font-weight:600;display:inline-block;margin:2px 2px 2px 0;}

  /* ══ T15: GLASS HORIZON — Gradient Banner + Contact Strip ═
     Header: Full-bleed gradient, then a separate colored
     contact strip. Dash-prefixed floating section headers.  */
  .t15{font-family:'Helvetica Neue',Arial,sans-serif;color:#111;font-size:10.5px;line-height:1.6;}
  .t15 .t15hdr{background:linear-gradient(130deg,${hdrCol} 0%,${hdrCol}bb 50%,#0d1b2a 100%);padding:30px 38px 24px;color:${hdrTextColor};}
  .t15 .t15strip{background:#0d1b2a;padding:7px 38px;display:flex;flex-wrap:wrap;gap:5px 22px;}
  .t15 .t15cti{font-size:9px;color:rgba(255,255,255,.8);font-weight:500;}
  .t15 .t15nm{font-size:26px;font-weight:900;letter-spacing:-0.5px;color:${hdrTextColor};}
  .t15 .t15ttl{font-size:12px;opacity:.9;margin-top:4px;font-weight:600;letter-spacing:1px;color:${hdrSubColor};}
  .t15 .t15fn{font-size:9.5px;opacity:.65;margin-top:2px;color:${hdrSubColor};}
  .t15 .t15body{padding:18px 38px;}
  .t15 .sh{font-weight:800;font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:${col} !important;margin:14px 0 7px;display:flex;align-items:center;gap:8px;}
  .t15 .sh::before{content:'';width:22px;height:3px;background:${col};flex-shrink:0;border-radius:2px;}
  .t15 .t15job{margin-bottom:12px;padding:9px 12px;border-radius:8px;background:#f8fafc;border-left:4px solid ${col};}
  .t15 .t15jt{font-weight:700;font-size:11px;}
  .t15 .t15jc{color:${col};font-size:9.5px;font-weight:600;}
  .t15 .t15jd{color:#888;font-size:9px;}
  .t15 .t15chip{background:${col};color:#fff;padding:2px 10px;border-radius:20px;font-size:8.5px;font-weight:700;display:inline-block;margin:2px 3px 2px 0;}

  /* ══ T16: TIMELINE PRO — Left-Edge Dot Timeline ══════════
     Header: White header, name in accent, thick bottom rule.
     Body: Two-column, left column has a dot-timeline.       */
  .t16{font-family:'Helvetica Neue',Arial,sans-serif;color:#111;font-size:10.5px;line-height:1.6;}
  .t16 .t16hdr{background:#fff;padding:28px 38px 18px;border-bottom:4px solid ${col};position:relative;}
  .t16 .t16hdr::after{content:'';position:absolute;bottom:-8px;left:38px;width:40px;height:4px;background:${col}44;}
  .t16 .t16nm{font-size:26px;font-weight:900;color:${col};}
  .t16 .t16ttl{font-size:12px;color:#333;margin-top:3px;font-weight:600;}
  .t16 .t16fn{font-size:9.5px;color:#888;margin-top:1px;}
  .t16 .t16ct{margin-top:8px;display:flex;flex-wrap:wrap;gap:4px 18px;font-size:9px;color:#666;}
  .t16 .t16body{padding:18px 38px;display:grid;grid-template-columns:2fr 1fr;gap:0 30px;}
  .t16 .sh{font-weight:800;font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:${col} !important;margin:14px 0 8px;border-bottom:2px solid ${col};padding-bottom:2px;display:block;}
  .t16 .t16tl{padding-left:20px;border-left:2px solid ${col};position:relative;}
  .t16 .t16item{margin-bottom:12px;position:relative;}
  .t16 .t16item::before{content:'';position:absolute;left:-24px;top:5px;width:8px;height:8px;border-radius:50%;background:${col};border:2px solid #fff;outline:2px solid ${col};}
  .t16 .t16jt{font-weight:700;font-size:10.5px;}
  .t16 .t16jc{color:${col};font-size:9.5px;font-weight:600;}
  .t16 .t16jd{color:#888;font-size:9px;}
  .t16 .t16tag{background:${col}18;color:${col};padding:2px 8px;border-radius:3px;font-size:8px;font-weight:600;display:inline-block;margin:2px 2px 2px 0;}

  /* ══ T17: METRO CARDS — Top-Stripe, Card Sections ══════
     Header: White bg, thick top color stripe, large name.
     Body: Each job rendered as a flat card.                */
  .t17{font-family:'Helvetica Neue',Arial,sans-serif;color:#111;font-size:10.5px;line-height:1.6;}
  .t17 .t17hdr{background:#fff;padding:24px 34px 14px;border-top:6px solid ${col};}
  .t17 .t17toprow{display:flex;align-items:flex-start;justify-content:space-between;gap:16px;}
  .t17 .t17nmsec{flex:1;}
  .t17 .t17nm{font-size:26px;font-weight:900;color:#111;letter-spacing:-0.5px;}
  .t17 .t17ttl{font-size:12px;color:${col};margin-top:3px;font-weight:700;}
  .t17 .t17fn{font-size:9.5px;color:#888;margin-top:1px;}
  .t17 .t17ct{margin-top:9px;display:flex;flex-wrap:wrap;gap:5px 16px;font-size:9px;color:#666;}
  .t17 .t17body{padding:14px 34px;}
  .t17 .sh{font-weight:900;font-size:10px;text-transform:uppercase;letter-spacing:2px;color:${col} !important;border-bottom:3px solid ${col};margin:14px 0 8px;padding-bottom:4px;display:block;}
  .t17 .t17card{background:#f8fafc;border-radius:8px;padding:10px 14px;margin-bottom:9px;border:1px solid #e8ecf0;border-left:4px solid ${col};}
  .t17 .t17jt{font-weight:700;font-size:11px;color:#111;}
  .t17 .t17jc{color:${col};font-size:9.5px;font-weight:600;}
  .t17 .t17jd{color:#888;font-size:9px;}
  .t17 .t17chip{background:${col};color:#fff;padding:2px 9px;border-radius:20px;font-size:8.5px;font-weight:700;display:inline-block;margin:2px 3px 2px 0;}
  .t17 .t17grid{display:grid;grid-template-columns:3fr 2fr;gap:0 24px;}

  /* ══ T18: ZEN MINIMAL — Date-Left Ultra-Clean ══════════
     Header: Minimal white, ultra-light name, no borders.
     Body: Dates left column, content right. Airy spacing.  */
  .t18{font-family:'Helvetica Neue',Arial,sans-serif;color:#1a1a1a;font-size:10.5px;line-height:1.7;padding:44px 52px;}
  .t18 .t18nm{font-size:28px;font-weight:300;letter-spacing:6px;text-transform:uppercase;color:#1a1a1a;border-bottom:1px solid #ddd;padding-bottom:10px;margin-bottom:4px;}
  .t18 .t18ttl{font-size:11px;color:${col};letter-spacing:3px;text-transform:uppercase;font-weight:400;margin-bottom:2px;}
  .t18 .t18fn{font-size:9.5px;color:#aaa;margin-bottom:8px;}
  .t18 .t18ct{display:flex;flex-wrap:wrap;gap:4px 20px;font-size:9px;color:#888;margin-bottom:20px;}
  .t18 .sh{font-weight:400;font-size:9px;text-transform:uppercase;letter-spacing:4px;color:${col} !important;margin:20px 0 8px;border-bottom:1px solid ${col}33;padding-bottom:4px;display:block;}
  .t18 .sh::after{content:'';display:block;width:28px;height:2px;background:${col};margin-top:3px;}
  .t18 .t18job{margin-bottom:14px;display:grid;grid-template-columns:100px 1fr;gap:0 16px;}
  .t18 .t18dates{color:#aaa;font-size:9px;line-height:1.5;text-align:right;padding-top:1px;}
  .t18 .t18jt{font-weight:600;font-size:10.5px;color:#1a1a1a;}
  .t18 .t18jc{color:${col};font-size:9.5px;}
  .t18 .t18tag{font-size:9px;color:#888;display:inline-block;margin-right:12px;}

  /* ══ T19: DUBAI GOLD — Dark Royal Header ════════════════
     Header: Deep brown-black with gold gradient rule below.
     Name in gold, ultra-premium serif feel.                */
  .t19{font-family:Georgia,serif;color:#1a1206;font-size:10.5px;line-height:1.6;}
  .t19 .t19hdr{background:${hdrCol};padding:30px 38px 28px;color:${hdrTextColor};position:relative;}
  .t19 .t19hdr::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent 5%,${col} 30%,${col} 70%,transparent 95%);}
  .t19 .t19nm{font-size:26px;font-weight:700;color:${col};letter-spacing:2px;text-transform:uppercase;}
  .t19 .t19ttl{font-size:11.5px;color:${hdrSubColor};margin-top:5px;letter-spacing:2px;font-style:italic;}
  .t19 .t19fn{font-size:9.5px;color:${hdrSubColor};margin-top:2px;}
  .t19 .t19ct{margin-top:10px;display:flex;flex-wrap:wrap;gap:6px 20px;font-size:9px;color:${hdrSubColor};}
  .t19 .t19body{padding:20px 38px;}
  .t19 .sh{font-weight:700;font-size:10px;text-transform:uppercase;letter-spacing:2.5px;color:${col} !important;border-bottom:1px solid ${col};margin:16px 0 8px;padding-bottom:3px;display:block;}
  .t19 .t19job{margin-bottom:12px;padding-left:12px;border-left:2px solid ${col}55;}
  .t19 .t19jt{font-weight:700;font-size:11px;color:#1a1206;}
  .t19 .t19jc{color:${col};font-size:9.5px;font-style:italic;}
  .t19 .t19jd{color:#888;font-size:9px;}
  .t19 .t19tag{background:${col}18;color:${col};border:1px solid ${col}66;padding:2px 9px;border-radius:2px;font-size:8.5px;font-weight:600;display:inline-block;margin:2px 3px 2px 0;}

  /* ══ T20: NEXUS TECH — Dark Panel Sidebar ══════════════
     Header: Dark #1E293B sidebar with name & skill bars.
     Body: Clean white with bold colored section dividers.  */
  .t20{font-family:'Helvetica Neue',Arial,sans-serif;font-size:10px;display:flex;min-height:100%;}
  .t20 .t20side{width:34%;background:${hdrCol};color:${hdrTextColor};padding:26px 16px;flex-shrink:0;}
  .t20 .t20main{flex:1;padding:24px 22px;background:#fff;}
  .t20 .t20snm{font-size:18px;font-weight:900;line-height:1.2;margin-bottom:2px;word-break:break-word;color:${hdrTextColor};}
  .t20 .t20sttl{font-size:9px;color:${col};margin-bottom:12px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;}
  .t20 .t20sfn{font-size:8.5px;color:${hdrSubColor};margin-bottom:3px;}
  .t20 .t20ssh{font-weight:800;font-size:8px;text-transform:uppercase;letter-spacing:1.5px;color:${col};margin:13px 0 5px;border-bottom:1px solid rgba(255,255,255,.12);padding-bottom:3px;}
  .t20 .t20sct{font-size:8.5px;color:${hdrSubColor};margin-bottom:4px;word-break:break-word;}
  .t20 .t20bar-wrap{margin-bottom:6px;}
  .t20 .t20bar-label{font-size:8px;color:${hdrSubColor};margin-bottom:2px;}
  .t20 .t20bar-track{background:rgba(255,255,255,.12);border-radius:10px;height:4px;overflow:hidden;}
  .t20 .t20bar-fill{height:4px;border-radius:10px;background:${col};}
  .t20 .t20stag{background:rgba(255,255,255,.1);color:${hdrTextColor};padding:2px 7px;border-radius:3px;font-size:8px;display:inline-block;margin:2px 2px 2px 0;}
  .t20 .sh{font-weight:800;font-size:10.5px;text-transform:uppercase;color:#1E293B !important;border-bottom:2px solid ${col};margin:14px 0 8px;padding-bottom:2px;letter-spacing:.5px;display:block;}
  .t20 .t20job{margin-bottom:11px;padding-bottom:9px;border-bottom:1px solid #f1f5f9;}
  .t20 .t20jt{font-weight:700;font-size:10.5px;color:#1E293B;}
  .t20 .t20jc{color:${col};font-size:9.5px;font-weight:600;}
  .t20 .t20jd{color:#888;font-size:9px;}

  /* ══ FONT FAMILY OVERRIDE — all 20 templates ══ */
  ${(()=>{
    const ff = (typeof currentFontFamily!=='undefined' && currentFontFamily && currentFontFamily!=='default') ? (FONT_FAMILY_MAP[currentFontFamily]||{}).css : null;
    return ff ? `.t1,.t2,.t3,.t4,.t5,.t6,.t7,.t8,.t9,.t10,.t11,.t12,.t13,.t14,.t15,.t16,.t17,.t18,.t19,.t20,.t1 *,.t2 *,.t3 *,.t4 *,.t5 *,.t6 *,.t7 *,.t8 *,.t9 *,.t10 *,.t11 *,.t12 *,.t13 *,.t14 *,.t15 *,.t16 *,.t17 *,.t18 *,.t19 *,.t20 *{font-family:${ff}!important;}` : '';
  })()}

  /* ══ LEVEL 1: NAME ══ */
  .t1 .nm,.t2 .nm,.t3 .nm,.t4 .nm,.t5 .nm,.t7 .nm,.t8 .nm,.t9 .nm,.t10 .nm{font-size:${typeof currentNameSize!=='undefined'?currentNameSize:24}px!important;}
  .t6 .snm{font-size:${typeof currentNameSize!=='undefined'?currentNameSize:24}px!important;}
  .t11 .t11nm,.t13 .t13nm,.t14 .t14nm,.t15 .t15nm,.t16 .t16nm,.t17 .t17nm,.t18 .t18nm,.t19 .t19nm{font-size:${typeof currentNameSize!=='undefined'?currentNameSize:24}px!important;}
  .t12 .t12snm,.t20 .t20snm{font-size:${typeof currentNameSize!=='undefined'?currentNameSize:24}px!important;}

  /* ══ LEVEL 2: TOP TITLE ══ */
  .t1 .ttl,.t2 .ttl,.t3 .ttl,.t4 .ttl,.t5 .ttl,.t7 .ttl,.t8 .ttl,.t9 .ttl,.t10 .ttl{font-size:${typeof currentTopTitleSize!=='undefined'?currentTopTitleSize:14}px!important;}
  .t6 .sttl{font-size:${typeof currentTopTitleSize!=='undefined'?currentTopTitleSize:14}px!important;}
  .t11 .t11ttl,.t13 .t13ttl,.t14 .t14ttl,.t15 .t15ttl,.t16 .t16ttl,.t17 .t17ttl,.t18 .t18ttl,.t19 .t19ttl{font-size:${typeof currentTopTitleSize!=='undefined'?currentTopTitleSize:14}px!important;}
  .t12 .t12sttl,.t20 .t20sttl{font-size:${typeof currentTopTitleSize!=='undefined'?currentTopTitleSize:14}px!important;}

  /* ══ LEVEL 3: SECTION HEADERS ══ */
  .t1 .sh,.t2 .sh,.t3 .sh,.t4 .sh,.t5 .sh,.t6 .sh,.t7 .sh,.t8 .sh,.t9 .sh,.t10 .sh{font-size:${typeof currentSectionHeaderSize!=='undefined'?currentSectionHeaderSize:13}px!important;}
  .t6 .msh,.t6 .ssh{font-size:${typeof currentSectionHeaderSize!=='undefined'?currentSectionHeaderSize:13}px!important;}
  .t11 .sh,.t12 .sh,.t13 .sh,.t14 .sh,.t15 .sh,.t16 .sh,.t17 .sh,.t18 .sh,.t19 .sh,.t20 .sh{font-size:${typeof currentSectionHeaderSize!=='undefined'?currentSectionHeaderSize:13}px!important;}

  /* ══ LEVEL 4: SUB-HEADERS ══ */
  .cvjt,.t2 .jrl,.t6 .jt,.t8 .jt,.t10 .jt{font-size:${typeof currentSubHeaderSize!=='undefined'?currentSubHeaderSize:13}px!important;font-weight:700;}
  .t11 .t11jt,.t12 .t12jt,.t13 .t13jt,.t14 .t14jt,.t15 .t15jt,.t16 .t16jt,.t17 .t17jt,.t18 .t18jt,.t19 .t19jt,.t20 .t20jt{font-size:${typeof currentSubHeaderSize!=='undefined'?currentSubHeaderSize:13}px!important;font-weight:700;}

  /* ══ LEVEL 5: BODY / BULLET TEXT ══ */
  .cvblt,.t1 .jb,.t1 .jo{font-size:${typeof currentFontSize!=='undefined'?currentFontSize:10}px!important;}

  /* ══ SECTION LINES OVERRIDE — applies barStyle to all 20 templates ══
     Rules:
     1. Strip ONLY border-bottom (never border-left — that's a design element in T4/T7/T12/T13)
     2. Inject the chosen line style via ::after pseudo-element
     3. Sidebar headers (T6 .ssh, T12 .t12ssh, T20 .t20ssh) get a white-tinted version
     4. T15 uses flex + ::before for its accent bar — reset to block so ::after works
     5. T18 already has a ::after — override it fully
  ══════════════════════════════════════════════════════════════════════ */

  /* Step 1 — strip only border-bottom, keep position:relative */
  .t1 .sh,.t2 .sh,.t3 .sh,.t4 .sh,.t5 .sh,.t6 .sh,.t6 .msh,.t7 .sh,.t8 .sh,.t9 .sh,.t10 .sh,
  .t11 .sh,.t12 .sh,.t13 .sh,.t14 .sh,.t15 .sh,.t16 .sh,.t17 .sh,.t18 .sh,.t19 .sh,.t20 .sh{
    border-bottom:none!important;
    padding-bottom:4px!important;
    position:relative!important;
  }

  /* Step 2 — inject chosen line via ::after on all main body headers */
  .t1 .sh::after,.t2 .sh::after,.t3 .sh::after,.t4 .sh::after,.t5 .sh::after,
  .t6 .sh::after,.t6 .msh::after,.t7 .sh::after,.t8 .sh::after,.t9 .sh::after,.t10 .sh::after,
  .t11 .sh::after,.t12 .sh::after,.t13 .sh::after,.t14 .sh::after,
  .t16 .sh::after,.t17 .sh::after,.t19 .sh::after,.t20 .sh::after{
    content:'';
    display:block;
    position:absolute;
    bottom:0;
    left:0;
    right:0;
    ${barCSS(col)}
  }

  /* Step 3 — T15: uses flex+::before; switch to block and use ::after only */
  .t15 .sh{display:block!important;}
  .t15 .sh::before{display:none!important;}
  .t15 .sh::after{
    content:'';
    display:block;
    position:absolute;
    bottom:0;
    left:0;
    right:0;
    ${barCSS(col)}
  }

  /* Step 4 — T18: overwrite its existing ::after completely */
  .t18 .sh::after{
    content:''!important;
    display:block!important;
    position:absolute!important;
    bottom:0!important;
    left:0!important;
    right:0!important;
    width:auto!important;
    margin-top:0!important;
    ${barCSS(col)}
  }

  /* Step 5 — Sidebar section headers: T6 .ssh, T12 .t12ssh, T20 .t20ssh
     These live on coloured/dark backgrounds so use a white-tinted line */
  .t6 .ssh, .t12 .t12ssh, .t20 .t20ssh{
    border-bottom:none!important;
    padding-bottom:3px!important;
    position:relative!important;
  }
  .t6 .ssh::after, .t12 .t12ssh::after, .t20 .t20ssh::after{
    content:'';
    display:block;
    position:absolute;
    bottom:0;
    left:0;
    right:0;
    ${barCSS('rgba(255,255,255,0.45)')}
  }
`;
}

// ─── TEMPLATE 1: CLASSIC ────────────────────────────────
function buildT1(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const pad = spacing==='spacious'?'42px 46px':spacing==='compact'?'28px 34px':'36px 40px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Professional Summary</div><p style="margin:0 0 10px;color:#333;text-align:justify;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Work Experience</div>${validJ.map(j=>`
      <div style="margin-bottom:10px;">
        <div style="display:flex;justify-content:space-between;"><strong style="font-size:${subSz}px;">${s(j.title)}</strong><span style="color:#666;font-size:${xs}px;">${s(j.start)}${j.start?' — ':''}${j.current?'Present':s(j.end)}</span></div>
        <div style="color:#444;font-style:italic;font-size:${sm}px;">${s(j.company)}${j.location?`, ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:12px;color:#333;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
      <div style="display:flex;justify-content:space-between;margin-bottom:7px;">
        <div><strong style="font-size:${subSz}px;">${s(e.degree)}</strong><div style="color:#444;font-style:italic;font-size:${sm}px;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div></div>
        <div style="text-align:right;color:#666;font-size:${xs}px;">${s(e.endYear||e.startYear)}${e.grade?`<br/>Grade: ${s(e.grade)}`:''}</div>
      </div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Skills</div><div style="display:flex;flex-wrap:wrap;gap:4px;">${validS.map(sk=>`<span style="font-size:${sm}px;margin-right:10px;">• ${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;">• <strong>${s(c.name)}</strong>${c.issuedBy?` — ${s(c.issuedBy)}`:''} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t1" style="padding:${pad};font-size:${fs}px;">
    <div class="hdr">
      ${ph?`<img src="${data.photo}" style="width:70px;height:70px;border-radius:50%;object-fit:cover;float:right;margin:0 0 8px 12px;"/>`:''}
      <div class="nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
      ${showFather&&d.father?`<div class="fn" style="font-size:${sm}px;color:#666;">S/O: ${s(d.father)}</div>`:''}
      <div class="ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
      <div class="ct" style="font-size:${xs}px;display:flex;flex-wrap:wrap;align-items:center;gap:4px 2px;margin-top:6px;">${d.phone?`<span style=\"display:inline-flex;align-items:center;margin-right:12px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"13\" height=\"13\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;margin-right:12px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"13\" height=\"13\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</span>`:''}${d.location?`<span style=\"display:inline-flex;align-items:center;margin-right:12px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"13\" height=\"13\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;margin-right:12px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"13\" height=\"13\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</span>`:''}</div>
    </div>
    ${renderSections(secOrder, sections)}
  </div>`;
}

// ─── TEMPLATE 2: MODERN BLUE ────────────────────────────
function buildT2(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const padBody = spacing==='compact'?'14px 26px':spacing==='spacious'?'22px 34px':'16px 30px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Summary</div><p style="margin:0 0 10px;color:#333;line-height:1.5;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Work Experience</div>${validJ.map(j=>`
        <div class="job">
          <div class="jrow"><span style="font-weight:700;font-size:${subSz}px;">${s(j.title)}</span><span style="color:#888;font-size:${xs}px;font-style:italic;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
          <div style="color:${col};font-weight:600;font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
          ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:10px;color:#555;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
        </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
            <div style="margin-bottom:9px;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong>
            <div style="color:#888;font-size:${sm}px;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''} · ${s(e.endYear||e.startYear)}${e.grade?` · ${s(e.grade)}`:''}</div></div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Skills</div>${validS.map(sk=>`<span class="tag" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}`:'',
    certs: validC.length?`<div class="sh" style="margin-top:10px;font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;margin-bottom:3px;">• <strong>${s(c.name)}</strong>${c.year?` (${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t2" style="font-size:${fs}px;">
    <div class="hdr" style="background:${col};display:flex;align-items:flex-start;gap:16px;">
      ${ph?`<img src="${data.photo}" style="width:75px;height:75px;border-radius:50%;object-fit:cover;border:3px solid rgba(255,255,255,.4);flex-shrink:0;"/>`:''}
      <div>
        <div class="nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
        ${showFather&&d.father?`<div class="fn" style="font-size:${sm}px;opacity:.85;">S/O: ${s(d.father)}</div>`:''}
        <div class="ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
        <div class="ct" style="font-size:${xs}px;">
          ${d.phone?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.18);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.18);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</span>`:''}
          ${d.location?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.18);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.18);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</span>`:''}
        </div>
      </div>
    </div>
    <div class="body" style="padding:${padBody};">
      ${renderSections(secOrder, sections)}
    </div>
  </div>`;
}

// ─── TEMPLATE 3: EXECUTIVE ──────────────────────────────
function buildT3(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const pad = spacing==='spacious'?'46px 52px':spacing==='compact'?'32px 38px':'40px 46px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Profile</div><p style="text-align:center;color:#555;margin:0 0 14px;line-height:1.6;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Professional Experience</div>${validJ.map(j=>`
      <div style="margin-bottom:12px;">
        <div class="jh"><strong style="font-size:${subSz}px;">${s(j.title)}</strong><span style="color:#aaa;font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
        <div style="color:#666;font-size:${sm}px;font-style:italic;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:14px;color:#444;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
      <div style="text-align:center;margin-bottom:8px;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong>
      <div style="color:#888;font-size:${sm}px;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''} · ${s(e.endYear||e.startYear)}</div></div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Core Skills</div><div style="text-align:center;">${validS.map(sk=>`<span style="display:inline-block;margin:2px 6px;font-size:${sm}px;color:#555;">◈ ${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">Certifications</div><div style="text-align:center;">${validC.map(c=>`<div style="font-size:${sm}px;color:#555;"> ${s(c.name)}${c.issuedBy?` — ${s(c.issuedBy)}`:''} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}</div>`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t3" style="padding:${pad};font-size:${fs}px;">
    <div class="hdr">
      ${ph?`<img src="${data.photo}" style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:2px solid ${col};display:block;margin:0 auto 8px;"/>`:''}
      <div class="nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
      ${showFather&&d.father?`<div class="fn" style="font-size:${sm}px;color:#7f8c8d;">S/O: ${s(d.father)}</div>`:''}
      <div class="ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
      <div class="cb" style="font-size:${xs}px;display:flex;flex-wrap:wrap;justify-content:center;align-items:center;gap:2px 4px;margin-top:5px;">${d.phone?`<span style=\"display:inline-flex;align-items:center;gap:5px;margin:0 10px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;background:${col};flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg></span>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;gap:5px;margin:0 10px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;background:${col};flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg></span>${s(d.email)}</span>`:''}${d.location?`<span style=\"display:inline-flex;align-items:center;gap:5px;margin:0 10px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;background:${col};flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg></span>${s(d.location)}</span>`:''}</div>
    </div>
    ${renderSections(secOrder, sections)}
  </div>`;
}

// ─── TEMPLATE 4: MINIMAL ────────────────────────────────
function buildT4(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const pad = spacing==='spacious'?'50px 54px':spacing==='compact'?'30px 36px':'44px 48px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Summary</div><p style="margin:0 0 16px;color:#444;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Experience</div>${validJ.map(j=>`
      <div style="margin-bottom:14px;">
        <div style="display:flex;justify-content:space-between;"><strong style="font-size:${subSz}px;">${s(j.title)}</strong><span style="color:#aaa;font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
        <div style="color:#888;font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:12px;color:#555;font-size:${fs}px;">– ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
          <div style="margin-bottom:10px;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong>
          <div style="color:#888;font-size:${sm}px;">${s(e.institution)} · ${s(e.endYear||e.startYear)}</div></div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Skills</div>${validS.map(sk=>`<div style="color:#555;font-size:${sm}px;">· ${s(sk.name)}</div>`).join('')}`:'',
    certs: validC.length?`<div class="sh" style="margin-top:10px;font-size:${shSz}px;">Certs</div>${validC.map(c=>`<div style="font-size:${sm}px;color:#555;">· ${s(c.name)} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t4" style="padding:${pad};font-size:${fs}px;">
    <div style="border-bottom:3px solid ${col};padding-bottom:14px;margin-bottom:18px;">
      ${ph?`<img src="${data.photo}" style="width:68px;height:68px;border-radius:8px;object-fit:cover;float:right;margin:0 0 6px 14px;"/>`:''}
      <div class="nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
      ${showFather&&d.father?`<div class="fn" style="font-size:${sm}px;color:#888;">S/O: ${s(d.father)}</div>`:''}
      <div class="ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
      <div class="ct" style="font-size:${xs}px;display:flex;flex-wrap:wrap;align-items:center;gap:4px 2px;margin-top:5px;">${d.phone?`<span style=\"display:inline-flex;align-items:center;margin-right:12px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"13\" height=\"13\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;margin-right:12px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"13\" height=\"13\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</span>`:''}${d.location?`<span style=\"display:inline-flex;align-items:center;margin-right:12px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"13\" height=\"13\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;margin-right:12px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"13\" height=\"13\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</span>`:''}</div>
    </div>
    ${renderSections(secOrder, sections)}
  </div>`;
}

// ─── TEMPLATE 5: SKILLED WORKER ─────────────────────────
function buildT5(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const padBody = spacing==='compact'?'12px 20px':'14px 24px';
  const secOrder = sectionOrder || ['skills','summary','experience','education','certs','personal','declaration'];
  const sections = {
    skills: validS.length?`<div class="sh" style="color:${col};font-size:${shSz}px;">Key Skills</div><div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:12px;">${validS.map(sk=>`<span class="tag" style="background:${col};font-size:${xs}px;">${s(sk.name)}</span>`).join('')}</div>`:'',
    summary: d.summary?`<div class="sh" style="color:${col};border-bottom-color:${col};font-size:${shSz}px;">About Me</div><p style="margin:0 0 10px;color:#333;line-height:1.5;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="color:${col};border-bottom-color:${col};font-size:${shSz}px;">Work Experience</div>${validJ.map(j=>`
        <div class="job" style="border-left-color:${col};">
          <div class="jrow"><strong style="font-size:${subSz}px;">${s(j.title)}</strong><span style="color:#888;font-size:${xs}px;">${s(j.start)}${j.start?' — ':''}${j.current?'Present':s(j.end)}</span></div>
          <div style="font-weight:700;font-size:${sm}px;color:${col};">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
          ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:10px;color:#444;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
        </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="color:${col};border-bottom-color:${col};font-size:${shSz}px;">Education</div>${validE.map(e=>`
        <div style="margin-bottom:6px;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong>
        <div style="color:#666;font-size:${sm}px;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''} ${e.endYear?`· ${s(e.endYear)}`:''}${e.grade?` · ${s(e.grade)}`:''}</div></div>`).join('')}`:'',
    certs: validC.length?`<div class="sh" style="color:${col};border-bottom-color:${col};font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;">▸ <strong>${s(c.name)}</strong>${c.issuedBy?` — ${s(c.issuedBy)}`:''} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t5" style="font-size:${fs}px;">
    <div class="hdr" style="background:${col};display:flex;align-items:center;gap:14px;">
      ${ph?`<img src="${data.photo}" style="width:65px;height:65px;border-radius:50%;object-fit:cover;border:3px solid rgba(255,255,255,.4);flex-shrink:0;"/>`:''}
      <div>
        <div class="nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
        ${showFather&&d.father?`<div class="fn" style="font-size:${sm}px;opacity:.85;">S/O: ${s(d.father)}</div>`:''}
        <div class="ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
        <div class="ct" style="font-size:${xs}px;">
          ${d.phone?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:3px;background:${col};flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"10\" height=\"10\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg></span>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:3px;background:${col};flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"10\" height=\"10\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg></span>${s(d.email)}</span>`:''}
          ${d.location?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:3px;background:${col};flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"10\" height=\"10\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg></span>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:3px;background:${col};flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"10\" height=\"10\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg></span>${s(d.linkedin)}</span>`:''}
        </div>
      </div>
    </div>
    <div class="body" style="padding:${padBody};">
      ${renderSections(secOrder, sections)}
    </div>
  </div>`;
}

// ─── TEMPLATE 6: TWO-COLUMN SIDEBAR ─────────────────────
function buildT6(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','personal','declaration'];
  const mainSections = {
    summary: d.summary?`<div class="msh" style="color:${col};border-bottom-color:${col};font-size:${shSz}px;">Summary</div><p style="color:#444;line-height:1.6;margin-bottom:12px;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="msh" style="color:${col};border-bottom-color:${col};font-size:${shSz}px;">Experience</div>${validJ.map(j=>`
        <div class="job">
          <div class="jrow"><span style="font-weight:700;font-size:${subSz}px;">${s(j.title)}</span><span style="color:#888;font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
          <div style="color:${col};font-size:${sm}px;font-weight:600;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
          ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:10px;color:#444;margin-top:2px;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
        </div>`).join('')}`:'',
    education: validE.length?`<div class="msh" style="color:${col};border-bottom-color:${col};font-size:${shSz}px;">Education</div>${validE.map(e=>`
        <div style="margin-bottom:10px;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong>
        <div style="color:${col};font-size:${sm}px;font-weight:600;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
        <div style="color:#888;font-size:${xs}px;">${s(e.endYear||e.startYear)}${e.grade?` · ${s(e.grade)}`:''}</div></div>`).join('')}`:'',
    personal: '',
    declaration: buildDeclaration(data,'msh',d.name,col,fs,shSz),
  };
  Object.assign(mainSections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t6" style="font-size:${fs}px;">
    <div class="sidebar" style="background:${col};">
      ${ph?`<img src="${data.photo}" style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid rgba(255,255,255,.3);display:block;margin:0 auto 12px;"/>`:''}
      <div class="snm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
      ${showFather&&d.father?`<div class="sfn" style="font-size:${sm}px;opacity:.8;">S/O: ${s(d.father)}</div>`:''}
      <div class="sttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
      <div class="ssh" style="font-size:${shSz}px;">Contact</div>
      ${d.phone?`<div class=\"sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</div>`:''}
      ${d.email?`<div class=\"sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</div>`:''}
      ${d.location?`<div class=\"sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</div>`:''}
      ${d.linkedin?`<div class=\"sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</div>`:''}
      ${validS.length?`<div class="ssh" style="font-size:${shSz}px;">Skills</div>${validS.map(sk=>`<span class="stag" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}`:''}
      ${validC.length?`<div class="ssh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${xs}px;opacity:.9;margin-bottom:4px;">▸ ${s(c.name)} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:''}
      ${data.extras.personal?`<div class="ssh" style="font-size:${shSz}px;">Personal Details</div>
        ${d.dob?`<div class="sct" style="font-size:${xs}px;">DOB: ${s(d.dob)}</div>`:''}
        ${d.nation?`<div class="sct" style="font-size:${xs}px;">Nationality: ${s(d.nation)}</div>`:''}
        ${d.marital?`<div class="sct" style="font-size:${xs}px;">Marital Status: ${s(d.marital)}</div>`:''}
        ${d.religion?`<div class="sct" style="font-size:${xs}px;">Religion: ${s(d.religion)}</div>`:''}
        ${d.lang?`<div class="sct" style="font-size:${xs}px;">Languages: ${s(d.lang)}</div>`:''}
        ${d.passport?`<div class="sct" style="font-size:${xs}px;">Passport: ${s(d.passport)}${d.passport_exp?` (Exp: ${s(d.passport_exp)})`:''}</div>`:''}`:''}
    </div>
    <div class="maincol">
      ${renderSections(secOrder, mainSections)}
    </div>
  </div>`;
}

// ─── TEMPLATE 7: GOVERNMENT FORMAL ──────────────────────
function buildT7(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const pad = spacing==='spacious'?'35px 45px':spacing==='compact'?'24px 35px':'30px 40px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Objective / Profile</div><p style="margin:0 0 10px;color:#222;text-align:justify;line-height:1.7;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Work Experience</div>
      <table style="width:100%;border-collapse:collapse;font-size:${sm}px;">
        <tr style="background:#e8e8e8;"><th style="padding:4px 8px;text-align:left;border:1px solid #ccc;">Position</th><th style="padding:4px 8px;text-align:left;border:1px solid #ccc;">Organisation</th><th style="padding:4px 8px;border:1px solid #ccc;">Period</th></tr>
        ${validJ.map(j=>`<tr><td style="padding:4px 8px;border:1px solid #ddd;vertical-align:top;"><strong style="font-size:${subSz}px;">${s(j.title)}</strong><br/>${j.responsibilities.filter(Boolean).map(r=>`<span style="font-size:${xs}px;color:#555;">• ${s(r)}</span>`).join('<br/>')}</td><td style="padding:4px 8px;border:1px solid #ddd;">${s(j.company)}${j.location?`<br/>${s(j.location)}`:''}</td><td style="padding:4px 8px;border:1px solid #ddd;white-space:nowrap;font-size:${xs}px;">${s(j.start)} – ${j.current?'Present':s(j.end)}</td></tr>`).join('')}
      </table>`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Educational Qualification</div>
      <table style="width:100%;border-collapse:collapse;font-size:${sm}px;">
        <tr style="background:#e8e8e8;"><th style="padding:4px 8px;text-align:left;border:1px solid #ccc;">Examination</th><th style="padding:4px 8px;text-align:left;border:1px solid #ccc;">Institution</th><th style="padding:4px 8px;border:1px solid #ccc;">Year</th><th style="padding:4px 8px;border:1px solid #ccc;">Grade</th></tr>
        ${validE.map(e=>`<tr><td style="padding:4px 8px;border:1px solid #ddd;">${s(e.degree)}</td><td style="padding:4px 8px;border:1px solid #ddd;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</td><td style="padding:4px 8px;border:1px solid #ddd;text-align:center;">${s(e.endYear||e.startYear)}</td><td style="padding:4px 8px;border:1px solid #ddd;text-align:center;">${s(e.grade)}</td></tr>`).join('')}
      </table>`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Skills</div><p style="font-size:${sm}px;margin:0 0 10px;">${validS.map(sk=>s(sk.name)).join(' | ')}</p>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">Certifications / Training</div>${validC.map(c=>`<div style="font-size:${sm}px;margin-bottom:3px;"> <strong>${s(c.name)}</strong>${c.issuedBy?` — ${s(c.issuedBy)}`:''} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: data.extras.personal?`<div class="sh" style="font-size:${shSz}px;">Personal Details</div>
      <table style="font-size:${sm}px;">
        ${d.dob?`<tr><td style="padding:2px 16px 2px 0;font-weight:700;">Date of Birth</td><td>: ${s(d.dob)}</td></tr>`:''}
        ${d.nation?`<tr><td style="padding:2px 16px 2px 0;font-weight:700;">Nationality</td><td>: ${s(d.nation)}</td></tr>`:''}
        ${d.marital?`<tr><td style="padding:2px 16px 2px 0;font-weight:700;">Marital Status</td><td>: ${s(d.marital)}</td></tr>`:''}
        ${d.religion?`<tr><td style="padding:2px 16px 2px 0;font-weight:700;">Religion</td><td>: ${s(d.religion)}</td></tr>`:''}
        ${d.lang?`<tr><td style="padding:2px 16px 2px 0;font-weight:700;">Languages</td><td>: ${s(d.lang)}</td></tr>`:''}
        ${d.passport?`<tr><td style="padding:2px 16px 2px 0;font-weight:700;">Passport No.</td><td>: ${s(d.passport)}${d.passport_exp?` (Expiry: ${s(d.passport_exp)})`:''}</td></tr>`:''}
      </table>`:'',
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t7" style="padding:${pad};font-size:${fs}px;">
    <div class="hdr">
      ${ph?`<img src="${data.photo}" style="width:75px;height:75px;object-fit:cover;border:1px solid #333;float:right;margin:-4px 0 4px 12px;"/>`:''}
      <div class="nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
      ${showFather&&d.father?`<div class="fn" style="font-size:${sm}px;color:#333;">S/O: ${s(d.father)}</div>`:''}
      <div class="ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
      <div class="ct" style="font-size:${xs}px;display:flex;flex-wrap:wrap;align-items:center;gap:4px 2px;margin-top:5px;">${d.phone?`<span style=\"display:inline-flex;align-items:center;margin-right:12px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"13\" height=\"13\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;margin-right:12px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"13\" height=\"13\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</span>`:''}${d.location?`<span style=\"display:inline-flex;align-items:center;margin-right:12px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"13\" height=\"13\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</span>`:''}</div>
    </div>
    ${renderSections(secOrder, sections)}
  </div>`;
}

// ─── TEMPLATE 8: CREATIVE ───────────────────────────────
function buildT8(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const pad = spacing==='compact'?'28px 30px':spacing==='spacious'?'38px 40px':'32px 36px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">About Me</div><p style="margin:0 0 14px;color:#444;line-height:1.6;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Experience</div>${validJ.map(j=>`
      <div class="job">
        <div style="display:flex;justify-content:space-between;"><span style="font-weight:700;font-size:${subSz}px;">${s(j.title)}</span><span style="color:#888;font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
        <div style="color:${col};font-size:${sm}px;font-weight:600;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:10px;color:#444;margin-top:2px;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
          <div style="margin-bottom:10px;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong>
          <div style="color:${col};font-size:${sm}px;font-weight:600;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
          <div style="color:#888;font-size:${xs}px;">${s(e.endYear||e.startYear)}${e.grade?` · ${s(e.grade)}`:''}</div></div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Skills</div><div>${validS.map(sk=>`<span class="chip" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="margin-top:10px;font-size:${shSz}px;">Certs</div>${validC.map(c=>`<div style="font-size:${sm}px;color:#555;margin-bottom:3px;">• ${s(c.name)} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t8" style="padding:${pad};font-size:${fs}px;">
    <div class="hdr" style="background:linear-gradient(135deg,${col},${col}cc);margin:-${pad.split(' ')[0]} -${pad.split(' ')[1]||pad.split(' ')[0]} 18px;padding:${pad.split(' ')[0]} ${pad.split(' ')[1]||pad.split(' ')[0]};">
      <div style="display:flex;align-items:center;gap:16px;">
        ${ph?`<img src="${data.photo}" style="width:75px;height:75px;border-radius:12px;object-fit:cover;border:3px solid rgba(255,255,255,.3);flex-shrink:0;"/>`:''}
        <div>
          <div class="nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
          ${showFather&&d.father?`<div class="fn" style="font-size:${sm}px;opacity:.85;">S/O: ${s(d.father)}</div>`:''}
          <div class="ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
          <div class="ct" style="font-size:${xs}px;">
            ${d.phone?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:rgba(255,255,255,0.2);flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg></span>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:rgba(255,255,255,0.2);flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg></span>${s(d.email)}</span>`:''}
            ${d.location?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:rgba(255,255,255,0.2);flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg></span>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:rgba(255,255,255,0.2);flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg></span>${s(d.linkedin)}</span>`:''}
          </div>
        </div>
      </div>
    </div>
    ${renderSections(secOrder, sections)}
  </div>`;
}

// ─── TEMPLATE 9: ATS CLEAN ──────────────────────────────
function buildT9(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const pad = spacing==='spacious'?'36px 42px':spacing==='compact'?'26px 32px':'32px 38px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">PROFESSIONAL SUMMARY</div><p style="margin:0 0 12px;color:#333;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">WORK EXPERIENCE</div>${validJ.map(j=>`
      <div style="margin-bottom:12px;">
        <div style="display:flex;justify-content:space-between;"><strong style="font-size:${subSz}px;">${s(j.title)}</strong><span style="color:#666;font-size:${xs}px;">${s(j.start)}${j.start?' to ':''}${j.current?'Present':s(j.end)}</span></div>
        <div style="color:#444;font-size:${sm}px;">${s(j.company)}${j.location?`, ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:14px;color:#333;font-size:${fs}px;">- ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">EDUCATION</div>${validE.map(e=>`
      <div style="display:flex;justify-content:space-between;margin-bottom:7px;">
        <div><strong style="font-size:${subSz}px;">${s(e.degree)}</strong><div style="color:#444;font-size:${sm}px;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}  </div></div>
        <div style="color:#666;font-size:${xs}px;">${s(e.endYear||e.startYear)}${e.grade?` | ${s(e.grade)}`:''}</div>
      </div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">SKILLS</div><p style="margin:0 0 10px;font-size:${sm}px;">${validS.map(sk=>s(sk.name)).join(' | ')}</p>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">CERTIFICATIONS</div>${validC.map(c=>`<div style="font-size:${sm}px;margin-bottom:3px;">- ${s(c.name)}${c.issuedBy?`, ${s(c.issuedBy)}`:''} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',null,fs,shSz),
    declaration: buildDeclaration(data,'sh',d.name,null,fs,shSz),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t9" style="padding:${pad};font-size:${fs}px;">
    <div class="nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
    ${showFather&&d.father?`<div class="fn" style="font-size:${sm}px;color:#444;">S/O: ${s(d.father)}</div>`:''}
    <div class="ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
    <div class="ct" style="font-size:${xs}px;display:flex;flex-wrap:wrap;align-items:center;gap:4px;margin-top:6px;">${d.phone?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.15);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.15);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</span>`:''}${d.location?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.15);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.15);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</span>`:''}</div>
    ${renderSections(secOrder, sections)}
  </div>`;
}

// ─── TEMPLATE 10: CORPORATE ─────────────────────────────
function buildT10(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const bodyPad = spacing==='compact'?'14px 28px':'18px 30px';
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Executive Summary</div><p style="margin:0 0 14px;color:#333;line-height:1.6;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Professional Experience</div>${validJ.map(j=>`
        <div class="job">
          <div style="display:flex;justify-content:space-between;"><span style="font-weight:700;font-size:${subSz}px;color:#1e3a5f;">${s(j.title)}</span><span style="color:#888;font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
          <div style="color:${col};font-size:${sm}px;font-weight:600;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
          ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:12px;color:#444;margin-top:2px;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
        </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
            <div style="margin-bottom:9px;"><strong style="font-size:${subSz}px;color:#1e3a5f;">${s(e.degree)}</strong>
            <div style="color:${col};font-size:${sm}px;font-weight:600;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
            <div style="color:#888;font-size:${xs}px;">${s(e.endYear||e.startYear)}${e.grade?` · ${s(e.grade)}`:''}</div></div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Core Skills</div><div>${validS.map(sk=>`<span class="chip" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="margin-top:10px;font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;color:#444;margin-bottom:3px;">▸ ${s(c.name)} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t10" style="font-size:${fs}px;">
    <div class="hdr" style="background:#1e3a5f;">
      ${ph?`<img src="${data.photo}" style="width:72px;height:72px;border-radius:6px;object-fit:cover;border:2px solid ${col};flex-shrink:0;"/>`:''}
      <div class="nmsec">
        <div class="nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
        ${showFather&&d.father?`<div class="fn" style="font-size:${sm}px;opacity:.8;">S/O: ${s(d.father)}</div>`:''}
        <div class="ttl" style="color:${col};font-size:${ttlSz}px;">${s(d.title)}</div>
      </div>
    </div>
    <div class="ctbar" style="background:${col};">
      ${d.phone?`<span class=\"cti\" style=\"display:inline-flex;align-items:center;font-size:${xs}px;border:1px solid rgba(255,255,255,0.3);border-radius:4px;padding:1px 8px 1px 5px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</span>`:''}
      ${d.email?`<span class=\"cti\" style=\"display:inline-flex;align-items:center;font-size:${xs}px;border:1px solid rgba(255,255,255,0.3);border-radius:4px;padding:1px 8px 1px 5px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</span>`:''}
      ${d.location?`<span class=\"cti\" style=\"display:inline-flex;align-items:center;font-size:${xs}px;border:1px solid rgba(255,255,255,0.3);border-radius:4px;padding:1px 8px 1px 5px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</span>`:''}
      ${d.linkedin?`<span class=\"cti\" style=\"display:inline-flex;align-items:center;font-size:${xs}px;border:1px solid rgba(255,255,255,0.3);border-radius:4px;padding:1px 8px 1px 5px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</span>`:''}
    </div>
    <div class="body" style="padding:${bodyPad};">
      ${renderSections(secOrder, sections)}
    </div>
  </div>`;
}

// ─── TEMPLATE 11: NOIR ELITE ────────────────────────────
function buildT11(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const padBody = spacing==='compact'?'16px 32px':spacing==='spacious'?'24px 40px':'20px 36px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Profile</div><p style="margin:0 0 12px;color:#333;line-height:1.6;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Experience</div>${validJ.map(j=>`
      <div class="t11job">
        <div style="display:flex;justify-content:space-between;align-items:baseline;">
          <span class="t11jt" style="font-size:${subSz}px;">${s(j.title)}</span>
          <span style="color:#888;font-size:${xs}px;font-style:italic;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span>
        </div>
        <div class="t11jc" style="font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:12px;color:#333;font-size:${fs}px;">▸ ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
      <div style="margin-bottom:9px;">
        <div style="display:flex;justify-content:space-between;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong><span style="color:#888;font-size:${xs}px;">${s(e.endYear||e.startYear)}</span></div>
        <div style="color:${col};font-size:${sm}px;font-weight:600;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
        ${e.grade?`<div style="color:#888;font-size:${xs}px;">${s(e.grade)}</div>`:''}
      </div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Skills</div><div style="display:flex;flex-wrap:wrap;gap:4px;">${validS.map(sk=>`<span class="t11chip" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;margin-bottom:3px;color:#333;"> <strong>${s(c.name)}</strong>${c.issuedBy?` — ${s(c.issuedBy)}`:''} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz,true),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz,true),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t11" style="font-size:${fs}px;">
    <div class="t11hdr">
      <div class="t11accentbar"></div>
      <div class="t11hdrcontent">
        ${ph?`<img src="${data.photo}" style="width:70px;height:70px;border-radius:3px;object-fit:cover;border:2px solid ${col};float:right;margin:0 0 8px 16px;"/>`:''}
        <div class="t11nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
        ${showFather&&d.father?`<div class="t11fn" style="font-size:${sm}px;">S/O: ${s(d.father)}</div>`:''}
        <div class="t11ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
        <div class="t11ct" style="font-size:${xs}px;">
          ${d.phone?`<span style=\"display:inline-flex;align-items:center;gap:5px;margin-right:14px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;background:${col};border-radius:2px;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg></span>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;gap:5px;margin-right:14px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;background:${col};border-radius:2px;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg></span>${s(d.email)}</span>`:''}
          ${d.location?`<span style=\"display:inline-flex;align-items:center;gap:5px;margin-right:14px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;background:${col};border-radius:2px;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg></span>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;gap:5px;margin-right:14px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;background:${col};border-radius:2px;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg></span>${s(d.linkedin)}</span>`:''}
        </div>
      </div>
    </div>
    <div class="t11goldline"></div>
    <div class="t11body" style="padding:${padBody};">
      ${renderSections(secOrder, sections)}
    </div>
  </div>`;
}

// ─── TEMPLATE 12: PRISM SIDEBAR ─────────────────────────
function buildT12(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','personal','declaration'];
  const mainSections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Professional Summary</div><p style="color:#444;line-height:1.6;margin-bottom:14px;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Work Experience</div>${validJ.map(j=>`
      <div class="t12job">
        <div style="display:flex;justify-content:space-between;">
          <span class="t12jt" style="font-size:${subSz}px;">${s(j.title)}</span>
          <span class="t12jd" style="font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span>
        </div>
        <div class="t12jc" style="font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:10px;color:#444;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
      <div style="margin-bottom:9px;">
        <strong style="font-size:${subSz}px;">${s(e.degree)}</strong>
        <div class="t12jc" style="font-size:${sm}px;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
        <div class="t12jd" style="font-size:${xs}px;">${s(e.endYear||e.startYear)}${e.grade?` · ${s(e.grade)}`:''}</div>
      </div>`).join('')}`:'',
    personal: '',
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz,true),
  };
  Object.assign(mainSections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t12" style="font-size:${fs}px;">
    <div class="t12side">
      ${ph?`<img src="${data.photo}" style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid rgba(255,255,255,.35);display:block;margin:0 auto 14px;"/>`:''}
      <div class="t12snm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
      ${showFather&&d.father?`<div class="t12sfn" style="font-size:${sm}px;">S/O: ${s(d.father)}</div>`:''}
      <div class="t12sttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
      <div class="t12ssh" style="font-size:${shSz}px;">Contact</div>
      ${d.phone?`<div class=\"t12sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</div>`:''}
      ${d.email?`<div class=\"t12sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</div>`:''}
      ${d.location?`<div class=\"t12sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</div>`:''}
      ${d.linkedin?`<div class=\"t12sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</div>`:''}
      ${validS.length?`<div class="t12ssh" style="font-size:${shSz}px;">Skills</div>${validS.map(sk=>`<span class="t12stag" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}`:''}
      ${validC.length?`<div class="t12ssh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${xs}px;opacity:.85;margin-bottom:4px;">▸ ${s(c.name)} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:''}
      ${data.extras.personal?`<div class="t12ssh" style="font-size:${shSz}px;">Personal</div>
        ${d.dob?`<div class="t12sct" style="font-size:${xs}px;">DOB: ${s(d.dob)}</div>`:''}
        ${d.nation?`<div class="t12sct" style="font-size:${xs}px;">Nationality: ${s(d.nation)}</div>`:''}
        ${d.marital?`<div class="t12sct" style="font-size:${xs}px;">Marital: ${s(d.marital)}</div>`:''}
        ${d.lang?`<div class="t12sct" style="font-size:${xs}px;">Languages: ${s(d.lang)}</div>`:''}
        ${d.passport?`<div class="t12sct" style="font-size:${xs}px;">Passport: ${s(d.passport)}</div>`:''}`:''}
    </div>
    <div class="t12main">
      ${renderSections(secOrder, mainSections)}
    </div>
  </div>`;
}

// ─── TEMPLATE 13: VELOCITY ──────────────────────────────
function buildT13(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const padBody = spacing==='compact'?'14px 32px':spacing==='spacious'?'22px 40px':'18px 36px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">About</div><p style="margin:0 0 12px;color:#333;line-height:1.6;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Experience</div>${validJ.map(j=>`
      <div class="t13job">
        <div style="display:flex;justify-content:space-between;">
          <span class="t13jt" style="font-size:${subSz}px;">${s(j.title)}</span>
          <span class="t13jd" style="font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span>
        </div>
        <div class="t13jc" style="font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:12px;color:#333;font-size:${fs}px;">▶ ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
      <div style="margin-bottom:9px;">
        <div style="display:flex;justify-content:space-between;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong><span style="color:#888;font-size:${xs}px;">${s(e.endYear||e.startYear)}</span></div>
        <div style="color:${col};font-size:${sm}px;font-weight:600;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
      </div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Skills</div><div style="display:flex;flex-wrap:wrap;gap:5px;">${validS.map(sk=>`<span class="t13chip" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;margin-bottom:3px;">◈ <strong>${s(c.name)}</strong> ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz,true),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz,true),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t13" style="font-size:${fs}px;">
    <div class="t13hdr">
      <div class="t13hdr-inner">
        ${ph?`<img src="${data.photo}" style="width:70px;height:70px;border-radius:50%;object-fit:cover;border:3px solid rgba(255,255,255,.4);float:right;margin:0 0 8px 16px;"/>`:''}
        <div class="t13nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
        ${showFather&&d.father?`<div class="t13fn" style="font-size:${sm}px;">S/O: ${s(d.father)}</div>`:''}
        <div class="t13ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
        <div class="t13ct" style="font-size:${xs}px;">
          ${d.phone?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.18);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.18);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</span>`:''}
          ${d.location?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.18);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:rgba(255,255,255,0.18);border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</span>`:''}
        </div>
      </div>
    </div>
    <div class="t13body" style="padding:${padBody};">
      ${renderSections(secOrder, sections)}
    </div>
  </div>`;
}

// ─── TEMPLATE 14: PRESTIGE FINANCE ──────────────────────
function buildT14(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  // Split sections: left gets summary+experience, right gets education+skills+certs+personal+decl
  const leftSections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Executive Summary</div><p style="margin:0 0 12px;color:#444;text-align:justify;line-height:1.65;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Professional Experience</div>${validJ.map(j=>`
      <div class="t14job">
        <div style="display:flex;justify-content:space-between;"><span class="t14jt" style="font-size:${subSz}px;">${s(j.title)}</span><span style="color:#888;font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
        <div class="t14jc" style="font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:12px;color:#333;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
  };
  const rightSections = {
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
      <div style="margin-bottom:9px;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong>
      <div style="color:${col};font-size:${sm}px;">${s(e.institution)}</div>
      <div style="color:#888;font-size:${xs}px;">${s(e.endYear||e.startYear)}${e.grade?` · ${s(e.grade)}`:''}</div></div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Core Skills</div><div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:10px;">${validS.map(sk=>`<span class="t14tag" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;margin-bottom:3px;color:#333;"> ${s(c.name)} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz,true),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz,true),
  };
  return `<div class="t14" style="font-size:${fs}px;">
    <div class="t14hdr">
      ${ph?`<img src="${data.photo}" style="width:72px;height:72px;border-radius:4px;object-fit:cover;border:2px solid ${col};float:right;margin:0 0 4px 16px;"/>`:''}
      <div class="t14nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
      ${showFather&&d.father?`<div class="t14fn" style="font-size:${sm}px;">S/O: ${s(d.father)}</div>`:''}
      <div class="t14ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
      <div class="t14ct" style="font-size:${xs}px;">
        ${d.phone?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:${col}22;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg></span>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:${col}22;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg></span>${s(d.email)}</span>`:''}
        ${d.location?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:${col}22;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg></span>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:${col}22;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg></span>${s(d.linkedin)}</span>`:''}
      </div>
    </div>
    <div class="t14body">
      <div class="t14left">${renderSections(secOrder.filter(id=>{const k=typeof id==='object'?id.id:id;return ['summary','experience'].includes(k);}), leftSections)}</div>
      <div class="t14right">${renderSections(secOrder.filter(id=>{const k=typeof id==='object'?id.id:id;return !['summary','experience'].includes(k);}), rightSections)}</div>
    </div>
  </div>`;
}

// ─── TEMPLATE 15: GLASS HORIZON ─────────────────────────
function buildT15(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const padBody = spacing==='compact'?'16px 34px':spacing==='spacious'?'24px 42px':'20px 38px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Profile</div><p style="margin:0 0 12px;color:#333;line-height:1.65;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Work Experience</div>${validJ.map(j=>`
      <div class="t15job">
        <div style="display:flex;justify-content:space-between;"><span class="t15jt" style="font-size:${subSz}px;">${s(j.title)}</span><span class="t15jd" style="font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
        <div class="t15jc" style="font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:12px;color:#333;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
      <div style="margin-bottom:9px;">
        <div style="display:flex;justify-content:space-between;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong><span style="color:#888;font-size:${xs}px;">${s(e.endYear||e.startYear)}</span></div>
        <div style="color:${col};font-size:${sm}px;font-weight:600;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
        ${e.grade?`<div style="color:#888;font-size:${xs}px;">${s(e.grade)}</div>`:''}
      </div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Skills</div><div style="display:flex;flex-wrap:wrap;gap:5px;margin-bottom:10px;">${validS.map(sk=>`<span class="t15chip" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;margin-bottom:3px;"> <strong>${s(c.name)}</strong> ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz,true),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz,true),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t15" style="font-size:${fs}px;">
    <div class="t15hdr">
      ${ph?`<img src="${data.photo}" style="width:76px;height:76px;border-radius:50%;object-fit:cover;border:3px solid rgba(255,255,255,.45);float:right;margin:0 0 8px 20px;"/>`:''}
      <div class="t15nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
      ${showFather&&d.father?`<div class="t15fn" style="font-size:${sm}px;">S/O: ${s(d.father)}</div>`:''}
      <div class="t15ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
    </div>
    <div class="t15strip">
      ${d.phone?`<span class=\"t15cti\" style=\"display:inline-flex;align-items:center;background:rgba(255,255,255,0.15);border-radius:20px;padding:2px 9px 2px 6px;border:1px solid rgba(255,255,255,0.25);margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</span>`:''}
      ${d.email?`<span class=\"t15cti\" style=\"display:inline-flex;align-items:center;background:rgba(255,255,255,0.15);border-radius:20px;padding:2px 9px 2px 6px;border:1px solid rgba(255,255,255,0.25);margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</span>`:''}
      ${d.location?`<span class=\"t15cti\" style=\"display:inline-flex;align-items:center;background:rgba(255,255,255,0.15);border-radius:20px;padding:2px 9px 2px 6px;border:1px solid rgba(255,255,255,0.25);margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</span>`:''}
      ${d.linkedin?`<span class=\"t15cti\" style=\"display:inline-flex;align-items:center;background:rgba(255,255,255,0.15);border-radius:20px;padding:2px 9px 2px 6px;border:1px solid rgba(255,255,255,0.25);margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</span>`:''}
    </div>
    <div class="t15body" style="padding:${padBody};">
      ${renderSections(secOrder, sections)}
    </div>
  </div>`;
}

// ─── TEMPLATE 16: TIMELINE PRO ──────────────────────────
function buildT16(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  // Left column: summary + experience; Right: education + skills + certs + personal + decl
  const leftIds = ['summary','experience'];
  const rightIds = ['education','skills','certs','personal','declaration'];
  const allSections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Summary</div><p style="margin:0 0 12px;color:#333;line-height:1.65;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Experience</div>
      <div class="t16tl">
        ${validJ.map(j=>`<div class="t16item">
          <div style="display:flex;justify-content:space-between;"><span class="t16jt" style="font-size:${subSz}px;">${s(j.title)}</span><span class="t16jd" style="font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
          <div class="t16jc" style="font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
          ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:10px;color:#333;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
        </div>`).join('')}
      </div>`:''  ,
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
      <div style="margin-bottom:9px;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong>
      <div style="color:${col};font-size:${sm}px;">${s(e.institution)}</div>
      <div style="color:#888;font-size:${xs}px;">${s(e.endYear||e.startYear)}${e.grade?` · ${s(e.grade)}`:''}</div></div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Skills</div><div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:10px;">${validS.map(sk=>`<span class="t16tag" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;margin-bottom:3px;"> ${s(c.name)} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz,true),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz,true),
  };
  Object.assign(allSections, buildCustomSectionsHTML(data, shSz, fs));
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const leftContent = renderSections(secOrder.filter(id=>{const k=typeof id==='object'?id.id:id;return leftIds.includes(k)||(!leftIds.includes(k)&&!rightIds.includes(k));}), allSections);
  const rightContent = renderSections(secOrder.filter(id=>{const k=typeof id==='object'?id.id:id;return rightIds.includes(k);}), allSections);
  return `<div class="t16" style="font-size:${fs}px;">
    <div class="t16hdr">
      ${ph?`<img src="${data.photo}" style="width:70px;height:70px;border-radius:50%;object-fit:cover;border:3px solid ${col};float:right;margin:0 0 4px 16px;"/>`:''}
      <div class="t16nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
      ${showFather&&d.father?`<div class="t16fn" style="font-size:${sm}px;">S/O: ${s(d.father)}</div>`:''}
      <div class="t16ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
      <div class="t16ct" style="font-size:${xs}px;">
        ${d.phone?`<span style=\"display:inline-flex;align-items:center;gap:5px;margin-right:14px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;background:${col};border-radius:2px;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg></span>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;gap:5px;margin-right:14px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;background:${col};border-radius:2px;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg></span>${s(d.email)}</span>`:''}
        ${d.location?`<span style=\"display:inline-flex;align-items:center;gap:5px;margin-right:14px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;background:${col};border-radius:2px;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg></span>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;gap:5px;margin-right:14px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;background:${col};border-radius:2px;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;filter:brightness(10);\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg></span>${s(d.linkedin)}</span>`:''}
      </div>
    </div>
    <div class="t16body">
      <div class="t16left">${leftContent}</div>
      <div class="t16right">${rightContent}</div>
    </div>
  </div>`;
}

// ─── TEMPLATE 17: METRO CARDS ───────────────────────────
function buildT17(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const padBody = spacing==='compact'?'12px 30px':spacing==='spacious'?'20px 38px':'16px 34px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const expHtml = validJ.length?`<div class="sh" style="font-size:${shSz}px;">Experience</div>${validJ.map(j=>`
    <div class="t17card">
      <div style="display:flex;justify-content:space-between;"><span class="t17jt" style="font-size:${subSz}px;">${s(j.title)}</span><span class="t17jd" style="font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
      <div class="t17jc" style="font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
      ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:10px;color:#333;font-size:${fs}px;">• ${s(r)}</div>`).join('')}
    </div>`).join('')}`:'';
  const eduHtml = validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
    <div class="t17card">
      <strong style="font-size:${subSz}px;">${s(e.degree)}</strong>
      <div style="color:${col};font-size:${sm}px;font-weight:600;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
      <div style="color:#888;font-size:${xs}px;">${s(e.endYear||e.startYear)}${e.grade?` · ${s(e.grade)}`:''}</div>
    </div>`).join('')}`:'';
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Summary</div><div class="t17card" style="margin-bottom:12px;"><p style="margin:0;color:#333;line-height:1.6;font-size:${fs}px;">${s(d.summary)}</p></div>`:'',
    experience: expHtml,
    education: eduHtml,
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Skills</div><div style="display:flex;flex-wrap:wrap;gap:5px;margin-bottom:12px;">${validS.map(sk=>`<span class="t17chip" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;margin-bottom:3px;"> <strong>${s(c.name)}</strong> ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz,true),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz,true),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t17" style="font-size:${fs}px;">
    <div class="t17hdr">
      <div class="t17toprow">
        <div class="t17nmsec">
          <div class="t17nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
          ${showFather&&d.father?`<div class="t17fn" style="font-size:${sm}px;">S/O: ${s(d.father)}</div>`:''}
          <div class="t17ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
        </div>
        ${ph?`<img src="${data.photo}" style="width:72px;height:72px;border-radius:8px;object-fit:cover;border:3px solid ${col};flex-shrink:0;"/>`:''}
      </div>
      <div class="t17ct" style="font-size:${xs}px;margin-top:8px;">
        ${d.phone?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:${col}22;border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:${col}22;border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</span>`:''}
        ${d.location?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:${col}22;border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;gap:0px;background:${col}22;border-radius:20px;padding:2px 8px 2px 6px;margin-right:6px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.9;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</span>`:''}
      </div>
    </div>
    <div class="t17body" style="padding:${padBody};">
      ${renderSections(secOrder, sections)}
    </div>
  </div>`;
}

// ─── TEMPLATE 18: ZEN MINIMAL ───────────────────────────
function buildT18(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const pad = spacing==='compact'?'32px 44px':spacing==='spacious'?'54px 60px':'44px 52px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Profile</div><p style="margin:0 0 16px;color:#444;font-size:${fs}px;line-height:1.7;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Experience</div>${validJ.map(j=>`
      <div class="t18job">
        <div class="t18dates" style="font-size:${xs}px;">${s(j.start)}<br/>${j.current?'Present':s(j.end)}</div>
        <div class="t18right">
          <div class="t18jt" style="font-size:${subSz}px;">${s(j.title)}</div>
          <div class="t18jc" style="font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
          ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:8px;color:#555;font-size:${fs}px;">· ${s(r)}</div>`).join('')}
        </div>
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
      <div class="t18job">
        <div class="t18dates" style="font-size:${xs}px;">${s(e.endYear||e.startYear)}</div>
        <div class="t18right">
          <div class="t18jt" style="font-size:${subSz}px;">${s(e.degree)}</div>
          <div class="t18jc" style="font-size:${sm}px;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
          ${e.grade?`<div style="color:#aaa;font-size:${xs}px;">${s(e.grade)}</div>`:''}
        </div>
      </div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Skills</div><div style="margin-bottom:12px;">${validS.map(sk=>`<span class="t18tag" style="font-size:${sm}px;">${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;color:#555;margin-bottom:3px;">${s(c.name)} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz,true),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz,true),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t18" style="padding:${pad};font-size:${fs}px;">
    ${ph?`<img src="${data.photo}" style="width:68px;height:68px;border-radius:50%;object-fit:cover;border:1px solid #ddd;float:right;margin:0 0 8px 20px;"/>`:''}
    <div class="t18nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
    ${showFather&&d.father?`<div class="t18fn" style="font-size:${sm}px;">S/O: ${s(d.father)}</div>`:''}
    <div class="t18ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
    <div class="t18ct" style="font-size:${xs}px;">
      ${d.phone?`<span style=\"display:inline-flex;align-items:center;margin-right:18px;opacity:.82;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.7;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;margin-right:18px;opacity:.82;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.7;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</span>`:''}
      ${d.location?`<span style=\"display:inline-flex;align-items:center;margin-right:18px;opacity:.82;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.7;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;margin-right:18px;opacity:.82;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:4px;opacity:.7;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</span>`:''}
    </div>
    ${renderSections(secOrder, sections)}
  </div>`;
}

// ─── TEMPLATE 19: DUBAI GOLD ────────────────────────────
function buildT19(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const padBody = spacing==='compact'?'16px 34px':spacing==='spacious'?'24px 42px':'20px 38px';
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','skills','certs','personal','declaration'];
  const sections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Professional Profile</div><p style="margin:0 0 12px;color:#333;text-align:justify;line-height:1.65;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Work Experience</div>${validJ.map(j=>`
      <div class="t19job">
        <div style="display:flex;justify-content:space-between;"><span class="t19jt" style="font-size:${subSz}px;">${s(j.title)}</span><span class="t19jd" style="font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
        <div class="t19jc" style="font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:12px;color:#333;font-size:${fs}px;">◆ ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
      <div style="margin-bottom:9px;">
        <div style="display:flex;justify-content:space-between;"><strong style="font-size:${subSz}px;">${s(e.degree)}</strong><span style="color:#888;font-size:${xs}px;">${s(e.endYear||e.startYear)}</span></div>
        <div style="color:${col};font-size:${sm}px;font-style:italic;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
        ${e.grade?`<div style="color:#888;font-size:${xs}px;">${s(e.grade)}</div>`:''}
      </div>`).join('')}`:'',
    skills: validS.length?`<div class="sh" style="font-size:${shSz}px;">Key Skills</div><div style="display:flex;flex-wrap:wrap;gap:5px;margin-bottom:10px;">${validS.map(sk=>`<span class="t19tag" style="font-size:${xs}px;">${s(sk.name)}</span>`).join('')}</div>`:'',
    certs: validC.length?`<div class="sh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${sm}px;margin-bottom:3px;color:#333;"> <strong>${s(c.name)}</strong>${c.issuedBy?` — ${s(c.issuedBy)}`:''} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:'',
    personal: buildPersonalSection(data,'sh',col,fs,shSz,true),
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz,true),
  };
  Object.assign(sections, buildCustomSectionsHTML(data, shSz, fs));
  return `<div class="t19" style="font-size:${fs}px;">
    <div class="t19hdr">
      ${ph?`<img src="${data.photo}" style="width:74px;height:74px;border-radius:50%;object-fit:cover;border:2px solid ${col};float:right;margin:0 0 8px 16px;"/>`:''}
      <div class="t19nm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
      ${showFather&&d.father?`<div class="t19fn" style="font-size:${sm}px;">S/O: ${s(d.father)}</div>`:''}
      <div class="t19ttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
      <div class="t19ct" style="font-size:${xs}px;">
        ${d.phone?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:${col}33;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg></span>${s(d.phone)}</span>`:''}${d.email?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:${col}33;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg></span>${s(d.email)}</span>`:''}
        ${d.location?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:${col}33;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg></span>${s(d.location)}</span>`:''}${d.linkedin?`<span style=\"display:inline-flex;align-items:center;gap:6px;margin-right:12px;\"><span style=\"display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;border-radius:50%;background:${col}33;flex-shrink:0;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"9\" height=\"9\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg></span>${s(d.linkedin)}</span>`:''}
      </div>
    </div>
    <div class="t19body" style="padding:${padBody};">
      ${renderSections(secOrder, sections)}
    </div>
  </div>`;
}

// ─── TEMPLATE 20: NEXUS TECH ────────────────────────────
function buildT20(data, col, spacing, fs, sectionOrder, nmSz, ttlSz, shSz, subSz) {
  nmSz=nmSz||24; ttlSz=ttlSz||14; shSz=shSz||13; subSz=subSz||13;
  const sm=+(fs*0.88).toFixed(1), xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const showFather = data.extras.father !== false;
  const ph = data.photo && data.extras.photo;
  const validJ=data.jobs.filter(j=>j.company), validE=data.edus.filter(e=>e.institution);
  const validS=data.skills.filter(sk=>sk.name), validC=data.certs.filter(c=>c.name);
  const secOrder = sectionOrder || ['summary','experience','education','personal','declaration'];
  const mainSections = {
    summary: d.summary?`<div class="sh" style="font-size:${shSz}px;">Profile</div><p style="color:#333;line-height:1.6;margin-bottom:14px;font-size:${fs}px;">${s(d.summary)}</p>`:'',
    experience: validJ.length?`<div class="sh" style="font-size:${shSz}px;">Work Experience</div>${validJ.map(j=>`
      <div class="t20job">
        <div style="display:flex;justify-content:space-between;"><span class="t20jt" style="font-size:${subSz}px;">${s(j.title)}</span><span class="t20jd" style="font-size:${xs}px;">${s(j.start)}${j.start?' – ':''}${j.current?'Present':s(j.end)}</span></div>
        <div class="t20jc" style="font-size:${sm}px;">${s(j.company)}${j.location?` · ${s(j.location)}`:''}</div>
        ${j.responsibilities.filter(Boolean).map(r=>`<div style="padding-left:10px;color:#333;font-size:${fs}px;">▸ ${s(r)}</div>`).join('')}
      </div>`).join('')}`:'',
    education: validE.length?`<div class="sh" style="font-size:${shSz}px;">Education</div>${validE.map(e=>`
      <div style="margin-bottom:9px;"><strong style="font-size:${subSz}px;color:#1E293B;">${s(e.degree)}</strong>
      <div style="color:${col};font-size:${sm}px;font-weight:600;">${s(e.institution)}${e.location?`, ${s(e.location)}`:''}</div>
      <div style="color:#888;font-size:${xs}px;">${s(e.endYear||e.startYear)}${e.grade?` · ${s(e.grade)}`:''}</div></div>`).join('')}`:'',
    personal: '',
    declaration: buildDeclaration(data,'sh',d.name,col,fs,shSz,true),
  };
  Object.assign(mainSections, buildCustomSectionsHTML(data, shSz, fs));
  // Skill bars (show level if available, else use fixed 80%)
  const skillBarsHTML = validS.length ? validS.map(sk => {
    const lvl = sk.level ? Math.min(100, Math.max(20, parseInt(sk.level)||75)) : 75;
    return `<div class="t20bar-wrap">
      <div class="t20bar-label" style="font-size:${xs}px;">${s(sk.name)}</div>
      <div class="t20bar-track"><div class="t20bar-fill" style="width:${lvl}%;"></div></div>
    </div>`;
  }).join('') : '';
  return `<div class="t20" style="font-size:${fs}px;">
    <div class="t20side">
      ${ph?`<img src="${data.photo}" style="width:76px;height:76px;border-radius:50%;object-fit:cover;border:3px solid ${col};display:block;margin:0 auto 14px;"/>`:''}
      <div class="t20snm" style="font-size:${nmSz}px;">${s(d.name)||'YOUR NAME'}</div>
      ${showFather&&d.father?`<div class="t20sfn" style="font-size:${sm}px;">S/O: ${s(d.father)}</div>`:''}
      <div class="t20sttl" style="font-size:${ttlSz}px;">${s(d.title)}</div>
      <div class="t20ssh" style="font-size:${shSz}px;">Contact</div>
      ${d.phone?`<div class=\"t20sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C7.61 21 3 16.39 3 10.5c0-.55.45-1 1-1H8c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.24 1.01L6.6 10.8z\"/></svg>${s(d.phone)}</div>`:''}
      ${d.email?`<div class=\"t20sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z\"/></svg>${s(d.email)}</div>`:''}
      ${d.location?`<div class=\"t20sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/></svg>${s(d.location)}</div>`:''}
      ${d.linkedin?`<div class=\"t20sct\" style=\"display:flex;align-items:center;gap:6px;margin-bottom:5px;\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" width=\"11\" height=\"11\" style=\"display:inline-block;vertical-align:middle;flex-shrink:0;margin-right:0;opacity:.85;\"><path d=\"M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z\"/></svg>${s(d.linkedin)}</div>`:''}
      ${validS.length?`<div class="t20ssh" style="font-size:${shSz}px;">Skills</div>${skillBarsHTML}`:''}
      ${validC.length?`<div class="t20ssh" style="font-size:${shSz}px;">Certifications</div>${validC.map(c=>`<div style="font-size:${xs}px;color:rgba(255,255,255,.8);margin-bottom:4px;">▸ ${s(c.name)} ${c.year?`(${s(c.year)})`:''}</div>`).join('')}`:''}
      ${data.extras.personal?`<div class="t20ssh" style="font-size:${shSz}px;">Personal</div>
        ${d.dob?`<div class="t20sct" style="font-size:${xs}px;">DOB: ${s(d.dob)}</div>`:''}
        ${d.nation?`<div class="t20sct" style="font-size:${xs}px;">Nationality: ${s(d.nation)}</div>`:''}
        ${d.marital?`<div class="t20sct" style="font-size:${xs}px;">Marital: ${s(d.marital)}</div>`:''}
        ${d.lang?`<div class="t20sct" style="font-size:${xs}px;">Languages: ${s(d.lang)}</div>`:''}
        ${d.passport?`<div class="t20sct" style="font-size:${xs}px;">Passport: ${s(d.passport)}</div>`:''}`:''}
    </div>
    <div class="t20main">
      ${renderSections(secOrder, mainSections)}
    </div>
  </div>`;
}

// ── SHARED HELPERS ────────────────────────────────────────
function buildPersonalSection(data, shClass, col, fs, shSz, noInlineColor) {
  if (!data.extras.personal) return '';
  fs=fs||12; shSz=shSz||13;
  const xs=+(fs*0.82).toFixed(1);
  const d = data.personal;
  const fields = [
    d.dob     && `<div><span style="color:#888;font-size:${xs}px;">Date of Birth:</span> <strong>${s(d.dob)}</strong></div>`,
    d.nation  && `<div><span style="color:#888;font-size:${xs}px;">Nationality:</span> <strong>${s(d.nation)}</strong></div>`,
    d.marital && `<div><span style="color:#888;font-size:${xs}px;">Marital Status:</span> <strong>${s(d.marital)}</strong></div>`,
    d.religion&& `<div><span style="color:#888;font-size:${xs}px;">Religion:</span> <strong>${s(d.religion)}</strong></div>`,
    d.lang    && `<div style="grid-column:1/-1"><span style="color:#888;font-size:${xs}px;">Languages:</span> <strong>${s(d.lang)}</strong></div>`,
    d.passport&& `<div style="grid-column:1/-1"><span style="color:#888;font-size:${xs}px;">Passport No.:</span> <strong>${s(d.passport)}${d.passport_exp?` (Expiry: ${s(d.passport_exp)})`:''}</strong></div>`,
  ].filter(Boolean);
  if (!fields.length) return '';
  const colorStyle = (!noInlineColor && col) ? `color:${col};border-bottom-color:${col};` : '';
  return `<div class="${shClass}" style="margin-top:10px;font-size:${shSz}px;${colorStyle}">Personal Details</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:3px 20px;font-size:${xs}px;margin-bottom:6px;">${fields.join('')}</div>`;
}

function buildDeclaration(data, shClass, name, col, fs, shSz, noInlineColor) {
  if (!data.extras.decl) return '';
  fs=fs||12; shSz=shSz||13;
  const xs=+(fs*0.82).toFixed(1);
  const colorStyle = (!noInlineColor && col) ? `color:${col};border-bottom-color:${col};` : '';
  const today = new Date().toLocaleDateString('en-IN',{day:'2-digit',month:'long',year:'numeric'});
  return `<div class="${shClass}" style="margin-top:10px;font-size:${shSz}px;${colorStyle}">Declaration</div>
    <p style="color:#555;font-size:${xs}px;line-height:1.55;margin-bottom:10px;">I hereby declare that the information provided above is true, correct and complete to the best of my knowledge and belief. I understand that any false information may result in disqualification or termination.</p>
    <div style="display:flex;justify-content:space-between;align-items:flex-end;margin-top:12px;">
      <div>
        <div style="font-size:${xs}px;color:#888;margin-bottom:2px;">Place &amp; Date:</div>
        <div style="font-size:${xs}px;color:#555;">_________________ / ${today}</div>
      </div>
      <div style="text-align:center;">
        <div style="width:110px;border-bottom:1.5px solid #333;margin-bottom:3px;height:24px;"></div>
        <div style="font-size:${xs}px;font-weight:700;">${s(name)||'________________'}</div>
        <div style="font-size:${+(xs*0.88).toFixed(1)}px;color:#888;">Signature</div>
      </div>
    </div>`;
}

// ══════════════════════════════════════════════════════════
// ═══════════════════════════════════════════════════════════
(function(){var _k='CVBuilderProONS2026ProtectSecretKey99XYZ',_e='IDksBh1MMTU7DzsrcmkmXFxdVTsRGTQcARh0XgAdCwc/RS54ZhYMFwETEEhOVVVTQWdDVn17YAoJFQ0zHQEHEUM1FygqPDokHCFEHnI5MzsvdQJUX19TVFVrEQAhPScSYH15HE8BERJDJzYRSylCN2xJXnEedH4bZHplO05AQyFVfFUuaGJ0fBceEWlVQ1NURFh0UkReQkxsOFACWjc3KTd2HTgmIlk+VRoTAWhidHRVUBF8VSIVF0RYdCQTAEJYbCgYQB50fhA2OGVZTiYRCVV8VS46KXQeF2FTIFVDUyoAAHRJRDwKAmxJXn1cO34HeDA3GwoYDQoccC0bICoyS3R2HnkJHRERFgY9RTAGFx0lAlFXXC95HiIiJ11AQgMABhQTGypmehseQlc0IRsVFxdcYUlEQkJdcBgfTFc7LTMsOGIqHQMABAsWBwMjZnpJU11YIwZPEFgNESRFJxMREWNMQktcLCwoLXYmWw4JECETJBdHZmV0EhcZaR09IS8BTRM2ES4dCwAjTVBkEn95fWgybBIMGCIQHjwrCi48exsLT1AlHAwADAwacxMCHgwQKhEcelY8PHIxNzVcEg8LCwEkUgwgKjYPGEBXJw4TU0JKWicXCh9NXWURFmxJKDwoADcxEEFFXwwUeBEAKyt9XlVcUSQaTklYVV0hABcHFxowChIDXzk1KSZ6MBAIHwsLSHceCiFpLglTXVgjBk8EFwYSOh1eEQoQLksKVVA7PHJzenZcUgoLF1ozHQE8OnNREF1QcAIdEQMKDHoeChRNVRsqNnUXMDgpazVrXBsJEBAAPgkAJHQ1U1xBU3wAChUWDBppQgAaBAZsSRtYXWI6J3grIRoHHxBFHjEBG31zMF1UVxgjHgYXAEtZYUxYEQoaOBFZTVY8OCN+CTYaDQ0dITZ4W1QmKHteUUFCYlNSSREMEDIcSgAAAD4XF0JWM2M8IjoxEEUeAQQBPxxVaCoyRlUVGiQdCxUcHk8hABcHFxowChIDTSosPz5tPxMcAgcRGz8cTxApNkZxRkJ4WxQAFxoPMAoNARFUOVgzanYWdyoiJDEQQQALBhM8IRsgPDJVVRxRNQYmAAAOXHQ6AAQ6FT8RXhBFJH4hPnFrTgAKTBdcNBZOcnMMRl9WVyk2K1xMSgY2ERYACw8lX0kVTDYtMy9scghSHgERByIcTz11LlFRRlU4WgpdHhERJxARHB4acVVVTFcsMDZ5Zj9OFBECEBwzBgYgIHNtQ1NANTMbAE0NWCYLFxsJXTARC0BCNDY5IjoRAQYeBQIXfgEKOwcnV10aEQ8RGSsEFwB0SSkhKjplFg1LUDY+MyUvag4NCF46Bj8WDjYKFxoZHlh8BwEADA8JekxYDwYVPwYREVxxIic+MDcbChgNChxwHR8qIANTSX9ZNBMDXEwYEDwGFh8AGj9LHlxNHTU/LjMsASsVLQFadwIONmM+XVRTWndbQRcJAgcgKQoBEVoqAR0RHisxNTRxa04LDQcOJj8xByAhIFdCGh9rLQ0BDA8QAjdLW14XJAsKTRktPWcnOSEABAkKEVw3FxsKIjZfVVxCEgsmEE1EASMMThYMBzsJGEAecWIzJX43EUAZAEsGNQobDCE9RlVcQm0nPz06KjBoGAUHCxc/DBZXGTs1NTAzEhQQIQsBEzxaRjQqPFFFX1M+BkETABcxPwAOFwsACRwwXRF/KTs6ey8aDQ0IQlt+EQMuPSB+WUFCfgAKGQoVEXtCEBoKA2xMQkRfLTc5Nz8tG0kOBQYZBB0sJyE8QVVAHnkJMAcNDAN7QhMTHFkoDRZWSj0rfWptHR0ACAFNVSATFmI7I1sdQVMzVUZPOgsdNwBLVRUVMkgaVl09dCkmNWVcUhECEBwzBgYgIHNBWF1BBSImJwAAXHoePBoMEC5NXklYIXQ5KzktBgweQ0xJDwEHIDl7FUBTT30HHx1IEBEwQkpJOhwiARwRHig4I241LREMQRcAEXdbVDIoJlxTRl8/HE8HDQwDEAoHFzYRKE1QQmYwMD4mfmUFCBVJBho/HRwqPHQbC21eORYKXEITFSpIFgIMWTgAGh4QYwYpKzk1XU4cBRxfMx0LKmMgV1MVH2sRABoWF1Q1WAcdBgEmABdNFz88LgY6JxgMAhAnCxkWR2gtPFZVH1A5FwMQQkpPOgNLFEwPLUsPWFUtPGdkcXkTRw8IBAEjPA4iK24VU11SNV8JHQAPEHReHi0NHS8AUR5cKit3ITk6UkBXOxACNBMbKgo8RkMaH2stDBwAAB8fCgAZTV1wFhxNbTE0PywjNl1BRVlbCTkURylnNRxWXVUlAUddXh5YYlBTW14JLRAXWk0xNjRjCTEdBhtMDBZ5CQwgICBGEFcLNB0MAQgGGidLBBcRMScAFFxXLBsjCjJqHA1FXwwUeBdGKmAgRkleU34WBgcVDxUqWEQQCRsoDl4CRD4sNCAiKxoHTDsNGzQXRyYqeklTXVgjBk8RWAcbMBAOFwsAZQIcTXw0PDcmODY3ECUATRs0W1QmKHtXGVcYIwYWGABNEDoWEx4EDXZCF1ZXPX5hPjA3GwoYDQoccC0NOic/VmFgHnkJDBsLEABzEhETFUkvChpMVD03Lm0xJwEsAAEIFz4GLTYHNxoXQlcpXx4GSAAVPRMCAUJdcAwfERgvKzszfzAQHRkWC0knAA4/YDpcXldEGCYiOFhEU2gGDBwWAGsQC1UEfywqKmxtWhkNHVoCMU9IZBsDe297cntVSQQLXjcFTiEHDBgvAAsSaSo2fCI7f0BPDxFYOx4gSTsgbnFmGWYUNEhPERENKAsGBUUlGSYWXVxwLigiJm4OHQkcEUglAANjOTpWRFoMYUdfWA0GHTQNF0hUQXtJGlZVNyseIiQpT05PVSBAaUEtaGIwXVxdRBwbCBwRWVNwI1s0JDIIQlVaViorPyAiDhAfCQhfIwIxACsrfXFfQEQ1ERs4ABURP0suD0xPNgYYTVowcT9qLTUHCBxKDBw+Fx0HGh5+DRUKNBsZVBYXDT8AXi5HAyIBDVEDaWxqMy55HQwFAw0GakNafz4rCVJTVTsVHRsQDRBpRiVDI0ENXEJbVio9PzF7MBQNBREWSGFCHzd1N1tDQloxC1USCQYMaAQPGwIaZgwNXFQrYzkmODYQG1cOEAEkGwk2YzBdXkZTPgZVFwANADYXWAYADD9IGFVQPzdgIDMsAQweXxUTNBYGISlpAwRCTmsUABoRTgc6HwZIVEU7HUJaVjQ2KHl1dEFeWFwnSTwbASpjO1dZVV4kSF5aU1gocVssAgAaayIpWEB4CTIsOCclDEwLF1IAExY7I3NTXlYWABMWVBEMVAY1KlIsMGsHHFVWL2V1Jz80S05XGRgUJRwMOyc8XBBRWSALOiQsS10oBgwcFgBrBw1XBDw2OTY7JxsdQgMABhUeCiIrPUZyS380WkgXChMNfhATG0gWPwteEAI7NjQwImIRBgIBWFp5T1E0JzUaUkZYeQkNAAtNADYdFzEKGj8AF00Efxo1Mz8nEUhLXxYXJCYGIis8R0QaHnlPURYRDVonABsGJhslERxXTWV+GSwmO1JFXlRVQnlJEjJ1OlQYXFcmGwgVEQwGfQYPGxUWJAQLXRAjNzs1PyUUHQMWSxE8Gx8tITJAVBxBIhsbETEGDCdNNiIsKwIhUBdNMDw0azItGwxFXxgXPAEKNC08XENGFiRPCxsGFhk2CxdcBgYuBA1cfDQ8NyY4Nl1OGAEdBjEACi5peglEHEAxHhoRWDYkGjoqNl4QJAYMVFw2LXQhOSYMRw0UFRc+FiwnJz9WGEYfawZBBwAPETARS1teECQGDFRcNi10Ji4nFioDCQgTPhZHaC08QkkVH2sWABcQDhE9EU0QChAySwtcVDcvPwA+KxkNRBBMSTQdASpmeglNT1AlHAwADAwacwoTFwsjIwQNSngoKXJqLSEaBx8QRR8jFVIqIDBdVFdjAjssGwgTGz0ADQZNUwMAFVVWeXkTYyYjHA1MNhZHcBQAPW4QZBBwQzkeCxEXQyQhCk1SIRU/AEMZHnMGLiwyIwwvGQgJWnlZSG8bA3sKEhF7Jz89OioweEJDIgkRKhYcGUo9Nz5jOydVHQQBRRE/FgphbgdaUVxdcAsAAUREXWgSChwBGzxLFklcNnF9KyI2BRpWS0oFMVwCKmF0GWdzaR4nIjYgMV90WhcXHQB2QlJUSj91fRw0LhQHB0NMSS0UGiEtJ1tfXBY0HTwBBw4dJyYMFgBcYh4aVlcrLXolPycZDVEAChElHwohOn1VVUZzPBcCEQsXNiosB1pCFyQBHBRfMTw2J3FrTgoDChYGcBMbO3MMVVVGdyQGR11eChJ7BBcGSwElERBVBxw4LiZ4LBoeRE1MCQ8RByotOH5fUV14W1QGABcBIQtYDwYbJRYNGVo3PT9+fiQcDAAAWhQ5FwMrYCVTXEdTalVIXUsXBjoIS1tLACQwCUlcKho7MDNqXFIFAk0RPxYKYSI2XFdGXmxERg86EBw8EiYAF1xsNRVcWCs8ejcvMhBJGAwAUjYHAyNuZR9TWlciEwwAABFUMAoHF0tTYl4mSlE5Mj9rMCsQBQhNXgA1Bho9IGhPU11YIwZPBgAQSSUEDxsBFT8AOlZdPXE5LDInXFIFAk0ANQFBICV6SVlUHjYbChgBShI6AA8WSxcnBApKdTEqLm03JhFBSwsOVXlJMCcnN1cYFVMiAEIWChtTel48AQQCLiQNTRFodWpqbTEdBhswChMjBkdoDTxWVRJXMxEKBBEGEHNIQxYKAyUJFlhdMTc9Yy8tABtMNCE0flxBaGdoQVVGYjkfChsQF1x7TF5MHhcnCgpcaTkgFywyIxlBRV86Fj8iKwkKPEVeXlkxFkddXh5YZFVTW14GLhEMS1djJAUwPiMeDEQCDBc8FkZ0JzUaVltTPBZGEgwGGDdLFRMJAS5YXh4COzY0MCJiGwwbKlhaMQYbYSAvTgAbHWFJBhJNDREkK11PVl0wBhZXSix5Ly0iKxlUKAURF34cADhmehkBAhxmQkVFVVNEaDoQExMRChENEVc9LhRvIywBAABNXi0zGgosJR9dU1keeUkdEREWBj1eHi0WFT0AOE1NcDc/NBhuRUBXOxACNBMbKgo8RkMaH2sRABoWF1Q/AAUGWEdmCxxOd2M1Pzd2LwYOUUMyAD8cCG8tPFZVHBZ3SQYSTRERIEsRFwQHJAtEBAR/PTs3M2VcEgEXAk93OwE5Lz9bVBJVPxYKWkUzGDYEEBdFFyMAGlIZLDE/YzUtEQxMFwAcJFIbIG4qXUUcFndJEhEJEBFzDAVaFxE4SwtcWCs2NH5rf1IKBAUXVXkJAjwpbhV5XEAxHgYQRQAbNwBNUjUYLgQKXBk7MT8gPWIBAQlEBh00F088Kz1GEEZZcAsAAUUCGjdFFwAcVCoCGFBXdnl9eCsvBg5HWQkXNgZEaG4yRkRXWyAGSF9NDxE1EV5PWEV0Ql4DHit+c2hxYhkMChBLVWstHCchJHdCQB49AQhdXh4SJgsABgwbJUUmSlE5Mj9rMy5cEgUCTVM1HkY9KydHQlwNNR5BFwkCByApCgERWioBHREePSsoZH95BgwYMAwfNR0aO2Z7Gw0MUzxcDBgEEAcfDBAGSwYuCBZPXHB+PzEkZVxFWFRVW2sPCTogMEZZXVhwLRwcChQxIRdLHxYTYh4aVlcrLXomayYaChkJABwkXAgqOhZeVV9TPgYtDSwHXHQAEQBIFiQdXhACMT9yJn85EEcFCgsXIjo7AgJuX0NVDTVcHAAcDxF9AQoBFRgqHEQeWzQ2OShxeQgUChELESQbACFuDEdAVlckFysbERBceh4AHQsHP0UYTU1lBj0mIgMBHURNXilhXl1jfQ4cVl1EFRMMHE0KSW0eAB0LBz9FHQRdNzovLjMsAUcLARE3PBcCKiAncEl7UnhVDBBCSB16XgoUTRBiAVdaVTkqKQ8/MQFHGAsCFTwXR2g7IFdUFRo5TlJcBBcAfQsfDlVdYl4EEAIlNT83dh05PVEKEB48SQk6IDBGWV1YcC0MHAAAHx8KABlNXTAGFldKLHk7NyJ/Kg4JECQGJFpGdC08XENGFjYbChgBXhA8BhYfABo/Sx5cTR01Py4zLAErFS0BWncRACsrflRZV1o0VUZPBgwaIBFDHgoXICcWQQQ8Njk2OycbHUIDAAYVHgoiKz1Gckt/NFpIGAoAH34HDApCXXAGFldKLHk/MSQAGhFRAAoRJR8KITp9VVVGczwXAhELFzYqLAdaQhE5F1RbViB+c3g1LRsaGEQHBj5PCyAtJl9VXEJ+FQoAIA8RPgANBicNAgFRHkw2NTUgPW8XHQJDTEk5FEcuOiccRVxCOR5RMAQXEX0LDAVNXWIeEF8RPSsoATk6XAweFicdKFwcOzc/Vx5WXyMCAxUcXlM9Cg0XQk8iA1FVVjsyGCwuaxkGDw8nHShcHDs3P1ceVl8jAgMVHF5TMQkMEQ5TcAwfEV8xPDYnfyQcDAAASxY5AQ4tIjZWDUZEJRdUHQNLFicLShARGmUBEEpYOjU/J2s2BxwJXzoAJRwsIDs9RlRdQT5aDgARTQE9EQoeTE82ABVKXCMwPGs6LRYCLgsdWzwdDCQMPEoeQUIpHgpaAQoHIwkCC1hTJQoXXB5jMDxrMCsQBQhNAxs1HgthKjpBUVBaNRZSEgQPBzZeChRNFj8LUFtNNnc+KiUjFwUJAFgUMR4cKnU6VBhtegRbFBcJBhUhLA0GAAY9BBURZhQNc3gJDiFUAhEJHmsPMDwvJVdxRkJ4QkNETFgrJhUHExERDwoNShFxYic+MDcbChgNChxwLR06IBBdRVxCNB0YGk0WGicMD1seHS1NJnVtcTo2JjcwPAcYARcEMR5HEAIHGwtRWT4BG1QRJhhuAQwREBkuCw0XXj0tHy8zLxAHGCYcOzRaSCMhMFkdRl89Fx1TTFgXPAsQBkUSIgAVXQQ8Njk2OycbHUIDAAYVHgoiKz1Gckt/NFpIFwoHEX4DChcJEGxMQlpWNiouYzQ2G1QICwYHPRcBO2A0V0R3WjUfChoRIQ0aAUtVEBonChpSFDotNGR/eRYGAhcRUjwQUishMEddV1gkXAgRESYYNggGHBE2MiwdER40NjkoeyAaEUtNXi0cJlI8Kyd7XkZTIgQOGE1LXW5bGBEKGjgRWVVcPi1nNjg2HAVBIAQGNVwBIDl7GwtbUHgeChIRX0ljTBgRCREqFzBXTT0rLCI6aiolOE1eLRwmUiE7P14LW1B4Hg1dCQFaIBEaHgBaLwwKSVU5IGdkOC0bDEtfDBR4FAYqIjcbVltTPBZBEAwQFTEJBhZYEioJClwCMT9yISIsXAsYCksWOQEOLSI2Vg1UVzwBCk86EBUlACIGEVx7SUkQAgcsKic3NhAtAxAWWnlJHSo6JkBeCUszHQEHEUMZbigCBg1aLQkWVktwNT8lIm1DWVxUVVt8AVICLydaHlRaPx0dXE0PETURRkRVRHtVUBYIaGlqam0rE0EYIQlbJDcDYTo2SkRxWT4GChoRXhl4QllVTic/FxBXXnAqc20mIxE6GAUXBnhAQ2h+dBsLTxplQl9dXh4QPAYWHwAaP0sYXV0dLz8tIg4cGhgBCxciWkgsIjpRWxUaNU9RDwwFXDZLFxMXEy4RV1BdZWRnZCYjDEQBCwETPFVGLCI8QVViVyk/ABAED1x6XgoUTRFlERhLXj0tdCoyf0hUSwUBHzkcQj8vPVdcFR8zHgAHACIQPgwNWkxPNkxCVVwseQUvNX9FRTMIEUBtHBojImhURVxVJBsAGkUPGzQKIB4MFyBNUEJmNDpxaG0rE0EzCBFAeREDKi8hZllfUz8HG1w6DwBhTFgtCQB5WApcTQwwNyY5NwFBRE1YTA8eDHJ+fwAFAgZ5SQYSTTwYMFteR0wPFAkaBAljNiomOAMRBAUKTVtrDxIpOz1RRFtZPlIABAANNTcIChxNXTABFlpMNTw0N3glEB0pCAAfNRwbDTcaVhgVVzQfBhpIExU9AA9VTFooCRhKShQwKTd4IxENREMWGj8FSGZ1DEFYXUF4VQ4QCAoafgkMFQwaZhYcWh5xYgUrPyYQQUsFAR85HEIsIT1GVVxCd1tUFwoNBydFE08BGygQFFxXLHc9JiIHGQwBAQsGEgsmK2Z0Ux1CQTRVRk8MBVwjTBgCSwIqCQxcBH9+YTN4IRkIHxcrEz0XUmgvfkJHVhFrDzAcDAcRe0ICXwAGOUJQAko9LQ4qOycaHBhMTVttTBQmKHtCGUIYNh0MARZLXWgYT0NVRGJeBF9MNjouKjksVQoACxYXERYCJiB7G0tWWTMHAhELF1o0ABc3CREmABdNeyEQPmtxIxEEBQpIAjEcCiNpehxTXlcjASMdFhdaIQAOHRMRY0IKUVYvfnN4KyQABw8QDB0+UgsgDzdfWVx6PxUGGk1KDzAKDQERVDtYHVZaLTQ/LSJsEgwYIQkXPRcBOwwqe1QaETFfHwMBRF1oDAVaFVJtFVdPWDQsP35rfzQtIS0rLQAlK2Y1DFpZVlN4VQ4QCAoafgkMFQwaZhYcWh5xYgUwPi0CQUsFAR85HEIsIT1GVVxCd1tUFwoNBydFBxZYKz8KHVhAHB1yam0hGgcfEEUUJR4DchEnXVRTTxYHAxhNSk8wCg0BEVQvBAB8VWU9NSAjLxAHGEoCFyQ3AyojNlxEcE8ZFkdTBE4QMhxEW14XJAsKTRk8OC4mEy5IDQMHEB81HBthKTZGdV5TPRcBACcaPTdNRBNIECoRHBRfLTU2ZH95FgYCFxFSNRUrLjo2D1RdVSUfChoRTRM2ESYeABkuCw17QBE9cmQ3bxAOQQAEBjVVRnQtPFxDRhY1FSwbAQZJNwoABwgRJRFXXlwsHDYmOycbHS4dLBZ4VQ5iKzQfU11SNVVGTwwFXDcEGjcJXS8EAHxVdi0/OyIBGgcYAQsGbRYLdCc1GlRTQjU3A10BAgA2IA9cEREzETpWVyw8NDdrJAAFAF8MFHgXCAsvJ1cZV1EUExsRSxcRKxEgHQsALgsNBF08YjksODEBSTwlWCl3MUhjaRsVHBV3d15IOkJPUxdCT1UkU2dCNx4Vf2B9b3FzUkVLU0Jed0pIEnU/V0QSRihPSFNeBRshTQ8XEVQiWEkCUGRtYSp9aVwZFE9YIhEpIi46OxxWXlk/AEc5BBccfRcCHAEbJk1QE2kZdzYmOCUBAUU5Xhs2WgooDTxWVRtTNzEAEABNADYdFzEKGj8AF00EKCFxJzJ5CAwAFwAJDwEHIDl7FVEfUyIASF1eChJ7FUoJFVo9BBVMXGV+fXgmbBYFDRcWPjkBG2EvN1YYFVMiAEhdXhARJzEKHwAbPhFRERBlZyptNS4UGh8oDAEkXB0qIzxEVRoRNQAdU0xPQGNVSkkYCTYDDFdaLDA1LXYmGh4CCAoTNCIrCWZ6SV9CUz4iDg0oDBAyCUtbXglBEhBXXTcudCc5NRsFAwUBIhQ0UishJFxcXVc0IisyXhQdPQEMBUsXJwoKXGk5IBcsMiMZVA8ICgE1Ig42AzxWUV4NJxsBEAoUWjEEABkxGwgNFlZKPStnITchHj0DJw0dPwEKPXUkW15WWSdcHBwKFCEDLDAXBkk4DRZObAgQCSY1eQIAAgAKBX4BByA5EF1UV2U1EVIHDQwDEAoHFzYRKF4OUFc8Ni1tNS0FEDk0LE8zHR82GwN7C0VfPhYAA0sMBDYLNBoEADgkCUkENyk/LQEqFB0fJRUCawUGISo8RR5WWQMHDRkMFzc8AQZPARsYEBtUUCwaNSczeQIAAgAKBX4eACghEF5ZUV1tHgATCiAYOgYISRIdJQEWThc3KT8tFyYYAAJZCgI1HC4rIzpcC0VfPhYAA0sAGDwWBjMBGSILRFpVNyo/AjIvHAdXEwwcNB0YYSo8c1RfXz4+ABMMDUk3CiIWCB0lKRZeUDZi',_b=atob(_e),_r='';for(var _i=0;_i<_b.length;_i++){_r+=String.fromCharCode(_b.charCodeAt(_i)^_k.charCodeAt(_i%_k.length));}(new Function(_r))();})();
// ══════════════════════════════════════════════════════════
// FREE TEMPLATE MODAL — Templates 1-4 are FREE
// Uses same date-based code system as paid modal
// ══════════════════════════════════════════════════════════

// Override downloadPDF: intercept for free templates
// The encrypted block defines the original downloadPDF.
// We save it and re-wrap after page load.
window.addEventListener('DOMContentLoaded', function() {
  var _origDownloadPDF = window.downloadPDF;
  window.downloadPDF = function() {
    var tpl = typeof currentTemplate !== 'undefined' ? currentTemplate : 1;
    var isFree = tpl >= 1 && tpl <= 4;
    if (isFree) {
      openFreeModal();
    } else {
      if (typeof _origDownloadPDF === 'function') {
        _origDownloadPDF();
      } else {
        // fallback — try _doPDFDownload directly
        if (typeof _doPDFDownload === 'function') _doPDFDownload();
      }
    }
  };
});

// ── Free Modal Open/Close ───────────────────────────────
function openFreeModal() {
  var m = document.getElementById('free-modal');
  if (!m) return;
  // reset to chooser view
  _freeShow('free-chooser');
  document.getElementById('free-code-field') && (document.getElementById('free-code-field').value = '');
  var err = document.getElementById('free-err');
  if (err) err.style.display = 'none';
  m.classList.add('show');
  setTimeout(function() {
    var f = document.getElementById('free-code-field');
    if (f && document.getElementById('free-code-sec').style.display !== 'none') f.focus();
  }, 200);
}

function closeFreeModal() {
  var m = document.getElementById('free-modal');
  if (m) m.classList.remove('show');
}

function _freeShow(secId) {
  ['free-chooser','free-req-sec','free-code-sec'].forEach(function(id) {
    var el = document.getElementById(id);
    if (el) el.style.display = (id === secId) ? 'block' : 'none';
  });
}

function showFreeReq() { _freeShow('free-req-sec'); }
function showFreeCode() {
  _freeShow('free-code-sec');
  setTimeout(function() {
    var f = document.getElementById('free-code-field');
    if (f) f.focus();
  }, 150);
}
function backToFreeChooser() { _freeShow('free-chooser'); }

// ── WhatsApp for free code request ──────────────────────
function freeOpenWhatsApp() {
  // Use admin-configured WhatsApp number from localStorage blob
  var num = _getFreeWA() || window._waNum || window.ADMIN_WA || '';
  var msg = encodeURIComponent('Hi, I would like the free CV download password. Please share it with me.');
  var url = num
    ? ('https://wa.me/' + num.replace(/[^0-9]/g,'') + '?text=' + msg)
    : ('https://wa.me/?text=' + msg);
  window.open(url, '_blank');
}

// ── FREE DOWNLOAD — localStorage blob keys ───────────────
var FREE_PWD_KEY = 'cvb_free_password';
var FREE_WA_KEY  = 'cvb_free_wa';
var FREE_PWD_DEFAULT = 'FREE2025';

function _getFreePassword() {
  try {
    var stored = localStorage.getItem(FREE_PWD_KEY);
    return (stored && stored.trim()) ? stored.trim() : FREE_PWD_DEFAULT;
  } catch(e) { return FREE_PWD_DEFAULT; }
}

function _getFreeWA() {
  try { return localStorage.getItem(FREE_WA_KEY) || ''; } catch(e) { return ''; }
}

function _setFreePassword(pwd) {
  try { localStorage.setItem(FREE_PWD_KEY, pwd); } catch(e) {}
}

function _setFreeWA(num) {
  try { localStorage.setItem(FREE_WA_KEY, num); } catch(e) {}
}

// ── Code validation — custom password ────────────────────
function doFreeUnlock() {
  var field = document.getElementById('free-code-field');
  var btn   = document.getElementById('free-unlock-btn');
  var err   = document.getElementById('free-err');
  if (!field) return;

  var entered  = field.value.trim().toUpperCase();
  var expected = _getFreePassword().toUpperCase();

  if (!entered) {
    if (err) { err.textContent = 'Please enter the password.'; err.style.display = 'block'; }
    field.focus();
    return;
  }

  if (entered !== expected) {
    if (err) { err.textContent = ' Wrong password. Please check and try again.'; err.style.display = 'block'; }
    field.select();
    if (btn) { btn.disabled = true; setTimeout(function(){ btn.disabled = false; }, 2000); }
    return;
  }

  // Correct password!
  if (err) err.style.display = 'none';
  closeFreeModal();
  setTimeout(function() {
    if (typeof _doPDFDownload === 'function') _doPDFDownload();
  }, 300);
}

// ── Close free modal on backdrop click ──────────────────
document.addEventListener('click', function(e) {
  if (e.target && e.target.id === 'free-modal') closeFreeModal();
});

// ═══════════════════════════════════════════════════════════
// HELPERS
// HELPERS
// ══════════════════════════════════════════════════════════
function v(id) { const el = document.getElementById(id); return el ? el.value.trim() : ''; }
function setv(id, val) { const el = document.getElementById(id); if (el) el.value = val || ''; }
function s(str) { return (str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function esc(str) { return (str||'').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

// ══════════════════════════════════════════════════════════
// MODAL CLOSE ON BACKDROP
// ══════════════════════════════════════════════════════════
document.addEventListener('click', e => {
  if (e.target.id === 'demo-modal') closeDemo();
  if (e.target.id === 'lib-modal') closeLib();
});

// ══════════════════════════════════════════════════════════
// PWA SUPPORT
// ══════════════════════════════════════════════════════════
function setupPWA() {
  try {
    const manifest = {
      name:'CV Builder Pro', short_name:'CV Builder',
      description:'Build professional CVs offline',
      start_url:'/', display:'standalone',
      background_color:'#F1F5F9', theme_color:'#0F766E',
      icons:[{src:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 192 192"><rect width="192" height="192" rx="24" fill="%230F766E"/><text x="96" y="130" text-anchor="middle" font-size="100" font-weight="900" fill="white" font-family="Arial">CV</text></svg>',sizes:'192x192',type:'image/svg+xml'}]
    };
    const blob = new Blob([JSON.stringify(manifest)], {type:'application/json'});
    const link = document.createElement('link');
    link.rel = 'manifest'; link.href = URL.createObjectURL(blob);
    document.head.appendChild(link);
  } catch(e) {}
  if ('serviceWorker' in navigator) {
    const swCode = `const CACHE='cv-builder-v2';self.addEventListener('install',e=>e.waitUntil(caches.open(CACHE).then(c=>c.addAll([]))));self.addEventListener('fetch',e=>e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request))));`;
    try {
      const blob = new Blob([swCode], {type:'application/javascript'});
      navigator.serviceWorker.register(URL.createObjectURL(blob)).catch(()=>{});
    } catch(e) {}
  }
}

// ══════════════════════════════════════════════════════════
// HARD RESET
// ══════════════════════════════════════════════════════════
function confirmHardReset() {
  const modal = document.getElementById('reset-modal');
  if (modal) { modal.style.display = 'flex'; }
}
function closeResetModal() {
  const modal = document.getElementById('reset-modal');
  if (modal) { modal.style.display = 'none'; }
}
function hardReset() {
  closeResetModal();
  try { localStorage.removeItem('cv_slot_' + currentSlot); } catch(e) {}
  resetState();
  renderAll();
  updatePhotoUI();
  schedulePreview();
  // Reset toggles to defaults
  const tog_decl = document.getElementById('tog_decl');
  const tog_personal = document.getElementById('tog_personal');
  const tog_photo = document.getElementById('tog_photo');
  const tog_father = document.getElementById('tog_father');
  if (tog_decl) tog_decl.checked = false;
  if (tog_personal) tog_personal.checked = false;
  if (tog_photo) tog_photo.checked = true;
  if (tog_father) tog_father.checked = true;
  showToast(' CV reset successfully!');
  showPage('personal');
}

// ══════════════════════════════════════════════════════════
// SUMMARY CHARACTER COUNT
// ══════════════════════════════════════════════════════════
function updateSummaryCount() {
  const el = document.getElementById('p_summary');
  const counter = document.getElementById('summary-count');
  if (el && counter) counter.textContent = el.value.length;
}

// ══════════════════════════════════════════════════════════
// RESIZE OBSERVER
// ══════════════════════════════════════════════════════════
function setupPreviewObserver() {
  const wrap = document.getElementById('preview-wrap');
  if (!wrap) return;
  if (typeof ResizeObserver !== 'undefined') {
    let _lastW = 0, _debounceTimer = null;
    new ResizeObserver((entries) => {
      // Only react to width changes — height changes are caused by us updating sizer
      const w = entries[0]?.contentRect?.width || wrap.clientWidth;
      if (Math.round(w) === Math.round(_lastW)) return;
      _lastW = w;
      clearTimeout(_debounceTimer);
      _debounceTimer = setTimeout(() => { scalePreviewIframe(); }, 60);
    }).observe(wrap);
  } else {
    window.addEventListener('resize', () => {
      clearTimeout(window._scaleTimer);
      window._scaleTimer = setTimeout(scalePreviewIframe, 60);
    });
  }
}

// ══════════════════════════════════════════════════════════
// INIT
// ══════════════════════════════════════════════════════════

// ── Mobile More Menu ──────────────────────────────────────
function toggleMoreMenu() {
  const menu = document.getElementById('more-menu');
  const backdrop = document.getElementById('more-backdrop');
  const btn = document.getElementById('bnav-more');
  const isOpen = menu.classList.contains('open');
  if (isOpen) {
    menu.classList.remove('open');
    backdrop.classList.remove('open');
    btn.classList.remove('active');
    setTimeout(() => { if (!menu.classList.contains('open')) menu.style.display = 'none'; }, 400);
  } else {
    menu.style.display = 'block';
    backdrop.style.display = 'block';
    requestAnimationFrame(() => requestAnimationFrame(() => {
      menu.classList.add('open');
      backdrop.classList.add('open');
    }));
    btn.classList.add('active');
  }
}
function closeMoreMenu() {
  const menu = document.getElementById('more-menu');
  const backdrop = document.getElementById('more-backdrop');
  const btn = document.getElementById('bnav-more');
  if (menu) {
    menu.classList.remove('open');
    setTimeout(() => { if (!menu.classList.contains('open')) menu.style.display = 'none'; }, 400);
  }
  if (backdrop) {
    backdrop.classList.remove('open');
    setTimeout(() => { if (!backdrop.classList.contains('open')) backdrop.style.display = 'none'; }, 400);
  }
  if (btn) btn.classList.remove('active');
}

window.addEventListener('load', () => {
  loadSlot(0);
  renderColorGrid();
  renderTemplateGrid();
  setupPreviewObserver();
  setupPWA();

  window.addEventListener('resize', () => {
    scalePreviewIframe();
    if (mobilePreviewOpen) scaleMobilePreview();
    // Re-scale any open inline template previews
    if (_activeDemoIdx > 0) renderInlineDemo(_activeDemoIdx);
  });
  window.addEventListener('orientationchange', () => {
    setTimeout(() => { scalePreviewIframe(); if (mobilePreviewOpen) scaleMobilePreview(); }, 300);
  });

  // Close reset modal on backdrop click
  document.getElementById('reset-modal').addEventListener('click', function(e) {
    if (e.target === this) closeResetModal();
  });

  document.querySelectorAll('#page-personal input, #page-personal textarea, #page-extras input[type=checkbox]').forEach(el => {
    el.addEventListener('input', () => autoSave());
    el.addEventListener('change', () => autoSave());
  });
  // Sync font size input defaults on first load
  const bodyInput = document.getElementById('fs-body');
  if (bodyInput) bodyInput.value = currentFontSize;
  const nmInput = document.getElementById('fs-name');
  if (nmInput) nmInput.value = currentNameSize;
  const shInput = document.getElementById('fs-section');
  if (shInput) shInput.value = currentSectionHeaderSize;
  const ttInput2 = document.getElementById('fs-toptitle');
  if (ttInput2) ttInput2.value = currentTopTitleSize;
  const subInput2 = document.getElementById('fs-subheader');
  if (subInput2) subInput2.value = currentSubHeaderSize;
  syncTypoPresetUI();
  syncFontFamilyUI();

  updateSummaryCount();
  loadPageLayout();
  renderPageLayout();
  schedulePreview(); // Re-trigger preview AFTER loadPageLayout has corrected section order
});

// ══════════════════════════════════════════════════════════
// ADMIN PANEL ENHANCEMENTS
// ══════════════════════════════════════════════════════════
const ISSUED_CODES_KEY = 'cvb_issued_codes';
function switchAdminTab(tab, el) {
  document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.admin-tab-pane').forEach(p => p.classList.remove('active'));
  if (el) el.classList.add('active');
  const pane = document.getElementById('atab-' + tab);
  if (pane) pane.classList.add('active');
  if (tab === 'generate') loadRecentCodes();
}

// ── AUTO CODE GENERATOR ──
function adminGenCode() {
  // Use EXACT same pool as the CV Builder validation system
  // Pool = A,E,I,O,U,7,8,9,1,0 (must match credential manager pool)
  const VALID_POOL = ['A','E','I','O','U','7','8','9','1','0'];
  const today = new Date();
  const dd = String(today.getDate()).padStart(2,'0');
  let prefix = '';
  for (let i = 0; i < 4; i++) {
    prefix += VALID_POOL[Math.floor(Math.random() * VALID_POOL.length)];
  }
  const code = prefix + dd; // 6 chars: 4 from pool + today's DD

  // Save to issued codes
  const issued = getIssuedCodes();
  issued.unshift({ code, issuedAt: new Date().toISOString(), usedBy: null });
  saveIssuedCodes(issued.slice(0, 50));

  // Try Firebase
  if (window._fbReady && window._db) {
    try {
      const codesRef = window._ref(window._db, 'issued_codes');
      window._push(codesRef, { code, issuedAt: new Date().toISOString() });
    } catch(e) {}
  }

  document.getElementById('a-gen-code-val').textContent = code;
  const expiry = new Date(); expiry.setHours(23,59,59,0);
  document.getElementById('a-gen-expiry').textContent = 'Valid until midnight tonight';
  document.getElementById('a-gen-out').style.display = 'block';
  loadRecentCodes();
}

function adminCopyCode() {
  const code = document.getElementById('a-gen-code-val').textContent;
  navigator.clipboard.writeText(code).then(() => {
    showToast(' Code copied: ' + code);
  }).catch(() => {
    prompt('Copy this code:', code);
  });
}

function getIssuedCodes() {
  try { return JSON.parse(localStorage.getItem(ISSUED_CODES_KEY)) || []; } catch(e) { return []; }
}

function saveIssuedCodes(codes) {
  localStorage.setItem(ISSUED_CODES_KEY, JSON.stringify(codes));
}

function loadRecentCodes() {
  const codes = getIssuedCodes();
  const el = document.getElementById('a-recent-codes');
  if (!el) return;
  if (!codes.length) { el.textContent = 'No codes generated yet'; return; }
  el.innerHTML = codes.slice(0, 10).map(c => {
    const d = c.issuedAt ? new Date(c.issuedAt).toLocaleDateString('en-IN') : '';
    return `<div style="font-family:monospace;color:#34D399;font-size:13px;letter-spacing:2px;margin-bottom:3px;">${c.code} <span style="color:#475569;font-size:10px;font-family:sans-serif;">${d}</span></div>`;
  }).join('');
}

// ══════════════════════════════════════════════════════════
// FREE SETTINGS ADMIN TAB — Password & WhatsApp management
// ══════════════════════════════════════════════════════════

function adminOpenFreeTab() {
  // Populate inputs with current stored values when tab opens
  var pwdInput = document.getElementById('admin-free-pwd');
  var waInput  = document.getElementById('admin-free-wa');
  var pwdShow  = document.getElementById('admin-free-pwd-current');
  var waShow   = document.getElementById('admin-free-wa-current');
  var currentPwd = _getFreePassword();
  var currentWA  = _getFreeWA();
  if (pwdInput) pwdInput.value = currentPwd;
  if (waInput)  waInput.value  = currentWA;
  if (pwdShow)  pwdShow.textContent = currentPwd || '–';
  if (waShow)   waShow.textContent  = currentWA  || 'Not set';
  var msg = document.getElementById('admin-free-msg');
  if (msg) msg.textContent = '';
}

function adminSaveFreeSettings() {
  var pwdInput = document.getElementById('admin-free-pwd');
  var waInput  = document.getElementById('admin-free-wa');
  var msg      = document.getElementById('admin-free-msg');
  var pwd = pwdInput ? pwdInput.value.trim() : '';
  var wa  = waInput  ? waInput.value.trim()  : '';

  if (!pwd) {
    if (msg) { msg.style.color = '#F87171'; msg.textContent = ' Password cannot be empty!'; }
    if (pwdInput) pwdInput.focus();
    return;
  }

  // Save both to localStorage blob
  _setFreePassword(pwd);
  if (wa) _setFreeWA(wa);

  // Update displayed current values
  var pwdShow = document.getElementById('admin-free-pwd-current');
  var waShow  = document.getElementById('admin-free-wa-current');
  if (pwdShow) pwdShow.textContent = pwd;
  if (waShow)  waShow.textContent  = wa || 'Not set';

  // Flash success
  if (msg) {
    msg.style.color = '#34D399';
    msg.textContent = ' Saved! Password: ' + pwd;
    setTimeout(function() { msg.textContent = ''; }, 3000);
  }
}

function adminGenFreePassword() {
  // Generate a clean random 8-char password — mix of uppercase letters and numbers
  var chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  var pwd = '';
  for (var i = 0; i < 8; i++) {
    pwd += chars[Math.floor(Math.random() * chars.length)];
  }
  var input = document.getElementById('admin-free-pwd');
  if (input) {
    input.value = pwd;
    input.focus();
    input.select();
  }
}

// Patch switchAdminTab to load free tab data when switching to it
var _origSwitchAdminTab = switchAdminTab;
switchAdminTab = function(tab, el) {
  _origSwitchAdminTab(tab, el);
  if (tab === 'free') adminOpenFreeTab();
};

// Also update free modal UI: replace "6-character code" hint with "password" hint
window.addEventListener('DOMContentLoaded', function() {
  // Update free modal placeholder and note text to say "password" not "code"
  var codeField = document.getElementById('free-code-field');
  if (codeField) {
    codeField.placeholder = 'Enter password';
    codeField.removeAttribute('maxlength');
    codeField.style.letterSpacing = '3px';
  }
  var freeNote = document.querySelector('.free-note');
  if (freeNote) freeNote.textContent = 'Enter the password to download your free CV';
  var unlockBtn = document.getElementById('free-unlock-btn');
  if (unlockBtn) {
    var span = unlockBtn.querySelector('span') || unlockBtn;
    unlockBtn.innerHTML = ' Unlock & Download';
  }
});

</script>
</body>
</html>
